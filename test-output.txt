bun test v1.3.2 (b131639c)

test/debug-doc-decorator.test.ts:
ğŸ§ª TESTING DOC DECORATOR EQUIVALENT

test/effect-patterns.test.ts:
timestamp=2025-11-18T20:59:24.686Z level=INFO fiber=#0 message="Starting successful chain"
timestamp=2025-11-18T20:59:24.689Z level=INFO fiber=#1 message="Starting error chain"
timestamp=2025-11-18T20:59:24.693Z level=INFO fiber=#7 message="ğŸ”§ Initializing Test Service..." message={}
timestamp=2025-11-18T20:59:24.694Z level=INFO fiber=#7 message="âœ… Test Service initialized successfully"
timestamp=2025-11-18T20:59:24.694Z level=INFO fiber=#8 message="Error context: Test error"
timestamp=2025-11-18T20:59:24.720Z level=INFO fiber=#9 message="Operation completed in 24.39ms"
timestamp=2025-11-18T20:59:24.896Z level=INFO fiber=#11 message="ğŸ”§ Initializing Pipeline Test..." message={}
timestamp=2025-11-18T20:59:24.896Z level=INFO fiber=#11 message="âœ… Pipeline Test initialized successfully"

test/debug-diagnostic-isolation.test.ts:
ğŸ§ª ISOLATING DIAGNOSTIC RESOLUTION ISSUE

test/debug-types-test.test.ts:
ğŸ§ª TESTING WORKING TYPESPEC TYPES

test/performance-benchmarks.test.ts:
ğŸ’¥ ERROR: initializeCacheMetrics is not defined
ğŸ“ Files added, testing compilation...
ğŸ“ Files added, testing diagnostic isolation...
ğŸ’¥ ERROR: Unexpected diagnostics:
/test/types-test.tsp:19:1 - error blockless-namespace-first: Blockless namespaces can't follow other declarations.
/test/types-test.tsp:24:11 - undefined @lars-artmann/typespec-asyncapi.invalid-server-config: undefined
/test/types-test.tsp:7:12 - error missing-implementation: Extern declaration must have an implementation in JS file.
/test/types-test.tsp:10:12 - error missing-implementation: Extern declaration must have an implementation in JS file.
/test/types-test.tsp:13:12 - error missing-implementation: Extern declaration must have an implementation in JS file.
/test/types-test.tsp:16:12 - error missing-implementation: Extern declaration must have an implementation in JS file.
ğŸ“‹ Stack: AssertionError [ERR_ASSERTION]: Unexpected diagnostics:
/test/types-test.tsp:19:1 - error blockless-namespace-first: Blockless namespaces can't follow other declarations.
/test/types-test.tsp:24:11 - undefined @lars-artmann/typespec-asyncapi.invalid-server-config: undefined
/test/types-test.tsp:7:12 - error missing-implementation: Extern declaration must have an implementation in JS file.
/test/types-test.tsp:10:12 - error missing-implementation: Extern declaration must have an implementation in JS file.
/test/types-test.tsp:13:12 - error missing-implementation: Extern declaration must have an implementation in JS file.
/test/types-test.tsp:16:12 - error missing-implementation: Extern declaration must have an implementation in JS file.
    at expectDiagnosticEmpty (/Users/larsartmann/projects/typespec-asyncapi/node_modules/@typespec/compiler/dist/src/testing/expect.js:13:9)
    at compile (/Users/larsartmann/projects/typespec-asyncapi/node_modules/@typespec/compiler/dist/src/testing/test-host.js:51:9)
    at processTicksAndRejections (native:7:39)
ğŸ’¥ ERROR: Unexpected diagnostics:
/test/diagnostic-test.tsp:11:11 - undefined @lars-artmann/typespec-asyncapi.invalid-server-config: undefined
ğŸ“‹ Stack: AssertionError [ERR_ASSERTION]: Unexpected diagnostics:
/test/diagnostic-test.tsp:11:11 - undefined @lars-artmann/typespec-asyncapi.invalid-server-config: undefined
    at expectDiagnosticEmpty (/Users/larsartmann/projects/typespec-asyncapi/node_modules/@typespec/compiler/dist/src/testing/expect.js:13:9)
    at compile (/Users/larsartmann/projects/typespec-asyncapi/node_modules/@typespec/compiler/dist/src/testing/test-host.js:51:9)
    at processTicksAndRejections (native:7:39)
timestamp=2025-11-18T20:59:26.041Z level=INFO fiber=#12 message="TypeSpec compilation completed in 898.65ms"
timestamp=2025-11-18T20:59:26.096Z level=INFO fiber=#14 message="Memory usage delta: 8.48MB"
timestamp=2025-11-18T20:59:26.205Z level=INFO fiber=#15 message="Processed 50 operations in 0.107s"
timestamp=2025-11-18T20:59:26.205Z level=INFO fiber=#15 message="Throughput: 467.19 ops/sec"
timestamp=2025-11-18T20:59:26.845Z level=INFO fiber=#16 message="Processed 100 nodes in 639.09ms"
timestamp=2025-11-18T20:59:26.846Z level=INFO fiber=#16 message="Memory usage: 0.32MB"

test/debug-emitfile.test.ts:
ğŸ” DEBUG: Starting minimal emitFile test
ğŸ” DEBUG: Compiling with test framework...

test/debug-minimal-server.test.ts:
ğŸ§ª TESTING MINIMAL @server REPRODUCTION

test/advanced-decorators.test.ts:
ğŸ” DEBUG: Error caught: Unexpected diagnostics:
/test/main.tsp:2:1 - error duplicate-using: duplicate using of "TypeSpec.AsyncAPI" namespace
/test/main.tsp:4:1 - error duplicate-using: duplicate using of "TypeSpec.AsyncAPI" namespace
/test/main.tsp:10:11 - undefined @lars-artmann/typespec-asyncapi.invalid-server-config: undefined
ğŸ” DEBUG: Error stack: AssertionError [ERR_ASSERTION]: Unexpected diagnostics:
/test/main.tsp:2:1 - error duplicate-using: duplicate using of "TypeSpec.AsyncAPI" namespace
/test/main.tsp:4:1 - error duplicate-using: duplicate using of "TypeSpec.AsyncAPI" namespace
/test/main.tsp:10:11 - undefined @lars-artmann/typespec-asyncapi.invalid-server-config: undefined
    at expectDiagnosticEmpty (/Users/larsartmann/projects/typespec-asyncapi/node_modules/@typespec/compiler/dist/src/testing/expect.js:13:9)
    at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/node_modules/@typespec/compiler/dist/src/testing/tester.js:361:13)
    at processTicksAndRejections (native:7:39)
ğŸ“ Files added, attempting compilation...
ğŸ’¥ ERROR: Unexpected diagnostics:
/test/minimal.tsp:11:11 - undefined @lars-artmann/typespec-asyncapi.invalid-server-config: undefined
ğŸ“‹ Stack: AssertionError [ERR_ASSERTION]: Unexpected diagnostics:
/test/minimal.tsp:11:11 - undefined @lars-artmann/typespec-asyncapi.invalid-server-config: undefined
    at expectDiagnosticEmpty (/Users/larsartmann/projects/typespec-asyncapi/node_modules/@typespec/compiler/dist/src/testing/expect.js:13:9)
    at compile (/Users/larsartmann/projects/typespec-asyncapi/node_modules/@typespec/compiler/dist/src/testing/test-host.js:51:9)
    at processTicksAndRejections (native:7:39)

test/debug-server-decorator.test.ts:
Mock diagnostic: {
  code: "@lars-artmann/typespec-asyncapi.invalid-server-config",
  target: {
    kind: "Namespace",
    name: "TestNamespace",
  },
  serverName: "unknown",
  error: "Configuration must be an object",
}
âœ… Server decorator called successfully

test/documentation/README.test.ts:
OrderCreatedEvent not found in schemas - inheritance may not be implemented

test/unit/emitter-core.test.ts:
timestamp=2025-11-18T20:59:38.710Z level=INFO fiber=#17 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:38.711Z level=INFO fiber=#17 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:38.713Z level=INFO fiber=#17 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:38.713Z level=INFO fiber=#17 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:38.714Z level=INFO fiber=#17 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:38.714Z level=INFO fiber=#17 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:38.714Z level=INFO fiber=#17 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:38.714Z level=INFO fiber=#17 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:38.714Z level=INFO fiber=#17 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:38.714Z level=INFO fiber=#17 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:38.714Z level=INFO fiber=#17 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:38.714Z level=INFO fiber=#17 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:38.715Z level=INFO fiber=#17 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:38.715Z level=INFO fiber=#17 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:38.715Z level=INFO fiber=#17 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:38.716Z level=INFO fiber=#17 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:38.716Z level=INFO fiber=#17 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:38.716Z level=INFO fiber=#17 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:38.717Z level=INFO fiber=#17 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:38.717Z level=INFO fiber=#17 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:38.718Z level=INFO fiber=#17 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:38.718Z level=INFO fiber=#17 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:38.718Z level=INFO fiber=#17 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:38.718Z level=INFO fiber=#17 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:38.719Z level=INFO fiber=#17 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:38.719Z level=INFO fiber=#17 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:38.719Z level=INFO fiber=#17 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:38.719Z level=INFO fiber=#17 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.43ms)"
timestamp=2025-11-18T20:59:38.720Z level=INFO fiber=#17 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:38.720Z level=INFO fiber=#17 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:38.720Z level=INFO fiber=#17 message="ğŸ” Emitting file: basic.json"
timestamp=2025-11-18T20:59:38.720Z level=INFO fiber=#17 message="ğŸ” Emitting file: basic.json"
timestamp=2025-11-18T20:59:38.720Z level=INFO fiber=#17 message="ğŸ” Emitting file: basic.json"
timestamp=2025-11-18T20:59:38.721Z level=INFO fiber=#17 message="âœ… File emitted: basic.json"
timestamp=2025-11-18T20:59:38.721Z level=INFO fiber=#17 message="âœ… File emitted: basic.json"
timestamp=2025-11-18T20:59:38.721Z level=INFO fiber=#17 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:38.721Z level=INFO fiber=#17 message="âœ… File emitted: basic.json"
timestamp=2025-11-18T20:59:38.721Z level=INFO fiber=#17 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:38.722Z level=INFO fiber=#18 message="âœ… Generated AsyncAPI specification: basic.json"
92 | 	const outputFile = Object.keys(result.outputs).find(
93 | 		f => f.endsWith(".yaml") || f.endsWith(".json"),
94 | 	)
95 | 
96 | 	if (!outputFile) {
97 | 		throw new Error("No AsyncAPI output generated")
                 ^
error: No AsyncAPI output generated
      at compileAsyncAPI (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:97:13)
      at async compileAsyncAPIWithoutErrors (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:127:23)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/emitter-core.test.ts:24:25)
(fail) AsyncAPI Emitter Core (NEW API) > Basic Compilation > should compile simple TypeSpec model to AsyncAPI [91.31ms]
timestamp=2025-11-18T20:59:38.788Z level=INFO fiber=#19 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:38.788Z level=INFO fiber=#19 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:38.789Z level=INFO fiber=#19 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:38.789Z level=INFO fiber=#19 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:38.789Z level=INFO fiber=#19 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:38.789Z level=INFO fiber=#19 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:38.789Z level=INFO fiber=#19 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:38.789Z level=INFO fiber=#19 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:38.789Z level=INFO fiber=#19 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:38.789Z level=INFO fiber=#19 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:38.789Z level=INFO fiber=#19 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:38.789Z level=INFO fiber=#19 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:38.789Z level=INFO fiber=#19 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:38.789Z level=INFO fiber=#19 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:38.789Z level=INFO fiber=#19 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:38.789Z level=INFO fiber=#19 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:38.793Z level=INFO fiber=#19 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:38.793Z level=INFO fiber=#19 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:38.793Z level=INFO fiber=#19 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:38.793Z level=INFO fiber=#19 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:38.793Z level=INFO fiber=#19 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:38.793Z level=INFO fiber=#19 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:38.793Z level=INFO fiber=#19 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:38.793Z level=INFO fiber=#19 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:38.793Z level=INFO fiber=#19 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:38.793Z level=INFO fiber=#19 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:38.793Z level=INFO fiber=#19 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:38.793Z level=INFO fiber=#19 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:38.793Z level=INFO fiber=#19 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:38.793Z level=INFO fiber=#19 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:38.793Z level=INFO fiber=#19 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:38.793Z level=INFO fiber=#19 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.06ms)"
timestamp=2025-11-18T20:59:38.793Z level=INFO fiber=#19 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:38.793Z level=INFO fiber=#19 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:38.794Z level=INFO fiber=#19 message="ğŸ” Emitting file: complex.json"
timestamp=2025-11-18T20:59:38.794Z level=INFO fiber=#19 message="ğŸ” Emitting file: complex.json"
timestamp=2025-11-18T20:59:38.794Z level=INFO fiber=#19 message="ğŸ” Emitting file: complex.json"
timestamp=2025-11-18T20:59:38.794Z level=INFO fiber=#19 message="âœ… File emitted: complex.json"
timestamp=2025-11-18T20:59:38.794Z level=INFO fiber=#19 message="âœ… File emitted: complex.json"
timestamp=2025-11-18T20:59:38.794Z level=INFO fiber=#19 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:38.794Z level=INFO fiber=#19 message="âœ… File emitted: complex.json"
timestamp=2025-11-18T20:59:38.794Z level=INFO fiber=#19 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:38.794Z level=INFO fiber=#20 message="âœ… Generated AsyncAPI specification: complex.json"
92 | 	const outputFile = Object.keys(result.outputs).find(
93 | 		f => f.endsWith(".yaml") || f.endsWith(".json"),
94 | 	)
95 | 
96 | 	if (!outputFile) {
97 | 		throw new Error("No AsyncAPI output generated")
                 ^
error: No AsyncAPI output generated
      at compileAsyncAPI (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:97:13)
      at async compileAsyncAPIWithoutErrors (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:127:23)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/emitter-core.test.ts:39:25)
(fail) AsyncAPI Emitter Core (NEW API) > Basic Compilation > should handle complex nested models [70.81ms]
timestamp=2025-11-18T20:59:38.837Z level=INFO fiber=#21 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:38.837Z level=INFO fiber=#21 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:38.837Z level=INFO fiber=#21 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:38.837Z level=INFO fiber=#21 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:38.837Z level=INFO fiber=#21 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:38.837Z level=INFO fiber=#21 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:38.837Z level=INFO fiber=#21 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:38.837Z level=INFO fiber=#21 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:38.837Z level=INFO fiber=#21 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:38.837Z level=INFO fiber=#21 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:38.837Z level=INFO fiber=#21 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:38.837Z level=INFO fiber=#21 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:38.837Z level=INFO fiber=#21 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:38.837Z level=INFO fiber=#21 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:38.837Z level=INFO fiber=#21 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:38.837Z level=INFO fiber=#21 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:38.837Z level=INFO fiber=#21 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:38.837Z level=INFO fiber=#21 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:38.837Z level=INFO fiber=#21 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:38.837Z level=INFO fiber=#21 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:38.837Z level=INFO fiber=#21 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:38.838Z level=INFO fiber=#21 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:38.838Z level=INFO fiber=#21 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:38.838Z level=INFO fiber=#21 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:38.838Z level=INFO fiber=#21 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:38.838Z level=INFO fiber=#21 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:38.838Z level=INFO fiber=#21 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:38.838Z level=INFO fiber=#21 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:38.838Z level=INFO fiber=#21 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:38.838Z level=INFO fiber=#21 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:38.838Z level=INFO fiber=#21 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:38.838Z level=INFO fiber=#21 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.03ms)"
timestamp=2025-11-18T20:59:38.838Z level=INFO fiber=#21 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:38.838Z level=INFO fiber=#21 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:38.838Z level=INFO fiber=#21 message="ğŸ” Emitting file: documented.json"
timestamp=2025-11-18T20:59:38.838Z level=INFO fiber=#21 message="ğŸ” Emitting file: documented.json"
timestamp=2025-11-18T20:59:38.838Z level=INFO fiber=#21 message="ğŸ” Emitting file: documented.json"
timestamp=2025-11-18T20:59:38.838Z level=INFO fiber=#21 message="âœ… File emitted: documented.json"
timestamp=2025-11-18T20:59:38.838Z level=INFO fiber=#21 message="âœ… File emitted: documented.json"
timestamp=2025-11-18T20:59:38.838Z level=INFO fiber=#21 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:38.838Z level=INFO fiber=#21 message="âœ… File emitted: documented.json"
timestamp=2025-11-18T20:59:38.838Z level=INFO fiber=#21 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:38.838Z level=INFO fiber=#22 message="âœ… Generated AsyncAPI specification: documented.json"
92 | 	const outputFile = Object.keys(result.outputs).find(
93 | 		f => f.endsWith(".yaml") || f.endsWith(".json"),
94 | 	)
95 | 
96 | 	if (!outputFile) {
97 | 		throw new Error("No AsyncAPI output generated")
                 ^
error: No AsyncAPI output generated
      at compileAsyncAPI (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:97:13)
      at async compileAsyncAPIWithoutErrors (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:127:23)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/emitter-core.test.ts:54:25)
(fail) AsyncAPI Emitter Core (NEW API) > Basic Compilation > should preserve TypeSpec documentation [44.19ms]
timestamp=2025-11-18T20:59:38.941Z level=INFO fiber=#23 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:38.942Z level=INFO fiber=#23 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:38.943Z level=INFO fiber=#23 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:38.943Z level=INFO fiber=#23 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:38.943Z level=INFO fiber=#23 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:38.944Z level=INFO fiber=#23 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:38.944Z level=INFO fiber=#23 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:38.944Z level=INFO fiber=#23 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:38.944Z level=INFO fiber=#23 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:38.945Z level=INFO fiber=#23 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:38.946Z level=INFO fiber=#23 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:38.946Z level=INFO fiber=#23 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:38.946Z level=INFO fiber=#23 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:38.946Z level=INFO fiber=#23 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:38.946Z level=INFO fiber=#23 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:38.946Z level=INFO fiber=#23 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:38.946Z level=INFO fiber=#23 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:38.946Z level=INFO fiber=#23 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:38.946Z level=INFO fiber=#23 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:38.946Z level=INFO fiber=#23 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:38.946Z level=INFO fiber=#23 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:38.947Z level=INFO fiber=#23 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:38.947Z level=INFO fiber=#23 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:38.947Z level=INFO fiber=#23 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:38.948Z level=INFO fiber=#23 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:38.948Z level=INFO fiber=#23 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:38.948Z level=INFO fiber=#23 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:38.948Z level=INFO fiber=#23 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:38.948Z level=INFO fiber=#23 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:38.948Z level=INFO fiber=#23 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:38.948Z level=INFO fiber=#23 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:38.948Z level=INFO fiber=#23 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.07ms)"
timestamp=2025-11-18T20:59:38.948Z level=INFO fiber=#23 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:38.948Z level=INFO fiber=#23 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:38.949Z level=INFO fiber=#23 message="ğŸ” Emitting file: json-test.json"
timestamp=2025-11-18T20:59:38.949Z level=INFO fiber=#23 message="ğŸ” Emitting file: json-test.json"
timestamp=2025-11-18T20:59:38.949Z level=INFO fiber=#23 message="ğŸ” Emitting file: json-test.json"
timestamp=2025-11-18T20:59:38.949Z level=INFO fiber=#23 message="âœ… File emitted: json-test.json"
timestamp=2025-11-18T20:59:38.949Z level=INFO fiber=#23 message="âœ… File emitted: json-test.json"
timestamp=2025-11-18T20:59:38.949Z level=INFO fiber=#23 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:38.949Z level=INFO fiber=#23 message="âœ… File emitted: json-test.json"
timestamp=2025-11-18T20:59:38.949Z level=INFO fiber=#23 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:38.950Z level=INFO fiber=#24 message="âœ… Generated AsyncAPI specification: json-test.json"
92 | 	const outputFile = Object.keys(result.outputs).find(
93 | 		f => f.endsWith(".yaml") || f.endsWith(".json"),
94 | 	)
95 | 
96 | 	if (!outputFile) {
97 | 		throw new Error("No AsyncAPI output generated")
                 ^
error: No AsyncAPI output generated
      at compileAsyncAPI (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:97:13)
      at async compileAsyncAPIWithoutErrors (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:127:23)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/emitter-core.test.ts:79:25)
(fail) AsyncAPI Emitter Core (NEW API) > Output Formats > should generate valid JSON output [111.62ms]
timestamp=2025-11-18T20:59:39.003Z level=INFO fiber=#25 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:39.003Z level=INFO fiber=#25 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:39.003Z level=INFO fiber=#25 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:39.003Z level=INFO fiber=#25 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:39.003Z level=INFO fiber=#25 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:39.003Z level=INFO fiber=#25 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:39.003Z level=INFO fiber=#25 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:39.003Z level=INFO fiber=#25 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:39.003Z level=INFO fiber=#25 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:39.003Z level=INFO fiber=#25 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:39.003Z level=INFO fiber=#25 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:39.003Z level=INFO fiber=#25 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:39.003Z level=INFO fiber=#25 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:39.003Z level=INFO fiber=#25 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:39.003Z level=INFO fiber=#25 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:39.003Z level=INFO fiber=#25 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:39.003Z level=INFO fiber=#25 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:39.003Z level=INFO fiber=#25 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:39.003Z level=INFO fiber=#25 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:39.003Z level=INFO fiber=#25 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:39.003Z level=INFO fiber=#25 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:39.003Z level=INFO fiber=#25 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:39.003Z level=INFO fiber=#25 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:39.003Z level=INFO fiber=#25 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:39.003Z level=INFO fiber=#25 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:39.004Z level=INFO fiber=#25 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:39.004Z level=INFO fiber=#25 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:39.004Z level=INFO fiber=#25 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:39.004Z level=INFO fiber=#25 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:39.008Z level=INFO fiber=#25 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:39.008Z level=INFO fiber=#25 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:39.008Z level=INFO fiber=#25 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.10ms)"
timestamp=2025-11-18T20:59:39.008Z level=INFO fiber=#25 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:39.008Z level=INFO fiber=#25 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:39.022Z level=INFO fiber=#25 message="ğŸ” Emitting file: yaml-test.yaml"
timestamp=2025-11-18T20:59:39.022Z level=INFO fiber=#25 message="ğŸ” Emitting file: yaml-test.yaml"
timestamp=2025-11-18T20:59:39.022Z level=INFO fiber=#25 message="ğŸ” Emitting file: yaml-test.yaml"
timestamp=2025-11-18T20:59:39.022Z level=INFO fiber=#25 message="âœ… File emitted: yaml-test.yaml"
timestamp=2025-11-18T20:59:39.022Z level=INFO fiber=#25 message="âœ… File emitted: yaml-test.yaml"
timestamp=2025-11-18T20:59:39.022Z level=INFO fiber=#25 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:39.022Z level=INFO fiber=#25 message="âœ… File emitted: yaml-test.yaml"
timestamp=2025-11-18T20:59:39.022Z level=INFO fiber=#25 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:39.022Z level=INFO fiber=#26 message="âœ… Generated AsyncAPI specification: yaml-test.yaml"
92 | 	const outputFile = Object.keys(result.outputs).find(
93 | 		f => f.endsWith(".yaml") || f.endsWith(".json"),
94 | 	)
95 | 
96 | 	if (!outputFile) {
97 | 		throw new Error("No AsyncAPI output generated")
                 ^
error: No AsyncAPI output generated
      at compileAsyncAPI (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:97:13)
      at async compileAsyncAPIWithoutErrors (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:127:23)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/emitter-core.test.ts:97:25)
(fail) AsyncAPI Emitter Core (NEW API) > Output Formats > should generate valid YAML output [72.30ms]
timestamp=2025-11-18T20:59:39.074Z level=INFO fiber=#27 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:39.074Z level=INFO fiber=#27 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:39.076Z level=INFO fiber=#27 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:39.076Z level=INFO fiber=#27 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:39.077Z level=INFO fiber=#27 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:39.077Z level=INFO fiber=#27 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:39.077Z level=INFO fiber=#27 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:39.077Z level=INFO fiber=#27 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:39.077Z level=INFO fiber=#27 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:39.077Z level=INFO fiber=#27 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:39.077Z level=INFO fiber=#27 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:39.077Z level=INFO fiber=#27 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:39.077Z level=INFO fiber=#27 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:39.077Z level=INFO fiber=#27 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:39.077Z level=INFO fiber=#27 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:39.077Z level=INFO fiber=#27 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:39.077Z level=INFO fiber=#27 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:39.077Z level=INFO fiber=#27 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:39.077Z level=INFO fiber=#27 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:39.077Z level=INFO fiber=#27 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:39.077Z level=INFO fiber=#27 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:39.078Z level=INFO fiber=#27 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:39.078Z level=INFO fiber=#27 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:39.078Z level=INFO fiber=#27 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:39.078Z level=INFO fiber=#27 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:39.078Z level=INFO fiber=#27 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:39.078Z level=INFO fiber=#27 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:39.078Z level=INFO fiber=#27 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:39.078Z level=INFO fiber=#27 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:39.078Z level=INFO fiber=#27 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:39.078Z level=INFO fiber=#27 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:39.078Z level=INFO fiber=#27 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T20:59:39.078Z level=INFO fiber=#27 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:39.078Z level=INFO fiber=#27 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:39.083Z level=INFO fiber=#27 message="ğŸ” Emitting file: default-format.yaml"
timestamp=2025-11-18T20:59:39.083Z level=INFO fiber=#27 message="ğŸ” Emitting file: default-format.yaml"
timestamp=2025-11-18T20:59:39.083Z level=INFO fiber=#27 message="ğŸ” Emitting file: default-format.yaml"
timestamp=2025-11-18T20:59:39.083Z level=INFO fiber=#27 message="âœ… File emitted: default-format.yaml"
timestamp=2025-11-18T20:59:39.083Z level=INFO fiber=#27 message="âœ… File emitted: default-format.yaml"
timestamp=2025-11-18T20:59:39.083Z level=INFO fiber=#27 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:39.083Z level=INFO fiber=#27 message="âœ… File emitted: default-format.yaml"
timestamp=2025-11-18T20:59:39.083Z level=INFO fiber=#27 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:39.083Z level=INFO fiber=#28 message="âœ… Generated AsyncAPI specification: default-format.yaml"
92 | 	const outputFile = Object.keys(result.outputs).find(
93 | 		f => f.endsWith(".yaml") || f.endsWith(".json"),
94 | 	)
95 | 
96 | 	if (!outputFile) {
97 | 		throw new Error("No AsyncAPI output generated")
                 ^
error: No AsyncAPI output generated
      at compileAsyncAPI (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:97:13)
      at async compileAsyncAPIWithoutErrors (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:127:23)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/emitter-core.test.ts:114:25)
(fail) AsyncAPI Emitter Core (NEW API) > Output Formats > should default to YAML when no file-type specified [60.61ms]
timestamp=2025-11-18T20:59:39.137Z level=INFO fiber=#29 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:39.137Z level=INFO fiber=#29 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:39.137Z level=INFO fiber=#29 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:39.137Z level=INFO fiber=#29 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:39.137Z level=INFO fiber=#29 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:39.137Z level=INFO fiber=#29 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:39.137Z level=INFO fiber=#29 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:39.137Z level=INFO fiber=#29 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:39.137Z level=INFO fiber=#29 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:39.137Z level=INFO fiber=#29 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:39.137Z level=INFO fiber=#29 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:39.137Z level=INFO fiber=#29 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:39.137Z level=INFO fiber=#29 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:39.137Z level=INFO fiber=#29 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:39.137Z level=INFO fiber=#29 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:39.137Z level=INFO fiber=#29 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:39.137Z level=INFO fiber=#29 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:39.137Z level=INFO fiber=#29 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:39.137Z level=INFO fiber=#29 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:39.137Z level=INFO fiber=#29 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:39.137Z level=INFO fiber=#29 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:39.137Z level=INFO fiber=#29 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:39.137Z level=INFO fiber=#29 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:39.138Z level=INFO fiber=#29 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:39.138Z level=INFO fiber=#29 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:39.138Z level=INFO fiber=#29 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:39.138Z level=INFO fiber=#29 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:39.138Z level=INFO fiber=#29 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:39.138Z level=INFO fiber=#29 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:39.138Z level=INFO fiber=#29 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:39.138Z level=INFO fiber=#29 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:39.138Z level=INFO fiber=#29 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.03ms)"
timestamp=2025-11-18T20:59:39.138Z level=INFO fiber=#29 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:39.138Z level=INFO fiber=#29 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:39.138Z level=INFO fiber=#29 message="ğŸ” Emitting file: asyncapi.json"
timestamp=2025-11-18T20:59:39.138Z level=INFO fiber=#29 message="ğŸ” Emitting file: asyncapi.json"
timestamp=2025-11-18T20:59:39.138Z level=INFO fiber=#29 message="ğŸ” Emitting file: asyncapi.json"
timestamp=2025-11-18T20:59:39.138Z level=INFO fiber=#29 message="âœ… File emitted: asyncapi.json"
timestamp=2025-11-18T20:59:39.138Z level=INFO fiber=#29 message="âœ… File emitted: asyncapi.json"
timestamp=2025-11-18T20:59:39.138Z level=INFO fiber=#29 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:39.138Z level=INFO fiber=#29 message="âœ… File emitted: asyncapi.json"
timestamp=2025-11-18T20:59:39.138Z level=INFO fiber=#29 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:39.138Z level=INFO fiber=#30 message="âœ… Generated AsyncAPI specification: asyncapi.json"
92 | 	const outputFile = Object.keys(result.outputs).find(
93 | 		f => f.endsWith(".yaml") || f.endsWith(".json"),
94 | 	)
95 | 
96 | 	if (!outputFile) {
97 | 		throw new Error("No AsyncAPI output generated")
                 ^
error: No AsyncAPI output generated
      at compileAsyncAPI (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:97:13)
      at async compileAsyncAPIWithoutErrors (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:127:23)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/emitter-core.test.ts:124:25)
(fail) AsyncAPI Emitter Core (NEW API) > Output Formats > should default filename when no output-file specified [55.05ms]
timestamp=2025-11-18T20:59:39.230Z level=INFO fiber=#31 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:39.230Z level=INFO fiber=#31 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:39.230Z level=INFO fiber=#31 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:39.230Z level=INFO fiber=#31 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:39.230Z level=INFO fiber=#31 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:39.230Z level=INFO fiber=#31 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:39.230Z level=INFO fiber=#31 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:39.230Z level=INFO fiber=#31 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:39.230Z level=INFO fiber=#31 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:39.230Z level=INFO fiber=#31 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:39.230Z level=INFO fiber=#31 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:39.230Z level=INFO fiber=#31 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:39.230Z level=INFO fiber=#31 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:39.230Z level=INFO fiber=#31 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:39.230Z level=INFO fiber=#31 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:39.230Z level=INFO fiber=#31 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:39.231Z level=INFO fiber=#31 message="âœ… Discovery: 3 operations found"
timestamp=2025-11-18T20:59:39.231Z level=INFO fiber=#31 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:39.231Z level=INFO fiber=#31 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:39.231Z level=INFO fiber=#31 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:39.231Z level=INFO fiber=#31 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:39.231Z level=INFO fiber=#31 message="ğŸ”„ Processing 3 operations with Effect.TS..."
timestamp=2025-11-18T20:59:39.231Z level=INFO fiber=#31 message="âœ… Processed 3 operations successfully"
timestamp=2025-11-18T20:59:39.231Z level=INFO fiber=#31 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:39.231Z level=INFO fiber=#31 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:39.232Z level=INFO fiber=#31 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:39.232Z level=INFO fiber=#31 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:39.232Z level=INFO fiber=#31 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 3,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 3
}"
timestamp=2025-11-18T20:59:39.232Z level=INFO fiber=#31 message="âœ… Processing: 3 elements processed"
timestamp=2025-11-18T20:59:39.232Z level=INFO fiber=#31 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:39.232Z level=INFO fiber=#31 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:39.232Z level=INFO fiber=#31 message="âœ… AsyncAPI document validation passed! 3 channels, 0 operations (0.08ms)"
timestamp=2025-11-18T20:59:39.232Z level=INFO fiber=#31 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:39.232Z level=INFO fiber=#31 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:39.232Z level=INFO fiber=#31 message="ğŸ” Emitting file: multi.json"
timestamp=2025-11-18T20:59:39.232Z level=INFO fiber=#31 message="ğŸ” Emitting file: multi.json"
timestamp=2025-11-18T20:59:39.232Z level=INFO fiber=#31 message="ğŸ” Emitting file: multi.json"
timestamp=2025-11-18T20:59:39.232Z level=INFO fiber=#31 message="âœ… File emitted: multi.json"
timestamp=2025-11-18T20:59:39.232Z level=INFO fiber=#31 message="âœ… File emitted: multi.json"
timestamp=2025-11-18T20:59:39.232Z level=INFO fiber=#31 message="ğŸ‰ TYPESPEC API SUCCESS: 3 channels, 0 operations"
timestamp=2025-11-18T20:59:39.232Z level=INFO fiber=#31 message="âœ… File emitted: multi.json"
timestamp=2025-11-18T20:59:39.232Z level=INFO fiber=#31 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:39.232Z level=INFO fiber=#32 message="âœ… Generated AsyncAPI specification: multi.json"
92 | 	const outputFile = Object.keys(result.outputs).find(
93 | 		f => f.endsWith(".yaml") || f.endsWith(".json"),
94 | 	)
95 | 
96 | 	if (!outputFile) {
97 | 		throw new Error("No AsyncAPI output generated")
                 ^
error: No AsyncAPI output generated
      at compileAsyncAPI (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:97:13)
      at async compileAsyncAPIWithoutErrors (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:127:23)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/emitter-core.test.ts:136:25)
(fail) AsyncAPI Emitter Core (NEW API) > Multiple Operations > should handle multiple operations in single namespace [95.69ms]
timestamp=2025-11-18T20:59:39.337Z level=INFO fiber=#33 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:39.337Z level=INFO fiber=#33 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:39.337Z level=INFO fiber=#33 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:39.337Z level=INFO fiber=#33 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:39.337Z level=INFO fiber=#33 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:39.337Z level=INFO fiber=#33 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:39.337Z level=INFO fiber=#33 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:39.337Z level=INFO fiber=#33 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:39.337Z level=INFO fiber=#33 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:39.337Z level=INFO fiber=#33 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:39.337Z level=INFO fiber=#33 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:39.337Z level=INFO fiber=#33 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:39.337Z level=INFO fiber=#33 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:39.337Z level=INFO fiber=#33 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:39.342Z level=INFO fiber=#33 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:39.348Z level=INFO fiber=#33 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:39.350Z level=INFO fiber=#33 message="âœ… Discovery: 3 operations found"
timestamp=2025-11-18T20:59:39.350Z level=INFO fiber=#33 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:39.351Z level=INFO fiber=#33 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:39.351Z level=INFO fiber=#33 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:39.351Z level=INFO fiber=#33 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:39.351Z level=INFO fiber=#33 message="ğŸ”„ Processing 3 operations with Effect.TS..."
timestamp=2025-11-18T20:59:39.351Z level=INFO fiber=#33 message="âœ… Processed 3 operations successfully"
timestamp=2025-11-18T20:59:39.351Z level=INFO fiber=#33 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:39.351Z level=INFO fiber=#33 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:39.351Z level=INFO fiber=#33 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:39.351Z level=INFO fiber=#33 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:39.351Z level=INFO fiber=#33 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 3,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 3
}"
timestamp=2025-11-18T20:59:39.352Z level=INFO fiber=#33 message="âœ… Processing: 3 elements processed"
timestamp=2025-11-18T20:59:39.352Z level=INFO fiber=#33 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:39.352Z level=INFO fiber=#33 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:39.352Z level=INFO fiber=#33 message="âœ… AsyncAPI document validation passed! 3 channels, 0 operations (0.07ms)"
timestamp=2025-11-18T20:59:39.352Z level=INFO fiber=#33 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:39.352Z level=INFO fiber=#33 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:39.352Z level=INFO fiber=#33 message="ğŸ” Emitting file: channels.json"
timestamp=2025-11-18T20:59:39.352Z level=INFO fiber=#33 message="ğŸ” Emitting file: channels.json"
timestamp=2025-11-18T20:59:39.352Z level=INFO fiber=#33 message="ğŸ” Emitting file: channels.json"
timestamp=2025-11-18T20:59:39.361Z level=INFO fiber=#33 message="âœ… File emitted: channels.json"
timestamp=2025-11-18T20:59:39.362Z level=INFO fiber=#33 message="âœ… File emitted: channels.json"
timestamp=2025-11-18T20:59:39.362Z level=INFO fiber=#33 message="ğŸ‰ TYPESPEC API SUCCESS: 3 channels, 0 operations"
timestamp=2025-11-18T20:59:39.369Z level=INFO fiber=#33 message="âœ… File emitted: channels.json"
timestamp=2025-11-18T20:59:39.369Z level=INFO fiber=#33 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:39.370Z level=INFO fiber=#34 message="âœ… Generated AsyncAPI specification: channels.json"
92 | 	const outputFile = Object.keys(result.outputs).find(
93 | 		f => f.endsWith(".yaml") || f.endsWith(".json"),
94 | 	)
95 | 
96 | 	if (!outputFile) {
97 | 		throw new Error("No AsyncAPI output generated")
                 ^
error: No AsyncAPI output generated
      at compileAsyncAPI (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:97:13)
      at async compileAsyncAPIWithoutErrors (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:127:23)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/emitter-core.test.ts:152:25)
(fail) AsyncAPI Emitter Core (NEW API) > Multiple Operations > should create unique channels for each operation [137.44ms]
timestamp=2025-11-18T20:59:39.521Z level=INFO fiber=#35 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:39.521Z level=INFO fiber=#35 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:39.521Z level=INFO fiber=#35 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:39.521Z level=INFO fiber=#35 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:39.521Z level=INFO fiber=#35 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:39.521Z level=INFO fiber=#35 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:39.521Z level=INFO fiber=#35 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:39.521Z level=INFO fiber=#35 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:39.521Z level=INFO fiber=#35 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:39.521Z level=INFO fiber=#35 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:39.521Z level=INFO fiber=#35 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:39.521Z level=INFO fiber=#35 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:39.521Z level=INFO fiber=#35 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:39.521Z level=INFO fiber=#35 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:39.521Z level=INFO fiber=#35 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:39.521Z level=INFO fiber=#35 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:39.522Z level=INFO fiber=#35 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:39.522Z level=INFO fiber=#35 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:39.522Z level=INFO fiber=#35 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:39.522Z level=INFO fiber=#35 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:39.522Z level=INFO fiber=#35 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:39.522Z level=INFO fiber=#35 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:39.522Z level=INFO fiber=#35 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:39.522Z level=INFO fiber=#35 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:39.522Z level=INFO fiber=#35 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:39.522Z level=INFO fiber=#35 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:39.522Z level=INFO fiber=#35 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:39.522Z level=INFO fiber=#35 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:39.523Z level=INFO fiber=#35 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:39.523Z level=INFO fiber=#35 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:39.523Z level=INFO fiber=#35 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:39.523Z level=INFO fiber=#35 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.06ms)"
timestamp=2025-11-18T20:59:39.523Z level=INFO fiber=#35 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:39.523Z level=INFO fiber=#35 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:39.523Z level=INFO fiber=#35 message="ğŸ” Emitting file: required.json"
timestamp=2025-11-18T20:59:39.523Z level=INFO fiber=#35 message="ğŸ” Emitting file: required.json"
timestamp=2025-11-18T20:59:39.524Z level=INFO fiber=#35 message="ğŸ” Emitting file: required.json"
timestamp=2025-11-18T20:59:39.524Z level=INFO fiber=#35 message="âœ… File emitted: required.json"
timestamp=2025-11-18T20:59:39.524Z level=INFO fiber=#35 message="âœ… File emitted: required.json"
timestamp=2025-11-18T20:59:39.524Z level=INFO fiber=#35 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:39.524Z level=INFO fiber=#35 message="âœ… File emitted: required.json"
timestamp=2025-11-18T20:59:39.524Z level=INFO fiber=#35 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:39.525Z level=INFO fiber=#36 message="âœ… Generated AsyncAPI specification: required.json"
92 | 	const outputFile = Object.keys(result.outputs).find(
93 | 		f => f.endsWith(".yaml") || f.endsWith(".json"),
94 | 	)
95 | 
96 | 	if (!outputFile) {
97 | 		throw new Error("No AsyncAPI output generated")
                 ^
error: No AsyncAPI output generated
      at compileAsyncAPI (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:97:13)
      at async compileAsyncAPIWithoutErrors (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:127:23)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/emitter-core.test.ts:185:25)
(fail) AsyncAPI Emitter Core (NEW API) > Schema Generation > should handle required vs optional fields [155.18ms]
timestamp=2025-11-18T20:59:39.551Z level=INFO fiber=#37 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:39.551Z level=INFO fiber=#37 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:39.551Z level=INFO fiber=#37 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:39.551Z level=INFO fiber=#37 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:39.551Z level=INFO fiber=#37 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:39.551Z level=INFO fiber=#37 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:39.551Z level=INFO fiber=#37 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:39.551Z level=INFO fiber=#37 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:39.551Z level=INFO fiber=#37 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:39.551Z level=INFO fiber=#37 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:39.551Z level=INFO fiber=#37 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:39.551Z level=INFO fiber=#37 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:39.551Z level=INFO fiber=#37 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:39.551Z level=INFO fiber=#37 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:39.551Z level=INFO fiber=#37 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:39.551Z level=INFO fiber=#37 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:39.551Z level=INFO fiber=#37 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:39.551Z level=INFO fiber=#37 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:39.551Z level=INFO fiber=#37 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:39.569Z level=INFO fiber=#37 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:39.569Z level=INFO fiber=#37 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:39.571Z level=INFO fiber=#37 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:39.571Z level=INFO fiber=#37 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:39.571Z level=INFO fiber=#37 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:39.571Z level=INFO fiber=#37 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:39.571Z level=INFO fiber=#37 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:39.571Z level=INFO fiber=#37 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:39.571Z level=INFO fiber=#37 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:39.571Z level=INFO fiber=#37 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:39.571Z level=INFO fiber=#37 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:39.571Z level=INFO fiber=#37 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:39.572Z level=INFO fiber=#37 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.05ms)"
timestamp=2025-11-18T20:59:39.572Z level=INFO fiber=#37 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:39.572Z level=INFO fiber=#37 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:39.572Z level=INFO fiber=#37 message="ğŸ” Emitting file: union.json"
timestamp=2025-11-18T20:59:39.572Z level=INFO fiber=#37 message="ğŸ” Emitting file: union.json"
timestamp=2025-11-18T20:59:39.572Z level=INFO fiber=#37 message="ğŸ” Emitting file: union.json"
timestamp=2025-11-18T20:59:39.572Z level=INFO fiber=#37 message="âœ… File emitted: union.json"
timestamp=2025-11-18T20:59:39.572Z level=INFO fiber=#37 message="âœ… File emitted: union.json"
timestamp=2025-11-18T20:59:39.572Z level=INFO fiber=#37 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:39.572Z level=INFO fiber=#37 message="âœ… File emitted: union.json"
timestamp=2025-11-18T20:59:39.572Z level=INFO fiber=#37 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:39.572Z level=INFO fiber=#38 message="âœ… Generated AsyncAPI specification: union.json"
92 | 	const outputFile = Object.keys(result.outputs).find(
93 | 		f => f.endsWith(".yaml") || f.endsWith(".json"),
94 | 	)
95 | 
96 | 	if (!outputFile) {
97 | 		throw new Error("No AsyncAPI output generated")
                 ^
error: No AsyncAPI output generated
      at compileAsyncAPI (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:97:13)
      at async compileAsyncAPIWithoutErrors (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:127:23)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/emitter-core.test.ts:215:25)
(fail) AsyncAPI Emitter Core (NEW API) > Schema Generation > should handle union types [50.86ms]
timestamp=2025-11-18T20:59:39.621Z level=INFO fiber=#39 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:39.622Z level=INFO fiber=#39 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:39.622Z level=INFO fiber=#39 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:39.622Z level=INFO fiber=#39 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:39.622Z level=INFO fiber=#39 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:39.622Z level=INFO fiber=#39 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:39.622Z level=INFO fiber=#39 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:39.622Z level=INFO fiber=#39 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:39.622Z level=INFO fiber=#39 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:39.623Z level=INFO fiber=#39 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:39.623Z level=INFO fiber=#39 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:39.623Z level=INFO fiber=#39 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:39.623Z level=INFO fiber=#39 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:39.623Z level=INFO fiber=#39 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:39.623Z level=INFO fiber=#39 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:39.623Z level=INFO fiber=#39 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:39.623Z level=INFO fiber=#39 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:39.623Z level=INFO fiber=#39 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:39.623Z level=INFO fiber=#39 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:39.623Z level=INFO fiber=#39 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:39.623Z level=INFO fiber=#39 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:39.623Z level=INFO fiber=#39 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:39.624Z level=INFO fiber=#39 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:39.624Z level=INFO fiber=#39 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:39.624Z level=INFO fiber=#39 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:39.624Z level=INFO fiber=#39 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:39.624Z level=INFO fiber=#39 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:39.624Z level=INFO fiber=#39 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:39.624Z level=INFO fiber=#39 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:39.624Z level=INFO fiber=#39 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:39.624Z level=INFO fiber=#39 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:39.626Z level=INFO fiber=#39 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (1.26ms)"
timestamp=2025-11-18T20:59:39.626Z level=INFO fiber=#39 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:39.626Z level=INFO fiber=#39 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:39.626Z level=INFO fiber=#39 message="ğŸ” Emitting file: datetime.json"
timestamp=2025-11-18T20:59:39.626Z level=INFO fiber=#39 message="ğŸ” Emitting file: datetime.json"
timestamp=2025-11-18T20:59:39.626Z level=INFO fiber=#39 message="ğŸ” Emitting file: datetime.json"
timestamp=2025-11-18T20:59:39.626Z level=INFO fiber=#39 message="âœ… File emitted: datetime.json"
timestamp=2025-11-18T20:59:39.626Z level=INFO fiber=#39 message="âœ… File emitted: datetime.json"
timestamp=2025-11-18T20:59:39.626Z level=INFO fiber=#39 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:39.626Z level=INFO fiber=#39 message="âœ… File emitted: datetime.json"
timestamp=2025-11-18T20:59:39.626Z level=INFO fiber=#39 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:39.626Z level=INFO fiber=#40 message="âœ… Generated AsyncAPI specification: datetime.json"
92 | 	const outputFile = Object.keys(result.outputs).find(
93 | 		f => f.endsWith(".yaml") || f.endsWith(".json"),
94 | 	)
95 | 
96 | 	if (!outputFile) {
97 | 		throw new Error("No AsyncAPI output generated")
                 ^
error: No AsyncAPI output generated
      at compileAsyncAPI (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:97:13)
      at async compileAsyncAPIWithoutErrors (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:127:23)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/emitter-core.test.ts:241:25)
(fail) AsyncAPI Emitter Core (NEW API) > Schema Generation > should handle utcDateTime types [49.15ms]
timestamp=2025-11-18T20:59:39.749Z level=INFO fiber=#41 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:39.749Z level=INFO fiber=#41 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:39.749Z level=INFO fiber=#41 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:39.749Z level=INFO fiber=#41 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:39.749Z level=INFO fiber=#41 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:39.749Z level=INFO fiber=#41 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:39.749Z level=INFO fiber=#41 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:39.750Z level=INFO fiber=#41 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:39.750Z level=INFO fiber=#41 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:39.750Z level=INFO fiber=#41 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:39.750Z level=INFO fiber=#41 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:39.750Z level=INFO fiber=#41 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:39.750Z level=INFO fiber=#41 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:39.750Z level=INFO fiber=#41 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:39.750Z level=INFO fiber=#41 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:39.750Z level=INFO fiber=#41 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:39.750Z level=INFO fiber=#41 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:39.750Z level=INFO fiber=#41 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:39.750Z level=INFO fiber=#41 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:39.750Z level=INFO fiber=#41 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:39.750Z level=INFO fiber=#41 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:39.751Z level=INFO fiber=#41 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:39.751Z level=INFO fiber=#41 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:39.751Z level=INFO fiber=#41 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:39.751Z level=INFO fiber=#41 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:39.751Z level=INFO fiber=#41 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:39.751Z level=INFO fiber=#41 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:39.751Z level=INFO fiber=#41 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:39.751Z level=INFO fiber=#41 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:39.752Z level=INFO fiber=#41 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:39.752Z level=INFO fiber=#41 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:39.752Z level=INFO fiber=#41 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.09ms)"
timestamp=2025-11-18T20:59:39.752Z level=INFO fiber=#41 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:39.752Z level=INFO fiber=#41 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:39.752Z level=INFO fiber=#41 message="ğŸ” Emitting file: warning.json"
timestamp=2025-11-18T20:59:39.752Z level=INFO fiber=#41 message="ğŸ” Emitting file: warning.json"
timestamp=2025-11-18T20:59:39.752Z level=INFO fiber=#41 message="ğŸ” Emitting file: warning.json"
timestamp=2025-11-18T20:59:39.752Z level=INFO fiber=#41 message="âœ… File emitted: warning.json"
timestamp=2025-11-18T20:59:39.752Z level=INFO fiber=#41 message="âœ… File emitted: warning.json"
timestamp=2025-11-18T20:59:39.752Z level=INFO fiber=#41 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:39.752Z level=INFO fiber=#41 message="âœ… File emitted: warning.json"
timestamp=2025-11-18T20:59:39.752Z level=INFO fiber=#41 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:39.752Z level=INFO fiber=#42 message="âœ… Generated AsyncAPI specification: warning.json"
92 | 	const outputFile = Object.keys(result.outputs).find(
93 | 		f => f.endsWith(".yaml") || f.endsWith(".json"),
94 | 	)
95 | 
96 | 	if (!outputFile) {
97 | 		throw new Error("No AsyncAPI output generated")
                 ^
error: No AsyncAPI output generated
      at compileAsyncAPI (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:97:13)
      at async compileAsyncAPIWithoutErrors (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:127:23)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/emitter-core.test.ts:277:25)
(fail) AsyncAPI Emitter Core (NEW API) > Error Handling > should compile successfully with warnings [126.28ms]
timestamp=2025-11-18T20:59:39.809Z level=INFO fiber=#43 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:39.810Z level=INFO fiber=#43 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:39.810Z level=INFO fiber=#43 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:39.810Z level=INFO fiber=#43 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:39.810Z level=INFO fiber=#43 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:39.810Z level=INFO fiber=#43 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:39.810Z level=INFO fiber=#43 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:39.810Z level=INFO fiber=#43 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:39.810Z level=INFO fiber=#43 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:39.810Z level=INFO fiber=#43 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:39.811Z level=INFO fiber=#43 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:39.811Z level=INFO fiber=#43 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:39.811Z level=INFO fiber=#43 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:39.811Z level=INFO fiber=#43 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:39.811Z level=INFO fiber=#43 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:39.811Z level=INFO fiber=#43 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:39.811Z level=INFO fiber=#43 message="âœ… Discovery: 0 operations found"
timestamp=2025-11-18T20:59:39.811Z level=INFO fiber=#43 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:39.811Z level=INFO fiber=#43 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:39.811Z level=INFO fiber=#43 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:39.811Z level=INFO fiber=#43 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:39.811Z level=INFO fiber=#43 message="ğŸ”„ Processing 0 operations with Effect.TS..."
timestamp=2025-11-18T20:59:39.811Z level=INFO fiber=#43 message="âœ… Processed 0 operations successfully"
timestamp=2025-11-18T20:59:39.811Z level=INFO fiber=#43 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:39.812Z level=INFO fiber=#43 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:39.812Z level=INFO fiber=#43 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:39.812Z level=INFO fiber=#43 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:39.812Z level=INFO fiber=#43 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 0,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 0
}"
timestamp=2025-11-18T20:59:39.812Z level=INFO fiber=#43 message="âœ… Processing: 0 elements processed"
timestamp=2025-11-18T20:59:39.812Z level=INFO fiber=#43 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:39.812Z level=INFO fiber=#43 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:39.812Z level=INFO fiber=#43 message="âœ… AsyncAPI document validation passed! 0 channels, 0 operations (0.47ms)"
timestamp=2025-11-18T20:59:39.812Z level=INFO fiber=#43 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:39.812Z level=INFO fiber=#43 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:39.813Z level=INFO fiber=#43 message="ğŸ” Emitting file: empty.json"
timestamp=2025-11-18T20:59:39.813Z level=INFO fiber=#43 message="ğŸ” Emitting file: empty.json"
timestamp=2025-11-18T20:59:39.813Z level=INFO fiber=#43 message="ğŸ” Emitting file: empty.json"
timestamp=2025-11-18T20:59:39.813Z level=INFO fiber=#43 message="âœ… File emitted: empty.json"
timestamp=2025-11-18T20:59:39.813Z level=INFO fiber=#43 message="âœ… File emitted: empty.json"
timestamp=2025-11-18T20:59:39.813Z level=INFO fiber=#43 message="ğŸ‰ TYPESPEC API SUCCESS: 0 channels, 0 operations"
timestamp=2025-11-18T20:59:39.813Z level=INFO fiber=#43 message="âœ… File emitted: empty.json"
timestamp=2025-11-18T20:59:39.813Z level=INFO fiber=#43 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:39.813Z level=INFO fiber=#44 message="âœ… Generated AsyncAPI specification: empty.json"
92 | 	const outputFile = Object.keys(result.outputs).find(
93 | 		f => f.endsWith(".yaml") || f.endsWith(".json"),
94 | 	)
95 | 
96 | 	if (!outputFile) {
97 | 		throw new Error("No AsyncAPI output generated")
                 ^
error: No AsyncAPI output generated
      at compileAsyncAPI (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:97:13)
      at async compileAsyncAPIWithoutErrors (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:127:23)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/emitter-core.test.ts:301:25)
(fail) AsyncAPI Emitter Core (NEW API) > Error Handling > should handle empty operations gracefully [60.56ms]

test/unit/error-handling.test.ts:

# Unhandled error between tests
-------------------------------
1 | })
2 | {
    ^
SyntaxError: Export named 'Validators' not found in module '/Users/larsartmann/projects/typespec-asyncapi/src/utils/standardized-errors.ts'.
      at loadAndEvaluateModule (2:1)
-------------------------------


test/unit/decorator-registration.test.ts:
error: Cannot find module '../../dist/domain/decorators/security.js' from '/Users/larsartmann/projects/typespec-asyncapi/test/unit/decorator-registration.test.ts'
(fail) ğŸ”§ M6: Decorator Registration Integration > should test decorator function availability [1.24ms]

test/unit/options.test.ts:
timestamp=2025-11-18T20:59:40.082Z level=WARN fiber=#71 message="âš ï¸  AsyncAPI options validation failed: AsyncAPIOptionsValidationError: Schema validation failed: ParseError: AsyncAPIEmitterOptions
â””â”€ [\"file-type\"]
   â””â”€ Output file type. Default: 'yaml' | undefined
      â”œâ”€ Output file type. Default: 'yaml'
      â”‚  â”œâ”€ Expected \"yaml\", actual \"invalid\"
      â”‚  â””â”€ Expected \"json\", actual \"invalid\"
      â””â”€ Expected undefined, actual \"invalid\""
timestamp=2025-11-18T20:59:40.082Z level=WARN fiber=#73 message="âš ï¸  AsyncAPI options validation failed: AsyncAPIOptionsParseError: Expected object, got string"
timestamp=2025-11-18T20:59:40.083Z level=WARN fiber=#74 message="âš ï¸  AsyncAPI options validation failed: AsyncAPIOptionsParseError: Input cannot be null or undefined"
timestamp=2025-11-18T20:59:40.083Z level=WARN fiber=#75 message="âš ï¸  AsyncAPI options validation failed: AsyncAPIOptionsParseError: Input cannot be null or undefined"
timestamp=2025-11-18T20:59:40.083Z level=WARN fiber=#76 message="âš ï¸  AsyncAPI options validation failed: AsyncAPIOptionsParseError: Expected object, got number"
timestamp=2025-11-18T20:59:40.087Z level=WARN fiber=#101 message="âš ï¸  AsyncAPI options validation failed: AsyncAPIOptionsValidationError: Schema validation failed: ParseError: AsyncAPIEmitterOptions
â””â”€ [\"output-file\"]
   â””â”€ Name of the output file. Supports template variables: {cmd}, {project-root}, {emitter-name}, {output-dir}. Default: 'asyncapi.yaml' | undefined
      â”œâ”€ Invalid path template format
      â””â”€ Expected undefined, actual \"{invalid-variable}/output.yaml\""

test/unit/plugin-system.test.ts:
14 |   // Test registration
15 |   registry.register(testPlugin)
16 | 
17 |   // Test retrieval
18 |   const retrieved = registry.get("test-plugin")
19 |   expect(retrieved).toBe(testPlugin)
                         ^
error: expect(received).toBe(expected)

Expected: {
  name: "test-plugin",
  version: "1.0.0",
  initialize: [Function: initialize],
}
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/plugin-system.test.ts:19:21)
(fail) Basic Plugin System - Registration and Retrieval [0.59ms]

test/unit/path-templates.test.ts:
208 | 	test("should resolve valid template with context", () => {
209 | 		const template = "{project-root}/specs/{cmd}-api.yaml"
210 | 		const context: PathTemplateContext = {}
211 | 
212 | 		const resolved = resolvePathTemplateWithValidation(template, context)
213 | 		expect(resolved).toContain("specs")
                         ^
error: expect(received).toContain(expected)

Expected to contain: "specs"
Received: {
  _id: "Exit",
  _tag: "Success",
  value: "/Users/larsartmann/projects/typespec-asyncapi/specs/typespec-api.yaml",
}

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/path-templates.test.ts:213:20)
(fail) Path Template Resolution with Validation > should resolve valid template with context [0.43ms]
218 | 		const invalidTemplate = "{invalid-var}/spec.yaml"
219 | 		const context: PathTemplateContext = {}
220 | 
221 | 		expect(() => {
222 | 			resolvePathTemplateWithValidation(invalidTemplate, context)
223 | 		}).toThrow("Path template validation failed")
           ^
error: expect(received).toThrow(expected)

Expected substring: "Path template validation failed"

Received function did not throw
Received value: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/path-templates.test.ts:223:6)
(fail) Path Template Resolution with Validation > should throw error for invalid template variables [0.16ms]
225 | 
226 | 	test("should handle empty context", () => {
227 | 		const template = "{emitter-name}/simple.yaml"
228 | 
229 | 		const resolved = resolvePathTemplateWithValidation(template)
230 | 		expect(resolved).toContain("asyncapi/simple.yaml")
                         ^
error: expect(received).toContain(expected)

Expected to contain: "asyncapi/simple.yaml"
Received: {
  _id: "Exit",
  _tag: "Success",
  value: "/Users/larsartmann/projects/typespec-asyncapi/asyncapi/simple.yaml",
}

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/path-templates.test.ts:230:20)
(fail) Path Template Resolution with Validation > should handle empty context [0.29ms]
310 | 		try {
311 | 			resolvePathTemplateWithValidation(invalidTemplate)
312 | 			expect.unreachable("Should have thrown validation error")
313 | 		} catch (error) {
314 | 			const message = String(error)
315 | 			expect(message).toContain("Path template validation failed")
                         ^
error: expect(received).toContain(expected)

Expected to contain: "Path template validation failed"
Received: "UnreachableError: Should have thrown validation error"

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/path-templates.test.ts:315:20)
(fail) Error Handling > should provide detailed error messages for validation failures [0.16ms]

test/unit/emitter-tester-verification.test.ts:
timestamp=2025-11-18T20:59:40.203Z level=INFO fiber=#130 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:40.203Z level=INFO fiber=#130 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:40.203Z level=INFO fiber=#130 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:40.203Z level=INFO fiber=#130 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:40.203Z level=INFO fiber=#130 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:40.204Z level=INFO fiber=#130 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:40.204Z level=INFO fiber=#130 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:40.204Z level=INFO fiber=#130 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:40.204Z level=INFO fiber=#130 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:40.204Z level=INFO fiber=#130 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:40.204Z level=INFO fiber=#130 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:40.204Z level=INFO fiber=#130 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:40.204Z level=INFO fiber=#130 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:40.204Z level=INFO fiber=#130 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:40.204Z level=INFO fiber=#130 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:40.204Z level=INFO fiber=#130 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:40.204Z level=INFO fiber=#130 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:40.204Z level=INFO fiber=#130 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:40.204Z level=INFO fiber=#130 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:40.204Z level=INFO fiber=#130 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:40.204Z level=INFO fiber=#130 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:40.204Z level=INFO fiber=#130 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:40.204Z level=INFO fiber=#130 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:40.204Z level=INFO fiber=#130 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:40.204Z level=INFO fiber=#130 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:40.204Z level=INFO fiber=#130 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:40.205Z level=INFO fiber=#130 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:40.205Z level=INFO fiber=#130 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:40.205Z level=INFO fiber=#130 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:40.205Z level=INFO fiber=#130 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:40.205Z level=INFO fiber=#130 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:40.205Z level=INFO fiber=#130 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.06ms)"
timestamp=2025-11-18T20:59:40.205Z level=INFO fiber=#130 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:40.205Z level=INFO fiber=#130 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:40.206Z level=INFO fiber=#130 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.206Z level=INFO fiber=#130 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.206Z level=INFO fiber=#130 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.206Z level=INFO fiber=#130 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.206Z level=INFO fiber=#130 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.206Z level=INFO fiber=#130 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:40.206Z level=INFO fiber=#130 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.206Z level=INFO fiber=#130 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:40.206Z level=INFO fiber=#131 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
92 | 	const outputFile = Object.keys(result.outputs).find(
93 | 		f => f.endsWith(".yaml") || f.endsWith(".json"),
94 | 	)
95 | 
96 | 	if (!outputFile) {
97 | 		throw new Error("No AsyncAPI output generated")
                 ^
error: No AsyncAPI output generated
      at compileAsyncAPI (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:97:13)
      at async compileAsyncAPIWithoutErrors (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:127:23)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/emitter-tester-verification.test.ts:31:24)
(fail) EmitterTester API Verification > should compile TypeSpec to AsyncAPI [73.73ms]
timestamp=2025-11-18T20:59:40.313Z level=INFO fiber=#132 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:40.316Z level=INFO fiber=#132 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:40.316Z level=INFO fiber=#132 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:40.317Z level=INFO fiber=#132 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:40.317Z level=INFO fiber=#132 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:40.317Z level=INFO fiber=#132 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:40.317Z level=INFO fiber=#132 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:40.317Z level=INFO fiber=#132 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:40.317Z level=INFO fiber=#132 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:40.317Z level=INFO fiber=#132 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:40.317Z level=INFO fiber=#132 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:40.317Z level=INFO fiber=#132 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:40.317Z level=INFO fiber=#132 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:40.317Z level=INFO fiber=#132 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:40.317Z level=INFO fiber=#132 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:40.321Z level=INFO fiber=#132 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:40.322Z level=INFO fiber=#132 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:40.322Z level=INFO fiber=#132 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:40.322Z level=INFO fiber=#132 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:40.322Z level=INFO fiber=#132 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:40.322Z level=INFO fiber=#132 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:40.322Z level=INFO fiber=#132 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:40.334Z level=INFO fiber=#132 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:40.345Z level=INFO fiber=#132 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:40.358Z level=INFO fiber=#132 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:40.358Z level=INFO fiber=#132 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:40.358Z level=INFO fiber=#132 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:40.358Z level=INFO fiber=#132 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:40.358Z level=INFO fiber=#132 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:40.358Z level=INFO fiber=#132 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:40.359Z level=INFO fiber=#132 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:40.359Z level=INFO fiber=#132 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.09ms)"
timestamp=2025-11-18T20:59:40.359Z level=INFO fiber=#132 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:40.359Z level=INFO fiber=#132 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:40.359Z level=INFO fiber=#132 message="ğŸ” Emitting file: asyncapi.json"
timestamp=2025-11-18T20:59:40.359Z level=INFO fiber=#132 message="ğŸ” Emitting file: asyncapi.json"
timestamp=2025-11-18T20:59:40.359Z level=INFO fiber=#132 message="ğŸ” Emitting file: asyncapi.json"
timestamp=2025-11-18T20:59:40.379Z level=INFO fiber=#132 message="âœ… File emitted: asyncapi.json"
timestamp=2025-11-18T20:59:40.379Z level=INFO fiber=#132 message="âœ… File emitted: asyncapi.json"
timestamp=2025-11-18T20:59:40.379Z level=INFO fiber=#132 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:40.379Z level=INFO fiber=#132 message="âœ… File emitted: asyncapi.json"
timestamp=2025-11-18T20:59:40.379Z level=INFO fiber=#132 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:40.379Z level=INFO fiber=#133 message="âœ… Generated AsyncAPI specification: asyncapi.json"
92 | 	const outputFile = Object.keys(result.outputs).find(
93 | 		f => f.endsWith(".yaml") || f.endsWith(".json"),
94 | 	)
95 | 
96 | 	if (!outputFile) {
97 | 		throw new Error("No AsyncAPI output generated")
                 ^
error: No AsyncAPI output generated
      at compileAsyncAPI (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:97:13)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/emitter-tester-verification.test.ts:39:24)
(fail) EmitterTester API Verification > should pass file-type option correctly (JSON) [172.91ms]
timestamp=2025-11-18T20:59:40.490Z level=INFO fiber=#134 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:40.490Z level=INFO fiber=#134 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:40.490Z level=INFO fiber=#134 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:40.490Z level=INFO fiber=#134 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:40.490Z level=INFO fiber=#134 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:40.490Z level=INFO fiber=#134 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:40.490Z level=INFO fiber=#134 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:40.490Z level=INFO fiber=#134 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:40.490Z level=INFO fiber=#134 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:40.490Z level=INFO fiber=#134 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:40.490Z level=INFO fiber=#134 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:40.490Z level=INFO fiber=#134 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:40.490Z level=INFO fiber=#134 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:40.490Z level=INFO fiber=#134 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:40.491Z level=INFO fiber=#134 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:40.491Z level=INFO fiber=#134 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:40.491Z level=INFO fiber=#134 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:40.491Z level=INFO fiber=#134 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:40.491Z level=INFO fiber=#134 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:40.491Z level=INFO fiber=#134 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:40.491Z level=INFO fiber=#134 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:40.491Z level=INFO fiber=#134 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:40.491Z level=INFO fiber=#134 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:40.491Z level=INFO fiber=#134 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:40.491Z level=INFO fiber=#134 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:40.491Z level=INFO fiber=#134 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:40.491Z level=INFO fiber=#134 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:40.491Z level=INFO fiber=#134 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:40.491Z level=INFO fiber=#134 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:40.491Z level=INFO fiber=#134 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:40.491Z level=INFO fiber=#134 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:40.491Z level=INFO fiber=#134 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T20:59:40.491Z level=INFO fiber=#134 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:40.491Z level=INFO fiber=#134 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:40.493Z level=INFO fiber=#134 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.493Z level=INFO fiber=#134 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.493Z level=INFO fiber=#134 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.493Z level=INFO fiber=#134 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.493Z level=INFO fiber=#134 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.493Z level=INFO fiber=#134 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:40.493Z level=INFO fiber=#134 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.493Z level=INFO fiber=#134 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:40.493Z level=INFO fiber=#135 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
92 | 	const outputFile = Object.keys(result.outputs).find(
93 | 		f => f.endsWith(".yaml") || f.endsWith(".json"),
94 | 	)
95 | 
96 | 	if (!outputFile) {
97 | 		throw new Error("No AsyncAPI output generated")
                 ^
error: No AsyncAPI output generated
      at compileAsyncAPI (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:97:13)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/emitter-tester-verification.test.ts:49:24)
(fail) EmitterTester API Verification > should pass file-type option correctly (YAML) [114.18ms]
timestamp=2025-11-18T20:59:40.552Z level=INFO fiber=#136 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.03ms)"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="ğŸ” Emitting file: custom-name.json"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="ğŸ” Emitting file: custom-name.json"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="ğŸ” Emitting file: custom-name.json"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="âœ… File emitted: custom-name.json"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="âœ… File emitted: custom-name.json"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="âœ… File emitted: custom-name.json"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#136 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:40.553Z level=INFO fiber=#137 message="âœ… Generated AsyncAPI specification: custom-name.json"
92 | 	const outputFile = Object.keys(result.outputs).find(
93 | 		f => f.endsWith(".yaml") || f.endsWith(".json"),
94 | 	)
95 | 
96 | 	if (!outputFile) {
97 | 		throw new Error("No AsyncAPI output generated")
                 ^
error: No AsyncAPI output generated
      at compileAsyncAPI (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:97:13)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/emitter-tester-verification.test.ts:59:24)
(fail) EmitterTester API Verification > should pass output-file option correctly [59.99ms]
timestamp=2025-11-18T20:59:40.634Z level=INFO fiber=#138 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:40.634Z level=INFO fiber=#138 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:40.634Z level=INFO fiber=#138 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:40.634Z level=INFO fiber=#138 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:40.644Z level=INFO fiber=#138 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:40.644Z level=INFO fiber=#138 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:40.644Z level=INFO fiber=#138 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:40.644Z level=INFO fiber=#138 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:40.644Z level=INFO fiber=#138 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:40.644Z level=INFO fiber=#138 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:40.644Z level=INFO fiber=#138 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:40.644Z level=INFO fiber=#138 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:40.644Z level=INFO fiber=#138 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:40.644Z level=INFO fiber=#138 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:40.644Z level=INFO fiber=#138 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:40.644Z level=INFO fiber=#138 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:40.646Z level=INFO fiber=#138 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:40.647Z level=INFO fiber=#138 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:40.647Z level=INFO fiber=#138 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:40.647Z level=INFO fiber=#138 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:40.647Z level=INFO fiber=#138 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:40.647Z level=INFO fiber=#138 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:40.648Z level=INFO fiber=#138 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:40.648Z level=INFO fiber=#138 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:40.648Z level=INFO fiber=#138 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:40.648Z level=INFO fiber=#138 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:40.648Z level=INFO fiber=#138 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:40.648Z level=INFO fiber=#138 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:40.648Z level=INFO fiber=#138 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:40.648Z level=INFO fiber=#138 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:40.648Z level=INFO fiber=#138 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:40.648Z level=INFO fiber=#138 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.03ms)"
timestamp=2025-11-18T20:59:40.648Z level=INFO fiber=#138 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:40.648Z level=INFO fiber=#138 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:40.649Z level=INFO fiber=#138 message="ğŸ” Emitting file: test-output.yaml"
timestamp=2025-11-18T20:59:40.649Z level=INFO fiber=#138 message="ğŸ” Emitting file: test-output.yaml"
timestamp=2025-11-18T20:59:40.649Z level=INFO fiber=#138 message="ğŸ” Emitting file: test-output.yaml"
timestamp=2025-11-18T20:59:40.649Z level=INFO fiber=#138 message="âœ… File emitted: test-output.yaml"
timestamp=2025-11-18T20:59:40.649Z level=INFO fiber=#138 message="âœ… File emitted: test-output.yaml"
timestamp=2025-11-18T20:59:40.649Z level=INFO fiber=#138 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:40.649Z level=INFO fiber=#138 message="âœ… File emitted: test-output.yaml"
timestamp=2025-11-18T20:59:40.649Z level=INFO fiber=#138 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:40.649Z level=INFO fiber=#139 message="âœ… Generated AsyncAPI specification: test-output.yaml"
92 | 	const outputFile = Object.keys(result.outputs).find(
93 | 		f => f.endsWith(".yaml") || f.endsWith(".json"),
94 | 	)
95 | 
96 | 	if (!outputFile) {
97 | 		throw new Error("No AsyncAPI output generated")
                 ^
error: No AsyncAPI output generated
      at compileAsyncAPI (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:97:13)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/emitter-tester-verification.test.ts:70:24)
(fail) EmitterTester API Verification > should provide direct access to outputs [95.33ms]
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.03ms)"
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:40.687Z level=INFO fiber=#140 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:40.698Z level=INFO fiber=#140 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.698Z level=INFO fiber=#140 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.698Z level=INFO fiber=#140 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.698Z level=INFO fiber=#140 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.698Z level=INFO fiber=#140 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.698Z level=INFO fiber=#140 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:40.698Z level=INFO fiber=#140 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.698Z level=INFO fiber=#140 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:40.698Z level=INFO fiber=#141 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
92 | 	const outputFile = Object.keys(result.outputs).find(
93 | 		f => f.endsWith(".yaml") || f.endsWith(".json"),
94 | 	)
95 | 
96 | 	if (!outputFile) {
97 | 		throw new Error("No AsyncAPI output generated")
                 ^
error: No AsyncAPI output generated
      at compileAsyncAPI (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:97:13)
      at async compileAsyncAPIWithoutErrors (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:127:23)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/emitter-tester-verification.test.ts:80:24)
(fail) EmitterTester API Verification > should parse AsyncAPI document correctly [49.86ms]
timestamp=2025-11-18T20:59:40.789Z level=INFO fiber=#142 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:40.789Z level=INFO fiber=#142 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:40.789Z level=INFO fiber=#142 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:40.789Z level=INFO fiber=#142 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:40.789Z level=INFO fiber=#142 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:40.789Z level=INFO fiber=#142 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:40.789Z level=INFO fiber=#142 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:40.789Z level=INFO fiber=#142 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:40.789Z level=INFO fiber=#142 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:40.789Z level=INFO fiber=#142 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:40.789Z level=INFO fiber=#142 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:40.789Z level=INFO fiber=#142 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:40.789Z level=INFO fiber=#142 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:40.789Z level=INFO fiber=#142 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:40.789Z level=INFO fiber=#142 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:40.789Z level=INFO fiber=#142 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:40.790Z level=INFO fiber=#142 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:40.790Z level=INFO fiber=#142 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:40.790Z level=INFO fiber=#142 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:40.790Z level=INFO fiber=#142 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:40.790Z level=INFO fiber=#142 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:40.790Z level=INFO fiber=#142 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:40.790Z level=INFO fiber=#142 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:40.790Z level=INFO fiber=#142 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:40.790Z level=INFO fiber=#142 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:40.790Z level=INFO fiber=#142 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:40.790Z level=INFO fiber=#142 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:40.790Z level=INFO fiber=#142 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:40.790Z level=INFO fiber=#142 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:40.790Z level=INFO fiber=#142 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:40.790Z level=INFO fiber=#142 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:40.790Z level=INFO fiber=#142 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.06ms)"
timestamp=2025-11-18T20:59:40.790Z level=INFO fiber=#142 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:40.790Z level=INFO fiber=#142 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:40.790Z level=INFO fiber=#142 message="ğŸ” Emitting file: options-test.json"
timestamp=2025-11-18T20:59:40.790Z level=INFO fiber=#142 message="ğŸ” Emitting file: options-test.json"
timestamp=2025-11-18T20:59:40.790Z level=INFO fiber=#142 message="ğŸ” Emitting file: options-test.json"
timestamp=2025-11-18T20:59:40.791Z level=INFO fiber=#142 message="âœ… File emitted: options-test.json"
timestamp=2025-11-18T20:59:40.791Z level=INFO fiber=#142 message="âœ… File emitted: options-test.json"
timestamp=2025-11-18T20:59:40.791Z level=INFO fiber=#142 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:40.791Z level=INFO fiber=#142 message="âœ… File emitted: options-test.json"
timestamp=2025-11-18T20:59:40.791Z level=INFO fiber=#142 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:40.791Z level=INFO fiber=#143 message="âœ… Generated AsyncAPI specification: options-test.json"
92 | 	const outputFile = Object.keys(result.outputs).find(
93 | 		f => f.endsWith(".yaml") || f.endsWith(".json"),
94 | 	)
95 | 
96 | 	if (!outputFile) {
97 | 		throw new Error("No AsyncAPI output generated")
                 ^
error: No AsyncAPI output generated
      at compileAsyncAPI (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:97:13)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/emitter-tester-verification.test.ts:103:24)
(fail) EmitterTester API Verification > CRITICAL: should pass options to emitter (OPTIONS PASSING VERIFICATION) [61.23ms]

test/breakthroughs/mock-elimination-verification.test.ts:
ğŸš€ compileAsyncAPISpecRaw called with source length: 203
timestamp=2025-11-18T20:59:40.894Z level=INFO fiber=#144 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:40.894Z level=INFO fiber=#144 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:40.894Z level=INFO fiber=#144 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:40.894Z level=INFO fiber=#144 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:40.894Z level=INFO fiber=#144 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:40.894Z level=INFO fiber=#144 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:40.894Z level=INFO fiber=#144 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:40.894Z level=INFO fiber=#144 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:40.894Z level=INFO fiber=#144 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:40.894Z level=INFO fiber=#144 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:40.894Z level=INFO fiber=#144 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:40.894Z level=INFO fiber=#144 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:40.894Z level=INFO fiber=#144 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:40.895Z level=INFO fiber=#144 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:40.895Z level=INFO fiber=#144 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:40.895Z level=INFO fiber=#144 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:40.895Z level=INFO fiber=#144 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:40.895Z level=INFO fiber=#144 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:40.895Z level=INFO fiber=#144 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:40.895Z level=INFO fiber=#144 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:40.895Z level=INFO fiber=#144 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:40.895Z level=INFO fiber=#144 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:40.895Z level=INFO fiber=#144 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:40.895Z level=INFO fiber=#144 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:40.895Z level=INFO fiber=#144 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:40.895Z level=INFO fiber=#144 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:40.895Z level=INFO fiber=#144 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:40.895Z level=INFO fiber=#144 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:40.895Z level=INFO fiber=#144 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:40.895Z level=INFO fiber=#144 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:40.896Z level=INFO fiber=#144 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:40.896Z level=INFO fiber=#144 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.12ms)"
timestamp=2025-11-18T20:59:40.896Z level=INFO fiber=#144 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:40.896Z level=INFO fiber=#144 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:40.897Z level=INFO fiber=#144 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.897Z level=INFO fiber=#144 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.897Z level=INFO fiber=#144 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.897Z level=INFO fiber=#144 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.897Z level=INFO fiber=#144 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.897Z level=INFO fiber=#144 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:40.897Z level=INFO fiber=#144 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.897Z level=INFO fiber=#144 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:40.897Z level=INFO fiber=#145 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
25 |     // This should use REAL TypeSpec compilation now, not mocks
26 |     const result = await compileAsyncAPISpecRaw(source)
27 | 
28 |     // The program should be a REAL TypeSpec Program with real methods
29 |     expect(result.program).toBeDefined()
30 |     expect(result.program.stateMap).toBeDefined()
                                         ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/breakthroughs/mock-elimination-verification.test.ts:30:37)
(fail) ğŸš¨ Mock Infrastructure Elimination > should use REAL TypeSpec Program instead of mock objects [103.28ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 204
timestamp=2025-11-18T20:59:40.963Z level=INFO fiber=#146 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:40.963Z level=INFO fiber=#146 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:40.963Z level=INFO fiber=#146 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:40.963Z level=INFO fiber=#146 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:40.963Z level=INFO fiber=#146 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:40.963Z level=INFO fiber=#146 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:40.964Z level=INFO fiber=#146 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:40.964Z level=INFO fiber=#146 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:40.964Z level=INFO fiber=#146 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:40.964Z level=INFO fiber=#146 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:40.964Z level=INFO fiber=#146 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:40.964Z level=INFO fiber=#146 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:40.964Z level=INFO fiber=#146 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:40.964Z level=INFO fiber=#146 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:40.964Z level=INFO fiber=#146 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:40.964Z level=INFO fiber=#146 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:40.964Z level=INFO fiber=#146 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:40.964Z level=INFO fiber=#146 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:40.964Z level=INFO fiber=#146 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:40.964Z level=INFO fiber=#146 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:40.964Z level=INFO fiber=#146 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:40.964Z level=INFO fiber=#146 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:40.964Z level=INFO fiber=#146 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:40.964Z level=INFO fiber=#146 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:40.964Z level=INFO fiber=#146 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:40.964Z level=INFO fiber=#146 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:40.964Z level=INFO fiber=#146 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:40.964Z level=INFO fiber=#146 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:40.964Z level=INFO fiber=#146 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:40.964Z level=INFO fiber=#146 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:40.964Z level=INFO fiber=#146 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:40.965Z level=INFO fiber=#146 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.07ms)"
timestamp=2025-11-18T20:59:40.965Z level=INFO fiber=#146 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:40.965Z level=INFO fiber=#146 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:40.966Z level=INFO fiber=#146 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.966Z level=INFO fiber=#146 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.966Z level=INFO fiber=#146 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.966Z level=INFO fiber=#146 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.966Z level=INFO fiber=#146 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.966Z level=INFO fiber=#146 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:40.966Z level=INFO fiber=#146 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:40.966Z level=INFO fiber=#146 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:40.966Z level=INFO fiber=#147 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
52 | 
53 |     const result = await compileAsyncAPISpecRaw(source)
54 | 
55 |     // Should have actual output files
56 |     expect(result.outputFiles).toBeDefined()
57 |     expect(result.outputFiles.size).toBeGreaterThan(0)
                                         ^
error: expect(received).toBeGreaterThan(expected)

Expected: > 0
Received: 0

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/breakthroughs/mock-elimination-verification.test.ts:57:37)
(fail) ğŸš¨ Mock Infrastructure Elimination > should generate AsyncAPI output using real emitter [71.30ms]

test/breakthroughs/breakthrough-verification.test.ts:
ğŸš€ compileAsyncAPISpecRaw called with source length: 167
timestamp=2025-11-18T20:59:41.033Z level=INFO fiber=#148 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:41.033Z level=INFO fiber=#148 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:41.033Z level=INFO fiber=#148 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:41.033Z level=INFO fiber=#148 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:41.033Z level=INFO fiber=#148 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:41.033Z level=INFO fiber=#148 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:41.033Z level=INFO fiber=#148 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:41.033Z level=INFO fiber=#148 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:41.033Z level=INFO fiber=#148 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:41.033Z level=INFO fiber=#148 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:41.033Z level=INFO fiber=#148 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:41.033Z level=INFO fiber=#148 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:41.033Z level=INFO fiber=#148 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:41.033Z level=INFO fiber=#148 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:41.033Z level=INFO fiber=#148 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:41.033Z level=INFO fiber=#148 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:41.034Z level=INFO fiber=#148 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:41.034Z level=INFO fiber=#148 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:41.034Z level=INFO fiber=#148 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:41.034Z level=INFO fiber=#148 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:41.034Z level=INFO fiber=#148 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:41.034Z level=INFO fiber=#148 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:41.034Z level=INFO fiber=#148 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:41.034Z level=INFO fiber=#148 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:41.034Z level=INFO fiber=#148 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:41.034Z level=INFO fiber=#148 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:41.034Z level=INFO fiber=#148 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:41.034Z level=INFO fiber=#148 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:41.034Z level=INFO fiber=#148 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:41.034Z level=INFO fiber=#148 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:41.034Z level=INFO fiber=#148 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:41.034Z level=INFO fiber=#148 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T20:59:41.034Z level=INFO fiber=#148 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:41.034Z level=INFO fiber=#148 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:41.035Z level=INFO fiber=#148 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:41.035Z level=INFO fiber=#148 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:41.035Z level=INFO fiber=#148 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:41.035Z level=INFO fiber=#148 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:41.035Z level=INFO fiber=#148 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:41.035Z level=INFO fiber=#148 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:41.035Z level=INFO fiber=#148 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:41.035Z level=INFO fiber=#148 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:41.035Z level=INFO fiber=#149 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi

test/breakthroughs/simple-mock-elimination.test.ts:
âœ… SUCCESS: Created REAL TypeSpec Program!
âœ… SUCCESS: No more mock Program objects!
Program has real methods: [ "loadTypeSpecScript", "getOption", "trace", "stateMap", "stateSet",
  "reportDiagnostic", "reportDiagnostics", "reportDuplicateSymbols", "hasError", "onValidate"
]
âœ… SUCCESS: Real Program methods work correctly!

test/decorators/subscribe.test.ts:
timestamp=2025-11-18T20:59:41.173Z level=INFO fiber=#150 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:41.173Z level=INFO fiber=#150 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:41.173Z level=INFO fiber=#150 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:41.173Z level=INFO fiber=#150 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:41.173Z level=INFO fiber=#150 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:41.173Z level=INFO fiber=#150 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:41.173Z level=INFO fiber=#150 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:41.173Z level=INFO fiber=#150 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:41.174Z level=INFO fiber=#150 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:41.174Z level=INFO fiber=#150 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:41.174Z level=INFO fiber=#150 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:41.174Z level=INFO fiber=#150 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:41.174Z level=INFO fiber=#150 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:41.174Z level=INFO fiber=#150 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:41.174Z level=INFO fiber=#150 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:41.174Z level=INFO fiber=#150 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:41.174Z level=INFO fiber=#150 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:41.174Z level=INFO fiber=#150 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:41.174Z level=INFO fiber=#150 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:41.174Z level=INFO fiber=#150 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:41.174Z level=INFO fiber=#150 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:41.174Z level=INFO fiber=#150 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:41.174Z level=INFO fiber=#150 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:41.174Z level=INFO fiber=#150 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:41.174Z level=INFO fiber=#150 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:41.174Z level=INFO fiber=#150 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:41.174Z level=INFO fiber=#150 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:41.174Z level=INFO fiber=#150 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:41.174Z level=INFO fiber=#150 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:41.174Z level=INFO fiber=#150 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:41.174Z level=INFO fiber=#150 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:41.174Z level=INFO fiber=#150 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.03ms)"
timestamp=2025-11-18T20:59:41.174Z level=INFO fiber=#150 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:41.174Z level=INFO fiber=#150 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:41.175Z level=INFO fiber=#150 message="ğŸ” Emitting file: test-subscribe.json"
timestamp=2025-11-18T20:59:41.175Z level=INFO fiber=#150 message="ğŸ” Emitting file: test-subscribe.json"
timestamp=2025-11-18T20:59:41.175Z level=INFO fiber=#150 message="ğŸ” Emitting file: test-subscribe.json"
timestamp=2025-11-18T20:59:41.175Z level=INFO fiber=#150 message="âœ… File emitted: test-subscribe.json"
timestamp=2025-11-18T20:59:41.175Z level=INFO fiber=#150 message="âœ… File emitted: test-subscribe.json"
timestamp=2025-11-18T20:59:41.175Z level=INFO fiber=#150 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:41.175Z level=INFO fiber=#150 message="âœ… File emitted: test-subscribe.json"
timestamp=2025-11-18T20:59:41.175Z level=INFO fiber=#150 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:41.175Z level=INFO fiber=#151 message="âœ… Generated AsyncAPI specification: test-subscribe.json"
92 | 	const outputFile = Object.keys(result.outputs).find(
93 | 		f => f.endsWith(".yaml") || f.endsWith(".json"),
94 | 	)
95 | 
96 | 	if (!outputFile) {
97 | 		throw new Error("No AsyncAPI output generated")
                 ^
error: No AsyncAPI output generated
      at compileAsyncAPI (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:97:13)
      at async compileAsyncAPIWithoutErrors (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:127:23)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/decorators/subscribe.test.ts:31:24)
(fail) @subscribe Decorator Tests > should compile @subscribe decorator successfully [71.34ms]
timestamp=2025-11-18T20:59:41.204Z level=INFO fiber=#152 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:41.204Z level=INFO fiber=#152 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:41.204Z level=INFO fiber=#152 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:41.204Z level=INFO fiber=#152 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:41.204Z level=INFO fiber=#152 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:41.204Z level=INFO fiber=#152 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:41.204Z level=INFO fiber=#152 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:41.204Z level=INFO fiber=#152 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="âœ… Discovery: 2 operations found"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="ğŸ”„ Processing 2 operations with Effect.TS..."
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="âœ… Processed 2 operations successfully"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 2,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 2
}"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="âœ… Processing: 2 elements processed"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="âœ… AsyncAPI document validation passed! 2 channels, 0 operations (0.03ms)"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="ğŸ” Emitting file: multi-subscribe-test.json"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="ğŸ” Emitting file: multi-subscribe-test.json"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="ğŸ” Emitting file: multi-subscribe-test.json"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="âœ… File emitted: multi-subscribe-test.json"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="âœ… File emitted: multi-subscribe-test.json"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="ğŸ‰ TYPESPEC API SUCCESS: 2 channels, 0 operations"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="âœ… File emitted: multi-subscribe-test.json"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#152 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:41.205Z level=INFO fiber=#153 message="âœ… Generated AsyncAPI specification: multi-subscribe-test.json"
92 | 	const outputFile = Object.keys(result.outputs).find(
93 | 		f => f.endsWith(".yaml") || f.endsWith(".json"),
94 | 	)
95 | 
96 | 	if (!outputFile) {
97 | 		throw new Error("No AsyncAPI output generated")
                 ^
error: No AsyncAPI output generated
      at compileAsyncAPI (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:97:13)
      at async compileAsyncAPIWithoutErrors (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:127:23)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/decorators/subscribe.test.ts:87:24)
(fail) @subscribe Decorator Tests > should handle multiple @subscribe operations [29.54ms]
timestamp=2025-11-18T20:59:41.249Z level=INFO fiber=#154 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:41.249Z level=INFO fiber=#154 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:41.251Z level=INFO fiber=#154 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:41.251Z level=INFO fiber=#154 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:41.252Z level=INFO fiber=#154 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:41.252Z level=INFO fiber=#154 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:41.252Z level=INFO fiber=#154 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:41.252Z level=INFO fiber=#154 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:41.252Z level=INFO fiber=#154 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:41.252Z level=INFO fiber=#154 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:41.252Z level=INFO fiber=#154 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:41.252Z level=INFO fiber=#154 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:41.252Z level=INFO fiber=#154 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:41.252Z level=INFO fiber=#154 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:41.252Z level=INFO fiber=#154 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:41.252Z level=INFO fiber=#154 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:41.252Z level=INFO fiber=#154 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:41.252Z level=INFO fiber=#154 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:41.252Z level=INFO fiber=#154 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:41.252Z level=INFO fiber=#154 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:41.252Z level=INFO fiber=#154 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:41.252Z level=INFO fiber=#154 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:41.252Z level=INFO fiber=#154 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:41.252Z level=INFO fiber=#154 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:41.253Z level=INFO fiber=#154 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:41.253Z level=INFO fiber=#154 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:41.253Z level=INFO fiber=#154 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:41.254Z level=INFO fiber=#154 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:41.254Z level=INFO fiber=#154 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:41.254Z level=INFO fiber=#154 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:41.254Z level=INFO fiber=#154 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:41.254Z level=INFO fiber=#154 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.07ms)"
timestamp=2025-11-18T20:59:41.254Z level=INFO fiber=#154 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:41.254Z level=INFO fiber=#154 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:41.254Z level=INFO fiber=#154 message="ğŸ” Emitting file: complex-subscribe-test.json"
timestamp=2025-11-18T20:59:41.254Z level=INFO fiber=#154 message="ğŸ” Emitting file: complex-subscribe-test.json"
timestamp=2025-11-18T20:59:41.254Z level=INFO fiber=#154 message="ğŸ” Emitting file: complex-subscribe-test.json"
timestamp=2025-11-18T20:59:41.254Z level=INFO fiber=#154 message="âœ… File emitted: complex-subscribe-test.json"
timestamp=2025-11-18T20:59:41.254Z level=INFO fiber=#154 message="âœ… File emitted: complex-subscribe-test.json"
timestamp=2025-11-18T20:59:41.254Z level=INFO fiber=#154 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:41.254Z level=INFO fiber=#154 message="âœ… File emitted: complex-subscribe-test.json"
timestamp=2025-11-18T20:59:41.254Z level=INFO fiber=#154 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:41.254Z level=INFO fiber=#155 message="âœ… Generated AsyncAPI specification: complex-subscribe-test.json"
92 | 	const outputFile = Object.keys(result.outputs).find(
93 | 		f => f.endsWith(".yaml") || f.endsWith(".json"),
94 | 	)
95 | 
96 | 	if (!outputFile) {
97 | 		throw new Error("No AsyncAPI output generated")
                 ^
error: No AsyncAPI output generated
      at compileAsyncAPI (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:97:13)
      at async compileAsyncAPIWithoutErrors (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:127:23)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/decorators/subscribe.test.ts:141:24)
(fail) @subscribe Decorator Tests > should handle @subscribe with complex message types [49.41ms]
timestamp=2025-11-18T20:59:41.284Z level=INFO fiber=#156 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:41.284Z level=INFO fiber=#156 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:41.284Z level=INFO fiber=#156 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:41.285Z level=INFO fiber=#156 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:41.285Z level=INFO fiber=#156 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:41.285Z level=INFO fiber=#156 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:41.285Z level=INFO fiber=#156 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:41.285Z level=INFO fiber=#156 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:41.285Z level=INFO fiber=#156 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:41.285Z level=INFO fiber=#156 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:41.285Z level=INFO fiber=#156 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:41.285Z level=INFO fiber=#156 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:41.285Z level=INFO fiber=#156 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:41.285Z level=INFO fiber=#156 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:41.285Z level=INFO fiber=#156 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:41.285Z level=INFO fiber=#156 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:41.285Z level=INFO fiber=#156 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:41.285Z level=INFO fiber=#156 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:41.285Z level=INFO fiber=#156 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:41.285Z level=INFO fiber=#156 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:41.285Z level=INFO fiber=#156 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:41.285Z level=INFO fiber=#156 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:41.285Z level=INFO fiber=#156 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:41.285Z level=INFO fiber=#156 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:41.285Z level=INFO fiber=#156 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:41.285Z level=INFO fiber=#156 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:41.285Z level=INFO fiber=#156 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:41.285Z level=INFO fiber=#156 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:41.285Z level=INFO fiber=#156 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:41.285Z level=INFO fiber=#156 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:41.285Z level=INFO fiber=#156 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:41.286Z level=INFO fiber=#156 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.06ms)"
timestamp=2025-11-18T20:59:41.286Z level=INFO fiber=#156 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:41.286Z level=INFO fiber=#156 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:41.286Z level=INFO fiber=#156 message="ğŸ” Emitting file: parameterized-subscribe-test.json"
timestamp=2025-11-18T20:59:41.286Z level=INFO fiber=#156 message="ğŸ” Emitting file: parameterized-subscribe-test.json"
timestamp=2025-11-18T20:59:41.286Z level=INFO fiber=#156 message="ğŸ” Emitting file: parameterized-subscribe-test.json"
timestamp=2025-11-18T20:59:41.286Z level=INFO fiber=#156 message="âœ… File emitted: parameterized-subscribe-test.json"
timestamp=2025-11-18T20:59:41.286Z level=INFO fiber=#156 message="âœ… File emitted: parameterized-subscribe-test.json"
timestamp=2025-11-18T20:59:41.286Z level=INFO fiber=#156 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:41.286Z level=INFO fiber=#156 message="âœ… File emitted: parameterized-subscribe-test.json"
timestamp=2025-11-18T20:59:41.286Z level=INFO fiber=#156 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:41.286Z level=INFO fiber=#157 message="âœ… Generated AsyncAPI specification: parameterized-subscribe-test.json"
92 | 	const outputFile = Object.keys(result.outputs).find(
93 | 		f => f.endsWith(".yaml") || f.endsWith(".json"),
94 | 	)
95 | 
96 | 	if (!outputFile) {
97 | 		throw new Error("No AsyncAPI output generated")
                 ^
error: No AsyncAPI output generated
      at compileAsyncAPI (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:97:13)
      at async compileAsyncAPIWithoutErrors (/Users/larsartmann/projects/typespec-asyncapi/test/utils/emitter-test-helpers.ts:127:23)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/decorators/subscribe.test.ts:185:24)
(fail) @subscribe Decorator Tests > should handle @subscribe with parameterized channels [31.44ms]

test/decorators/server.test.ts:
ğŸš€ compileAsyncAPISpecRaw called with source length: 325
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
28 |         "output-file": "server-valid",
29 |         "file-type": "json"
30 |       });
31 | 
32 |       const errors = diagnostics.filter(d => d.severity === "error");
33 |       expect(errors).toHaveLength(0);
                          ^
error: expect(received).toHaveLength(expected)

Expected length: 0
Received length: 1

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/decorators/server.test.ts:33:22)
(fail) @server decorator > basic functionality > should accept valid server configuration [156.31ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 604
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
61 |         "output-file": "multi-server",
62 |         "file-type": "json"
63 |       });
64 | 
65 |       const errors = diagnostics.filter(d => d.severity === "error");
66 |       expect(errors).toHaveLength(0);
                          ^
error: expect(received).toHaveLength(expected)

Expected length: 0
Received length: 3

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/decorators/server.test.ts:66:22)
(fail) @server decorator > basic functionality > should handle multiple server configurations [71.31ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 275
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
90 | 
91 |       // Should have error for missing URL
92 |       const urlErrors = diagnostics.filter(d =>
93 |         d.message?.includes("Server URL is required")
94 |       );
95 |       expect(urlErrors.length).toBeGreaterThan(0);
                                    ^
error: expect(received).toBeGreaterThan(expected)

Expected: > 0
Received: 0

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/decorators/server.test.ts:95:32)
(fail) @server decorator > basic functionality > should validate required server configuration fields [36.98ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 299
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
116 | 
117 |       // Should have error for missing protocol
118 |       const protocolErrors = diagnostics.filter(d =>
119 |         d.message?.includes("Server protocol is required")
120 |       );
121 |       expect(protocolErrors.length).toBeGreaterThan(0);
                                          ^
error: expect(received).toBeGreaterThan(expected)

Expected: > 0
Received: 0

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/decorators/server.test.ts:121:37)
(fail) @server decorator > basic functionality > should validate protocol field is required [75.17ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 337
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
153 |           "output-file": `protocol-${protocol.name}`,
154 |           "file-type": "json"
155 |         });
156 | 
157 |         const errors = diagnostics.filter(d => d.severity === "error");
158 |         expect(errors, `Protocol ${protocol.name} should be supported`).toHaveLength(0);
                                                                              ^
error: Protocol kafka should be supported

Expected length: 0
Received length: 1

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/decorators/server.test.ts:158:73)
(fail) @server decorator > protocol validation > should accept supported protocols [50.25ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 332
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
181 | 
182 |       // Should have error for unsupported protocol
183 |       const protocolErrors = diagnostics.filter(d =>
184 |         d.code === "@lars-artmann/typespec-asyncapi/unsupported-protocol"
185 |       );
186 |       expect(protocolErrors.length).toBeGreaterThan(0);
                                          ^
error: expect(received).toBeGreaterThan(expected)

Expected: > 0
Received: 0

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/decorators/server.test.ts:186:37)
(fail) @server decorator > protocol validation > should reject unsupported protocols [149.67ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 266
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
209 | 
210 |       // Should have error for applying @server to operation instead of namespace
211 |       const targetErrors = diagnostics.filter(d =>
212 |         d.message?.includes("@server can only be applied to namespaces")
213 |       );
214 |       expect(targetErrors.length).toBeGreaterThan(0);
                                        ^
error: expect(received).toBeGreaterThan(expected)

Expected: > 0
Received: 0

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/decorators/server.test.ts:214:35)
(fail) @server decorator > target validation > should only accept namespace targets [66.83ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 266
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
234 |         "output-file": "minimal-server",
235 |         "file-type": "json"
236 |       });
237 | 
238 |       const errors = diagnostics.filter(d => d.severity === "error");
239 |       expect(errors).toHaveLength(0);
                           ^
error: expect(received).toHaveLength(expected)

Expected length: 0
Received length: 1

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/decorators/server.test.ts:239:22)
(fail) @server decorator > configuration extraction > should handle minimal server configuration [47.54ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 351
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
270 |         "output-file": "documented-server",
271 |         "file-type": "json"
272 |       });
273 | 
274 |       const errors = diagnostics.filter(d => d.severity === "error");
275 |       expect(errors).toHaveLength(0);
                           ^
error: expect(received).toHaveLength(expected)

Expected length: 0
Received length: 1

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/decorators/server.test.ts:275:22)
(fail) @server decorator > configuration extraction > should preserve server descriptions [119.45ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 639
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
315 |         "output-file": "integration-test",
316 |         "file-type": "json"
317 |       });
318 | 
319 |       const errors = diagnostics.filter(d => d.severity === "error");
320 |       expect(errors).toHaveLength(0);
                           ^
error: expect(received).toHaveLength(expected)

Expected length: 0
Received length: 1

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/decorators/server.test.ts:320:22)
(fail) @server decorator > integration with other decorators > should work with @channel and @publish/@subscribe decorators [96.52ms]

test/integration/protocol-binding-integration.test.ts:
ğŸš€ compileAsyncAPISpecRaw called with source length: 455
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
318 | 	if (errors.length > 0) {
319 | 		Effect.log(`âŒ Compilation failed with ${errors.length} errors:`)
320 | 		for (const error of errors) {
321 | 			Effect.log(`  - ${error.message}`)
322 | 		}
323 | 		throw new Error(`Compilation failed with errors: ${errors.map(d => d.message).join(', ')}`)
                  ^
error: Compilation failed with errors: Expected 1 arguments, but got 2.
      at compileAsyncAPISpec (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:323:13)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/protocol-binding-integration.test.ts:35:26)
(fail) AsyncAPI Protocol Binding Integration > Kafka Protocol Integration > should generate AsyncAPI spec with Kafka server bindings [117.72ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 329
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
318 | 	if (errors.length > 0) {
319 | 		Effect.log(`âŒ Compilation failed with ${errors.length} errors:`)
320 | 		for (const error of errors) {
321 | 			Effect.log(`  - ${error.message}`)
322 | 		}
323 | 		throw new Error(`Compilation failed with errors: ${errors.map(d => d.message).join(', ')}`)
                  ^
error: Compilation failed with errors: Expected 1 arguments, but got 2.
      at compileAsyncAPISpec (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:323:13)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/protocol-binding-integration.test.ts:63:26)
(fail) AsyncAPI Protocol Binding Integration > Kafka Protocol Integration > should validate generated spec follows AsyncAPI 3.0 standard [105.80ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 566
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
318 | 	if (errors.length > 0) {
319 | 		Effect.log(`âŒ Compilation failed with ${errors.length} errors:`)
320 | 		for (const error of errors) {
321 | 			Effect.log(`  - ${error.message}`)
322 | 		}
323 | 		throw new Error(`Compilation failed with errors: ${errors.map(d => d.message).join(', ')}`)
                  ^
error: Compilation failed with errors: Expected 1 arguments, but got 2.
      at compileAsyncAPISpec (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:323:13)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/protocol-binding-integration.test.ts:99:26)
(fail) AsyncAPI Protocol Binding Integration > WebSocket Protocol Integration > should generate AsyncAPI spec with WebSocket channel bindings [73.17ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 423
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
318 | 	if (errors.length > 0) {
319 | 		Effect.log(`âŒ Compilation failed with ${errors.length} errors:`)
320 | 		for (const error of errors) {
321 | 			Effect.log(`  - ${error.message}`)
322 | 		}
323 | 		throw new Error(`Compilation failed with errors: ${errors.map(d => d.message).join(', ')}`)
                  ^
error: Compilation failed with errors: Expected 1 arguments, but got 2.
      at compileAsyncAPISpec (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:323:13)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/protocol-binding-integration.test.ts:131:26)
(fail) AsyncAPI Protocol Binding Integration > WebSocket Protocol Integration > should handle bidirectional WebSocket communication [118.95ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 497
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
318 | 	if (errors.length > 0) {
319 | 		Effect.log(`âŒ Compilation failed with ${errors.length} errors:`)
320 | 		for (const error of errors) {
321 | 			Effect.log(`  - ${error.message}`)
322 | 		}
323 | 		throw new Error(`Compilation failed with errors: ${errors.map(d => d.message).join(', ')}`)
                  ^
error: Compilation failed with errors: Expected 1 arguments, but got 2.
      at compileAsyncAPISpec (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:323:13)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/protocol-binding-integration.test.ts:160:26)
(fail) AsyncAPI Protocol Binding Integration > HTTP Protocol Integration > should generate AsyncAPI spec with HTTP operation bindings [69.00ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 475
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
318 | 	if (errors.length > 0) {
319 | 		Effect.log(`âŒ Compilation failed with ${errors.length} errors:`)
320 | 		for (const error of errors) {
321 | 			Effect.log(`  - ${error.message}`)
322 | 		}
323 | 		throw new Error(`Compilation failed with errors: ${errors.map(d => d.message).join(', ')}`)
                  ^
error: Compilation failed with errors: Expected 1 arguments, but got 2.
      at compileAsyncAPISpec (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:323:13)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/protocol-binding-integration.test.ts:190:26)
(fail) AsyncAPI Protocol Binding Integration > HTTP Protocol Integration > should support HTTP webhook patterns [102.29ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 722
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
318 | 	if (errors.length > 0) {
319 | 		Effect.log(`âŒ Compilation failed with ${errors.length} errors:`)
320 | 		for (const error of errors) {
321 | 			Effect.log(`  - ${error.message}`)
322 | 		}
323 | 		throw new Error(`Compilation failed with errors: ${errors.map(d => d.message).join(', ')}`)
                  ^
error: Compilation failed with errors: Expected 1 arguments, but got 2., Expected 1 arguments, but got 2.
      at compileAsyncAPISpec (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:323:13)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/protocol-binding-integration.test.ts:228:26)
(fail) AsyncAPI Protocol Binding Integration > Multi-Protocol Integration > should handle multiple protocols in a single specification [84.87ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 336
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
318 | 	if (errors.length > 0) {
319 | 		Effect.log(`âŒ Compilation failed with ${errors.length} errors:`)
320 | 		for (const error of errors) {
321 | 			Effect.log(`  - ${error.message}`)
322 | 		}
323 | 		throw new Error(`Compilation failed with errors: ${errors.map(d => d.message).join(', ')}`)
                  ^
error: Compilation failed with errors: Expected 1 arguments, but got 2.
      at compileAsyncAPISpec (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:323:13)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/protocol-binding-integration.test.ts:274:26)
(fail) AsyncAPI Protocol Binding Integration > AsyncAPI Specification Validation > should generate valid AsyncAPI 3.0 documents [76.87ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 389
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
318 | 	if (errors.length > 0) {
319 | 		Effect.log(`âŒ Compilation failed with ${errors.length} errors:`)
320 | 		for (const error of errors) {
321 | 			Effect.log(`  - ${error.message}`)
322 | 		}
323 | 		throw new Error(`Compilation failed with errors: ${errors.map(d => d.message).join(', ')}`)
                  ^
error: Compilation failed with errors: Expected 1 arguments, but got 2., Expected 1 arguments, but got 2.
      at compileAsyncAPISpec (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:323:13)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/protocol-binding-integration.test.ts:307:26)
(fail) AsyncAPI Protocol Binding Integration > AsyncAPI Specification Validation > should maintain protocol binding consistency [206.32ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 647
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
318 | 	if (errors.length > 0) {
319 | 		Effect.log(`âŒ Compilation failed with ${errors.length} errors:`)
320 | 		for (const error of errors) {
321 | 			Effect.log(`  - ${error.message}`)
322 | 		}
323 | 		throw new Error(`Compilation failed with errors: ${errors.map(d => d.message).join(', ')}`)
                  ^
error: Compilation failed with errors: Expected 1 arguments, but got 2., Expected 1 arguments, but got 2.
      at compileAsyncAPISpec (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:323:13)
      at async <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/protocol-binding-integration.test.ts:341:26)
(fail) AsyncAPI Protocol Binding Integration > AsyncAPI Specification Validation > should handle complex multi-protocol scenarios [113.50ms]

test/integration/basic-functionality.test.ts:
119 |     // Get the generated file content
120 |     const content = readFileSync(asyncapiFiles[0], 'utf8');
121 | 
122 |     // Validate basic AsyncAPI structure
123 |     expect(content).toContain("asyncapi: 3.0.0");
124 |     expect(content).toContain("publishSimpleEvent");
                          ^
error: expect(received).toContain(expected)

Expected to contain: "publishSimpleEvent"
Received: "asyncapi: 3.0.0\ninfo:\n  title: AsyncAPI Specification\n  version: 1.0.0\n  description: Generated from TypeSpec with @lars-artmann/typespec-asyncapi\nchannels:\n  users.events:\n    description: Channel for users.events operations\n    address: /users.events\n    messages:\n      users.eventsMessage:\n        $ref: \"#/components/messages/users.eventsMessage\"\n    operations:\n      send:\n        action: send\n        channel:\n          $ref: \"#/channels/users.events\"\n        summary: publishUserEvent operation\n        description: \"Generated from TypeSpec operation: publishUserEvent\"\n  orders.events:\n    description: Channel for orders.events operations\n    address: /orders.events\n    messages:\n      orders.eventsMessage:\n        $ref: \"#/components/messages/orders.eventsMessage\"\n    operations:\n      send:\n        action: send\n        channel:\n          $ref: \"#/channels/orders.events\"\n        summary: publishOrderEvent operation\n        description: \"Generated from TypeSpec operation: publishOrderEvent\"\noperations: {}\ncomponents:\n  schemas: {}\n  messages:\n    users.eventsMessage:\n      name: users.eventsMessage\n      title: users.events Message\n      description: Message for users.events operations\n      contentType: application/json\n      payload:\n        type: object\n        properties:\n          userId:\n            type: string\n          action:\n            type: string\n    orders.eventsMessage:\n      name: orders.eventsMessage\n      title: orders.events Message\n      description: Message for orders.events operations\n      contentType: application/json\n      payload:\n        type: object\n        properties:\n          orderId:\n            type: string\n          status:\n            type: string\n  securitySchemes: {}\n"

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/basic-functionality.test.ts:124:21)
(fail) AsyncAPI Basic Functionality > should compile simple TypeSpec to AsyncAPI using @channel decorator [3418.71ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 346
timestamp=2025-11-18T20:59:49.679Z level=INFO fiber=#158 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:49.680Z level=INFO fiber=#158 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:49.680Z level=INFO fiber=#158 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:49.680Z level=INFO fiber=#158 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:49.680Z level=INFO fiber=#158 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:49.680Z level=INFO fiber=#158 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:49.680Z level=INFO fiber=#158 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:49.680Z level=INFO fiber=#158 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:49.680Z level=INFO fiber=#158 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:49.680Z level=INFO fiber=#158 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:49.680Z level=INFO fiber=#158 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:49.680Z level=INFO fiber=#158 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:49.680Z level=INFO fiber=#158 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:49.680Z level=INFO fiber=#158 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:49.680Z level=INFO fiber=#158 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:49.680Z level=INFO fiber=#158 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:49.680Z level=INFO fiber=#158 message="âœ… Discovery: 2 operations found"
timestamp=2025-11-18T20:59:49.680Z level=INFO fiber=#158 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:49.680Z level=INFO fiber=#158 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:49.680Z level=INFO fiber=#158 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:49.680Z level=INFO fiber=#158 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:49.680Z level=INFO fiber=#158 message="ğŸ”„ Processing 2 operations with Effect.TS..."
timestamp=2025-11-18T20:59:49.681Z level=INFO fiber=#158 message="âœ… Processed 2 operations successfully"
timestamp=2025-11-18T20:59:49.681Z level=INFO fiber=#158 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:49.681Z level=INFO fiber=#158 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:49.681Z level=INFO fiber=#158 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:49.681Z level=INFO fiber=#158 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:49.681Z level=INFO fiber=#158 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 2,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 2
}"
timestamp=2025-11-18T20:59:49.681Z level=INFO fiber=#158 message="âœ… Processing: 2 elements processed"
timestamp=2025-11-18T20:59:49.681Z level=INFO fiber=#158 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:49.681Z level=INFO fiber=#158 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:49.681Z level=INFO fiber=#158 message="âœ… AsyncAPI document validation passed! 2 channels, 0 operations (0.10ms)"
timestamp=2025-11-18T20:59:49.681Z level=INFO fiber=#158 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:49.681Z level=INFO fiber=#158 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:49.682Z level=INFO fiber=#158 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:49.682Z level=INFO fiber=#158 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:49.682Z level=INFO fiber=#158 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:49.682Z level=INFO fiber=#158 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:49.682Z level=INFO fiber=#158 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:49.682Z level=INFO fiber=#158 message="ğŸ‰ TYPESPEC API SUCCESS: 2 channels, 0 operations"
timestamp=2025-11-18T20:59:49.682Z level=INFO fiber=#158 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:49.682Z level=INFO fiber=#158 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:49.683Z level=INFO fiber=#159 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: multi-channel.json
ğŸ” DEBUG: extractSchemaNameFromTest("multi-channel.json") = "UserEvent"
191 | 
192 |     const asyncapiDoc = await parseAsyncAPIOutput(outputFiles, "multi-channel.json");
193 |     const doc = asyncapiDoc as any;
194 | 
195 |     // Should have both operations
196 |     expect(doc.operations.publishUserEvent).toBeDefined();
                                                  ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/basic-functionality.test.ts:196:45)
(fail) AsyncAPI Basic Functionality > should handle multiple operations with different channels [73.42ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 371
timestamp=2025-11-18T20:59:49.786Z level=INFO fiber=#160 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:49.786Z level=INFO fiber=#160 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:49.786Z level=INFO fiber=#160 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:49.786Z level=INFO fiber=#160 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:49.786Z level=INFO fiber=#160 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:49.786Z level=INFO fiber=#160 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:49.786Z level=INFO fiber=#160 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:49.786Z level=INFO fiber=#160 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:49.786Z level=INFO fiber=#160 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:49.786Z level=INFO fiber=#160 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:49.786Z level=INFO fiber=#160 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:49.786Z level=INFO fiber=#160 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:49.786Z level=INFO fiber=#160 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:49.787Z level=INFO fiber=#160 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:49.787Z level=INFO fiber=#160 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:49.787Z level=INFO fiber=#160 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:49.787Z level=INFO fiber=#160 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:49.787Z level=INFO fiber=#160 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:49.787Z level=INFO fiber=#160 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:49.787Z level=INFO fiber=#160 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:49.787Z level=INFO fiber=#160 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:49.787Z level=INFO fiber=#160 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:49.787Z level=INFO fiber=#160 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:49.787Z level=INFO fiber=#160 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:49.788Z level=INFO fiber=#160 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:49.788Z level=INFO fiber=#160 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:49.788Z level=INFO fiber=#160 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:49.788Z level=INFO fiber=#160 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:49.788Z level=INFO fiber=#160 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:49.788Z level=INFO fiber=#160 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:49.788Z level=INFO fiber=#160 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:49.788Z level=INFO fiber=#160 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.13ms)"
timestamp=2025-11-18T20:59:49.788Z level=INFO fiber=#160 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:49.788Z level=INFO fiber=#160 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:49.790Z level=INFO fiber=#160 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:49.790Z level=INFO fiber=#160 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:49.790Z level=INFO fiber=#160 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:49.792Z level=INFO fiber=#160 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:49.792Z level=INFO fiber=#160 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:49.792Z level=INFO fiber=#160 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:49.792Z level=INFO fiber=#160 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:49.792Z level=INFO fiber=#160 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:49.792Z level=INFO fiber=#161 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: typed-test.json
ğŸ” DEBUG: extractSchemaNameFromTest("typed-test.json") = "null"
230 |     const asyncapiDoc = await parseAsyncAPIOutput(outputFiles, "typed-test.json");
231 |     const doc = asyncapiDoc as any;
232 |     const schema = doc.components.schemas.TypedEvent;
233 | 
234 |     // Validate type mappings
235 |     expect(schema.properties.stringField.type).toBe("string");
                 ^
TypeError: undefined is not an object (evaluating 'schema.properties')
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/basic-functionality.test.ts:235:12)
(fail) AsyncAPI Basic Functionality > should handle different TypeSpec data types [92.69ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 351
timestamp=2025-11-18T20:59:49.925Z level=INFO fiber=#162 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:49.925Z level=INFO fiber=#162 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:49.925Z level=INFO fiber=#162 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:49.925Z level=INFO fiber=#162 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:49.925Z level=INFO fiber=#162 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:49.925Z level=INFO fiber=#162 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:49.925Z level=INFO fiber=#162 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:49.925Z level=INFO fiber=#162 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:49.925Z level=INFO fiber=#162 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:49.926Z level=INFO fiber=#162 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:49.926Z level=INFO fiber=#162 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:49.926Z level=INFO fiber=#162 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:49.926Z level=INFO fiber=#162 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:49.926Z level=INFO fiber=#162 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:49.926Z level=INFO fiber=#162 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:49.926Z level=INFO fiber=#162 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:49.927Z level=INFO fiber=#162 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:49.927Z level=INFO fiber=#162 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:49.927Z level=INFO fiber=#162 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:49.927Z level=INFO fiber=#162 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:49.927Z level=INFO fiber=#162 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:49.927Z level=INFO fiber=#162 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:49.928Z level=INFO fiber=#162 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:49.928Z level=INFO fiber=#162 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:49.928Z level=INFO fiber=#162 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:49.928Z level=INFO fiber=#162 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:49.930Z level=INFO fiber=#162 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:49.930Z level=INFO fiber=#162 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:49.930Z level=INFO fiber=#162 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:49.930Z level=INFO fiber=#162 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:49.930Z level=INFO fiber=#162 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:49.930Z level=INFO fiber=#162 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.28ms)"
timestamp=2025-11-18T20:59:49.930Z level=INFO fiber=#162 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:49.930Z level=INFO fiber=#162 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:49.937Z level=INFO fiber=#162 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:49.937Z level=INFO fiber=#162 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:49.937Z level=INFO fiber=#162 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:49.938Z level=INFO fiber=#162 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:49.938Z level=INFO fiber=#162 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:49.938Z level=INFO fiber=#162 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:49.938Z level=INFO fiber=#162 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:49.938Z level=INFO fiber=#162 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:49.938Z level=INFO fiber=#163 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: doc-test.json
ğŸ” DEBUG: extractSchemaNameFromTest("doc-test.json") = "null"
269 |     const asyncapiDoc = await parseAsyncAPIOutput(outputFiles, "doc-test.json");
270 |     const doc = asyncapiDoc as any;
271 |     const schema = doc.components.schemas.DocumentedEvent;
272 | 
273 |     // Validate documentation is preserved
274 |     expect(schema.description).toBe("A well-documented event model");
                 ^
TypeError: undefined is not an object (evaluating 'schema.description')
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/basic-functionality.test.ts:274:12)
(fail) AsyncAPI Basic Functionality > should preserve @doc annotations [146.77ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 286
timestamp=2025-11-18T20:59:50.027Z level=INFO fiber=#164 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:50.027Z level=INFO fiber=#164 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:50.027Z level=INFO fiber=#164 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:50.027Z level=INFO fiber=#164 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:50.027Z level=INFO fiber=#164 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:50.027Z level=INFO fiber=#164 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:50.027Z level=INFO fiber=#164 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:50.027Z level=INFO fiber=#164 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:50.027Z level=INFO fiber=#164 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:50.027Z level=INFO fiber=#164 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:50.027Z level=INFO fiber=#164 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:50.027Z level=INFO fiber=#164 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:50.029Z level=INFO fiber=#164 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:50.029Z level=INFO fiber=#164 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:50.029Z level=INFO fiber=#164 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:50.029Z level=INFO fiber=#164 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:50.043Z level=INFO fiber=#164 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:50.043Z level=INFO fiber=#164 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:50.043Z level=INFO fiber=#164 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:50.043Z level=INFO fiber=#164 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:50.043Z level=INFO fiber=#164 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:50.043Z level=INFO fiber=#164 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:50.043Z level=INFO fiber=#164 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:50.043Z level=INFO fiber=#164 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:50.043Z level=INFO fiber=#164 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:50.044Z level=INFO fiber=#164 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:50.044Z level=INFO fiber=#164 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:50.044Z level=INFO fiber=#164 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:50.045Z level=INFO fiber=#164 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:50.046Z level=INFO fiber=#164 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:50.046Z level=INFO fiber=#164 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:50.046Z level=INFO fiber=#164 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.27ms)"
timestamp=2025-11-18T20:59:50.046Z level=INFO fiber=#164 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:50.046Z level=INFO fiber=#164 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:50.049Z level=INFO fiber=#164 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.049Z level=INFO fiber=#164 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.049Z level=INFO fiber=#164 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.049Z level=INFO fiber=#164 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.049Z level=INFO fiber=#164 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.049Z level=INFO fiber=#164 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:50.049Z level=INFO fiber=#164 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.049Z level=INFO fiber=#164 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:50.049Z level=INFO fiber=#165 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: param-test.json
ğŸ” DEBUG: extractSchemaNameFromTest("param-test.json") = "null"
298 | 
299 |     const asyncapiDoc = await parseAsyncAPIOutput(outputFiles, "param-test.json");
300 |     const doc = asyncapiDoc as any;
301 | 
302 |     // Should have operation with parameters
303 |     expect(doc.operations.publishParameterizedEvent).toBeDefined();
                                                           ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/basic-functionality.test.ts:303:54)
(fail) AsyncAPI Basic Functionality > should handle operations with parameters [208.48ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 337
timestamp=2025-11-18T20:59:50.302Z level=INFO fiber=#166 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:50.302Z level=INFO fiber=#166 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:50.302Z level=INFO fiber=#166 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:50.302Z level=INFO fiber=#166 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:50.302Z level=INFO fiber=#166 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:50.302Z level=INFO fiber=#166 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:50.302Z level=INFO fiber=#166 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:50.302Z level=INFO fiber=#166 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:50.302Z level=INFO fiber=#166 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:50.302Z level=INFO fiber=#166 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:50.302Z level=INFO fiber=#166 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:50.302Z level=INFO fiber=#166 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:50.302Z level=INFO fiber=#166 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:50.302Z level=INFO fiber=#166 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:50.302Z level=INFO fiber=#166 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:50.302Z level=INFO fiber=#166 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:50.302Z level=INFO fiber=#166 message="âœ… Discovery: 3 operations found"
timestamp=2025-11-18T20:59:50.302Z level=INFO fiber=#166 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:50.302Z level=INFO fiber=#166 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:50.302Z level=INFO fiber=#166 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:50.302Z level=INFO fiber=#166 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:50.302Z level=INFO fiber=#166 message="ğŸ”„ Processing 3 operations with Effect.TS..."
timestamp=2025-11-18T20:59:50.302Z level=INFO fiber=#166 message="âœ… Processed 3 operations successfully"
timestamp=2025-11-18T20:59:50.302Z level=INFO fiber=#166 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:50.303Z level=INFO fiber=#166 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:50.303Z level=INFO fiber=#166 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:50.303Z level=INFO fiber=#166 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:50.303Z level=INFO fiber=#166 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 3,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 3
}"
timestamp=2025-11-18T20:59:50.303Z level=INFO fiber=#166 message="âœ… Processing: 3 elements processed"
timestamp=2025-11-18T20:59:50.303Z level=INFO fiber=#166 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:50.303Z level=INFO fiber=#166 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:50.303Z level=INFO fiber=#166 message="âœ… AsyncAPI document validation passed! 3 channels, 0 operations (0.35ms)"
timestamp=2025-11-18T20:59:50.303Z level=INFO fiber=#166 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:50.303Z level=INFO fiber=#166 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:50.306Z level=INFO fiber=#166 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.306Z level=INFO fiber=#166 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.306Z level=INFO fiber=#166 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.306Z level=INFO fiber=#166 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.307Z level=INFO fiber=#166 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.307Z level=INFO fiber=#166 message="ğŸ‰ TYPESPEC API SUCCESS: 3 channels, 0 operations"
timestamp=2025-11-18T20:59:50.307Z level=INFO fiber=#166 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.307Z level=INFO fiber=#166 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:50.307Z level=INFO fiber=#167 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ“„ All available files: 
ğŸ“„ Selected file: undefined
âŒ ERROR: unique-names.json not found in output files!
ğŸ” Available files: 
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: undefined
703 | 
704 | 		// Generic fallback
705 | 		return createAlphaFallbackDocument("BasicEvent")
706 | 	} catch (error) {
707 | 		const availableFiles = Array.from(outputFiles.keys())
708 | 		throw new Error(`Failed to parse ${filename}: ${error}. Available files: ${availableFiles.join(", ")}`)
                  ^
error: Failed to parse undefined: TypeError: undefined is not an object (evaluating 'filename.replace'). Available files: 
      at parseAsyncAPIOutput (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:708:13)
      at parseAsyncAPIOutput (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:556:43)
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/basic-functionality.test.ts:353:31)
(fail) AsyncAPI Basic Functionality > should generate unique operation and channel names [206.10ms]

test/integration/decorator-validation.test.ts:
ğŸš€ compileAsyncAPISpecRaw called with source length: 411
timestamp=2025-11-18T20:59:50.573Z level=INFO fiber=#168 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:50.574Z level=INFO fiber=#168 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:50.574Z level=INFO fiber=#168 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:50.575Z level=INFO fiber=#168 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:50.575Z level=INFO fiber=#168 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:50.575Z level=INFO fiber=#168 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:50.575Z level=INFO fiber=#168 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:50.575Z level=INFO fiber=#168 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:50.575Z level=INFO fiber=#168 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:50.575Z level=INFO fiber=#168 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:50.575Z level=INFO fiber=#168 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:50.576Z level=INFO fiber=#168 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:50.578Z level=INFO fiber=#168 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:50.579Z level=INFO fiber=#168 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:50.579Z level=INFO fiber=#168 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:50.579Z level=INFO fiber=#168 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:50.580Z level=INFO fiber=#168 message="âœ… Discovery: 4 operations found"
timestamp=2025-11-18T20:59:50.580Z level=INFO fiber=#168 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:50.581Z level=INFO fiber=#168 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:50.581Z level=INFO fiber=#168 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:50.581Z level=INFO fiber=#168 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:50.581Z level=INFO fiber=#168 message="ğŸ”„ Processing 4 operations with Effect.TS..."
timestamp=2025-11-18T20:59:50.581Z level=INFO fiber=#168 message="âœ… Processed 4 operations successfully"
timestamp=2025-11-18T20:59:50.582Z level=INFO fiber=#168 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:50.582Z level=INFO fiber=#168 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:50.582Z level=INFO fiber=#168 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:50.582Z level=INFO fiber=#168 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:50.582Z level=INFO fiber=#168 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 4,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 4
}"
timestamp=2025-11-18T20:59:50.582Z level=INFO fiber=#168 message="âœ… Processing: 4 elements processed"
timestamp=2025-11-18T20:59:50.582Z level=INFO fiber=#168 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:50.582Z level=INFO fiber=#168 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:50.582Z level=INFO fiber=#168 message="âœ… AsyncAPI document validation passed! 4 channels, 0 operations (0.07ms)"
timestamp=2025-11-18T20:59:50.582Z level=INFO fiber=#168 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:50.582Z level=INFO fiber=#168 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:50.583Z level=INFO fiber=#168 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.583Z level=INFO fiber=#168 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.583Z level=INFO fiber=#168 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.584Z level=INFO fiber=#168 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.584Z level=INFO fiber=#168 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.584Z level=INFO fiber=#168 message="ğŸ‰ TYPESPEC API SUCCESS: 4 channels, 0 operations"
timestamp=2025-11-18T20:59:50.584Z level=INFO fiber=#168 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.584Z level=INFO fiber=#168 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:50.584Z level=INFO fiber=#169 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
29 |       const { diagnostics } = await compileAsyncAPISpec(source, {
30 |         "output-file": "channel-valid",
31 |         "file-type": "json"
32 |       });
33 | 
34 |       const errors = diagnostics.filter(d => d.severity === "error");
                          ^
TypeError: undefined is not an object (evaluating 'diagnostics.filter')
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/decorator-validation.test.ts:34:22)
(fail) AsyncAPI Decorator Validation > @channel decorator > should accept valid channel paths [209.61ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 326
timestamp=2025-11-18T20:59:50.694Z level=INFO fiber=#170 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:50.694Z level=INFO fiber=#170 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:50.694Z level=INFO fiber=#170 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:50.694Z level=INFO fiber=#170 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:50.694Z level=INFO fiber=#170 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:50.694Z level=INFO fiber=#170 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:50.694Z level=INFO fiber=#170 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:50.694Z level=INFO fiber=#170 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:50.694Z level=INFO fiber=#170 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:50.694Z level=INFO fiber=#170 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:50.694Z level=INFO fiber=#170 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:50.694Z level=INFO fiber=#170 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:50.694Z level=INFO fiber=#170 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:50.694Z level=INFO fiber=#170 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:50.694Z level=INFO fiber=#170 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:50.694Z level=INFO fiber=#170 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:50.694Z level=INFO fiber=#170 message="âœ… Discovery: 3 operations found"
timestamp=2025-11-18T20:59:50.694Z level=INFO fiber=#170 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:50.694Z level=INFO fiber=#170 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:50.694Z level=INFO fiber=#170 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:50.694Z level=INFO fiber=#170 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:50.695Z level=INFO fiber=#170 message="ğŸ”„ Processing 3 operations with Effect.TS..."
timestamp=2025-11-18T20:59:50.695Z level=INFO fiber=#170 message="âœ… Processed 3 operations successfully"
timestamp=2025-11-18T20:59:50.695Z level=INFO fiber=#170 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:50.695Z level=INFO fiber=#170 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:50.695Z level=INFO fiber=#170 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:50.703Z level=INFO fiber=#170 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:50.704Z level=INFO fiber=#170 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 3,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 3
}"
timestamp=2025-11-18T20:59:50.704Z level=INFO fiber=#170 message="âœ… Processing: 3 elements processed"
timestamp=2025-11-18T20:59:50.704Z level=INFO fiber=#170 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:50.704Z level=INFO fiber=#170 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:50.704Z level=INFO fiber=#170 message="âœ… AsyncAPI document validation passed! 3 channels, 0 operations (0.09ms)"
timestamp=2025-11-18T20:59:50.705Z level=INFO fiber=#170 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:50.705Z level=INFO fiber=#170 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:50.708Z level=INFO fiber=#170 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.711Z level=INFO fiber=#170 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.711Z level=INFO fiber=#170 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.711Z level=INFO fiber=#170 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.711Z level=INFO fiber=#170 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.711Z level=INFO fiber=#170 message="ğŸ‰ TYPESPEC API SUCCESS: 3 channels, 0 operations"
timestamp=2025-11-18T20:59:50.711Z level=INFO fiber=#170 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.711Z level=INFO fiber=#170 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:50.711Z level=INFO fiber=#171 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
55 |         "output-file": "channel-validation",
56 |         "file-type": "json"
57 |       });
58 | 
59 |       // Should have diagnostics for invalid channels but not for valid ones
60 |       const channelErrors = diagnostics.filter(d =>
                                 ^
TypeError: undefined is not an object (evaluating 'diagnostics.filter')
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/decorator-validation.test.ts:60:29)
(fail) AsyncAPI Decorator Validation > @channel decorator > should validate channel path format [115.33ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 274
timestamp=2025-11-18T20:59:50.811Z level=INFO fiber=#172 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:50.811Z level=INFO fiber=#172 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:50.811Z level=INFO fiber=#172 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:50.811Z level=INFO fiber=#172 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:50.811Z level=INFO fiber=#172 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:50.811Z level=INFO fiber=#172 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:50.811Z level=INFO fiber=#172 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:50.811Z level=INFO fiber=#172 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:50.811Z level=INFO fiber=#172 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:50.811Z level=INFO fiber=#172 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:50.811Z level=INFO fiber=#172 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:50.811Z level=INFO fiber=#172 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:50.811Z level=INFO fiber=#172 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:50.811Z level=INFO fiber=#172 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:50.811Z level=INFO fiber=#172 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:50.811Z level=INFO fiber=#172 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:50.812Z level=INFO fiber=#172 message="âœ… Discovery: 2 operations found"
timestamp=2025-11-18T20:59:50.812Z level=INFO fiber=#172 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:50.812Z level=INFO fiber=#172 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:50.812Z level=INFO fiber=#172 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:50.812Z level=INFO fiber=#172 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:50.812Z level=INFO fiber=#172 message="ğŸ”„ Processing 2 operations with Effect.TS..."
timestamp=2025-11-18T20:59:50.812Z level=INFO fiber=#172 message="âœ… Processed 2 operations successfully"
timestamp=2025-11-18T20:59:50.812Z level=INFO fiber=#172 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:50.812Z level=INFO fiber=#172 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:50.812Z level=INFO fiber=#172 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:50.813Z level=INFO fiber=#172 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:50.813Z level=INFO fiber=#172 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 2,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 2
}"
timestamp=2025-11-18T20:59:50.813Z level=INFO fiber=#172 message="âœ… Processing: 2 elements processed"
timestamp=2025-11-18T20:59:50.813Z level=INFO fiber=#172 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:50.813Z level=INFO fiber=#172 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:50.813Z level=INFO fiber=#172 message="âœ… AsyncAPI document validation passed! 2 channels, 0 operations (0.13ms)"
timestamp=2025-11-18T20:59:50.813Z level=INFO fiber=#172 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:50.813Z level=INFO fiber=#172 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:50.814Z level=INFO fiber=#172 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.814Z level=INFO fiber=#172 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.814Z level=INFO fiber=#172 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.815Z level=INFO fiber=#172 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.815Z level=INFO fiber=#172 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.815Z level=INFO fiber=#172 message="ğŸ‰ TYPESPEC API SUCCESS: 2 channels, 0 operations"
timestamp=2025-11-18T20:59:50.815Z level=INFO fiber=#172 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.815Z level=INFO fiber=#172 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:50.815Z level=INFO fiber=#173 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
83 |         "output-file": "missing-channel",
84 |         "file-type": "json"
85 |       });
86 | 
87 |       // Check for missing channel diagnostic
88 |       const missingChannelErrors = diagnostics.filter(d =>
                                        ^
TypeError: undefined is not an object (evaluating 'diagnostics.filter')
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/decorator-validation.test.ts:88:36)
(fail) AsyncAPI Decorator Validation > @channel decorator > should require @channel decorator for operations [132.66ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 426
timestamp=2025-11-18T20:59:50.926Z level=INFO fiber=#174 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:50.927Z level=INFO fiber=#174 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:50.927Z level=INFO fiber=#174 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:50.927Z level=INFO fiber=#174 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:50.927Z level=INFO fiber=#174 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:50.927Z level=INFO fiber=#174 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:50.927Z level=INFO fiber=#174 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:50.927Z level=INFO fiber=#174 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:50.927Z level=INFO fiber=#174 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:50.928Z level=INFO fiber=#174 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:50.928Z level=INFO fiber=#174 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:50.928Z level=INFO fiber=#174 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:50.928Z level=INFO fiber=#174 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:50.928Z level=INFO fiber=#174 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:50.928Z level=INFO fiber=#174 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:50.928Z level=INFO fiber=#174 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:50.928Z level=INFO fiber=#174 message="âœ… Discovery: 3 operations found"
timestamp=2025-11-18T20:59:50.928Z level=INFO fiber=#174 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:50.928Z level=INFO fiber=#174 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:50.928Z level=INFO fiber=#174 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:50.928Z level=INFO fiber=#174 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:50.929Z level=INFO fiber=#174 message="ğŸ”„ Processing 3 operations with Effect.TS..."
timestamp=2025-11-18T20:59:50.929Z level=INFO fiber=#174 message="âœ… Processed 3 operations successfully"
timestamp=2025-11-18T20:59:50.929Z level=INFO fiber=#174 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:50.929Z level=INFO fiber=#174 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:50.929Z level=INFO fiber=#174 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:50.929Z level=INFO fiber=#174 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:50.929Z level=INFO fiber=#174 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 3,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 3
}"
timestamp=2025-11-18T20:59:50.929Z level=INFO fiber=#174 message="âœ… Processing: 3 elements processed"
timestamp=2025-11-18T20:59:50.929Z level=INFO fiber=#174 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:50.929Z level=INFO fiber=#174 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:50.929Z level=INFO fiber=#174 message="âœ… AsyncAPI document validation passed! 3 channels, 0 operations (0.07ms)"
timestamp=2025-11-18T20:59:50.929Z level=INFO fiber=#174 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:50.930Z level=INFO fiber=#174 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:50.931Z level=INFO fiber=#174 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.931Z level=INFO fiber=#174 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.931Z level=INFO fiber=#174 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.931Z level=INFO fiber=#174 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.931Z level=INFO fiber=#174 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.931Z level=INFO fiber=#174 message="ğŸ‰ TYPESPEC API SUCCESS: 3 channels, 0 operations"
timestamp=2025-11-18T20:59:50.931Z level=INFO fiber=#174 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:50.931Z level=INFO fiber=#174 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:50.931Z level=INFO fiber=#175 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
117 |       const { diagnostics, outputFiles } = await compileAsyncAPISpec(source, {
118 |         "output-file": "operation-types",
119 |         "file-type": "json"
120 |       });
121 | 
122 |       const errors = diagnostics.filter(d => d.severity === "error");
                           ^
TypeError: undefined is not an object (evaluating 'diagnostics.filter')
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/decorator-validation.test.ts:122:22)
(fail) AsyncAPI Decorator Validation > Operation type validation > should handle @publish and @subscribe decorators [92.43ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 305
timestamp=2025-11-18T20:59:51.027Z level=INFO fiber=#176 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:51.027Z level=INFO fiber=#176 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:51.027Z level=INFO fiber=#176 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:51.027Z level=INFO fiber=#176 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:51.027Z level=INFO fiber=#176 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:51.027Z level=INFO fiber=#176 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:51.027Z level=INFO fiber=#176 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:51.027Z level=INFO fiber=#176 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:51.027Z level=INFO fiber=#176 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:51.027Z level=INFO fiber=#176 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:51.027Z level=INFO fiber=#176 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:51.027Z level=INFO fiber=#176 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:51.027Z level=INFO fiber=#176 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:51.027Z level=INFO fiber=#176 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:51.027Z level=INFO fiber=#176 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:51.027Z level=INFO fiber=#176 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:51.028Z level=INFO fiber=#176 message="âœ… Discovery: 2 operations found"
timestamp=2025-11-18T20:59:51.028Z level=INFO fiber=#176 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:51.028Z level=INFO fiber=#176 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:51.028Z level=INFO fiber=#176 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:51.028Z level=INFO fiber=#176 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:51.028Z level=INFO fiber=#176 message="ğŸ”„ Processing 2 operations with Effect.TS..."
timestamp=2025-11-18T20:59:51.028Z level=INFO fiber=#176 message="âœ… Processed 2 operations successfully"
timestamp=2025-11-18T20:59:51.028Z level=INFO fiber=#176 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:51.028Z level=INFO fiber=#176 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:51.028Z level=INFO fiber=#176 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:51.028Z level=INFO fiber=#176 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:51.028Z level=INFO fiber=#176 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 2,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 2
}"
timestamp=2025-11-18T20:59:51.028Z level=INFO fiber=#176 message="âœ… Processing: 2 elements processed"
timestamp=2025-11-18T20:59:51.028Z level=INFO fiber=#176 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:51.028Z level=INFO fiber=#176 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:51.028Z level=INFO fiber=#176 message="âœ… AsyncAPI document validation passed! 2 channels, 0 operations (0.05ms)"
timestamp=2025-11-18T20:59:51.028Z level=INFO fiber=#176 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:51.028Z level=INFO fiber=#176 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:51.029Z level=INFO fiber=#176 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.029Z level=INFO fiber=#176 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.029Z level=INFO fiber=#176 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.029Z level=INFO fiber=#176 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.029Z level=INFO fiber=#176 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.030Z level=INFO fiber=#176 message="ğŸ‰ TYPESPEC API SUCCESS: 2 channels, 0 operations"
timestamp=2025-11-18T20:59:51.030Z level=INFO fiber=#176 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.030Z level=INFO fiber=#176 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:51.030Z level=INFO fiber=#177 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
146 |         "output-file": "conflict-test",
147 |         "file-type": "json"
148 |       });
149 | 
150 |       // Should detect the conflict
151 |       const conflictErrors = diagnostics.filter(d =>
                                   ^
TypeError: undefined is not an object (evaluating 'diagnostics.filter')
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/decorator-validation.test.ts:151:30)
(fail) AsyncAPI Decorator Validation > Operation type validation > should detect conflicting @publish and @subscribe decorators [92.77ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 768
timestamp=2025-11-18T20:59:51.104Z level=INFO fiber=#178 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:51.104Z level=INFO fiber=#178 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:51.104Z level=INFO fiber=#178 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:51.104Z level=INFO fiber=#178 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:51.104Z level=INFO fiber=#178 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:51.104Z level=INFO fiber=#178 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:51.104Z level=INFO fiber=#178 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:51.104Z level=INFO fiber=#178 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:51.104Z level=INFO fiber=#178 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:51.104Z level=INFO fiber=#178 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:51.104Z level=INFO fiber=#178 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:51.104Z level=INFO fiber=#178 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:51.104Z level=INFO fiber=#178 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:51.104Z level=INFO fiber=#178 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:51.104Z level=INFO fiber=#178 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:51.104Z level=INFO fiber=#178 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:51.104Z level=INFO fiber=#178 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:51.104Z level=INFO fiber=#178 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:51.104Z level=INFO fiber=#178 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:51.104Z level=INFO fiber=#178 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:51.104Z level=INFO fiber=#178 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:51.104Z level=INFO fiber=#178 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:51.104Z level=INFO fiber=#178 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:51.104Z level=INFO fiber=#178 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:51.104Z level=INFO fiber=#178 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:51.104Z level=INFO fiber=#178 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:51.104Z level=INFO fiber=#178 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:51.105Z level=INFO fiber=#178 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:51.105Z level=INFO fiber=#178 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:51.105Z level=INFO fiber=#178 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:51.105Z level=INFO fiber=#178 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:51.105Z level=INFO fiber=#178 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.06ms)"
timestamp=2025-11-18T20:59:51.105Z level=INFO fiber=#178 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:51.105Z level=INFO fiber=#178 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:51.107Z level=INFO fiber=#178 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.107Z level=INFO fiber=#178 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.107Z level=INFO fiber=#178 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.107Z level=INFO fiber=#178 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.107Z level=INFO fiber=#178 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.108Z level=INFO fiber=#178 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:51.108Z level=INFO fiber=#178 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.108Z level=INFO fiber=#178 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:51.108Z level=INFO fiber=#179 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
195 |       const { diagnostics, outputFiles } = await compileAsyncAPISpec(source, {
196 |         "output-file": "model-validation",
197 |         "file-type": "json"
198 |       });
199 | 
200 |       const errors = diagnostics.filter(d => d.severity === "error");
                           ^
TypeError: undefined is not an object (evaluating 'diagnostics.filter')
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/decorator-validation.test.ts:200:22)
(fail) AsyncAPI Decorator Validation > Model validation > should handle models with all supported field types [79.07ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 244
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:51.389Z level=INFO fiber=#180 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T20:59:51.390Z level=INFO fiber=#180 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:51.390Z level=INFO fiber=#180 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:51.391Z level=INFO fiber=#180 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.391Z level=INFO fiber=#180 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.391Z level=INFO fiber=#180 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.391Z level=INFO fiber=#180 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.391Z level=INFO fiber=#180 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.391Z level=INFO fiber=#180 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:51.391Z level=INFO fiber=#180 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.391Z level=INFO fiber=#180 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:51.391Z level=INFO fiber=#181 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
231 |         "output-file": "recursive-test",
232 |         "file-type": "json"
233 |       });
234 | 
235 |       // Recursive models should not cause infinite loops
236 |       const errors = diagnostics.filter(d => d.severity === "error");
                           ^
TypeError: undefined is not an object (evaluating 'diagnostics.filter')
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/decorator-validation.test.ts:236:22)
(fail) AsyncAPI Decorator Validation > Model validation > should handle recursive models appropriately [289.29ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 690
timestamp=2025-11-18T20:59:51.460Z level=INFO fiber=#182 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:51.460Z level=INFO fiber=#182 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:51.461Z level=INFO fiber=#182 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:51.461Z level=INFO fiber=#182 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:51.461Z level=INFO fiber=#182 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:51.461Z level=INFO fiber=#182 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:51.461Z level=INFO fiber=#182 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:51.461Z level=INFO fiber=#182 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:51.461Z level=INFO fiber=#182 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:51.461Z level=INFO fiber=#182 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:51.461Z level=INFO fiber=#182 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:51.461Z level=INFO fiber=#182 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:51.461Z level=INFO fiber=#182 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:51.461Z level=INFO fiber=#182 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:51.461Z level=INFO fiber=#182 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:51.461Z level=INFO fiber=#182 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:51.461Z level=INFO fiber=#182 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:51.461Z level=INFO fiber=#182 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:51.461Z level=INFO fiber=#182 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:51.462Z level=INFO fiber=#182 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:51.462Z level=INFO fiber=#182 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:51.462Z level=INFO fiber=#182 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:51.462Z level=INFO fiber=#182 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:51.462Z level=INFO fiber=#182 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:51.462Z level=INFO fiber=#182 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:51.462Z level=INFO fiber=#182 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:51.462Z level=INFO fiber=#182 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:51.462Z level=INFO fiber=#182 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:51.462Z level=INFO fiber=#182 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:51.462Z level=INFO fiber=#182 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:51.462Z level=INFO fiber=#182 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:51.462Z level=INFO fiber=#182 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.06ms)"
timestamp=2025-11-18T20:59:51.462Z level=INFO fiber=#182 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:51.462Z level=INFO fiber=#182 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:51.464Z level=INFO fiber=#182 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.464Z level=INFO fiber=#182 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.465Z level=INFO fiber=#182 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.465Z level=INFO fiber=#182 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.465Z level=INFO fiber=#182 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.465Z level=INFO fiber=#182 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:51.465Z level=INFO fiber=#182 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.465Z level=INFO fiber=#182 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:51.465Z level=INFO fiber=#183 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
273 |       const { diagnostics, outputFiles } = await compileAsyncAPISpec(source, {
274 |         "output-file": "doc-validation",
275 |         "file-type": "json"
276 |       });
277 | 
278 |       const errors = diagnostics.filter(d => d.severity === "error");
                           ^
TypeError: undefined is not an object (evaluating 'diagnostics.filter')
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/decorator-validation.test.ts:278:22)
(fail) AsyncAPI Decorator Validation > Documentation validation > should preserve @doc decorations [67.14ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 579
timestamp=2025-11-18T20:59:51.516Z level=INFO fiber=#184 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:51.516Z level=INFO fiber=#184 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:51.516Z level=INFO fiber=#184 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:51.516Z level=INFO fiber=#184 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:51.516Z level=INFO fiber=#184 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:51.516Z level=INFO fiber=#184 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:51.516Z level=INFO fiber=#184 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:51.516Z level=INFO fiber=#184 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:51.516Z level=INFO fiber=#184 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:51.516Z level=INFO fiber=#184 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:51.516Z level=INFO fiber=#184 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:51.516Z level=INFO fiber=#184 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:51.516Z level=INFO fiber=#184 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:51.516Z level=INFO fiber=#184 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:51.516Z level=INFO fiber=#184 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:51.516Z level=INFO fiber=#184 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:51.516Z level=INFO fiber=#184 message="âœ… Discovery: 2 operations found"
timestamp=2025-11-18T20:59:51.516Z level=INFO fiber=#184 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:51.516Z level=INFO fiber=#184 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:51.516Z level=INFO fiber=#184 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:51.516Z level=INFO fiber=#184 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:51.516Z level=INFO fiber=#184 message="ğŸ”„ Processing 2 operations with Effect.TS..."
timestamp=2025-11-18T20:59:51.517Z level=INFO fiber=#184 message="âœ… Processed 2 operations successfully"
timestamp=2025-11-18T20:59:51.517Z level=INFO fiber=#184 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:51.517Z level=INFO fiber=#184 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:51.517Z level=INFO fiber=#184 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:51.517Z level=INFO fiber=#184 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:51.517Z level=INFO fiber=#184 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 2,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 2
}"
timestamp=2025-11-18T20:59:51.517Z level=INFO fiber=#184 message="âœ… Processing: 2 elements processed"
timestamp=2025-11-18T20:59:51.517Z level=INFO fiber=#184 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:51.517Z level=INFO fiber=#184 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:51.517Z level=INFO fiber=#184 message="âœ… AsyncAPI document validation passed! 2 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T20:59:51.517Z level=INFO fiber=#184 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:51.517Z level=INFO fiber=#184 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:51.518Z level=INFO fiber=#184 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.518Z level=INFO fiber=#184 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.518Z level=INFO fiber=#184 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.518Z level=INFO fiber=#184 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.518Z level=INFO fiber=#184 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.518Z level=INFO fiber=#184 message="ğŸ‰ TYPESPEC API SUCCESS: 2 channels, 0 operations"
timestamp=2025-11-18T20:59:51.518Z level=INFO fiber=#184 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.518Z level=INFO fiber=#184 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:51.518Z level=INFO fiber=#185 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
334 |       const { diagnostics, outputFiles } = await compileAsyncAPISpec(source, {
335 |         "output-file": "parameter-test",
336 |         "file-type": "json"
337 |       });
338 | 
339 |       const errors = diagnostics.filter(d => d.severity === "error");
                           ^
TypeError: undefined is not an object (evaluating 'diagnostics.filter')
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/decorator-validation.test.ts:339:22)
(fail) AsyncAPI Decorator Validation > Parameter validation > should handle operations with parameters [54.39ms]

test/integration/asyncapi-generation.test.ts:
ğŸš€ compileAsyncAPISpecRaw called with source length: 7864
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="âœ… Discovery: 10 operations found"
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="ğŸ”„ Processing 10 operations with Effect.TS..."
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="âœ… Processed 10 operations successfully"
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 10,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 10
}"
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="âœ… Processing: 10 elements processed"
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="âœ… AsyncAPI document validation passed! 10 channels, 0 operations (0.06ms)"
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:51.589Z level=INFO fiber=#186 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:51.598Z level=INFO fiber=#186 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.598Z level=INFO fiber=#186 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.598Z level=INFO fiber=#186 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.598Z level=INFO fiber=#186 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.598Z level=INFO fiber=#186 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.598Z level=INFO fiber=#186 message="ğŸ‰ TYPESPEC API SUCCESS: 10 channels, 0 operations"
timestamp=2025-11-18T20:59:51.598Z level=INFO fiber=#186 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.598Z level=INFO fiber=#186 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:51.598Z level=INFO fiber=#187 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
303 | 
304 | 			const {outputFiles, program} = await compileAsyncAPISpecWithoutErrors(source)
305 | 
306 | 			// Verify comprehensive compilation
307 | 			expect(program).toBeDefined()
308 | 			expect(outputFiles.size).toBeGreaterThan(0)
                                  ^
error: expect(received).toBeGreaterThan(expected)

Expected: > 0
Received: 0

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/asyncapi-generation.test.ts:308:29)
(fail) Real AsyncAPI Generation Tests > Complete TypeSpec â†’ AsyncAPI Transformation > should transform complex TypeSpec namespace to valid AsyncAPI document [60.83ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 969
timestamp=2025-11-18T20:59:51.669Z level=INFO fiber=#188 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:51.669Z level=INFO fiber=#188 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:51.669Z level=INFO fiber=#188 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:51.669Z level=INFO fiber=#188 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:51.669Z level=INFO fiber=#188 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:51.669Z level=INFO fiber=#188 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:51.669Z level=INFO fiber=#188 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:51.669Z level=INFO fiber=#188 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:51.669Z level=INFO fiber=#188 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:51.669Z level=INFO fiber=#188 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:51.669Z level=INFO fiber=#188 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:51.669Z level=INFO fiber=#188 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:51.669Z level=INFO fiber=#188 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:51.669Z level=INFO fiber=#188 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:51.669Z level=INFO fiber=#188 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:51.669Z level=INFO fiber=#188 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:51.669Z level=INFO fiber=#188 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:51.669Z level=INFO fiber=#188 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:51.669Z level=INFO fiber=#188 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:51.669Z level=INFO fiber=#188 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:51.669Z level=INFO fiber=#188 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:51.669Z level=INFO fiber=#188 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:51.670Z level=INFO fiber=#188 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:51.670Z level=INFO fiber=#188 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:51.670Z level=INFO fiber=#188 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:51.670Z level=INFO fiber=#188 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:51.670Z level=INFO fiber=#188 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:51.670Z level=INFO fiber=#188 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:51.670Z level=INFO fiber=#188 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:51.670Z level=INFO fiber=#188 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:51.670Z level=INFO fiber=#188 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:51.670Z level=INFO fiber=#188 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T20:59:51.670Z level=INFO fiber=#188 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:51.670Z level=INFO fiber=#188 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:51.673Z level=INFO fiber=#188 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.673Z level=INFO fiber=#188 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.673Z level=INFO fiber=#188 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.674Z level=INFO fiber=#188 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.674Z level=INFO fiber=#188 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.674Z level=INFO fiber=#188 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:51.674Z level=INFO fiber=#188 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.674Z level=INFO fiber=#188 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:51.674Z level=INFO fiber=#189 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: union-type-test.json
ğŸ” DEBUG: extractSchemaNameFromTest("union-type-test.json") = "EventWithStatus"
410 | 
411 | 			const asyncapiDoc = await parseAsyncAPIOutput(outputFiles, "union-type-test.json") as AsyncAPIObject
412 | 
413 | 			// Validate union type handling in schema
414 | 			const flexibleEventSchema = asyncapiDoc.components.schemas.FlexibleEvent
415 | 			expect(flexibleEventSchema).toBeDefined()
                                     ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/asyncapi-generation.test.ts:415:32)
(fail) Real AsyncAPI Generation Tests > Complete TypeSpec â†’ AsyncAPI Transformation > should handle TypeSpec union types and optional fields correctly [70.48ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 1808
timestamp=2025-11-18T20:59:51.756Z level=INFO fiber=#190 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:51.756Z level=INFO fiber=#190 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:51.756Z level=INFO fiber=#190 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:51.756Z level=INFO fiber=#190 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:51.756Z level=INFO fiber=#190 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:51.756Z level=INFO fiber=#190 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:51.756Z level=INFO fiber=#190 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:51.756Z level=INFO fiber=#190 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:51.756Z level=INFO fiber=#190 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:51.756Z level=INFO fiber=#190 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:51.756Z level=INFO fiber=#190 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:51.756Z level=INFO fiber=#190 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:51.756Z level=INFO fiber=#190 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:51.756Z level=INFO fiber=#190 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:51.756Z level=INFO fiber=#190 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:51.756Z level=INFO fiber=#190 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:51.757Z level=INFO fiber=#190 message="âœ… Discovery: 4 operations found"
timestamp=2025-11-18T20:59:51.757Z level=INFO fiber=#190 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:51.757Z level=INFO fiber=#190 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:51.757Z level=INFO fiber=#190 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:51.757Z level=INFO fiber=#190 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:51.757Z level=INFO fiber=#190 message="ğŸ”„ Processing 4 operations with Effect.TS..."
timestamp=2025-11-18T20:59:51.758Z level=INFO fiber=#190 message="âœ… Processed 4 operations successfully"
timestamp=2025-11-18T20:59:51.758Z level=INFO fiber=#190 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:51.758Z level=INFO fiber=#190 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:51.758Z level=INFO fiber=#190 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:51.758Z level=INFO fiber=#190 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:51.758Z level=INFO fiber=#190 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 4,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 4
}"
timestamp=2025-11-18T20:59:51.758Z level=INFO fiber=#190 message="âœ… Processing: 4 elements processed"
timestamp=2025-11-18T20:59:51.758Z level=INFO fiber=#190 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:51.758Z level=INFO fiber=#190 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:51.758Z level=INFO fiber=#190 message="âœ… AsyncAPI document validation passed! 4 channels, 0 operations (0.06ms)"
timestamp=2025-11-18T20:59:51.758Z level=INFO fiber=#190 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:51.758Z level=INFO fiber=#190 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:51.761Z level=INFO fiber=#190 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.761Z level=INFO fiber=#190 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.761Z level=INFO fiber=#190 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.762Z level=INFO fiber=#190 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.762Z level=INFO fiber=#190 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.762Z level=INFO fiber=#190 message="ğŸ‰ TYPESPEC API SUCCESS: 4 channels, 0 operations"
timestamp=2025-11-18T20:59:51.762Z level=INFO fiber=#190 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.762Z level=INFO fiber=#190 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:51.762Z level=INFO fiber=#191 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: multi-namespace-test.json
ğŸ” DEBUG: extractSchemaNameFromTest("multi-namespace-test.json") = "UserEvent"
497 | 			const asyncapiDoc = await parseAsyncAPIOutput(outputFiles, "multi-namespace-test.json") as AsyncAPIObject
498 | 
499 | 			// Validate schemas from all namespaces using shared utility
500 | 			const expectedSchemas = ["User", "UserProfile", "Order", "OrderItem", "Notification"]
501 | 			for (const schemaName of expectedSchemas) {
502 | 				expect(asyncapiDoc.components.schemas[schemaName]).toBeDefined()
                                                             ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/asyncapi-generation.test.ts:502:56)
(fail) Real AsyncAPI Generation Tests > Complete TypeSpec â†’ AsyncAPI Transformation > should generate valid AsyncAPI for multi-namespace TypeSpec [92.58ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 905
timestamp=2025-11-18T20:59:51.902Z level=INFO fiber=#192 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:51.902Z level=INFO fiber=#192 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:51.902Z level=INFO fiber=#192 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:51.902Z level=INFO fiber=#192 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:51.902Z level=INFO fiber=#192 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:51.902Z level=INFO fiber=#192 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:51.902Z level=INFO fiber=#192 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:51.902Z level=INFO fiber=#192 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:51.902Z level=INFO fiber=#192 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:51.902Z level=INFO fiber=#192 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:51.902Z level=INFO fiber=#192 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:51.902Z level=INFO fiber=#192 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:51.902Z level=INFO fiber=#192 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:51.902Z level=INFO fiber=#192 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:51.902Z level=INFO fiber=#192 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:51.902Z level=INFO fiber=#192 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:51.902Z level=INFO fiber=#192 message="âœ… Discovery: 2 operations found"
timestamp=2025-11-18T20:59:51.902Z level=INFO fiber=#192 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:51.902Z level=INFO fiber=#192 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:51.902Z level=INFO fiber=#192 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:51.902Z level=INFO fiber=#192 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:51.902Z level=INFO fiber=#192 message="ğŸ”„ Processing 2 operations with Effect.TS..."
timestamp=2025-11-18T20:59:51.903Z level=INFO fiber=#192 message="âœ… Processed 2 operations successfully"
timestamp=2025-11-18T20:59:51.903Z level=INFO fiber=#192 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:51.903Z level=INFO fiber=#192 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:51.903Z level=INFO fiber=#192 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:51.903Z level=INFO fiber=#192 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:51.903Z level=INFO fiber=#192 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 2,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 2
}"
timestamp=2025-11-18T20:59:51.903Z level=INFO fiber=#192 message="âœ… Processing: 2 elements processed"
timestamp=2025-11-18T20:59:51.903Z level=INFO fiber=#192 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:51.903Z level=INFO fiber=#192 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:51.903Z level=INFO fiber=#192 message="âœ… AsyncAPI document validation passed! 2 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T20:59:51.903Z level=INFO fiber=#192 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:51.903Z level=INFO fiber=#192 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:51.904Z level=INFO fiber=#192 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.904Z level=INFO fiber=#192 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.904Z level=INFO fiber=#192 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.904Z level=INFO fiber=#192 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.904Z level=INFO fiber=#192 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.904Z level=INFO fiber=#192 message="ğŸ‰ TYPESPEC API SUCCESS: 2 channels, 0 operations"
timestamp=2025-11-18T20:59:51.904Z level=INFO fiber=#192 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.904Z level=INFO fiber=#192 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:51.904Z level=INFO fiber=#193 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: compliance-test.json
ğŸ” DEBUG: extractSchemaNameFromTest("compliance-test.json") = "null"
564 | 			expect(asyncapiDoc.info.title).toBeDefined()
565 | 			expect(asyncapiDoc.info.version).toBeDefined()
566 | 
567 | 			// Validate channels structure
568 | 			expect(asyncapiDoc.channels).toBeDefined()
569 | 			expect(Object.keys(asyncapiDoc.channels).length).toBeGreaterThan(0)
                                                          ^
error: expect(received).toBeGreaterThan(expected)

Expected: > 0
Received: 0

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/asyncapi-generation.test.ts:569:53)
(fail) Real AsyncAPI Generation Tests > AsyncAPI 3.0.0 Specification Compliance > should generate AsyncAPI document compliant with 3.0.0 specification [149.03ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 1073
timestamp=2025-11-18T20:59:51.970Z level=INFO fiber=#194 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:51.970Z level=INFO fiber=#194 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:51.970Z level=INFO fiber=#194 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:51.971Z level=INFO fiber=#194 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:51.971Z level=INFO fiber=#194 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:51.971Z level=INFO fiber=#194 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:51.971Z level=INFO fiber=#194 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:51.971Z level=INFO fiber=#194 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:51.971Z level=INFO fiber=#194 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:51.971Z level=INFO fiber=#194 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:51.971Z level=INFO fiber=#194 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:51.971Z level=INFO fiber=#194 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:51.971Z level=INFO fiber=#194 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:51.971Z level=INFO fiber=#194 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:51.971Z level=INFO fiber=#194 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:51.971Z level=INFO fiber=#194 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:51.971Z level=INFO fiber=#194 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T20:59:51.971Z level=INFO fiber=#194 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:51.971Z level=INFO fiber=#194 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:51.971Z level=INFO fiber=#194 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:51.971Z level=INFO fiber=#194 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:51.972Z level=INFO fiber=#194 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T20:59:51.972Z level=INFO fiber=#194 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T20:59:51.972Z level=INFO fiber=#194 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:51.972Z level=INFO fiber=#194 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:51.973Z level=INFO fiber=#194 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:51.973Z level=INFO fiber=#194 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:51.973Z level=INFO fiber=#194 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T20:59:51.973Z level=INFO fiber=#194 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T20:59:51.973Z level=INFO fiber=#194 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:51.973Z level=INFO fiber=#194 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:51.973Z level=INFO fiber=#194 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.05ms)"
timestamp=2025-11-18T20:59:51.973Z level=INFO fiber=#194 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:51.973Z level=INFO fiber=#194 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:51.976Z level=INFO fiber=#194 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.976Z level=INFO fiber=#194 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.976Z level=INFO fiber=#194 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.976Z level=INFO fiber=#194 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.976Z level=INFO fiber=#194 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.976Z level=INFO fiber=#194 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T20:59:51.976Z level=INFO fiber=#194 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:51.976Z level=INFO fiber=#194 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:51.977Z level=INFO fiber=#195 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: reference-test.json
ğŸ” DEBUG: extractSchemaNameFromTest("reference-test.json") = "null"
646 | 			const {outputFiles} = await compileAsyncAPISpecWithoutErrors(source)
647 | 
648 | 			const asyncapiDoc = await parseAsyncAPIOutput(outputFiles, "reference-test.json") as AsyncAPIObject
649 | 
650 | 			// Validate all referenced schemas are generated
651 | 			expect(asyncapiDoc.components.schemas.BaseReference).toBeDefined()
                                                              ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/asyncapi-generation.test.ts:651:57)
(fail) Real AsyncAPI Generation Tests > AsyncAPI 3.0.0 Specification Compliance > should handle complex schema references correctly [60.88ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 19843
timestamp=2025-11-18T20:59:52.055Z level=INFO fiber=#196 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T20:59:52.055Z level=INFO fiber=#196 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T20:59:52.055Z level=INFO fiber=#196 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T20:59:52.055Z level=INFO fiber=#196 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T20:59:52.055Z level=INFO fiber=#196 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T20:59:52.055Z level=INFO fiber=#196 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T20:59:52.056Z level=INFO fiber=#196 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T20:59:52.056Z level=INFO fiber=#196 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T20:59:52.056Z level=INFO fiber=#196 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T20:59:52.056Z level=INFO fiber=#196 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T20:59:52.056Z level=INFO fiber=#196 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T20:59:52.056Z level=INFO fiber=#196 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T20:59:52.056Z level=INFO fiber=#196 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T20:59:52.056Z level=INFO fiber=#196 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T20:59:52.056Z level=INFO fiber=#196 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T20:59:52.056Z level=INFO fiber=#196 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T20:59:52.056Z level=INFO fiber=#196 message="âœ… Discovery: 40 operations found"
timestamp=2025-11-18T20:59:52.056Z level=INFO fiber=#196 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T20:59:52.056Z level=INFO fiber=#196 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T20:59:52.056Z level=INFO fiber=#196 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T20:59:52.056Z level=INFO fiber=#196 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T20:59:52.056Z level=INFO fiber=#196 message="ğŸ”„ Processing 40 operations with Effect.TS..."
timestamp=2025-11-18T20:59:52.057Z level=INFO fiber=#196 message="âœ… Processed 40 operations successfully"
timestamp=2025-11-18T20:59:52.057Z level=INFO fiber=#196 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T20:59:52.057Z level=INFO fiber=#196 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T20:59:52.066Z level=INFO fiber=#196 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T20:59:52.066Z level=INFO fiber=#196 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T20:59:52.066Z level=INFO fiber=#196 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 40,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 40
}"
timestamp=2025-11-18T20:59:52.066Z level=INFO fiber=#196 message="âœ… Processing: 40 elements processed"
timestamp=2025-11-18T20:59:52.066Z level=INFO fiber=#196 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T20:59:52.066Z level=INFO fiber=#196 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T20:59:52.066Z level=INFO fiber=#196 message="âœ… AsyncAPI document validation passed! 40 channels, 0 operations (0.13ms)"
timestamp=2025-11-18T20:59:52.066Z level=INFO fiber=#196 message="âœ… Validation: PASSED"
timestamp=2025-11-18T20:59:52.066Z level=INFO fiber=#196 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T20:59:52.084Z level=INFO fiber=#196 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:52.084Z level=INFO fiber=#196 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:52.084Z level=INFO fiber=#196 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T20:59:52.084Z level=INFO fiber=#196 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:52.084Z level=INFO fiber=#196 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:52.084Z level=INFO fiber=#196 message="ğŸ‰ TYPESPEC API SUCCESS: 40 channels, 0 operations"
timestamp=2025-11-18T20:59:52.084Z level=INFO fiber=#196 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T20:59:52.084Z level=INFO fiber=#196 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T20:59:52.085Z level=INFO fiber=#197 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: large-scale-test.json
ğŸ” DEBUG: extractSchemaNameFromTest("large-scale-test.json") = "null"
730 | 			const compilationTime = endTime - startTime
731 | 
732 | 			const asyncapiDoc = await parseAsyncAPIOutput(outputFiles, "large-scale-test.json") as AsyncAPIObject
733 | 
734 | 			// Validate scale - should have 20 schemas and 40 operations
735 | 			expect(Object.keys(asyncapiDoc?.components?.schemas).length).toBe(20)
                                                                      ^
error: expect(received).toBe(expected)

Expected: 20
Received: 1

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/asyncapi-generation.test.ts:735:65)
(fail) Real AsyncAPI Generation Tests > Performance and Scale Testing > should generate large AsyncAPI document efficiently [111.19ms]

test/integration/cli-simple-emitter.test.ts:
274 | 			`Compilation reported errors: ${result.errors.join(', ')}`
275 | 		)
276 | 	}
277 | 
278 | 	if (!result.asyncapiDoc) {
279 | 		throw new Error('Compilation succeeded but AsyncAPI document not generated')
                  ^
error: Compilation succeeded but AsyncAPI document not generated
      at assertCompilationSuccess (/Users/larsartmann/projects/typespec-asyncapi/test/utils/type-guards.ts:279:13)
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/cli-simple-emitter.test.ts:49:3)
(fail) CLI Tests: Simple AsyncAPI Emitter > should generate basic AsyncAPI from simple TypeSpec [2185.71ms]
89 | 		// Act: Compile with CLI
90 | 		testResult = await compileWithCLI(source)
91 | 
92 | 		// Assert: Compilation succeeded
93 | 		expect(testResult.exitCode).toBe(0)
94 | 		expect(testResult.asyncapiDoc).toBeDefined()
                                      ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/cli-simple-emitter.test.ts:94:34)
(fail) CLI Tests: Simple AsyncAPI Emitter > should handle multiple operations [3242.11ms]
131 | 		// Act: Compile with CLI
132 | 		testResult = await compileWithCLI(source)
133 | 
134 | 		// Assert: Compilation succeeded
135 | 		expect(testResult.exitCode).toBe(0)
136 | 		expect(testResult.asyncapiDoc).toBeDefined()
                                       ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/cli-simple-emitter.test.ts:136:34)
(fail) CLI Tests: Simple AsyncAPI Emitter > should generate YAML output [1885.72ms]
168 | 		// Act: Compile with CLI
169 | 		testResult = await compileWithCLI(source)
170 | 
171 | 		// Assert: Compilation succeeded
172 | 		expect(testResult.exitCode).toBe(0)
173 | 		expect(testResult.asyncapiDoc?.components).toBeDefined()
                                                   ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/cli-simple-emitter.test.ts:173:46)
(fail) CLI Tests: Simple AsyncAPI Emitter > should include schema components for models [2719.19ms]
201 | 		// Act: Compile with CLI
202 | 		testResult = await compileWithCLI(source)
203 | 
204 | 		// Assert: Compilation succeeded
205 | 		expect(testResult.exitCode).toBe(0)
206 | 		expect(testResult.asyncapiDoc).toBeDefined()
                                       ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/cli-simple-emitter.test.ts:206:34)
(fail) CLI Tests: Simple AsyncAPI Emitter > should handle namespaces correctly [3716.86ms]

test/integration/typespec-integration.test.ts:

# Unhandled error between tests
-------------------------------
error: Cannot find module '../src/typespec-compiler/TypeSpecIntegration.js' from '/Users/larsartmann/projects/typespec-asyncapi/test/integration/typespec-integration.test.ts'
-------------------------------


test/integration/real-world-scenarios.test.ts:
ğŸš€ compileAsyncAPISpecRaw called with source length: 4001
timestamp=2025-11-18T21:00:06.101Z level=INFO fiber=#198 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:06.101Z level=INFO fiber=#198 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:06.101Z level=INFO fiber=#198 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:06.101Z level=INFO fiber=#198 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:06.101Z level=INFO fiber=#198 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:06.101Z level=INFO fiber=#198 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:06.101Z level=INFO fiber=#198 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:06.101Z level=INFO fiber=#198 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:06.101Z level=INFO fiber=#198 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:06.101Z level=INFO fiber=#198 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:06.101Z level=INFO fiber=#198 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:06.101Z level=INFO fiber=#198 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:06.101Z level=INFO fiber=#198 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:06.101Z level=INFO fiber=#198 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:06.101Z level=INFO fiber=#198 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:06.101Z level=INFO fiber=#198 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:06.101Z level=INFO fiber=#198 message="âœ… Discovery: 10 operations found"
timestamp=2025-11-18T21:00:06.101Z level=INFO fiber=#198 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:06.101Z level=INFO fiber=#198 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:06.101Z level=INFO fiber=#198 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:06.102Z level=INFO fiber=#198 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:06.102Z level=INFO fiber=#198 message="ğŸ”„ Processing 10 operations with Effect.TS..."
timestamp=2025-11-18T21:00:06.102Z level=INFO fiber=#198 message="âœ… Processed 10 operations successfully"
timestamp=2025-11-18T21:00:06.102Z level=INFO fiber=#198 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:06.102Z level=INFO fiber=#198 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:06.102Z level=INFO fiber=#198 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:06.102Z level=INFO fiber=#198 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:06.102Z level=INFO fiber=#198 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 10,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 10
}"
timestamp=2025-11-18T21:00:06.102Z level=INFO fiber=#198 message="âœ… Processing: 10 elements processed"
timestamp=2025-11-18T21:00:06.102Z level=INFO fiber=#198 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:06.102Z level=INFO fiber=#198 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:06.102Z level=INFO fiber=#198 message="âœ… AsyncAPI document validation passed! 10 channels, 0 operations (0.10ms)"
timestamp=2025-11-18T21:00:06.102Z level=INFO fiber=#198 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:06.102Z level=INFO fiber=#198 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:06.115Z level=INFO fiber=#198 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.121Z level=INFO fiber=#198 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.121Z level=INFO fiber=#198 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.121Z level=INFO fiber=#198 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.121Z level=INFO fiber=#198 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.121Z level=INFO fiber=#198 message="ğŸ‰ TYPESPEC API SUCCESS: 10 channels, 0 operations"
timestamp=2025-11-18T21:00:06.121Z level=INFO fiber=#198 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.121Z level=INFO fiber=#198 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:06.121Z level=INFO fiber=#199 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: ecommerce-system.json
ğŸ” DEBUG: extractSchemaNameFromTest("ecommerce-system.json") = "null"
153 | 
154 |       // Validate overall structure
155 |       expect(AsyncAPIAssertions.hasValidStructure(asyncapiDoc)).toBe(true);
156 | 
157 |       // Validate all schemas are generated
158 |       expect(AsyncAPIAssertions.hasSchema(asyncapiDoc, "User")).toBe(true);
                                                                      ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/real-world-scenarios.test.ts:158:65)
(fail) Real-World AsyncAPI Scenarios > E-commerce Event System > should handle complete e-commerce event flow [193.07ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 4080
timestamp=2025-11-18T21:00:06.281Z level=INFO fiber=#200 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:06.282Z level=INFO fiber=#200 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:06.282Z level=INFO fiber=#200 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:06.282Z level=INFO fiber=#200 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:06.282Z level=INFO fiber=#200 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:06.282Z level=INFO fiber=#200 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:06.282Z level=INFO fiber=#200 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:06.282Z level=INFO fiber=#200 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:06.282Z level=INFO fiber=#200 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:06.282Z level=INFO fiber=#200 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:06.282Z level=INFO fiber=#200 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:06.282Z level=INFO fiber=#200 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:06.283Z level=INFO fiber=#200 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:06.283Z level=INFO fiber=#200 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:06.283Z level=INFO fiber=#200 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:06.283Z level=INFO fiber=#200 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:06.283Z level=INFO fiber=#200 message="âœ… Discovery: 10 operations found"
timestamp=2025-11-18T21:00:06.283Z level=INFO fiber=#200 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:06.283Z level=INFO fiber=#200 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:06.283Z level=INFO fiber=#200 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:06.283Z level=INFO fiber=#200 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:06.283Z level=INFO fiber=#200 message="ğŸ”„ Processing 10 operations with Effect.TS..."
timestamp=2025-11-18T21:00:06.283Z level=INFO fiber=#200 message="âœ… Processed 10 operations successfully"
timestamp=2025-11-18T21:00:06.283Z level=INFO fiber=#200 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:06.283Z level=INFO fiber=#200 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:06.283Z level=INFO fiber=#200 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:06.283Z level=INFO fiber=#200 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:06.283Z level=INFO fiber=#200 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 10,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 10
}"
timestamp=2025-11-18T21:00:06.283Z level=INFO fiber=#200 message="âœ… Processing: 10 elements processed"
timestamp=2025-11-18T21:00:06.283Z level=INFO fiber=#200 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:06.283Z level=INFO fiber=#200 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:06.284Z level=INFO fiber=#200 message="âœ… AsyncAPI document validation passed! 10 channels, 0 operations (0.14ms)"
timestamp=2025-11-18T21:00:06.284Z level=INFO fiber=#200 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:06.284Z level=INFO fiber=#200 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:06.292Z level=INFO fiber=#200 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.293Z level=INFO fiber=#200 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.293Z level=INFO fiber=#200 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.293Z level=INFO fiber=#200 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.293Z level=INFO fiber=#200 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.293Z level=INFO fiber=#200 message="ğŸ‰ TYPESPEC API SUCCESS: 10 channels, 0 operations"
timestamp=2025-11-18T21:00:06.293Z level=INFO fiber=#200 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.293Z level=INFO fiber=#200 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:06.293Z level=INFO fiber=#201 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: iot-system.json
ğŸ” DEBUG: extractSchemaNameFromTest("iot-system.json") = "null"
322 | 
323 |       // Validate IoT-specific structures
324 |       expect(AsyncAPIAssertions.hasValidStructure(asyncapiDoc)).toBe(true);
325 | 
326 |       // Validate IoT schemas
327 |       expect(AsyncAPIAssertions.hasSchema(asyncapiDoc, "Location")).toBe(true);
                                                                          ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/real-world-scenarios.test.ts:327:69)
(fail) Real-World AsyncAPI Scenarios > IoT Sensor Network > should handle IoT sensor data events [172.14ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 4420
timestamp=2025-11-18T21:00:06.384Z level=INFO fiber=#202 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:06.384Z level=INFO fiber=#202 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:06.384Z level=INFO fiber=#202 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:06.384Z level=INFO fiber=#202 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:06.384Z level=INFO fiber=#202 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:06.384Z level=INFO fiber=#202 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:06.384Z level=INFO fiber=#202 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:06.384Z level=INFO fiber=#202 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:06.384Z level=INFO fiber=#202 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:06.384Z level=INFO fiber=#202 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:06.384Z level=INFO fiber=#202 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:06.385Z level=INFO fiber=#202 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:06.385Z level=INFO fiber=#202 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:06.385Z level=INFO fiber=#202 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:06.385Z level=INFO fiber=#202 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:06.385Z level=INFO fiber=#202 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:06.385Z level=INFO fiber=#202 message="âœ… Discovery: 9 operations found"
timestamp=2025-11-18T21:00:06.385Z level=INFO fiber=#202 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:06.385Z level=INFO fiber=#202 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:06.385Z level=INFO fiber=#202 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:06.385Z level=INFO fiber=#202 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:06.385Z level=INFO fiber=#202 message="ğŸ”„ Processing 9 operations with Effect.TS..."
timestamp=2025-11-18T21:00:06.385Z level=INFO fiber=#202 message="âœ… Processed 9 operations successfully"
timestamp=2025-11-18T21:00:06.385Z level=INFO fiber=#202 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:06.385Z level=INFO fiber=#202 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:06.385Z level=INFO fiber=#202 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:06.385Z level=INFO fiber=#202 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:06.385Z level=INFO fiber=#202 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 9,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 9
}"
timestamp=2025-11-18T21:00:06.385Z level=INFO fiber=#202 message="âœ… Processing: 9 elements processed"
timestamp=2025-11-18T21:00:06.385Z level=INFO fiber=#202 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:06.385Z level=INFO fiber=#202 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:06.385Z level=INFO fiber=#202 message="âœ… AsyncAPI document validation passed! 9 channels, 0 operations (0.05ms)"
timestamp=2025-11-18T21:00:06.385Z level=INFO fiber=#202 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:06.385Z level=INFO fiber=#202 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:06.389Z level=INFO fiber=#202 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.389Z level=INFO fiber=#202 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.389Z level=INFO fiber=#202 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.389Z level=INFO fiber=#202 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.389Z level=INFO fiber=#202 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.389Z level=INFO fiber=#202 message="ğŸ‰ TYPESPEC API SUCCESS: 9 channels, 0 operations"
timestamp=2025-11-18T21:00:06.389Z level=INFO fiber=#202 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.389Z level=INFO fiber=#202 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:06.389Z level=INFO fiber=#203 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: trading-system.json
ğŸ” DEBUG: extractSchemaNameFromTest("trading-system.json") = "null"
505 | 
506 |       // Validate trading system structure
507 |       expect(AsyncAPIAssertions.hasValidStructure(asyncapiDoc)).toBe(true);
508 | 
509 |       // Validate financial schemas
510 |       expect(AsyncAPIAssertions.hasSchema(asyncapiDoc, "Instrument")).toBe(true);
                                                                            ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/real-world-scenarios.test.ts:510:71)
(fail) Real-World AsyncAPI Scenarios > Financial Trading System > should handle high-frequency trading events [92.52ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 3673
timestamp=2025-11-18T21:00:06.491Z level=INFO fiber=#204 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:06.491Z level=INFO fiber=#204 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:06.491Z level=INFO fiber=#204 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:06.491Z level=INFO fiber=#204 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:06.491Z level=INFO fiber=#204 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:06.491Z level=INFO fiber=#204 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:06.491Z level=INFO fiber=#204 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:06.491Z level=INFO fiber=#204 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:06.491Z level=INFO fiber=#204 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:06.492Z level=INFO fiber=#204 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:06.492Z level=INFO fiber=#204 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:06.492Z level=INFO fiber=#204 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:06.492Z level=INFO fiber=#204 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:06.492Z level=INFO fiber=#204 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:06.492Z level=INFO fiber=#204 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:06.492Z level=INFO fiber=#204 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:06.492Z level=INFO fiber=#204 message="âœ… Discovery: 8 operations found"
timestamp=2025-11-18T21:00:06.492Z level=INFO fiber=#204 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:06.492Z level=INFO fiber=#204 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:06.492Z level=INFO fiber=#204 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:06.492Z level=INFO fiber=#204 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:06.492Z level=INFO fiber=#204 message="ğŸ”„ Processing 8 operations with Effect.TS..."
timestamp=2025-11-18T21:00:06.493Z level=INFO fiber=#204 message="âœ… Processed 8 operations successfully"
timestamp=2025-11-18T21:00:06.493Z level=INFO fiber=#204 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:06.493Z level=INFO fiber=#204 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:06.493Z level=INFO fiber=#204 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:06.493Z level=INFO fiber=#204 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:06.493Z level=INFO fiber=#204 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 8,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 8
}"
timestamp=2025-11-18T21:00:06.493Z level=INFO fiber=#204 message="âœ… Processing: 8 elements processed"
timestamp=2025-11-18T21:00:06.493Z level=INFO fiber=#204 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:06.493Z level=INFO fiber=#204 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:06.493Z level=INFO fiber=#204 message="âœ… AsyncAPI document validation passed! 8 channels, 0 operations (0.14ms)"
timestamp=2025-11-18T21:00:06.493Z level=INFO fiber=#204 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:06.493Z level=INFO fiber=#204 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:06.504Z level=INFO fiber=#204 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.504Z level=INFO fiber=#204 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.504Z level=INFO fiber=#204 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.504Z level=INFO fiber=#204 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.504Z level=INFO fiber=#204 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.504Z level=INFO fiber=#204 message="ğŸ‰ TYPESPEC API SUCCESS: 8 channels, 0 operations"
timestamp=2025-11-18T21:00:06.504Z level=INFO fiber=#204 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.504Z level=INFO fiber=#204 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:06.504Z level=INFO fiber=#205 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: saas-platform.json
ğŸ” DEBUG: extractSchemaNameFromTest("saas-platform.json") = "null"
659 | 
660 |       // Validate SaaS platform structure
661 |       expect(AsyncAPIAssertions.hasValidStructure(asyncapiDoc)).toBe(true);
662 | 
663 |       // Validate multi-tenant schemas
664 |       expect(AsyncAPIAssertions.hasSchema(asyncapiDoc, "Tenant")).toBe(true);
                                                                        ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/real-world-scenarios.test.ts:664:67)
(fail) Real-World AsyncAPI Scenarios > Multi-tenant SaaS Platform > should handle tenant-isolated events [136.25ms]

test/integration/decorator-functionality.test.ts:
ğŸš€ compileAsyncAPISpecRaw called with source length: 1003
timestamp=2025-11-18T21:00:06.672Z level=INFO fiber=#206 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:06.672Z level=INFO fiber=#206 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:06.672Z level=INFO fiber=#206 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:06.672Z level=INFO fiber=#206 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:06.672Z level=INFO fiber=#206 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:06.672Z level=INFO fiber=#206 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:06.672Z level=INFO fiber=#206 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:06.672Z level=INFO fiber=#206 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:06.672Z level=INFO fiber=#206 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:06.672Z level=INFO fiber=#206 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:06.672Z level=INFO fiber=#206 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:06.672Z level=INFO fiber=#206 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:06.672Z level=INFO fiber=#206 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:06.672Z level=INFO fiber=#206 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:06.672Z level=INFO fiber=#206 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:06.672Z level=INFO fiber=#206 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:06.672Z level=INFO fiber=#206 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:06.672Z level=INFO fiber=#206 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:06.672Z level=INFO fiber=#206 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:06.672Z level=INFO fiber=#206 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:06.672Z level=INFO fiber=#206 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:06.672Z level=INFO fiber=#206 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:06.673Z level=INFO fiber=#206 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:06.673Z level=INFO fiber=#206 message="ğŸ¯ Processing 1 message models with functional composition..."
timestamp=2025-11-18T21:00:06.674Z level=INFO fiber=#207 message="ğŸ” Converting model to schema: UserRegisteredMessage (cache miss)"
timestamp=2025-11-18T21:00:06.674Z level=INFO fiber=#207 message="ğŸ” Converting model to schema: UserRegisteredMessage (cache miss)"
timestamp=2025-11-18T21:00:06.674Z level=INFO fiber=#207 message="ğŸ” walkPropertiesInherited found 4 properties for model UserRegisteredMessage"
timestamp=2025-11-18T21:00:06.674Z level=INFO fiber=#207 message="ğŸ“‹ Processing property: userId (type: Scalar)"
timestamp=2025-11-18T21:00:06.675Z level=INFO fiber=#207 message="ğŸ” Converting property: userId (Scalar)"
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#207 message="ğŸ” Converting type: Scalar"
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#207 message="âœ… Property userId converted to: {\"type\":\"string\"}"
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#207 message="ğŸ“‹ Processing property: email (type: Scalar)"
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#207 message="ğŸ” Converting property: email (Scalar)"
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#207 message="ğŸ” Converting type: Scalar"
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#207 message="âœ… Property email converted to: {\"type\":\"string\"}"
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#207 message="ğŸ“‹ Processing property: registeredAt (type: Scalar)"
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#207 message="ğŸ” Converting property: registeredAt (Scalar)"
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#207 message="ğŸ” Converting type: Scalar"
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#207 message="âœ… Property registeredAt converted to: {\"type\":\"string\",\"format\":\"date-time\"}"
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#207 message="ğŸ“‹ Processing property: preferences (type: Model)"
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#207 message="ğŸ” Converting property: preferences (Model)"
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#207 message="ğŸ” Converting type: Model"
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#207 message="ğŸ—ï¸ Processing model: "
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#207 message="ğŸ” Converting property: newsletter (Scalar)"
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#207 message="ğŸ” Converting type: Scalar"
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#207 message="âœ… Property newsletter converted to: {\"type\":\"boolean\"}"
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#207 message="ğŸ” Converting property: notifications (Scalar)"
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#207 message="ğŸ” Converting type: Scalar"
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#207 message="âœ… Property notifications converted to: {\"type\":\"boolean\"}"
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#207 message="âœ… Property preferences converted to: {\"type\":\"object\",\"properties\":{\"newsletter\":{\"description\":\"Property newsletter\",\"type\":\"boolean\"},\"notifications\":{\"description\":\"Property notifications\",\"type\":\"boolean\"}},\"required\":[\"newsletter\",\"notifications\"]}"
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#207 message="âœ… Schema conversion complete for UserRegisteredMessage: 4 properties, 4 required"
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#206 message="Batch emit completed" message="{
  \"processedCount\": 1,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#206 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#206 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#206 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 1,
  \"securityProcessed\": 0,
  \"totalProcessed\": 2
}"
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#206 message="âœ… Processing: 2 elements processed"
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#206 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#206 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#206 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#206 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:06.676Z level=INFO fiber=#206 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:06.686Z level=INFO fiber=#206 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.687Z level=INFO fiber=#206 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.687Z level=INFO fiber=#206 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.687Z level=INFO fiber=#206 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.687Z level=INFO fiber=#206 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.687Z level=INFO fiber=#206 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:06.687Z level=INFO fiber=#206 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.687Z level=INFO fiber=#206 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:06.687Z level=INFO fiber=#208 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
60 | 
61 | 			const {outputFiles, program} = await compileAsyncAPISpecWithoutErrors(source)
62 | 
63 | 			// Verify the compilation actually processed the decorator
64 | 			expect(program).toBeDefined()
65 | 			expect(outputFiles.size).toBeGreaterThan(0)
                                 ^
error: expect(received).toBeGreaterThan(expected)

Expected: > 0
Received: 0

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/decorator-functionality.test.ts:65:29)
(fail) Real Decorator Functionality Tests > @message Decorator Real Processing > should process @message decorator with real TypeSpec model compilation [136.24ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 813
timestamp=2025-11-18T21:00:06.788Z level=INFO fiber=#209 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:06.789Z level=INFO fiber=#209 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:06.789Z level=INFO fiber=#209 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:06.789Z level=INFO fiber=#209 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:06.789Z level=INFO fiber=#209 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:06.789Z level=INFO fiber=#209 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:06.789Z level=INFO fiber=#209 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:06.789Z level=INFO fiber=#209 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:06.789Z level=INFO fiber=#209 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:06.789Z level=INFO fiber=#209 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:06.789Z level=INFO fiber=#209 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:06.789Z level=INFO fiber=#209 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:06.789Z level=INFO fiber=#209 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:06.789Z level=INFO fiber=#209 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:06.789Z level=INFO fiber=#209 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:06.789Z level=INFO fiber=#209 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:06.789Z level=INFO fiber=#209 message="âœ… Discovery: 2 operations found"
timestamp=2025-11-18T21:00:06.789Z level=INFO fiber=#209 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:06.789Z level=INFO fiber=#209 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:06.790Z level=INFO fiber=#209 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:06.790Z level=INFO fiber=#209 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:06.790Z level=INFO fiber=#209 message="ğŸ”„ Processing 2 operations with Effect.TS..."
timestamp=2025-11-18T21:00:06.790Z level=INFO fiber=#209 message="âœ… Processed 2 operations successfully"
timestamp=2025-11-18T21:00:06.790Z level=INFO fiber=#209 message="ğŸ¯ Processing 2 message models with functional composition..."
timestamp=2025-11-18T21:00:06.790Z level=INFO fiber=#210 message="ğŸ” Converting model to schema: AvroMessage (cache miss)"
timestamp=2025-11-18T21:00:06.790Z level=INFO fiber=#210 message="ğŸ” Converting model to schema: AvroMessage (cache miss)"
timestamp=2025-11-18T21:00:06.790Z level=INFO fiber=#210 message="ğŸ” walkPropertiesInherited found 2 properties for model AvroMessage"
timestamp=2025-11-18T21:00:06.790Z level=INFO fiber=#210 message="ğŸ“‹ Processing property: schema (type: Scalar)"
timestamp=2025-11-18T21:00:06.790Z level=INFO fiber=#210 message="ğŸ” Converting property: schema (Scalar)"
timestamp=2025-11-18T21:00:06.790Z level=INFO fiber=#210 message="ğŸ” Converting type: Scalar"
timestamp=2025-11-18T21:00:06.790Z level=INFO fiber=#210 message="âœ… Property schema converted to: {\"type\":\"string\"}"
timestamp=2025-11-18T21:00:06.790Z level=INFO fiber=#210 message="ğŸ“‹ Processing property: data (type: Scalar)"
timestamp=2025-11-18T21:00:06.790Z level=INFO fiber=#210 message="ğŸ” Converting property: data (Scalar)"
timestamp=2025-11-18T21:00:06.790Z level=INFO fiber=#210 message="ğŸ” Converting type: Scalar"
timestamp=2025-11-18T21:00:06.790Z level=INFO fiber=#210 message="âœ… Property data converted to: {\"type\":\"string\",\"format\":\"binary\"}"
timestamp=2025-11-18T21:00:06.790Z level=INFO fiber=#210 message="âœ… Schema conversion complete for AvroMessage: 2 properties, 2 required"
timestamp=2025-11-18T21:00:06.790Z level=INFO fiber=#211 message="ğŸ” Converting model to schema: ProtobufMessage (cache miss)"
timestamp=2025-11-18T21:00:06.791Z level=INFO fiber=#211 message="ğŸ” Converting model to schema: ProtobufMessage (cache miss)"
timestamp=2025-11-18T21:00:06.791Z level=INFO fiber=#211 message="ğŸ” walkPropertiesInherited found 2 properties for model ProtobufMessage"
timestamp=2025-11-18T21:00:06.791Z level=INFO fiber=#211 message="ğŸ“‹ Processing property: messageType (type: Scalar)"
timestamp=2025-11-18T21:00:06.791Z level=INFO fiber=#211 message="ğŸ” Converting property: messageType (Scalar)"
timestamp=2025-11-18T21:00:06.791Z level=INFO fiber=#211 message="ğŸ” Converting type: Scalar"
timestamp=2025-11-18T21:00:06.791Z level=INFO fiber=#211 message="âœ… Property messageType converted to: {\"type\":\"string\"}"
timestamp=2025-11-18T21:00:06.791Z level=INFO fiber=#211 message="ğŸ“‹ Processing property: serializedData (type: Scalar)"
timestamp=2025-11-18T21:00:06.791Z level=INFO fiber=#211 message="ğŸ” Converting property: serializedData (Scalar)"
timestamp=2025-11-18T21:00:06.791Z level=INFO fiber=#211 message="ğŸ” Converting type: Scalar"
timestamp=2025-11-18T21:00:06.791Z level=INFO fiber=#211 message="âœ… Property serializedData converted to: {\"type\":\"string\",\"format\":\"binary\"}"
timestamp=2025-11-18T21:00:06.791Z level=INFO fiber=#211 message="âœ… Schema conversion complete for ProtobufMessage: 2 properties, 2 required"
timestamp=2025-11-18T21:00:06.791Z level=INFO fiber=#209 message="Batch emit completed" message="{
  \"processedCount\": 2,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:06.791Z level=INFO fiber=#209 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:06.791Z level=INFO fiber=#209 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:06.791Z level=INFO fiber=#209 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 2,
  \"messagesProcessed\": 2,
  \"securityProcessed\": 0,
  \"totalProcessed\": 4
}"
timestamp=2025-11-18T21:00:06.792Z level=INFO fiber=#209 message="âœ… Processing: 4 elements processed"
timestamp=2025-11-18T21:00:06.792Z level=INFO fiber=#209 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:06.792Z level=INFO fiber=#209 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:06.793Z level=INFO fiber=#209 message="âœ… AsyncAPI document validation passed! 2 channels, 0 operations (0.07ms)"
timestamp=2025-11-18T21:00:06.793Z level=INFO fiber=#209 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:06.793Z level=INFO fiber=#209 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:06.799Z level=INFO fiber=#209 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.799Z level=INFO fiber=#209 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.799Z level=INFO fiber=#209 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.800Z level=INFO fiber=#209 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.800Z level=INFO fiber=#209 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.800Z level=INFO fiber=#209 message="ğŸ‰ TYPESPEC API SUCCESS: 2 channels, 0 operations"
timestamp=2025-11-18T21:00:06.800Z level=INFO fiber=#209 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:06.800Z level=INFO fiber=#209 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:06.800Z level=INFO fiber=#212 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: content-type-test.json
ğŸ” DEBUG: extractSchemaNameFromTest("content-type-test.json") = "null"
132 | 			const {outputFiles} = await compileAsyncAPISpecWithoutErrors(source)
133 | 
134 | 			const asyncapiDoc = await parseAsyncAPIOutput(outputFiles, "content-type-test.json") as AsyncAPIObject
135 | 
136 | 			// Validate both message schemas were created
137 | 			expect(asyncapiDoc.components?.schemas?.AvroMessage).toBeDefined()
                                                              ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/decorator-functionality.test.ts:137:57)
(fail) Real Decorator Functionality Tests > @message Decorator Real Processing > should validate @message decorator with different content types [115.15ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 530
timestamp=2025-11-18T21:00:06.999Z level=INFO fiber=#213 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:06.999Z level=INFO fiber=#213 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:06.999Z level=INFO fiber=#213 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:06.999Z level=INFO fiber=#213 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:06.999Z level=INFO fiber=#213 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:06.999Z level=INFO fiber=#213 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:06.999Z level=INFO fiber=#213 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:06.999Z level=INFO fiber=#213 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:06.999Z level=INFO fiber=#213 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:06.999Z level=INFO fiber=#213 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:06.999Z level=INFO fiber=#213 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:06.999Z level=INFO fiber=#213 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:06.999Z level=INFO fiber=#213 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:06.999Z level=INFO fiber=#213 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:06.999Z level=INFO fiber=#213 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:06.999Z level=INFO fiber=#213 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:06.999Z level=INFO fiber=#213 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:06.999Z level=INFO fiber=#213 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:06.999Z level=INFO fiber=#213 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:06.999Z level=INFO fiber=#213 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:06.999Z level=INFO fiber=#213 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:07.000Z level=INFO fiber=#213 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:07.000Z level=INFO fiber=#213 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:07.000Z level=INFO fiber=#213 message="ğŸ¯ Processing 1 message models with functional composition..."
timestamp=2025-11-18T21:00:07.000Z level=INFO fiber=#214 message="ğŸ” Converting model to schema: TrackedMessage (cache miss)"
timestamp=2025-11-18T21:00:07.000Z level=INFO fiber=#214 message="ğŸ” Converting model to schema: TrackedMessage (cache miss)"
timestamp=2025-11-18T21:00:07.000Z level=INFO fiber=#214 message="ğŸ” walkPropertiesInherited found 2 properties for model TrackedMessage"
timestamp=2025-11-18T21:00:07.000Z level=INFO fiber=#214 message="ğŸ“‹ Processing property: correlationId (type: Scalar)"
timestamp=2025-11-18T21:00:07.000Z level=INFO fiber=#214 message="ğŸ” Converting property: correlationId (Scalar)"
timestamp=2025-11-18T21:00:07.000Z level=INFO fiber=#214 message="ğŸ” Converting type: Scalar"
timestamp=2025-11-18T21:00:07.000Z level=INFO fiber=#214 message="âœ… Property correlationId converted to: {\"type\":\"string\"}"
timestamp=2025-11-18T21:00:07.000Z level=INFO fiber=#214 message="ğŸ“‹ Processing property: payload (type: Model)"
timestamp=2025-11-18T21:00:07.000Z level=INFO fiber=#214 message="ğŸ” Converting property: payload (Model)"
timestamp=2025-11-18T21:00:07.001Z level=INFO fiber=#214 message="ğŸ” Converting type: Model"
timestamp=2025-11-18T21:00:07.001Z level=INFO fiber=#214 message="ğŸ—ï¸ Processing model: "
timestamp=2025-11-18T21:00:07.001Z level=INFO fiber=#214 message="ğŸ” Converting property: data (Scalar)"
timestamp=2025-11-18T21:00:07.001Z level=INFO fiber=#214 message="ğŸ” Converting type: Scalar"
timestamp=2025-11-18T21:00:07.001Z level=INFO fiber=#214 message="âœ… Property data converted to: {\"type\":\"string\"}"
timestamp=2025-11-18T21:00:07.001Z level=INFO fiber=#214 message="ğŸ” Converting property: version (Scalar)"
timestamp=2025-11-18T21:00:07.001Z level=INFO fiber=#214 message="ğŸ” Converting type: Scalar"
timestamp=2025-11-18T21:00:07.001Z level=INFO fiber=#214 message="âœ… Property version converted to: {\"type\":\"integer\",\"format\":\"int32\"}"
timestamp=2025-11-18T21:00:07.001Z level=INFO fiber=#214 message="âœ… Property payload converted to: {\"type\":\"object\",\"properties\":{\"data\":{\"description\":\"Property data\",\"type\":\"string\"},\"version\":{\"description\":\"Property version\",\"type\":\"integer\",\"format\":\"int32\"}},\"required\":[\"data\",\"version\"]}"
timestamp=2025-11-18T21:00:07.001Z level=INFO fiber=#214 message="âœ… Schema conversion complete for TrackedMessage: 2 properties, 2 required"
timestamp=2025-11-18T21:00:07.001Z level=INFO fiber=#213 message="Batch emit completed" message="{
  \"processedCount\": 1,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:07.001Z level=INFO fiber=#213 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:07.002Z level=INFO fiber=#213 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:07.002Z level=INFO fiber=#213 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 1,
  \"securityProcessed\": 0,
  \"totalProcessed\": 2
}"
timestamp=2025-11-18T21:00:07.002Z level=INFO fiber=#213 message="âœ… Processing: 2 elements processed"
timestamp=2025-11-18T21:00:07.002Z level=INFO fiber=#213 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:07.002Z level=INFO fiber=#213 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:07.002Z level=INFO fiber=#213 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T21:00:07.002Z level=INFO fiber=#213 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:07.002Z level=INFO fiber=#213 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:07.004Z level=INFO fiber=#213 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.004Z level=INFO fiber=#213 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.004Z level=INFO fiber=#213 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.004Z level=INFO fiber=#213 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.004Z level=INFO fiber=#213 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.004Z level=INFO fiber=#213 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:07.004Z level=INFO fiber=#213 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.004Z level=INFO fiber=#213 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:07.004Z level=INFO fiber=#215 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: headers-test.json
ğŸ” DEBUG: extractSchemaNameFromTest("headers-test.json") = "null"
173 | 			const {outputFiles} = await compileAsyncAPISpecWithoutErrors(source)
174 | 
175 | 			const asyncapiDoc = await parseAsyncAPIOutput(outputFiles, "headers-test.json") as AsyncAPIObject
176 | 
177 | 			// Validate message schema with correlation ID
178 | 			expect(asyncapiDoc.components?.schemas?.TrackedMessage).toBeDefined()
                                                                 ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/decorator-functionality.test.ts:178:60)
(fail) Real Decorator Functionality Tests > @message Decorator Real Processing > should handle @message decorator with headers and correlation ID [203.88ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 591
timestamp=2025-11-18T21:00:07.098Z level=INFO fiber=#218 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:07.098Z level=INFO fiber=#218 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:07.098Z level=INFO fiber=#218 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:07.099Z level=INFO fiber=#218 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:07.099Z level=INFO fiber=#218 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:07.099Z level=INFO fiber=#218 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:07.099Z level=INFO fiber=#218 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:07.099Z level=INFO fiber=#218 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:07.099Z level=INFO fiber=#218 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:07.099Z level=INFO fiber=#218 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:07.099Z level=INFO fiber=#218 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:07.099Z level=INFO fiber=#218 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:07.099Z level=INFO fiber=#218 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:07.099Z level=INFO fiber=#218 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:07.099Z level=INFO fiber=#218 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:07.099Z level=INFO fiber=#218 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:07.099Z level=INFO fiber=#218 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:07.099Z level=INFO fiber=#218 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:07.099Z level=INFO fiber=#218 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:07.099Z level=INFO fiber=#218 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:07.099Z level=INFO fiber=#218 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:07.099Z level=INFO fiber=#218 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:07.100Z level=INFO fiber=#218 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:07.100Z level=INFO fiber=#218 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:07.100Z level=INFO fiber=#218 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:07.100Z level=INFO fiber=#218 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:07.100Z level=INFO fiber=#218 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:07.100Z level=INFO fiber=#218 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:07.100Z level=INFO fiber=#218 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:07.100Z level=INFO fiber=#218 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:07.100Z level=INFO fiber=#218 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:07.100Z level=INFO fiber=#218 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T21:00:07.100Z level=INFO fiber=#218 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:07.100Z level=INFO fiber=#218 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:07.101Z level=INFO fiber=#218 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.101Z level=INFO fiber=#218 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.101Z level=INFO fiber=#218 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.101Z level=INFO fiber=#218 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.101Z level=INFO fiber=#218 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.101Z level=INFO fiber=#218 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:07.101Z level=INFO fiber=#218 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.101Z level=INFO fiber=#218 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:07.101Z level=INFO fiber=#219 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: kafka-protocol-test.json
ğŸ” DEBUG: extractSchemaNameFromTest("kafka-protocol-test.json") = "null"
218 | 			expect(program).toBeDefined()
219 | 
220 | 			const asyncapiDoc = await parseAsyncAPIOutput(outputFiles, "kafka-protocol-test.json") as AsyncAPIObject
221 | 
222 | 			// Validate schema was created
223 | 			expect(asyncapiDoc.components?.schemas?.KafkaMessage).toBeDefined()
                                                               ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/decorator-functionality.test.ts:223:58)
(fail) Real Decorator Functionality Tests > @protocol Decorator Real Processing > should process @protocol decorator with Kafka binding [97.77ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 622
timestamp=2025-11-18T21:00:07.213Z level=INFO fiber=#222 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:07.214Z level=INFO fiber=#222 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:07.214Z level=INFO fiber=#222 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:07.214Z level=INFO fiber=#222 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:07.214Z level=INFO fiber=#222 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:07.214Z level=INFO fiber=#222 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:07.214Z level=INFO fiber=#222 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:07.214Z level=INFO fiber=#222 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:07.214Z level=INFO fiber=#222 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:07.214Z level=INFO fiber=#222 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:07.214Z level=INFO fiber=#222 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:07.215Z level=INFO fiber=#222 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:07.215Z level=INFO fiber=#222 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:07.215Z level=INFO fiber=#222 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:07.215Z level=INFO fiber=#222 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:07.215Z level=INFO fiber=#222 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:07.215Z level=INFO fiber=#222 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:07.215Z level=INFO fiber=#222 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:07.215Z level=INFO fiber=#222 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:07.215Z level=INFO fiber=#222 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:07.215Z level=INFO fiber=#222 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:07.215Z level=INFO fiber=#222 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:07.215Z level=INFO fiber=#222 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:07.216Z level=INFO fiber=#222 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:07.216Z level=INFO fiber=#222 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:07.216Z level=INFO fiber=#222 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:07.216Z level=INFO fiber=#222 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:07.216Z level=INFO fiber=#222 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:07.216Z level=INFO fiber=#222 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:07.216Z level=INFO fiber=#222 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:07.216Z level=INFO fiber=#222 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:07.216Z level=INFO fiber=#222 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.09ms)"
timestamp=2025-11-18T21:00:07.216Z level=INFO fiber=#222 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:07.216Z level=INFO fiber=#222 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:07.217Z level=INFO fiber=#222 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.217Z level=INFO fiber=#222 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.217Z level=INFO fiber=#222 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.217Z level=INFO fiber=#222 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.217Z level=INFO fiber=#222 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.217Z level=INFO fiber=#222 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:07.217Z level=INFO fiber=#222 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.217Z level=INFO fiber=#222 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:07.217Z level=INFO fiber=#223 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: websocket-protocol-test.json
ğŸ” DEBUG: extractSchemaNameFromTest("websocket-protocol-test.json") = "null"
264 | 			const {outputFiles} = await compileAsyncAPISpecWithoutErrors(source)
265 | 
266 | 			const asyncapiDoc = await parseAsyncAPIOutput(outputFiles, "websocket-protocol-test.json") as AsyncAPIObject
267 | 
268 | 			// Validate WebSocket message schema
269 | 			expect(asyncapiDoc.components?.schemas?.WebSocketMessage).toBeDefined()
                                                                   ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/decorator-functionality.test.ts:269:62)
(fail) Real Decorator Functionality Tests > @protocol Decorator Real Processing > should process @protocol decorator with WebSocket binding [112.25ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 789
timestamp=2025-11-18T21:00:07.294Z level=INFO fiber=#228 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:07.294Z level=INFO fiber=#228 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:07.294Z level=INFO fiber=#228 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:07.294Z level=INFO fiber=#228 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:07.294Z level=INFO fiber=#228 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:07.300Z level=INFO fiber=#228 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:07.300Z level=INFO fiber=#228 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:07.300Z level=INFO fiber=#228 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:07.300Z level=INFO fiber=#228 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:07.300Z level=INFO fiber=#228 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:07.300Z level=INFO fiber=#228 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:07.300Z level=INFO fiber=#228 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:07.300Z level=INFO fiber=#228 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:07.300Z level=INFO fiber=#228 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:07.300Z level=INFO fiber=#228 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:07.300Z level=INFO fiber=#228 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:07.300Z level=INFO fiber=#228 message="âœ… Discovery: 2 operations found"
timestamp=2025-11-18T21:00:07.300Z level=INFO fiber=#228 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:07.300Z level=INFO fiber=#228 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:07.300Z level=INFO fiber=#228 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:07.300Z level=INFO fiber=#228 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:07.300Z level=INFO fiber=#228 message="ğŸ”„ Processing 2 operations with Effect.TS..."
timestamp=2025-11-18T21:00:07.300Z level=INFO fiber=#228 message="âœ… Processed 2 operations successfully"
timestamp=2025-11-18T21:00:07.300Z level=INFO fiber=#228 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:07.300Z level=INFO fiber=#228 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:07.300Z level=INFO fiber=#228 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:07.300Z level=INFO fiber=#228 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:07.300Z level=INFO fiber=#228 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 2,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 2
}"
timestamp=2025-11-18T21:00:07.300Z level=INFO fiber=#228 message="âœ… Processing: 2 elements processed"
timestamp=2025-11-18T21:00:07.300Z level=INFO fiber=#228 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:07.300Z level=INFO fiber=#228 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:07.300Z level=INFO fiber=#228 message="âœ… AsyncAPI document validation passed! 2 channels, 0 operations (0.05ms)"
timestamp=2025-11-18T21:00:07.301Z level=INFO fiber=#228 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:07.301Z level=INFO fiber=#228 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:07.302Z level=INFO fiber=#228 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.302Z level=INFO fiber=#228 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.302Z level=INFO fiber=#228 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.302Z level=INFO fiber=#228 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.302Z level=INFO fiber=#228 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.302Z level=INFO fiber=#228 message="ğŸ‰ TYPESPEC API SUCCESS: 2 channels, 0 operations"
timestamp=2025-11-18T21:00:07.302Z level=INFO fiber=#228 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.302Z level=INFO fiber=#228 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:07.302Z level=INFO fiber=#229 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: multi-protocol-test.json
ğŸ” DEBUG: extractSchemaNameFromTest("multi-protocol-test.json") = "UserEvent"
321 | 			const {outputFiles} = await compileAsyncAPISpecWithoutErrors(source)
322 | 
323 | 			const asyncapiDoc = await parseAsyncAPIOutput(outputFiles, "multi-protocol-test.json") as AsyncAPIObject
324 | 
325 | 			// Validate both operations were created
326 | 			expect(asyncapiDoc.operations?.publishAMQPEvent).toBeDefined()
                                                          ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/decorator-functionality.test.ts:326:53)
(fail) Real Decorator Functionality Tests > @protocol Decorator Real Processing > should process @protocol decorator with multiple protocols [94.19ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 474
timestamp=2025-11-18T21:00:07.400Z level=INFO fiber=#230 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:07.401Z level=INFO fiber=#230 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:07.401Z level=INFO fiber=#230 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:07.401Z level=INFO fiber=#230 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:07.401Z level=INFO fiber=#230 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:07.401Z level=INFO fiber=#230 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:07.401Z level=INFO fiber=#230 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:07.401Z level=INFO fiber=#230 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:07.401Z level=INFO fiber=#230 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:07.401Z level=INFO fiber=#230 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:07.401Z level=INFO fiber=#230 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:07.401Z level=INFO fiber=#230 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:07.401Z level=INFO fiber=#230 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:07.401Z level=INFO fiber=#230 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:07.401Z level=INFO fiber=#230 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:07.401Z level=INFO fiber=#230 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:07.402Z level=INFO fiber=#230 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:07.402Z level=INFO fiber=#230 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:07.402Z level=INFO fiber=#230 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:07.402Z level=INFO fiber=#230 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:07.402Z level=INFO fiber=#230 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:07.402Z level=INFO fiber=#230 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:07.402Z level=INFO fiber=#230 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:07.402Z level=INFO fiber=#230 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:07.402Z level=INFO fiber=#230 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:07.402Z level=INFO fiber=#230 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:07.402Z level=INFO fiber=#230 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:07.402Z level=INFO fiber=#230 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:07.402Z level=INFO fiber=#230 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:07.402Z level=INFO fiber=#230 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:07.402Z level=INFO fiber=#230 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:07.402Z level=INFO fiber=#230 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T21:00:07.402Z level=INFO fiber=#230 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:07.402Z level=INFO fiber=#230 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:07.403Z level=INFO fiber=#230 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.403Z level=INFO fiber=#230 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.403Z level=INFO fiber=#230 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.403Z level=INFO fiber=#230 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.403Z level=INFO fiber=#230 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.403Z level=INFO fiber=#230 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:07.403Z level=INFO fiber=#230 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.403Z level=INFO fiber=#230 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:07.403Z level=INFO fiber=#231 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: jwt-security-test.json
ğŸ” DEBUG: extractSchemaNameFromTest("jwt-security-test.json") = "null"
363 | 			expect(program).toBeDefined()
364 | 
365 | 			const asyncapiDoc = await parseAsyncAPIOutput(outputFiles, "jwt-security-test.json") as AsyncAPIObject
366 | 
367 | 			// Validate secure message schema
368 | 			expect(asyncapiDoc.components?.schemas?.SecureMessage).toBeDefined()
                                                                ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/decorator-functionality.test.ts:368:59)
(fail) Real Decorator Functionality Tests > @security Decorator Real Processing > should process @security decorator with JWT Bearer authentication [94.19ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 1106
timestamp=2025-11-18T21:00:07.510Z level=INFO fiber=#232 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:07.510Z level=INFO fiber=#232 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:07.510Z level=INFO fiber=#232 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:07.510Z level=INFO fiber=#232 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:07.510Z level=INFO fiber=#232 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:07.511Z level=INFO fiber=#232 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:07.511Z level=INFO fiber=#232 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:07.511Z level=INFO fiber=#232 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:07.511Z level=INFO fiber=#232 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:07.511Z level=INFO fiber=#232 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:07.511Z level=INFO fiber=#232 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:07.511Z level=INFO fiber=#232 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:07.511Z level=INFO fiber=#232 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:07.511Z level=INFO fiber=#232 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:07.511Z level=INFO fiber=#232 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:07.511Z level=INFO fiber=#232 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:07.511Z level=INFO fiber=#232 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:07.511Z level=INFO fiber=#232 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:07.511Z level=INFO fiber=#232 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:07.511Z level=INFO fiber=#232 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:07.511Z level=INFO fiber=#232 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:07.511Z level=INFO fiber=#232 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:07.511Z level=INFO fiber=#232 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:07.511Z level=INFO fiber=#232 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:07.511Z level=INFO fiber=#232 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:07.511Z level=INFO fiber=#232 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:07.511Z level=INFO fiber=#232 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:07.511Z level=INFO fiber=#232 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:07.511Z level=INFO fiber=#232 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:07.511Z level=INFO fiber=#232 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:07.511Z level=INFO fiber=#232 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:07.511Z level=INFO fiber=#232 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T21:00:07.511Z level=INFO fiber=#232 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:07.511Z level=INFO fiber=#232 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:07.512Z level=INFO fiber=#232 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.512Z level=INFO fiber=#232 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.512Z level=INFO fiber=#232 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.512Z level=INFO fiber=#232 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.512Z level=INFO fiber=#232 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.512Z level=INFO fiber=#232 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:07.512Z level=INFO fiber=#232 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.512Z level=INFO fiber=#232 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:07.512Z level=INFO fiber=#233 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: oauth2-security-test.json
ğŸ” DEBUG: extractSchemaNameFromTest("oauth2-security-test.json") = "null"
420 | 			const {outputFiles} = await compileAsyncAPISpecWithoutErrors(source)
421 | 
422 | 			const asyncapiDoc = await parseAsyncAPIOutput(outputFiles, "oauth2-security-test.json") as AsyncAPIObject
423 | 
424 | 			// Validate OAuth2 secured message schema
425 | 			expect(asyncapiDoc.components?.schemas?.OAuth2SecuredMessage).toBeDefined()
                                                                       ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/decorator-functionality.test.ts:425:66)
(fail) Real Decorator Functionality Tests > @security Decorator Real Processing > should process @security decorator with OAuth2 flows [121.99ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 624
timestamp=2025-11-18T21:00:07.672Z level=INFO fiber=#236 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:07.672Z level=INFO fiber=#236 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:07.672Z level=INFO fiber=#236 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:07.672Z level=INFO fiber=#236 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:07.672Z level=INFO fiber=#236 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:07.672Z level=INFO fiber=#236 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:07.672Z level=INFO fiber=#236 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:07.672Z level=INFO fiber=#236 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:07.672Z level=INFO fiber=#236 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:07.672Z level=INFO fiber=#236 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:07.673Z level=INFO fiber=#236 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:07.673Z level=INFO fiber=#236 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:07.673Z level=INFO fiber=#236 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:07.673Z level=INFO fiber=#236 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:07.673Z level=INFO fiber=#236 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:07.673Z level=INFO fiber=#236 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:07.673Z level=INFO fiber=#236 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:07.673Z level=INFO fiber=#236 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:07.673Z level=INFO fiber=#236 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:07.673Z level=INFO fiber=#236 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:07.673Z level=INFO fiber=#236 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:07.673Z level=INFO fiber=#236 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:07.673Z level=INFO fiber=#236 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:07.673Z level=INFO fiber=#236 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:07.673Z level=INFO fiber=#236 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:07.673Z level=INFO fiber=#236 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:07.673Z level=INFO fiber=#236 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:07.673Z level=INFO fiber=#236 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:07.673Z level=INFO fiber=#236 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:07.673Z level=INFO fiber=#236 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:07.673Z level=INFO fiber=#236 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:07.673Z level=INFO fiber=#236 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.07ms)"
timestamp=2025-11-18T21:00:07.673Z level=INFO fiber=#236 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:07.673Z level=INFO fiber=#236 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:07.674Z level=INFO fiber=#236 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.674Z level=INFO fiber=#236 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.674Z level=INFO fiber=#236 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.674Z level=INFO fiber=#236 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.674Z level=INFO fiber=#236 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.674Z level=INFO fiber=#236 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:07.674Z level=INFO fiber=#236 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.674Z level=INFO fiber=#236 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:07.675Z level=INFO fiber=#237 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: sasl-security-test.json
ğŸ” DEBUG: extractSchemaNameFromTest("sasl-security-test.json") = "null"
466 | 			const {outputFiles} = await compileAsyncAPISpecWithoutErrors(source)
467 | 
468 | 			const asyncapiDoc = await parseAsyncAPIOutput(outputFiles, "sasl-security-test.json") as AsyncAPIObject
469 | 
470 | 			// Validate SASL secured message
471 | 			expect(asyncapiDoc.components?.schemas?.SASLSecuredMessage).toBeDefined()
                                                                     ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/decorator-functionality.test.ts:471:64)
(fail) Real Decorator Functionality Tests > @security Decorator Real Processing > should process @security decorator with SASL authentication for Kafka [147.74ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 2546
timestamp=2025-11-18T21:00:07.929Z level=INFO fiber=#242 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:07.929Z level=INFO fiber=#242 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:07.929Z level=INFO fiber=#242 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:07.929Z level=INFO fiber=#242 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:07.929Z level=INFO fiber=#242 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:07.929Z level=INFO fiber=#242 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:07.929Z level=INFO fiber=#242 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:07.929Z level=INFO fiber=#242 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:07.929Z level=INFO fiber=#242 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:07.929Z level=INFO fiber=#242 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:07.929Z level=INFO fiber=#242 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:07.929Z level=INFO fiber=#242 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:07.929Z level=INFO fiber=#242 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:07.929Z level=INFO fiber=#242 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:07.929Z level=INFO fiber=#242 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:07.929Z level=INFO fiber=#242 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:07.929Z level=INFO fiber=#242 message="âœ… Discovery: 2 operations found"
timestamp=2025-11-18T21:00:07.930Z level=INFO fiber=#242 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:07.930Z level=INFO fiber=#242 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:07.930Z level=INFO fiber=#242 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:07.930Z level=INFO fiber=#242 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:07.930Z level=INFO fiber=#242 message="ğŸ”„ Processing 2 operations with Effect.TS..."
timestamp=2025-11-18T21:00:07.930Z level=INFO fiber=#242 message="âœ… Processed 2 operations successfully"
timestamp=2025-11-18T21:00:07.930Z level=INFO fiber=#242 message="ğŸ¯ Processing 1 message models with functional composition..."
timestamp=2025-11-18T21:00:07.930Z level=INFO fiber=#243 message="ğŸ” Converting model to schema: SecureKafkaEvent (cache miss)"
timestamp=2025-11-18T21:00:07.930Z level=INFO fiber=#243 message="ğŸ” Converting model to schema: SecureKafkaEvent (cache miss)"
timestamp=2025-11-18T21:00:07.930Z level=INFO fiber=#243 message="ğŸ” walkPropertiesInherited found 7 properties for model SecureKafkaEvent"
timestamp=2025-11-18T21:00:07.930Z level=INFO fiber=#243 message="ğŸ“‹ Processing property: traceId (type: Scalar)"
timestamp=2025-11-18T21:00:07.930Z level=INFO fiber=#243 message="ğŸ” Converting property: traceId (Scalar)"
timestamp=2025-11-18T21:00:07.930Z level=INFO fiber=#243 message="ğŸ” Converting type: Scalar"
timestamp=2025-11-18T21:00:07.930Z level=INFO fiber=#243 message="âœ… Property traceId converted to: {\"type\":\"string\"}"
timestamp=2025-11-18T21:00:07.930Z level=INFO fiber=#243 message="ğŸ“‹ Processing property: eventId (type: Scalar)"
timestamp=2025-11-18T21:00:07.930Z level=INFO fiber=#243 message="ğŸ” Converting property: eventId (Scalar)"
timestamp=2025-11-18T21:00:07.930Z level=INFO fiber=#243 message="ğŸ” Converting type: Scalar"
timestamp=2025-11-18T21:00:07.930Z level=INFO fiber=#243 message="âœ… Property eventId converted to: {\"type\":\"string\"}"
timestamp=2025-11-18T21:00:07.931Z level=INFO fiber=#243 message="ğŸ“‹ Processing property: userId (type: Scalar)"
timestamp=2025-11-18T21:00:07.931Z level=INFO fiber=#243 message="ğŸ” Converting property: userId (Scalar)"
timestamp=2025-11-18T21:00:07.931Z level=INFO fiber=#243 message="ğŸ” Converting type: Scalar"
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="âœ… Property userId converted to: {\"type\":\"string\"}"
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="ğŸ“‹ Processing property: action (type: Union)"
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="ğŸ” Converting property: action (Union)"
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="ğŸ” Converting type: Union"
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="ğŸ”€ Processing union type with 4 variants"
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="âœ… Property action converted to: {\"type\":\"string\",\"enum\":[\"create\",\"update\",\"delete\",\"view\"]}"
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="ğŸ“‹ Processing property: resource (type: Model)"
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="ğŸ” Converting property: resource (Model)"
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="ğŸ” Converting type: Model"
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="ğŸ—ï¸ Processing model: "
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="ğŸ” Converting property: type (Scalar)"
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="ğŸ” Converting type: Scalar"
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="âœ… Property type converted to: {\"type\":\"string\"}"
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="ğŸ” Converting property: id (Scalar)"
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="ğŸ” Converting type: Scalar"
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="âœ… Property id converted to: {\"type\":\"string\"}"
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="ğŸ” Converting property: attributes (Model)"
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="ğŸ” Converting type: Model"
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="âœ… Property attributes converted to: {\"type\":\"object\",\"additionalProperties\":{\"type\":\"string\"}}"
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="âœ… Property resource converted to: {\"type\":\"object\",\"properties\":{\"type\":{\"description\":\"Property type\",\"type\":\"string\"},\"id\":{\"description\":\"Property id\",\"type\":\"string\"},\"attributes\":{\"description\":\"Property attributes\",\"type\":\"object\",\"additionalProperties\":{\"type\":\"string\"}}},\"required\":[\"type\",\"id\",\"attributes\"]}"
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="ğŸ“‹ Processing property: timestamp (type: Scalar)"
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="ğŸ” Converting property: timestamp (Scalar)"
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="ğŸ” Converting type: Scalar"
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="âœ… Property timestamp converted to: {\"type\":\"string\",\"format\":\"date-time\"}"
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="ğŸ“‹ Processing property: securityContext (type: Model)"
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="ğŸ” Converting property: securityContext (Model)"
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="ğŸ” Converting type: Model"
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="ğŸ—ï¸ Processing model: "
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="ğŸ” Converting property: roles (Model)"
timestamp=2025-11-18T21:00:07.932Z level=INFO fiber=#243 message="ğŸ” Converting type: Model"
timestamp=2025-11-18T21:00:07.933Z level=INFO fiber=#243 message="ğŸ” Converting type: Scalar"
timestamp=2025-11-18T21:00:07.933Z level=INFO fiber=#243 message="âœ… Property roles converted to: {\"type\":\"array\",\"items\":{\"type\":\"string\"}}"
timestamp=2025-11-18T21:00:07.933Z level=INFO fiber=#243 message="ğŸ” Converting property: permissions (Model)"
timestamp=2025-11-18T21:00:07.933Z level=INFO fiber=#243 message="ğŸ” Converting type: Model"
timestamp=2025-11-18T21:00:07.933Z level=INFO fiber=#243 message="ğŸ” Converting type: Scalar"
timestamp=2025-11-18T21:00:07.933Z level=INFO fiber=#243 message="âœ… Property permissions converted to: {\"type\":\"array\",\"items\":{\"type\":\"string\"}}"
timestamp=2025-11-18T21:00:07.933Z level=INFO fiber=#243 message="ğŸ” Converting property: sessionId (Scalar)"
timestamp=2025-11-18T21:00:07.933Z level=INFO fiber=#243 message="ğŸ” Converting type: Scalar"
timestamp=2025-11-18T21:00:07.933Z level=INFO fiber=#243 message="âœ… Property sessionId converted to: {\"type\":\"string\"}"
timestamp=2025-11-18T21:00:07.933Z level=INFO fiber=#243 message="âœ… Property securityContext converted to: {\"type\":\"object\",\"properties\":{\"roles\":{\"description\":\"Property roles\",\"type\":\"array\",\"items\":{\"type\":\"string\"}},\"permissions\":{\"description\":\"Property permissions\",\"type\":\"array\",\"items\":{\"type\":\"string\"}},\"sessionId\":{\"description\":\"Property sessionId\",\"type\":\"string\"}},\"required\":[\"roles\",\"permissions\",\"sessionId\"]}"
timestamp=2025-11-18T21:00:07.933Z level=INFO fiber=#243 message="âœ… Schema conversion complete for SecureKafkaEvent: 7 properties, 7 required"
timestamp=2025-11-18T21:00:07.933Z level=INFO fiber=#242 message="Batch emit completed" message="{
  \"processedCount\": 1,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:07.933Z level=INFO fiber=#242 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:07.933Z level=INFO fiber=#242 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:07.933Z level=INFO fiber=#242 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 2,
  \"messagesProcessed\": 1,
  \"securityProcessed\": 0,
  \"totalProcessed\": 3
}"
timestamp=2025-11-18T21:00:07.933Z level=INFO fiber=#242 message="âœ… Processing: 3 elements processed"
timestamp=2025-11-18T21:00:07.933Z level=INFO fiber=#242 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:07.933Z level=INFO fiber=#242 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:07.933Z level=INFO fiber=#242 message="âœ… AsyncAPI document validation passed! 2 channels, 0 operations (0.05ms)"
timestamp=2025-11-18T21:00:07.933Z level=INFO fiber=#242 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:07.933Z level=INFO fiber=#242 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:07.937Z level=INFO fiber=#242 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.937Z level=INFO fiber=#242 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.937Z level=INFO fiber=#242 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.938Z level=INFO fiber=#242 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.938Z level=INFO fiber=#242 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.938Z level=INFO fiber=#242 message="ğŸ‰ TYPESPEC API SUCCESS: 2 channels, 0 operations"
timestamp=2025-11-18T21:00:07.938Z level=INFO fiber=#242 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:07.938Z level=INFO fiber=#242 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:07.938Z level=INFO fiber=#244 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: combined-decorators-test.json
ğŸ” DEBUG: extractSchemaNameFromTest("combined-decorators-test.json") = "null"
580 | 			expect(program).toBeDefined()
581 | 
582 | 			const asyncapiDoc = await parseAsyncAPIOutput(outputFiles, "combined-decorators-test.json") as AsyncAPIObject
583 | 
584 | 			// Validate complex message schema
585 | 			expect(asyncapiDoc.components?.schemas?.SecureKafkaEvent).toBeDefined()
                                                                   ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/decorator-functionality.test.ts:585:62)
(fail) Real Decorator Functionality Tests > Combined Decorator Integration > should process all decorators together in complex scenario [273.49ms]

test/integration/basic-emit.test.ts:
ğŸš€ compileAsyncAPISpecRaw called with source length: 737
timestamp=2025-11-18T21:00:08.097Z level=INFO fiber=#245 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:08.097Z level=INFO fiber=#245 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:08.097Z level=INFO fiber=#245 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:08.097Z level=INFO fiber=#245 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:08.097Z level=INFO fiber=#245 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:08.097Z level=INFO fiber=#245 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:08.097Z level=INFO fiber=#245 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:08.097Z level=INFO fiber=#245 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:08.097Z level=INFO fiber=#245 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:08.097Z level=INFO fiber=#245 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:08.097Z level=INFO fiber=#245 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:08.097Z level=INFO fiber=#245 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:08.097Z level=INFO fiber=#245 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:08.097Z level=INFO fiber=#245 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:08.097Z level=INFO fiber=#245 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:08.097Z level=INFO fiber=#245 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:08.097Z level=INFO fiber=#245 message="âœ… Discovery: 2 operations found"
timestamp=2025-11-18T21:00:08.097Z level=INFO fiber=#245 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:08.098Z level=INFO fiber=#245 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:08.098Z level=INFO fiber=#245 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:08.098Z level=INFO fiber=#245 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:08.098Z level=INFO fiber=#245 message="ğŸ”„ Processing 2 operations with Effect.TS..."
timestamp=2025-11-18T21:00:08.098Z level=INFO fiber=#245 message="âœ… Processed 2 operations successfully"
timestamp=2025-11-18T21:00:08.098Z level=INFO fiber=#245 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:08.098Z level=INFO fiber=#245 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:08.098Z level=INFO fiber=#245 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:08.098Z level=INFO fiber=#245 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:08.098Z level=INFO fiber=#245 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 2,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 2
}"
timestamp=2025-11-18T21:00:08.098Z level=INFO fiber=#245 message="âœ… Processing: 2 elements processed"
timestamp=2025-11-18T21:00:08.098Z level=INFO fiber=#245 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:08.098Z level=INFO fiber=#245 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:08.098Z level=INFO fiber=#245 message="âœ… AsyncAPI document validation passed! 2 channels, 0 operations (0.05ms)"
timestamp=2025-11-18T21:00:08.098Z level=INFO fiber=#245 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:08.098Z level=INFO fiber=#245 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:08.099Z level=INFO fiber=#245 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.099Z level=INFO fiber=#245 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.099Z level=INFO fiber=#245 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.099Z level=INFO fiber=#245 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.099Z level=INFO fiber=#245 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.099Z level=INFO fiber=#245 message="ğŸ‰ TYPESPEC API SUCCESS: 2 channels, 0 operations"
timestamp=2025-11-18T21:00:08.099Z level=INFO fiber=#245 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.100Z level=INFO fiber=#245 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:08.100Z level=INFO fiber=#246 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
49 | 		const content = outputFiles.get(f) as string
50 | 		return content && content.includes('asyncapi: 3.0.0')
51 | 	})
52 | 
53 | 	if (asyncapiFiles.length === 0) {
54 | 		throw new Error(`No AsyncAPI YAML files found. Available files: ${availableFiles.join(', ')}`)
                 ^
error: No AsyncAPI YAML files found. Available files: 
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/basic-emit.test.ts:54:13)
(fail) AsyncAPI Emitter Integration > should compile basic-events example and generate AsyncAPI [137.32ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 647
timestamp=2025-11-18T21:00:08.210Z level=INFO fiber=#247 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:08.210Z level=INFO fiber=#247 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:08.210Z level=INFO fiber=#247 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:08.210Z level=INFO fiber=#247 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:08.210Z level=INFO fiber=#247 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:08.210Z level=INFO fiber=#247 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:08.210Z level=INFO fiber=#247 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:08.210Z level=INFO fiber=#247 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:08.210Z level=INFO fiber=#247 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:08.211Z level=INFO fiber=#247 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:08.211Z level=INFO fiber=#247 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:08.211Z level=INFO fiber=#247 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:08.211Z level=INFO fiber=#247 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:08.211Z level=INFO fiber=#247 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:08.211Z level=INFO fiber=#247 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:08.211Z level=INFO fiber=#247 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:08.211Z level=INFO fiber=#247 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:08.211Z level=INFO fiber=#247 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:08.211Z level=INFO fiber=#247 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:08.211Z level=INFO fiber=#247 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:08.211Z level=INFO fiber=#247 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:08.211Z level=INFO fiber=#247 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:08.211Z level=INFO fiber=#247 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:08.211Z level=INFO fiber=#247 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:08.211Z level=INFO fiber=#247 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:08.211Z level=INFO fiber=#247 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:08.211Z level=INFO fiber=#247 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:08.211Z level=INFO fiber=#247 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:08.211Z level=INFO fiber=#247 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:08.211Z level=INFO fiber=#247 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:08.211Z level=INFO fiber=#247 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:08.211Z level=INFO fiber=#247 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.06ms)"
timestamp=2025-11-18T21:00:08.211Z level=INFO fiber=#247 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:08.211Z level=INFO fiber=#247 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:08.212Z level=INFO fiber=#247 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.212Z level=INFO fiber=#247 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.212Z level=INFO fiber=#247 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.212Z level=INFO fiber=#247 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.212Z level=INFO fiber=#247 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.212Z level=INFO fiber=#247 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:08.213Z level=INFO fiber=#247 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.213Z level=INFO fiber=#247 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:08.217Z level=INFO fiber=#248 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: complex-test.json
ğŸ” DEBUG: extractSchemaNameFromTest("complex-test.json") = "ComplexEvent"
105 | 		expect(asyncapiDoc.operations).toBeDefined()
106 | 		expect(asyncapiDoc.components.schemas).toBeDefined()
107 | 
108 | 		// Validate generated schema for ComplexEvent
109 | 		const complexEventSchema = asyncapiDoc.components.schemas.ComplexEvent
110 | 		expect(complexEventSchema).toBeDefined()
                                   ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/basic-emit.test.ts:110:30)
(fail) AsyncAPI Emitter Integration > should validate TypeSpec models and generate schemas [116.63ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 538
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="âœ… Discovery: 3 operations found"
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="ğŸ”„ Processing 3 operations with Effect.TS..."
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="âœ… Processed 3 operations successfully"
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 3,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 3
}"
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="âœ… Processing: 3 elements processed"
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="âœ… AsyncAPI document validation passed! 3 channels, 0 operations (0.05ms)"
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:08.318Z level=INFO fiber=#249 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:08.320Z level=INFO fiber=#249 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.320Z level=INFO fiber=#249 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.320Z level=INFO fiber=#249 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.320Z level=INFO fiber=#249 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.320Z level=INFO fiber=#249 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.320Z level=INFO fiber=#249 message="ğŸ‰ TYPESPEC API SUCCESS: 3 channels, 0 operations"
timestamp=2025-11-18T21:00:08.320Z level=INFO fiber=#249 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.320Z level=INFO fiber=#249 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:08.320Z level=INFO fiber=#250 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
159 | 		const content = typeof rawContent === 'string' ? rawContent : (rawContent as any).content
160 | 		return content && content.includes('asyncapi: 3.0.0')
161 | 	})
162 | 
163 | 	if (asyncapiFiles.length === 0) {
164 | 		throw new Error(`No AsyncAPI YAML files found. Available files: ${availableFiles.join(', ')}`)
                  ^
error: No AsyncAPI YAML files found. Available files: 
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/basic-emit.test.ts:164:13)
(fail) AsyncAPI Emitter Integration > should handle multiple operations and channels [101.71ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 533
timestamp=2025-11-18T21:00:08.374Z level=INFO fiber=#251 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:08.374Z level=INFO fiber=#251 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:08.374Z level=INFO fiber=#251 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:08.374Z level=INFO fiber=#251 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:08.374Z level=INFO fiber=#251 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:08.374Z level=INFO fiber=#251 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:08.374Z level=INFO fiber=#251 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:08.374Z level=INFO fiber=#251 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:08.374Z level=INFO fiber=#251 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:08.374Z level=INFO fiber=#251 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:08.374Z level=INFO fiber=#251 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:08.374Z level=INFO fiber=#251 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:08.374Z level=INFO fiber=#251 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:08.374Z level=INFO fiber=#251 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:08.374Z level=INFO fiber=#251 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:08.374Z level=INFO fiber=#251 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:08.375Z level=INFO fiber=#251 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:08.375Z level=INFO fiber=#251 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:08.375Z level=INFO fiber=#251 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:08.375Z level=INFO fiber=#251 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:08.375Z level=INFO fiber=#251 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:08.375Z level=INFO fiber=#251 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:08.375Z level=INFO fiber=#251 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:08.375Z level=INFO fiber=#251 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:08.375Z level=INFO fiber=#251 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:08.375Z level=INFO fiber=#251 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:08.375Z level=INFO fiber=#251 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:08.375Z level=INFO fiber=#251 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:08.375Z level=INFO fiber=#251 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:08.375Z level=INFO fiber=#251 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:08.375Z level=INFO fiber=#251 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:08.375Z level=INFO fiber=#251 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T21:00:08.375Z level=INFO fiber=#251 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:08.375Z level=INFO fiber=#251 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:08.376Z level=INFO fiber=#251 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.376Z level=INFO fiber=#251 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.376Z level=INFO fiber=#251 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.376Z level=INFO fiber=#251 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.376Z level=INFO fiber=#251 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.376Z level=INFO fiber=#251 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:08.376Z level=INFO fiber=#251 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.376Z level=INFO fiber=#251 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:08.376Z level=INFO fiber=#252 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: doc-test.json
ğŸ” DEBUG: extractSchemaNameFromTest("doc-test.json") = "null"
208 | 		const {outputFiles} = await compileAsyncAPISpecWithoutErrors(source)
209 | 
210 | 		const asyncapiDoc = await parseAsyncAPIOutput(outputFiles, "doc-test.json")
211 | 
212 | 		// Validate documentation is preserved
213 | 		const channel = asyncapiDoc.channels.documented.events
                                             ^
TypeError: undefined is not an object (evaluating 'asyncapiDoc.channels.documented.events')
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/basic-emit.test.ts:213:40)
(fail) AsyncAPI Emitter Integration > should handle TypeSpec decorators and documentation [57.75ms]

test/integration/simple-emitter.test.ts:
ğŸš€ compileAsyncAPISpecRaw called with source length: 190
timestamp=2025-11-18T21:00:08.648Z level=INFO fiber=#253 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:08.648Z level=INFO fiber=#253 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:08.648Z level=INFO fiber=#253 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:08.648Z level=INFO fiber=#253 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:08.648Z level=INFO fiber=#253 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:08.648Z level=INFO fiber=#253 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:08.648Z level=INFO fiber=#253 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:08.648Z level=INFO fiber=#253 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:08.648Z level=INFO fiber=#253 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:08.648Z level=INFO fiber=#253 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:08.648Z level=INFO fiber=#253 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:08.648Z level=INFO fiber=#253 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:08.648Z level=INFO fiber=#253 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:08.648Z level=INFO fiber=#253 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:08.648Z level=INFO fiber=#253 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:08.648Z level=INFO fiber=#253 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:08.648Z level=INFO fiber=#253 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:08.648Z level=INFO fiber=#253 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:08.649Z level=INFO fiber=#253 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:08.649Z level=INFO fiber=#253 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:08.649Z level=INFO fiber=#253 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:08.649Z level=INFO fiber=#253 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:08.649Z level=INFO fiber=#253 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:08.649Z level=INFO fiber=#253 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:08.649Z level=INFO fiber=#253 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:08.649Z level=INFO fiber=#253 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:08.649Z level=INFO fiber=#253 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:08.649Z level=INFO fiber=#253 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:08.649Z level=INFO fiber=#253 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:08.649Z level=INFO fiber=#253 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:08.649Z level=INFO fiber=#253 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:08.649Z level=INFO fiber=#253 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.10ms)"
timestamp=2025-11-18T21:00:08.649Z level=INFO fiber=#253 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:08.650Z level=INFO fiber=#253 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:08.655Z level=INFO fiber=#253 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.662Z level=INFO fiber=#253 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.662Z level=INFO fiber=#253 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.662Z level=INFO fiber=#253 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.663Z level=INFO fiber=#253 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.663Z level=INFO fiber=#253 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:08.663Z level=INFO fiber=#253 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.663Z level=INFO fiber=#253 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:08.663Z level=INFO fiber=#254 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: simple-test.json
ğŸ” DEBUG: extractSchemaNameFromTest("simple-test.json") = "null"
ğŸš€ compileAsyncAPISpecRaw called with source length: 281
timestamp=2025-11-18T21:00:08.737Z level=INFO fiber=#255 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:08.737Z level=INFO fiber=#255 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:08.737Z level=INFO fiber=#255 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:08.737Z level=INFO fiber=#255 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:08.737Z level=INFO fiber=#255 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:08.738Z level=INFO fiber=#255 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:08.738Z level=INFO fiber=#255 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:08.738Z level=INFO fiber=#255 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:08.738Z level=INFO fiber=#255 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:08.738Z level=INFO fiber=#255 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:08.738Z level=INFO fiber=#255 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:08.738Z level=INFO fiber=#255 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:08.738Z level=INFO fiber=#255 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:08.738Z level=INFO fiber=#255 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:08.738Z level=INFO fiber=#255 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:08.738Z level=INFO fiber=#255 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:08.738Z level=INFO fiber=#255 message="âœ… Discovery: 2 operations found"
timestamp=2025-11-18T21:00:08.738Z level=INFO fiber=#255 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:08.738Z level=INFO fiber=#255 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:08.738Z level=INFO fiber=#255 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:08.738Z level=INFO fiber=#255 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:08.738Z level=INFO fiber=#255 message="ğŸ”„ Processing 2 operations with Effect.TS..."
timestamp=2025-11-18T21:00:08.739Z level=INFO fiber=#255 message="âœ… Processed 2 operations successfully"
timestamp=2025-11-18T21:00:08.739Z level=INFO fiber=#255 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:08.739Z level=INFO fiber=#255 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:08.741Z level=INFO fiber=#255 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:08.741Z level=INFO fiber=#255 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:08.741Z level=INFO fiber=#255 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 2,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 2
}"
timestamp=2025-11-18T21:00:08.741Z level=INFO fiber=#255 message="âœ… Processing: 2 elements processed"
timestamp=2025-11-18T21:00:08.741Z level=INFO fiber=#255 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:08.741Z level=INFO fiber=#255 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:08.741Z level=INFO fiber=#255 message="âœ… AsyncAPI document validation passed! 2 channels, 0 operations (0.05ms)"
timestamp=2025-11-18T21:00:08.741Z level=INFO fiber=#255 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:08.741Z level=INFO fiber=#255 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:08.743Z level=INFO fiber=#255 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.743Z level=INFO fiber=#255 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.743Z level=INFO fiber=#255 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.743Z level=INFO fiber=#255 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.743Z level=INFO fiber=#255 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.743Z level=INFO fiber=#255 message="ğŸ‰ TYPESPEC API SUCCESS: 2 channels, 0 operations"
timestamp=2025-11-18T21:00:08.743Z level=INFO fiber=#255 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.743Z level=INFO fiber=#255 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:08.743Z level=INFO fiber=#256 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: multi-op.json
ğŸ” DEBUG: extractSchemaNameFromTest("multi-op.json") = "UserEvent"
ğŸš€ compileAsyncAPISpecRaw called with source length: 142
timestamp=2025-11-18T21:00:08.810Z level=INFO fiber=#257 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:08.811Z level=INFO fiber=#257 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:08.811Z level=INFO fiber=#257 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:08.811Z level=INFO fiber=#257 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:08.811Z level=INFO fiber=#257 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:08.811Z level=INFO fiber=#257 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:08.811Z level=INFO fiber=#257 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:08.811Z level=INFO fiber=#257 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:08.811Z level=INFO fiber=#257 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:08.811Z level=INFO fiber=#257 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:08.811Z level=INFO fiber=#257 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:08.811Z level=INFO fiber=#257 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:08.812Z level=INFO fiber=#257 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:08.812Z level=INFO fiber=#257 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:08.812Z level=INFO fiber=#257 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:08.812Z level=INFO fiber=#257 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:08.812Z level=INFO fiber=#257 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:08.812Z level=INFO fiber=#257 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:08.812Z level=INFO fiber=#257 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:08.812Z level=INFO fiber=#257 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:08.812Z level=INFO fiber=#257 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:08.812Z level=INFO fiber=#257 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:08.812Z level=INFO fiber=#257 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:08.812Z level=INFO fiber=#257 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:08.812Z level=INFO fiber=#257 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:08.812Z level=INFO fiber=#257 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:08.812Z level=INFO fiber=#257 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:08.812Z level=INFO fiber=#257 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:08.812Z level=INFO fiber=#257 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:08.813Z level=INFO fiber=#257 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:08.813Z level=INFO fiber=#257 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:08.813Z level=INFO fiber=#257 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.05ms)"
timestamp=2025-11-18T21:00:08.813Z level=INFO fiber=#257 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:08.813Z level=INFO fiber=#257 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:08.813Z level=INFO fiber=#257 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.813Z level=INFO fiber=#257 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.813Z level=INFO fiber=#257 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.813Z level=INFO fiber=#257 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.813Z level=INFO fiber=#257 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.813Z level=INFO fiber=#257 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:08.813Z level=INFO fiber=#257 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:08.813Z level=INFO fiber=#257 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:08.813Z level=INFO fiber=#258 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: undefined
703 | 
704 | 		// Generic fallback
705 | 		return createAlphaFallbackDocument("BasicEvent")
706 | 	} catch (error) {
707 | 		const availableFiles = Array.from(outputFiles.keys())
708 | 		throw new Error(`Failed to parse ${filename}: ${error}. Available files: ${availableFiles.join(", ")}`)
                  ^
error: Failed to parse undefined: TypeError: undefined is not an object (evaluating 'filename.replace'). Available files: 
      at parseAsyncAPIOutput (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:708:13)
      at parseAsyncAPIOutput (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:556:43)
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/simple-emitter.test.ts:93:29)
(fail) Simple AsyncAPI Emitter (No Decorators) > should generate YAML output [72.26ms]

test/integration/real-compilation.test.ts:
âœ… tsp compile output: TypeSpec compiler v1.6.0

timestamp=2025-11-18T21:00:12.527Z level=INFO fiber=#0 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:12.529Z level=INFO fiber=#0 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:12.529Z level=INFO fiber=#0 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:12.529Z level=INFO fiber=#0 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:12.529Z level=INFO fiber=#0 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:12.529Z level=INFO fiber=#0 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:12.529Z level=INFO fiber=#0 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:12.529Z level=INFO fiber=#0 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:12.529Z level=INFO fiber=#0 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:12.529Z level=INFO fiber=#0 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:12.530Z level=INFO fiber=#0 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:12.530Z level=INFO fiber=#0 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:12.531Z level=INFO fiber=#0 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:12.531Z level=INFO fiber=#0 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:12.532Z level=INFO fiber=#0 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:12.532Z level=INFO fiber=#0 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:12.532Z level=INFO fiber=#0 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:12.533Z level=INFO fiber=#0 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:12.534Z level=INFO fiber=#0 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:12.534Z level=INFO fiber=#0 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:12.534Z level=INFO fiber=#0 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:12.539Z level=INFO fiber=#0 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:12.539Z level=INFO fiber=#0 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:12.539Z level=INFO fiber=#0 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:12.539Z level=INFO fiber=#0 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:12.553Z level=INFO fiber=#0 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:12.554Z level=INFO fiber=#0 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:12.554Z level=INFO fiber=#0 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.40ms)"
timestamp=2025-11-18T21:00:12.554Z level=INFO fiber=#0 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:12.554Z level=INFO fiber=#0 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:12.599Z level=INFO fiber=#0 message="ğŸ” Emitting file: AsyncAPI.yaml"
timestamp=2025-11-18T21:00:12.599Z level=INFO fiber=#0 message="ğŸ” Emitting file: AsyncAPI.yaml"
timestamp=2025-11-18T21:00:12.600Z level=INFO fiber=#0 message="ğŸ” Emitting file: AsyncAPI.yaml"
timestamp=2025-11-18T21:00:12.602Z level=INFO fiber=#1 message="âœ… Generated AsyncAPI specification: AsyncAPI.yaml"

Compilation completed successfully.


âš ï¸  stderr: - Compiling...
âœ” Compiling
- Running @lars-artmann/typespec-asyncapi...
âœ” @lars-artmann/typespec-asyncapi 80ms ../tsp-test/@lars-artmann/typespec-asyncapi/

 97 | 		expect(asyncapi.channels).toBeDefined()
 98 | 		expect(Object.keys(asyncapi.channels).length).toBeGreaterThan(0)
 99 | 
100 | 		// Verify operations
101 | 		expect(asyncapi.operations).toBeDefined()
102 | 		expect(Object.keys(asyncapi.operations).length).toBeGreaterThan(0)
                                                        ^
error: expect(received).toBeGreaterThan(expected)

Expected: > 0
Received: 0

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/real-compilation.test.ts:102:51)
(fail) Real Compilation Integration Test > should compile TypeSpec to AsyncAPI 3.0 using real tsp compile [3805.90ms]

test/integration/plugin-integration.test.ts:
timestamp=2025-11-18T21:00:12.667Z level=INFO fiber=#259 message="ğŸ”§ Initializing AsyncAPI 3.0.0 Validator with REAL @asyncapi/parser..." message={}
timestamp=2025-11-18T21:00:12.667Z level=INFO fiber=#259 message="âœ… AsyncAPI 3.0.0 Validator initialized successfully"
ğŸš€ compileAsyncAPISpecRaw called with source length: 488
timestamp=2025-11-18T21:00:12.716Z level=INFO fiber=#260 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:12.717Z level=INFO fiber=#260 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:12.717Z level=INFO fiber=#260 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:12.717Z level=INFO fiber=#260 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:12.717Z level=INFO fiber=#260 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:12.717Z level=INFO fiber=#260 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:12.717Z level=INFO fiber=#260 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:12.717Z level=INFO fiber=#260 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:12.717Z level=INFO fiber=#260 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:12.717Z level=INFO fiber=#260 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:12.717Z level=INFO fiber=#260 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:12.717Z level=INFO fiber=#260 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:12.717Z level=INFO fiber=#260 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:12.717Z level=INFO fiber=#260 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:12.717Z level=INFO fiber=#260 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:12.717Z level=INFO fiber=#260 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:12.718Z level=INFO fiber=#260 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:12.718Z level=INFO fiber=#260 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:12.718Z level=INFO fiber=#260 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:12.718Z level=INFO fiber=#260 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:12.718Z level=INFO fiber=#260 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:12.719Z level=INFO fiber=#260 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:12.720Z level=INFO fiber=#260 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:12.720Z level=INFO fiber=#260 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:12.720Z level=INFO fiber=#260 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:12.720Z level=INFO fiber=#260 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:12.720Z level=INFO fiber=#260 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:12.720Z level=INFO fiber=#260 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:12.720Z level=INFO fiber=#260 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:12.720Z level=INFO fiber=#260 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:12.720Z level=INFO fiber=#260 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:12.720Z level=INFO fiber=#260 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.13ms)"
timestamp=2025-11-18T21:00:12.720Z level=INFO fiber=#260 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:12.720Z level=INFO fiber=#260 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:12.722Z level=INFO fiber=#260 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:12.722Z level=INFO fiber=#260 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:12.722Z level=INFO fiber=#260 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:12.722Z level=INFO fiber=#260 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:12.722Z level=INFO fiber=#260 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:12.722Z level=INFO fiber=#260 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:12.722Z level=INFO fiber=#260 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:12.722Z level=INFO fiber=#260 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:12.722Z level=INFO fiber=#261 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
54 |         "file-type": "json",
55 |         "output-file": "http-plugin-test",
56 |       });
57 | 
58 |       // Verify compilation success
59 |       expect(compilationResult.diagnostics).toBeDefined();
                                                 ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/plugin-integration.test.ts:59:45)
(fail) Plugin Integration Tests > HTTP Plugin Integration (M7-M10) > should generate HTTP bindings using extracted plugin [57.64ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 698
timestamp=2025-11-18T21:00:12.783Z level=INFO fiber=#262 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:12.783Z level=INFO fiber=#262 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:12.783Z level=INFO fiber=#262 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:12.783Z level=INFO fiber=#262 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:12.783Z level=INFO fiber=#262 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:12.783Z level=INFO fiber=#262 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:12.783Z level=INFO fiber=#262 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:12.783Z level=INFO fiber=#262 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:12.783Z level=INFO fiber=#262 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:12.783Z level=INFO fiber=#262 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:12.783Z level=INFO fiber=#262 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:12.783Z level=INFO fiber=#262 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:12.783Z level=INFO fiber=#262 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:12.783Z level=INFO fiber=#262 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:12.783Z level=INFO fiber=#262 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:12.783Z level=INFO fiber=#262 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:12.783Z level=INFO fiber=#262 message="âœ… Discovery: 2 operations found"
timestamp=2025-11-18T21:00:12.783Z level=INFO fiber=#262 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:12.783Z level=INFO fiber=#262 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:12.783Z level=INFO fiber=#262 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:12.783Z level=INFO fiber=#262 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:12.783Z level=INFO fiber=#262 message="ğŸ”„ Processing 2 operations with Effect.TS..."
timestamp=2025-11-18T21:00:12.784Z level=INFO fiber=#262 message="âœ… Processed 2 operations successfully"
timestamp=2025-11-18T21:00:12.784Z level=INFO fiber=#262 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:12.785Z level=INFO fiber=#262 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:12.785Z level=INFO fiber=#262 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:12.785Z level=INFO fiber=#262 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:12.785Z level=INFO fiber=#262 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 2,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 2
}"
timestamp=2025-11-18T21:00:12.785Z level=INFO fiber=#262 message="âœ… Processing: 2 elements processed"
timestamp=2025-11-18T21:00:12.785Z level=INFO fiber=#262 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:12.785Z level=INFO fiber=#262 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:12.785Z level=INFO fiber=#262 message="âœ… AsyncAPI document validation passed! 2 channels, 0 operations (0.09ms)"
timestamp=2025-11-18T21:00:12.785Z level=INFO fiber=#262 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:12.785Z level=INFO fiber=#262 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:12.786Z level=INFO fiber=#262 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:12.786Z level=INFO fiber=#262 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:12.786Z level=INFO fiber=#262 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:12.786Z level=INFO fiber=#262 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:12.786Z level=INFO fiber=#262 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:12.786Z level=INFO fiber=#262 message="ğŸ‰ TYPESPEC API SUCCESS: 2 channels, 0 operations"
timestamp=2025-11-18T21:00:12.786Z level=INFO fiber=#262 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:12.787Z level=INFO fiber=#262 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:12.787Z level=INFO fiber=#263 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
128 |         "file-type": "json",
129 |         "output-file": "kafka-plugin-test",
130 |       });
131 | 
132 |       // Verify compilation success
133 |       expect(compilationResult.diagnostics).toBeDefined();
                                                  ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/plugin-integration.test.ts:133:45)
(fail) Plugin Integration Tests > Kafka Plugin Integration (M11-M14) > should generate Kafka bindings using extracted plugin [63.64ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 1091
timestamp=2025-11-18T21:00:12.851Z level=INFO fiber=#264 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:12.851Z level=INFO fiber=#264 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:12.851Z level=INFO fiber=#264 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:12.851Z level=INFO fiber=#264 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:12.851Z level=INFO fiber=#264 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:12.851Z level=INFO fiber=#264 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:12.851Z level=INFO fiber=#264 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:12.851Z level=INFO fiber=#264 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:12.851Z level=INFO fiber=#264 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:12.851Z level=INFO fiber=#264 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:12.851Z level=INFO fiber=#264 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:12.851Z level=INFO fiber=#264 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:12.851Z level=INFO fiber=#264 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:12.851Z level=INFO fiber=#264 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:12.852Z level=INFO fiber=#264 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:12.852Z level=INFO fiber=#264 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:12.852Z level=INFO fiber=#264 message="âœ… Discovery: 3 operations found"
timestamp=2025-11-18T21:00:12.852Z level=INFO fiber=#264 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:12.852Z level=INFO fiber=#264 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:12.852Z level=INFO fiber=#264 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:12.852Z level=INFO fiber=#264 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:12.852Z level=INFO fiber=#264 message="ğŸ”„ Processing 3 operations with Effect.TS..."
timestamp=2025-11-18T21:00:12.852Z level=INFO fiber=#264 message="âœ… Processed 3 operations successfully"
timestamp=2025-11-18T21:00:12.852Z level=INFO fiber=#264 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:12.853Z level=INFO fiber=#264 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:12.853Z level=INFO fiber=#264 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:12.853Z level=INFO fiber=#264 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:12.853Z level=INFO fiber=#264 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 3,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 3
}"
timestamp=2025-11-18T21:00:12.853Z level=INFO fiber=#264 message="âœ… Processing: 3 elements processed"
timestamp=2025-11-18T21:00:12.853Z level=INFO fiber=#264 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:12.853Z level=INFO fiber=#264 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:12.853Z level=INFO fiber=#264 message="âœ… AsyncAPI document validation passed! 3 channels, 0 operations (0.05ms)"
timestamp=2025-11-18T21:00:12.853Z level=INFO fiber=#264 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:12.853Z level=INFO fiber=#264 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:12.855Z level=INFO fiber=#264 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:12.855Z level=INFO fiber=#264 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:12.855Z level=INFO fiber=#264 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:12.855Z level=INFO fiber=#264 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:12.855Z level=INFO fiber=#264 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:12.855Z level=INFO fiber=#264 message="ğŸ‰ TYPESPEC API SUCCESS: 3 channels, 0 operations"
timestamp=2025-11-18T21:00:12.855Z level=INFO fiber=#264 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:12.855Z level=INFO fiber=#264 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:12.855Z level=INFO fiber=#265 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
206 |         "file-type": "json",
207 |         "output-file": "plugin-system-test",
208 |       });
209 | 
210 |       // Verify compilation success (M88)
211 |       expect(compilationResult.diagnostics).toBeDefined();
                                                  ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/plugin-integration.test.ts:211:45)
(fail) Plugin Integration Tests > Real Output Validation (M15, M87-M89) > should validate complete user workflow from TypeSpec to AsyncAPI [77.07ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 365
timestamp=2025-11-18T21:00:12.962Z level=INFO fiber=#266 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:12.962Z level=INFO fiber=#266 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:12.962Z level=INFO fiber=#266 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:12.962Z level=INFO fiber=#266 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:12.962Z level=INFO fiber=#266 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:12.962Z level=INFO fiber=#266 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:12.962Z level=INFO fiber=#266 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:12.962Z level=INFO fiber=#266 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:12.962Z level=INFO fiber=#266 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:12.962Z level=INFO fiber=#266 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:12.962Z level=INFO fiber=#266 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:12.962Z level=INFO fiber=#266 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:12.962Z level=INFO fiber=#266 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:12.962Z level=INFO fiber=#266 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:12.962Z level=INFO fiber=#266 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:12.962Z level=INFO fiber=#266 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:12.962Z level=INFO fiber=#266 message="âœ… Discovery: 2 operations found"
timestamp=2025-11-18T21:00:12.962Z level=INFO fiber=#266 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:12.962Z level=INFO fiber=#266 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:12.962Z level=INFO fiber=#266 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:12.962Z level=INFO fiber=#266 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:12.962Z level=INFO fiber=#266 message="ğŸ”„ Processing 2 operations with Effect.TS..."
timestamp=2025-11-18T21:00:12.963Z level=INFO fiber=#266 message="âœ… Processed 2 operations successfully"
timestamp=2025-11-18T21:00:12.963Z level=INFO fiber=#266 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:12.963Z level=INFO fiber=#266 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:12.963Z level=INFO fiber=#266 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:12.963Z level=INFO fiber=#266 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:12.963Z level=INFO fiber=#266 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 2,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 2
}"
timestamp=2025-11-18T21:00:12.963Z level=INFO fiber=#266 message="âœ… Processing: 2 elements processed"
timestamp=2025-11-18T21:00:12.963Z level=INFO fiber=#266 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:12.963Z level=INFO fiber=#266 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:12.963Z level=INFO fiber=#266 message="âœ… AsyncAPI document validation passed! 2 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T21:00:12.963Z level=INFO fiber=#266 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:12.963Z level=INFO fiber=#266 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:12.964Z level=INFO fiber=#266 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:12.965Z level=INFO fiber=#266 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:12.965Z level=INFO fiber=#266 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:12.965Z level=INFO fiber=#266 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:12.965Z level=INFO fiber=#266 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:12.965Z level=INFO fiber=#266 message="ğŸ‰ TYPESPEC API SUCCESS: 2 channels, 0 operations"
timestamp=2025-11-18T21:00:12.965Z level=INFO fiber=#266 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:12.965Z level=INFO fiber=#266 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:12.965Z level=INFO fiber=#267 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
267 |         "file-type": "yaml", // Test YAML output as well
268 |         "output-file": "binding-test",
269 |       });
270 | 
271 |       // Verify YAML output is generated
272 |       expect(compilationResult.outputFiles.size).toBeGreaterThan(0);
                                     ^
TypeError: undefined is not an object (evaluating 'compilationResult.outputFiles.size')
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/plugin-integration.test.ts:272:32)
(fail) Plugin Integration Tests > Real Output Validation (M15, M87-M89) > should verify all protocol bindings work in final output (M87) [103.63ms]

test/integration/options-integration.test.ts:
28 | 		}).not.toThrow()
29 | 	})
30 | 
31 | 	test("schema rejects invalid enum values", () => {
32 | 		// Test that our enum constraints would catch invalid values
33 | 		const fileTypeSchema = ASYNC_API_EMITTER_OPTIONS_SCHEMA.properties["file-type"]
                                                               ^
TypeError: undefined is not an object (evaluating 'ASYNC_API_EMITTER_OPTIONS_SCHEMA.properties["file-type"]')
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/options-integration.test.ts:33:59)
(fail) Options Integration > schema rejects invalid enum values [0.18ms]
42 | 	test("security: additionalProperties false prevents injection", () => {
43 | 		// This is the critical security test
44 | 		expect(ASYNC_API_EMITTER_OPTIONS_SCHEMA.additionalProperties).toBe(false)
45 | 
46 | 		// Ensure all top-level properties are explicitly defined
47 | 		const allowedProperties = Object.keys(ASYNC_API_EMITTER_OPTIONS_SCHEMA.properties)
                                        ^
TypeError: undefined is not an object (evaluating 'Object.keys(ASYNC_API_EMITTER_OPTIONS_SCHEMA.properties)')
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/integration/options-integration.test.ts:47:36)
(fail) Options Integration > security: additionalProperties false prevents injection [0.12ms]

test/utils/breakthrough-metrics.test.ts:
89 |     Effect.log(`   AVERAGE COMPILATION: ${averageCompilationTime}ms`)
90 |     Effect.log(`   DECORATOR SYSTEM: OPERATIONAL âœ…`)
91 |     Effect.log("=" .repeat(60))
92 | 
93 |     // Core success metrics
94 |     expect(totalUnknownDecoratorErrors).toBe(0)
                                             ^
error: expect(received).toBe(expected)

Expected: 0
Received: 11

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/utils/breakthrough-metrics.test.ts:94:41)
(fail) ğŸ“Š BREAKTHROUGH METRICS > ğŸ¯ P0 Mission Success: 51% Impact Achieved [233.67ms]

test/utils/decorator-breakthrough-validation.test.ts:
48 | 
49 |     Effect.log(`ğŸš€ BREAKTHROUGH METRIC: Unknown decorator errors: ${unknownDecoratorErrors.length} (was 371+)`)
50 |     Effect.log(`âœ… SOLUTION CONFIRMED: Decorator registration system working`)
51 | 
52 |     // THE CORE BREAKTHROUGH: No unknown decorator errors
53 |     expect(unknownDecoratorErrors).toHaveLength(0)
                                        ^
error: expect(received).toHaveLength(expected)

Expected length: 0
Received length: 8

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/utils/decorator-breakthrough-validation.test.ts:53:36)
(fail) ğŸš€ DECORATOR REGISTRATION BREAKTHROUGH > ğŸ¯ BREAKTHROUGH: No more 'Unknown decorator' errors [40.52ms]
80 |       const unknownErrors = diagnostics.filter(d =>
81 |         d.message?.includes("Unknown decorator")
82 |       )
83 | 
84 |       Effect.log(`âœ… ${test.name}: ${unknownErrors.length} unknown decorator errors`)
85 |       expect(unknownErrors).toHaveLength(0)
                                 ^
error: expect(received).toHaveLength(expected)

Expected length: 0
Received length: 1

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/utils/decorator-breakthrough-validation.test.ts:85:29)
(fail) ğŸš€ DECORATOR REGISTRATION BREAKTHROUGH > ğŸ¯ BREAKTHROUGH: Individual decorator validation [84.46ms]
142 |     Effect.log(`   Unknown decorator errors: ${unknownDecorators.length} (BREAKTHROUGH: was 371+)`)
143 |     Effect.log(`   Critical type errors: ${typeErrors.length}`)
144 |     Effect.log(`   Program validity: ${!!program && !!program.checker}`)
145 | 
146 |     // The core success metric
147 |     expect(unknownDecorators).toHaveLength(0)
                                    ^
error: expect(received).toHaveLength(expected)

Expected length: 0
Received length: 6

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/utils/decorator-breakthrough-validation.test.ts:147:31)
(fail) ğŸš€ DECORATOR REGISTRATION BREAKTHROUGH > ğŸ“Š IMPACT MEASUREMENT: Decorator system metrics [73.90ms]

test/acceptance/user-acceptance-simulation.test.ts:

# Unhandled error between tests
-------------------------------
1 | })
2 | {
    ^
SyntaxError: Export named 'API_VERSIONS' not found in module '/Users/larsartmann/projects/typespec-asyncapi/src/constants/index.ts'.
      at loadAndEvaluateModule (2:1)
-------------------------------


test/templates/cli-test-template.test.ts:
54 | 
55 | 		// Act: Compile with CLI
56 | 		testResult = await compileWithCLI(typespecSource)
57 | 
58 | 		// Assert: Compilation succeeded
59 | 		expect(testResult.exitCode).toBe(0)
                                   ^
error: expect(received).toBe(expected)

Expected: 0
Received: 1

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/templates/cli-test-template.test.ts:59:31)
(fail) CLI Tests: FEATURE_NAME > should generate AsyncAPI for FEATURE_NAME - success case [3003.72ms]
100 | 
101 | 		// Assert: Compilation failed
102 | 		expect(testResult.exitCode).not.toBe(0)
103 | 
104 | 		// Assert: Errors captured
105 | 		expect(testResult.errors.length).toBeGreaterThan(0)
                                         ^
error: expect(received).toBeGreaterThan(expected)

Expected: > 0
Received: 0

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/templates/cli-test-template.test.ts:105:36)
(fail) CLI Tests: FEATURE_NAME > should fail gracefully with invalid TypeSpec [2346.48ms]
132 | 
133 | 		// Assert: Compilation succeeded (empty model is valid)
134 | 		expect(testResult.exitCode).toBe(0)
135 | 
136 | 		// Assert: AsyncAPI generated with empty schema
137 | 		expect(testResult.asyncapiDoc?.channels).toHaveProperty('edge.case')
                                                 ^
error: expect(received).toHaveProperty(path)

Expected path: "edge.case"

Unable to find property

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/templates/cli-test-template.test.ts:137:44)
(fail) CLI Tests: FEATURE_NAME > should handle FEATURE_NAME edge cases [2798.58ms]
165 | 
166 | 		// Act: Compile with CLI
167 | 		testResult = await compileWithCLI(integrationSource)
168 | 
169 | 		// Assert: Compilation succeeded
170 | 		expect(testResult.exitCode).toBe(0)
                                    ^
error: expect(received).toBe(expected)

Expected: 0
Received: 1

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/templates/cli-test-template.test.ts:170:31)
(fail) CLI Tests: FEATURE_NAME > should integrate FEATURE_NAME with other features [2817.11ms]
ENOENT: no such file or directory, copyfile 'test/utils/fixtures/FEATURE_NAME.tsp' -> '/Users/larsartmann/projects/typespec-asyncapi/test/temp-output/test-1763499624782-lvcqyks/main.tsp'
    path: "test/utils/fixtures/FEATURE_NAME.tsp",
    dest: "/Users/larsartmann/projects/typespec-asyncapi/test/temp-output/test-1763499624782-lvcqyks/main.tsp",
 syscall: "copyfile",
   errno: -2,
    code: "ENOENT"

(fail) CLI Tests: FEATURE_NAME (Fixtures) > should load FEATURE_NAME from fixture file [0.73ms]

test/e2e/realworld-ecommerce.test.ts:
 8 |  * Assert there is no diagnostics.
 9 |  * @param diagnostics Diagnostics
10 |  */
11 | export function expectDiagnosticEmpty(diagnostics) {
12 |     if (diagnostics.length > 0) {
13 |         fail(`Unexpected diagnostics:\n${formatDiagnostics(diagnostics)}`);
             ^
AssertionError: Unexpected diagnostics:
/test/main.tsp:152:9 - error token-expected: Property expected.
/test/main.tsp:152:24 - error token-expected: ',' expected.
/test/main.tsp:153:9 - error token-expected: Property expected.
/test/main.tsp:153:25 - error token-expected: ',' expected.
/test/main.tsp:26:14 - error invalid-argument: Argument of type '#{protocol: "kafka", binding: #{topic: "product-events", key: "productId", groupId: "catalog-service"}}' is not assignable to parameter of type 'Model'
/test/main.tsp:38:14 - error invalid-argument: Argument of type '#{protocol: "kafka", binding: #{topic: "product-events", key: "productId"}}' is not assignable to parameter of type 'Model'
/test/main.tsp:57:14 - error invalid-argument: Argument of type '#{protocol: "kafka", binding: #{topic: "inventory-events", key: "productId", groupId: "inventory-service"}}' is not assignable to parameter of type 'Model'
/test/main.tsp:69:14 - error invalid-argument: Argument of type '#{protocol: "websocket", binding: #{method: "GET"}}' is not assignable to parameter of type 'Model'
/test/main.tsp:104:14 - error invalid-argument: Argument of type '#{protocol: "kafka", binding: #{topic: "order-events", key: "orderId", groupId: "order-service"}}' is not assignable to parameter of type 'Model'
/test/main.tsp:112:14 - error invalid-argument: Argument of type '#{name: "orderAuth", scheme: #{type: "http", scheme: "bearer", bearerFormat: "JWT"}}' is not assignable to parameter of type 'Model'
/test/main.tsp:136:14 - error invalid-argument: Argument of type '#{protocol: "kafka", binding: #{topic: "payment-events", key: "orderId", groupId: "payment-service"}}' is not assignable to parameter of type 'Model'
/test/main.tsp:144:14 - error invalid-argument: Argument of type '#{name: "paymentAuth", scheme: #{type: "oauth2", flows: #{clientCredentials: #{tokenUrl: "https://auth.ecommerce.com/oauth/token", scopes: #{<missing identifier>1: "payments:read", <missing identifier>2: "Read payment data", <missing identifier>3: "payments:write", <missing identifier>4: "Process payments"}}}}}' is not assignable to parameter of type 'Model'
/test/main.tsp:178:14 - error invalid-argument: Argument of type '#{protocol: "kafka", binding: #{topic: "shipment-events", key: "orderId"}}' is not assignable to parameter of type 'Model'
/test/main.tsp:197:14 - error invalid-argument: Argument of type '#{protocol: "websocket", binding: #{method: "GET"}}' is not assignable to parameter of type 'Model'
/test/main.tsp:216:14 - error invalid-argument: Argument of type '#{protocol: "http", binding: #{type: "request", method: "POST"}}' is not assignable to parameter of type 'Model'
/test/main.tsp:223:14 - error invalid-argument: Argument of type '#{name: "webhookAuth", scheme: #{type: "apiKey", in: "header", name: "X-Webhook-Secret"}}' is not assignable to parameter of type 'Model'
 generatedMessage: false,
     actual: undefined,
   expected: undefined,
   operator: "fail",
       code: "ERR_ASSERTION"

      at expectDiagnosticEmpty (/Users/larsartmann/projects/typespec-asyncapi/node_modules/@typespec/compiler/dist/src/testing/expect.js:13:9)
      at compile (/Users/larsartmann/projects/typespec-asyncapi/node_modules/@typespec/compiler/dist/src/testing/test-host.js:58:5)
      at processTicksAndRejections (native:7:39)
(fail) E2E: Real-World E-Commerce System > should generate complete e-commerce event system [52.88ms]

test/e2e/multi-protocol-comprehensive.test.ts:
 8 |  * Assert there is no diagnostics.
 9 |  * @param diagnostics Diagnostics
10 |  */
11 | export function expectDiagnosticEmpty(diagnostics) {
12 |     if (diagnostics.length > 0) {
13 |         fail(`Unexpected diagnostics:\n${formatDiagnostics(diagnostics)}`);
             ^
AssertionError: Unexpected diagnostics:
/test/main.tsp:16:14 - error invalid-argument: Argument of type '#{protocol: "kafka", binding: #{topic: "user-events", key: "userId", groupId: "user-service", bindingVersion: "0.5.0"}}' is not assignable to parameter of type 'Model'
/test/main.tsp:25:14 - error invalid-argument: Argument of type '#{name: "kafkaAuth", scheme: #{type: "sasl", mechanism: "SCRAM-SHA-256"}}' is not assignable to parameter of type 'Model'
/test/main.tsp:45:14 - error invalid-argument: Argument of type '#{protocol: "websocket", binding: #{method: "GET", query: #{type: "object", properties: #{token: #{type: "string"}}}, bindingVersion: "0.1.0"}}' is not assignable to parameter of type 'Model'
/test/main.tsp:58:14 - error invalid-argument: Argument of type '#{name: "bearerAuth", scheme: #{type: "http", scheme: "bearer", bearerFormat: "JWT"}}' is not assignable to parameter of type 'Model'
/test/main.tsp:81:14 - error invalid-argument: Argument of type '#{protocol: "http", binding: #{type: "request", method: "POST", bindingVersion: "0.3.0"}}' is not assignable to parameter of type 'Model'
/test/main.tsp:89:14 - error invalid-argument: Argument of type '#{name: "apiKeyAuth", scheme: #{type: "apiKey", in: "header", name: "X-API-Key"}}' is not assignable to parameter of type 'Model'
/test/main.tsp:114:14 - error invalid-argument: Argument of type '#{protocol: "mqtt", binding: #{qos: 1, retain: true, bindingVersion: "0.2.0"}}' is not assignable to parameter of type 'Model'
 generatedMessage: false,
     actual: undefined,
   expected: undefined,
   operator: "fail",
       code: "ERR_ASSERTION"

      at expectDiagnosticEmpty (/Users/larsartmann/projects/typespec-asyncapi/node_modules/@typespec/compiler/dist/src/testing/expect.js:13:9)
      at compile (/Users/larsartmann/projects/typespec-asyncapi/node_modules/@typespec/compiler/dist/src/testing/test-host.js:58:5)
      at processTicksAndRejections (native:7:39)
(fail) E2E: Multi-Protocol Comprehensive Test > should generate AsyncAPI 3.0 with all protocols [54.93ms]

test/e2e/protocol-bindings-integration.test.ts:
timestamp=2025-11-18T21:00:28.233Z level=INFO fiber=#268 message="ğŸ”§ Initializing AsyncAPI 3.0.0 Validator with REAL @asyncapi/parser..." message={}
timestamp=2025-11-18T21:00:28.233Z level=INFO fiber=#268 message="âœ… AsyncAPI 3.0.0 Validator initialized successfully"
ğŸš€ compileAsyncAPISpecRaw called with source length: 2709
timestamp=2025-11-18T21:00:28.269Z level=INFO fiber=#269 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:28.269Z level=INFO fiber=#269 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:28.269Z level=INFO fiber=#269 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:28.269Z level=INFO fiber=#269 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:28.269Z level=INFO fiber=#269 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:28.269Z level=INFO fiber=#269 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:28.269Z level=INFO fiber=#269 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:28.269Z level=INFO fiber=#269 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:28.269Z level=INFO fiber=#269 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:28.269Z level=INFO fiber=#269 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:28.269Z level=INFO fiber=#269 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:28.269Z level=INFO fiber=#269 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:28.269Z level=INFO fiber=#269 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:28.269Z level=INFO fiber=#269 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:28.269Z level=INFO fiber=#269 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:28.269Z level=INFO fiber=#269 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:28.269Z level=INFO fiber=#269 message="âœ… Discovery: 4 operations found"
timestamp=2025-11-18T21:00:28.269Z level=INFO fiber=#269 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:28.269Z level=INFO fiber=#269 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:28.269Z level=INFO fiber=#269 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:28.269Z level=INFO fiber=#269 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:28.269Z level=INFO fiber=#269 message="ğŸ”„ Processing 4 operations with Effect.TS..."
timestamp=2025-11-18T21:00:28.269Z level=INFO fiber=#269 message="âœ… Processed 4 operations successfully"
timestamp=2025-11-18T21:00:28.269Z level=INFO fiber=#269 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:28.269Z level=INFO fiber=#269 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:28.269Z level=INFO fiber=#269 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:28.270Z level=INFO fiber=#269 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:28.270Z level=INFO fiber=#269 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 4,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 4
}"
timestamp=2025-11-18T21:00:28.270Z level=INFO fiber=#269 message="âœ… Processing: 4 elements processed"
timestamp=2025-11-18T21:00:28.270Z level=INFO fiber=#269 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:28.270Z level=INFO fiber=#269 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:28.270Z level=INFO fiber=#269 message="âœ… AsyncAPI document validation passed! 4 channels, 0 operations (0.06ms)"
timestamp=2025-11-18T21:00:28.270Z level=INFO fiber=#269 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:28.270Z level=INFO fiber=#269 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:28.274Z level=INFO fiber=#269 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.274Z level=INFO fiber=#269 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.274Z level=INFO fiber=#269 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.274Z level=INFO fiber=#269 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.274Z level=INFO fiber=#269 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.274Z level=INFO fiber=#269 message="ğŸ‰ TYPESPEC API SUCCESS: 4 channels, 0 operations"
timestamp=2025-11-18T21:00:28.274Z level=INFO fiber=#269 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.274Z level=INFO fiber=#269 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:28.274Z level=INFO fiber=#270 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
117 |         "file-type": "json",
118 |         "output-file": "kafka-api",
119 |       });
120 | 
121 |       // Verify compilation success
122 |       expect(compilationResult.diagnostics).toBeDefined();
                                                  ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/e2e/protocol-bindings-integration.test.ts:122:45)
(fail) E2E Protocol Bindings Integration > Kafka Protocol Binding E2E > should generate complete AsyncAPI with Kafka bindings from TypeSpec [52.87ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 786
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="âœ… Discovery: 2 operations found"
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="ğŸ”„ Processing 2 operations with Effect.TS..."
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="âœ… Processed 2 operations successfully"
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 2,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 2
}"
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="âœ… Processing: 2 elements processed"
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="âœ… AsyncAPI document validation passed! 2 channels, 0 operations (0.03ms)"
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:28.323Z level=INFO fiber=#271 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:28.324Z level=INFO fiber=#271 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.324Z level=INFO fiber=#271 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.324Z level=INFO fiber=#271 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.324Z level=INFO fiber=#271 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.324Z level=INFO fiber=#271 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.324Z level=INFO fiber=#271 message="ğŸ‰ TYPESPEC API SUCCESS: 2 channels, 0 operations"
timestamp=2025-11-18T21:00:28.324Z level=INFO fiber=#271 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.324Z level=INFO fiber=#271 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:28.324Z level=INFO fiber=#272 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
196 |       });
197 | 
198 |       const asyncApiDoc = parseAsyncAPIOutput(compilationResult.outputFiles, "kafka-partitioned.json");
199 |       const validationResult = await validator.validate(asyncApiDoc);
200 | 
201 |       expect(validationResult.valid).toBe(true);
                                           ^
error: expect(received).toBe(expected)

Expected: true
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/e2e/protocol-bindings-integration.test.ts:201:38)
(fail) E2E Protocol Bindings Integration > Kafka Protocol Binding E2E > should handle Kafka topic naming patterns and partitioning [59.30ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 2561
557 | 	content: string
558 | }>, filename: string): Promise<AsyncAPIObject | string> {
559 | 	//TODO: refactor to use Effect.TS!
560 | 
561 | 	// ğŸ”¥ CRITICAL: Added debug logging at entry
562 | 	console.log(`ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: ${outputFiles.size}, looking for: ${filename}`)
                                                                           ^
TypeError: undefined is not an object (evaluating 'outputFiles.size')
      at parseAsyncAPIOutput (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:562:70)
      at parseAsyncAPIOutput (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:556:43)
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/e2e/protocol-bindings-integration.test.ts:198:27)
(fail) E2E Protocol Bindings Integration > WebSocket Protocol Binding E2E > should generate WebSocket real-time communication API [2.87ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 2345
timestamp=2025-11-18T21:00:28.407Z level=INFO fiber=#276 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:28.408Z level=INFO fiber=#276 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="âœ… Discovery: 6 operations found"
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="ğŸ”„ Processing 6 operations with Effect.TS..."
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="âœ… Processed 6 operations successfully"
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 6,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 6
}"
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="âœ… Processing: 6 elements processed"
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="âœ… AsyncAPI document validation passed! 6 channels, 0 operations (0.05ms)"
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:28.409Z level=INFO fiber=#276 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:28.414Z level=INFO fiber=#276 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.414Z level=INFO fiber=#276 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.415Z level=INFO fiber=#276 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.415Z level=INFO fiber=#276 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.415Z level=INFO fiber=#276 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.415Z level=INFO fiber=#276 message="ğŸ‰ TYPESPEC API SUCCESS: 6 channels, 0 operations"
timestamp=2025-11-18T21:00:28.415Z level=INFO fiber=#276 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.415Z level=INFO fiber=#276 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:28.415Z level=INFO fiber=#277 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.430Z level=INFO fiber=#278 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:28.430Z level=INFO fiber=#278 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:28.430Z level=INFO fiber=#278 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:28.430Z level=INFO fiber=#278 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:28.430Z level=INFO fiber=#278 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:28.430Z level=INFO fiber=#278 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:28.430Z level=INFO fiber=#278 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:28.430Z level=INFO fiber=#278 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:28.430Z level=INFO fiber=#278 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:28.430Z level=INFO fiber=#278 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:28.430Z level=INFO fiber=#278 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:28.430Z level=INFO fiber=#278 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:28.430Z level=INFO fiber=#278 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:28.430Z level=INFO fiber=#278 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:28.430Z level=INFO fiber=#278 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:28.430Z level=INFO fiber=#278 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:28.430Z level=INFO fiber=#278 message="âœ… Discovery: 3 operations found"
timestamp=2025-11-18T21:00:28.430Z level=INFO fiber=#278 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:28.430Z level=INFO fiber=#278 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:28.430Z level=INFO fiber=#278 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:28.430Z level=INFO fiber=#278 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:28.430Z level=INFO fiber=#278 message="ğŸ”„ Processing 3 operations with Effect.TS..."
timestamp=2025-11-18T21:00:28.431Z level=INFO fiber=#278 message="âœ… Processed 3 operations successfully"
timestamp=2025-11-18T21:00:28.431Z level=INFO fiber=#278 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:28.431Z level=INFO fiber=#278 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:28.431Z level=INFO fiber=#278 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:28.431Z level=INFO fiber=#278 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:28.431Z level=INFO fiber=#278 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 3,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 3
}"
timestamp=2025-11-18T21:00:28.431Z level=INFO fiber=#278 message="âœ… Processing: 3 elements processed"
timestamp=2025-11-18T21:00:28.431Z level=INFO fiber=#278 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:28.431Z level=INFO fiber=#278 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:28.431Z level=INFO fiber=#278 message="âœ… AsyncAPI document validation passed! 3 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T21:00:28.431Z level=INFO fiber=#278 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:28.431Z level=INFO fiber=#278 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:28.432Z level=INFO fiber=#278 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.432Z level=INFO fiber=#278 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.432Z level=INFO fiber=#278 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.432Z level=INFO fiber=#278 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.432Z level=INFO fiber=#278 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.432Z level=INFO fiber=#278 message="ğŸ‰ TYPESPEC API SUCCESS: 3 channels, 0 operations"
timestamp=2025-11-18T21:00:28.432Z level=INFO fiber=#278 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.432Z level=INFO fiber=#278 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:28.432Z level=INFO fiber=#279 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"

# Unhandled error between tests
-------------------------------
305 |       });
306 | 
307 |       const asyncApiDoc = parseAsyncAPIOutput(compilationResult.outputFiles, "websocket-api.json");
308 |       const validationResult = await validator.validate(asyncApiDoc);
309 | 
310 |       expect(validationResult.valid).toBe(true);
                                           ^
error: expect(received).toBe(expected)

Expected: true
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/e2e/protocol-bindings-integration.test.ts:310:38)
-------------------------------

557 | 	content: string
558 | }>, filename: string): Promise<AsyncAPIObject | string> {
559 | 	//TODO: refactor to use Effect.TS!
560 | 
561 | 	// ğŸ”¥ CRITICAL: Added debug logging at entry
562 | 	console.log(`ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: ${outputFiles.size}, looking for: ${filename}`)
                                                                           ^
TypeError: undefined is not an object (evaluating 'outputFiles.size')
      at parseAsyncAPIOutput (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:562:70)
      at parseAsyncAPIOutput (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:556:43)
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/e2e/protocol-bindings-integration.test.ts:307:27)
(fail) E2E Protocol Bindings Integration > HTTP Protocol Binding E2E > should generate HTTP webhooks and callbacks API [86.81ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 1555
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"

# Unhandled error between tests
-------------------------------
425 |       });
426 | 
427 |       const asyncApiDoc = parseAsyncAPIOutput(compilationResult.outputFiles, "http-webhook-api.json");
428 |       const validationResult = await validator.validate(asyncApiDoc);
429 | 
430 |       expect(validationResult.valid).toBe(true);
                                           ^
error: expect(received).toBe(expected)

Expected: true
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/e2e/protocol-bindings-integration.test.ts:430:38)
-------------------------------

557 | 	content: string
558 | }>, filename: string): Promise<AsyncAPIObject | string> {
559 | 	//TODO: refactor to use Effect.TS!
560 | 
561 | 	// ğŸ”¥ CRITICAL: Added debug logging at entry
562 | 	console.log(`ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: ${outputFiles.size}, looking for: ${filename}`)
                                                                           ^
TypeError: undefined is not an object (evaluating 'outputFiles.size')
      at parseAsyncAPIOutput (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:562:70)
      at parseAsyncAPIOutput (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:1002:16)
      at /Users/larsartmann/projects/typespec-asyncapi/test/e2e/protocol-bindings-integration.test.ts:450:33
      at processTicksAndRejections (unknown:7:39)
(fail) E2E Protocol Bindings Integration > Multi-Protocol E2E Integration > should generate AsyncAPI with multiple protocol bindings [9.26ms]

test/e2e/security-schemes-comprehensive.test.ts:
timestamp=2025-11-18T21:00:28.526Z level=INFO fiber=#286 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:28.526Z level=INFO fiber=#286 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:28.526Z level=INFO fiber=#286 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:28.526Z level=INFO fiber=#286 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:28.526Z level=INFO fiber=#286 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:28.526Z level=INFO fiber=#286 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:28.527Z level=INFO fiber=#286 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:28.527Z level=INFO fiber=#286 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:28.527Z level=INFO fiber=#286 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:28.527Z level=INFO fiber=#286 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:28.527Z level=INFO fiber=#286 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:28.527Z level=INFO fiber=#286 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:28.527Z level=INFO fiber=#286 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:28.527Z level=INFO fiber=#286 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:28.527Z level=INFO fiber=#286 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:28.527Z level=INFO fiber=#286 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:28.527Z level=INFO fiber=#286 message="âœ… Discovery: 6 operations found"
timestamp=2025-11-18T21:00:28.527Z level=INFO fiber=#286 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:28.527Z level=INFO fiber=#286 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:28.527Z level=INFO fiber=#286 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:28.527Z level=INFO fiber=#286 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:28.527Z level=INFO fiber=#286 message="ğŸ”„ Processing 6 operations with Effect.TS..."
timestamp=2025-11-18T21:00:28.527Z level=INFO fiber=#286 message="âœ… Processed 6 operations successfully"
timestamp=2025-11-18T21:00:28.527Z level=INFO fiber=#286 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:28.527Z level=INFO fiber=#286 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:28.527Z level=INFO fiber=#286 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:28.528Z level=INFO fiber=#286 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:28.528Z level=INFO fiber=#286 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 6,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 6
}"
timestamp=2025-11-18T21:00:28.528Z level=INFO fiber=#286 message="âœ… Processing: 6 elements processed"
timestamp=2025-11-18T21:00:28.528Z level=INFO fiber=#286 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:28.528Z level=INFO fiber=#286 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:28.528Z level=INFO fiber=#286 message="âœ… AsyncAPI document validation passed! 6 channels, 0 operations (0.13ms)"
timestamp=2025-11-18T21:00:28.528Z level=INFO fiber=#286 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:28.528Z level=INFO fiber=#286 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:28.532Z level=INFO fiber=#286 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.532Z level=INFO fiber=#286 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.532Z level=INFO fiber=#286 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.532Z level=INFO fiber=#286 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.532Z level=INFO fiber=#286 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.532Z level=INFO fiber=#286 message="ğŸ‰ TYPESPEC API SUCCESS: 6 channels, 0 operations"
timestamp=2025-11-18T21:00:28.532Z level=INFO fiber=#286 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.532Z level=INFO fiber=#286 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:28.532Z level=INFO fiber=#287 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
557 | 	content: string
558 | }>, filename: string): Promise<AsyncAPIObject | string> {
559 | 	//TODO: refactor to use Effect.TS!
560 | 
561 | 	// ğŸ”¥ CRITICAL: Added debug logging at entry
562 | 	console.log(`ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: ${outputFiles.size}, looking for: ${filename}`)
                                                                           ^
TypeError: undefined is not an object (evaluating 'outputFiles.size')
      at parseAsyncAPIOutput (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:562:70)
      at parseAsyncAPIOutput (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:556:43)
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/e2e/protocol-bindings-integration.test.ts:508:27)
(fail) E2E: Security Schemes Comprehensive > should generate all AsyncAPI 3.0 security scheme types [70.35ms]

test/e2e/direct-program-test.test.ts:
44 | }
45 | export function createTestWrapper(host, testWrapperOptions = {}) {
46 |     const { autoImports, autoUsings, wrapper, compilerOptions: defaultCompilerOptions, } = testWrapperOptions;
47 |     const autoCode = [
48 |         ...(autoImports ??
49 |             host.libraries.filter((x) => x.name !== "@typespec/compiler").map((x) => x.name)).map((x) => `import "${x}";`),
                      ^
TypeError: undefined is not an object (evaluating 'host.libraries.filter')
      at createTestWrapper (/Users/larsartmann/projects/typespec-asyncapi/node_modules/@typespec/compiler/dist/src/testing/test-utils.js:49:18)
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/e2e/direct-program-test.test.ts:15:20)
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/e2e/direct-program-test.test.ts:12:66)
(fail) ğŸ”¥ Direct Program Test > should create a REAL TypeSpec Program without decorators [0.82ms]

test/e2e/complex-nested-schemas.test.ts:
timestamp=2025-11-18T21:00:28.724Z level=INFO fiber=#291 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:28.724Z level=INFO fiber=#291 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:28.724Z level=INFO fiber=#291 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:28.724Z level=INFO fiber=#291 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:28.724Z level=INFO fiber=#291 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:28.724Z level=INFO fiber=#291 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:28.724Z level=INFO fiber=#291 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:28.724Z level=INFO fiber=#291 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:28.724Z level=INFO fiber=#291 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:28.724Z level=INFO fiber=#291 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:28.724Z level=INFO fiber=#291 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:28.724Z level=INFO fiber=#291 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:28.724Z level=INFO fiber=#291 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:28.724Z level=INFO fiber=#291 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:28.724Z level=INFO fiber=#291 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:28.724Z level=INFO fiber=#291 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:28.725Z level=INFO fiber=#291 message="âœ… Discovery: 3 operations found"
timestamp=2025-11-18T21:00:28.725Z level=INFO fiber=#291 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:28.725Z level=INFO fiber=#291 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:28.725Z level=INFO fiber=#291 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:28.725Z level=INFO fiber=#291 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:28.725Z level=INFO fiber=#291 message="ğŸ”„ Processing 3 operations with Effect.TS..."
timestamp=2025-11-18T21:00:28.725Z level=INFO fiber=#291 message="âœ… Processed 3 operations successfully"
timestamp=2025-11-18T21:00:28.725Z level=INFO fiber=#291 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:28.725Z level=INFO fiber=#291 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:28.725Z level=INFO fiber=#291 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:28.725Z level=INFO fiber=#291 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:28.725Z level=INFO fiber=#291 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 3,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 3
}"
timestamp=2025-11-18T21:00:28.725Z level=INFO fiber=#291 message="âœ… Processing: 3 elements processed"
timestamp=2025-11-18T21:00:28.725Z level=INFO fiber=#291 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:28.725Z level=INFO fiber=#291 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:28.725Z level=INFO fiber=#291 message="âœ… AsyncAPI document validation passed! 3 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T21:00:28.725Z level=INFO fiber=#291 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:28.725Z level=INFO fiber=#291 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:28.726Z level=INFO fiber=#291 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.727Z level=INFO fiber=#291 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.727Z level=INFO fiber=#291 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.727Z level=INFO fiber=#291 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.727Z level=INFO fiber=#291 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.727Z level=INFO fiber=#291 message="ğŸ‰ TYPESPEC API SUCCESS: 3 channels, 0 operations"
timestamp=2025-11-18T21:00:28.727Z level=INFO fiber=#291 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.727Z level=INFO fiber=#291 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:28.727Z level=INFO fiber=#292 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
183 | 			const spec = content.startsWith('{') ? JSON.parse(content) : require('yaml').parse(content)
184 | 
185 | 			const schemas = spec.components?.schemas || {}
186 | 
187 | 			// Validate deep nesting (5 levels)
188 | 			expect(schemas.UserProfile).toBeDefined()
                                     ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/e2e/complex-nested-schemas.test.ts:188:32)
(fail) E2E: Complex Nested Schemas > should handle deeply nested and complex schema structures [143.13ms]

test/e2e/error-handling-edgecases.test.ts:
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T21:00:28.800Z level=INFO fiber=#293 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:28.801Z level=INFO fiber=#293 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:28.801Z level=INFO fiber=#293 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.801Z level=INFO fiber=#293 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.801Z level=INFO fiber=#293 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.802Z level=INFO fiber=#293 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.802Z level=INFO fiber=#293 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.802Z level=INFO fiber=#293 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:28.802Z level=INFO fiber=#293 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.802Z level=INFO fiber=#293 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:28.802Z level=INFO fiber=#294 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
50 | 		if (asyncApiFile) {
51 | 			const content = host.fs.get(asyncApiFile) as string
52 | 			const spec = content.startsWith('{') ? JSON.parse(content) : require('yaml').parse(content)
53 | 
54 | 			// Empty model should still generate valid schema
55 | 			expect(spec.components?.schemas?.EmptyMessage).toBeDefined()
                                                       ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/e2e/error-handling-edgecases.test.ts:55:51)
(fail) E2E: Error Handling and Edge Cases > should handle empty models gracefully [62.31ms]
timestamp=2025-11-18T21:00:28.905Z level=INFO fiber=#295 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:28.905Z level=INFO fiber=#295 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:28.905Z level=INFO fiber=#295 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:28.905Z level=INFO fiber=#295 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:28.905Z level=INFO fiber=#295 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:28.905Z level=INFO fiber=#295 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:28.905Z level=INFO fiber=#295 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:28.905Z level=INFO fiber=#295 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:28.905Z level=INFO fiber=#295 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:28.905Z level=INFO fiber=#295 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:28.905Z level=INFO fiber=#295 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:28.905Z level=INFO fiber=#295 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:28.905Z level=INFO fiber=#295 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:28.905Z level=INFO fiber=#295 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:28.905Z level=INFO fiber=#295 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:28.905Z level=INFO fiber=#295 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:28.905Z level=INFO fiber=#295 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:28.905Z level=INFO fiber=#295 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:28.905Z level=INFO fiber=#295 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:28.905Z level=INFO fiber=#295 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:28.905Z level=INFO fiber=#295 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:28.905Z level=INFO fiber=#295 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:28.905Z level=INFO fiber=#295 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:28.905Z level=INFO fiber=#295 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:28.905Z level=INFO fiber=#295 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:28.906Z level=INFO fiber=#295 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:28.906Z level=INFO fiber=#295 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:28.906Z level=INFO fiber=#295 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:28.906Z level=INFO fiber=#295 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:28.906Z level=INFO fiber=#295 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:28.906Z level=INFO fiber=#295 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:28.906Z level=INFO fiber=#295 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T21:00:28.906Z level=INFO fiber=#295 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:28.906Z level=INFO fiber=#295 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:28.906Z level=INFO fiber=#295 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.906Z level=INFO fiber=#295 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.906Z level=INFO fiber=#295 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.906Z level=INFO fiber=#295 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.906Z level=INFO fiber=#295 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.906Z level=INFO fiber=#295 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:28.906Z level=INFO fiber=#295 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.906Z level=INFO fiber=#295 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:28.906Z level=INFO fiber=#296 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
timestamp=2025-11-18T21:00:28.995Z level=INFO fiber=#297 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:28.995Z level=INFO fiber=#297 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:28.995Z level=INFO fiber=#297 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:28.995Z level=INFO fiber=#297 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:28.995Z level=INFO fiber=#297 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:28.995Z level=INFO fiber=#297 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:28.995Z level=INFO fiber=#297 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:28.995Z level=INFO fiber=#297 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:28.996Z level=INFO fiber=#297 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:28.996Z level=INFO fiber=#297 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:28.996Z level=INFO fiber=#297 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:28.996Z level=INFO fiber=#297 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:28.996Z level=INFO fiber=#297 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:28.996Z level=INFO fiber=#297 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:28.996Z level=INFO fiber=#297 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:28.996Z level=INFO fiber=#297 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:28.996Z level=INFO fiber=#297 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:28.996Z level=INFO fiber=#297 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:28.996Z level=INFO fiber=#297 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:28.996Z level=INFO fiber=#297 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:28.996Z level=INFO fiber=#297 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:28.996Z level=INFO fiber=#297 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:28.998Z level=INFO fiber=#297 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:28.998Z level=INFO fiber=#297 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:28.998Z level=INFO fiber=#297 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:28.998Z level=INFO fiber=#297 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:28.998Z level=INFO fiber=#297 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:28.998Z level=INFO fiber=#297 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:28.998Z level=INFO fiber=#297 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:28.998Z level=INFO fiber=#297 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:28.998Z level=INFO fiber=#297 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:28.998Z level=INFO fiber=#297 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.05ms)"
timestamp=2025-11-18T21:00:28.998Z level=INFO fiber=#297 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:28.998Z level=INFO fiber=#297 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:29.003Z level=INFO fiber=#297 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:29.003Z level=INFO fiber=#297 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:29.003Z level=INFO fiber=#297 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:29.003Z level=INFO fiber=#297 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:29.003Z level=INFO fiber=#297 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:29.003Z level=INFO fiber=#297 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:29.003Z level=INFO fiber=#297 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:29.003Z level=INFO fiber=#297 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:29.003Z level=INFO fiber=#298 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
163 | 		if (asyncApiFile) {
164 | 			const content = host.fs.get(asyncApiFile) as string
165 | 			const spec = content.startsWith('{') ? JSON.parse(content) : require('yaml').parse(content)
166 | 
167 | 			const schema = spec.components?.schemas?.EdgeCaseMessage
168 | 			expect(schema).toBeDefined()
                        ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/e2e/error-handling-edgecases.test.ts:168:19)
(fail) E2E: Error Handling and Edge Cases > should handle edge case data types [97.37ms]
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:29.099Z level=INFO fiber=#299 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:29.100Z level=INFO fiber=#299 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:29.100Z level=INFO fiber=#299 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T21:00:29.100Z level=INFO fiber=#299 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:29.100Z level=INFO fiber=#299 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:29.101Z level=INFO fiber=#299 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:29.101Z level=INFO fiber=#299 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:29.101Z level=INFO fiber=#299 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:29.101Z level=INFO fiber=#299 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:29.101Z level=INFO fiber=#299 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:29.101Z level=INFO fiber=#299 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:29.101Z level=INFO fiber=#299 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:29.101Z level=INFO fiber=#299 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:29.101Z level=INFO fiber=#300 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:29.162Z level=INFO fiber=#301 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:29.163Z level=INFO fiber=#301 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:29.163Z level=INFO fiber=#301 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:29.163Z level=INFO fiber=#301 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:29.163Z level=INFO fiber=#301 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:29.163Z level=INFO fiber=#301 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:29.163Z level=INFO fiber=#301 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:29.163Z level=INFO fiber=#301 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:29.163Z level=INFO fiber=#301 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:29.163Z level=INFO fiber=#302 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
272 | 		if (asyncApiFile) {
273 | 			const content = host.fs.get(asyncApiFile) as string
274 | 			const spec = content.startsWith('{') ? JSON.parse(content) : require('yaml').parse(content)
275 | 
276 | 			const schema = spec.components?.schemas?.StrictMessage
277 | 			expect(schema).toBeDefined()
                        ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/e2e/error-handling-edgecases.test.ts:277:19)
(fail) E2E: Error Handling and Edge Cases > should validate required vs optional fields correctly [62.33ms]
timestamp=2025-11-18T21:00:29.231Z level=INFO fiber=#303 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:29.231Z level=INFO fiber=#303 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:29.231Z level=INFO fiber=#303 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:29.231Z level=INFO fiber=#303 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:29.231Z level=INFO fiber=#303 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:29.231Z level=INFO fiber=#303 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:29.231Z level=INFO fiber=#303 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:29.231Z level=INFO fiber=#303 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:29.231Z level=INFO fiber=#303 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:29.231Z level=INFO fiber=#303 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:29.231Z level=INFO fiber=#303 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:29.231Z level=INFO fiber=#303 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:29.231Z level=INFO fiber=#303 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:29.231Z level=INFO fiber=#303 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:29.231Z level=INFO fiber=#303 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:29.231Z level=INFO fiber=#303 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:29.231Z level=INFO fiber=#303 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:29.231Z level=INFO fiber=#303 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:29.231Z level=INFO fiber=#303 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:29.231Z level=INFO fiber=#303 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:29.231Z level=INFO fiber=#303 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:29.232Z level=INFO fiber=#303 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:29.232Z level=INFO fiber=#303 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:29.232Z level=INFO fiber=#303 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:29.232Z level=INFO fiber=#303 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:29.232Z level=INFO fiber=#303 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:29.232Z level=INFO fiber=#303 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:29.232Z level=INFO fiber=#303 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:29.232Z level=INFO fiber=#303 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:29.232Z level=INFO fiber=#303 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:29.232Z level=INFO fiber=#303 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:29.232Z level=INFO fiber=#303 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T21:00:29.232Z level=INFO fiber=#303 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:29.232Z level=INFO fiber=#303 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:29.234Z level=INFO fiber=#303 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:29.234Z level=INFO fiber=#303 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:29.234Z level=INFO fiber=#303 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:29.235Z level=INFO fiber=#303 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:29.235Z level=INFO fiber=#303 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:29.235Z level=INFO fiber=#303 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:29.235Z level=INFO fiber=#303 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:29.235Z level=INFO fiber=#303 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:29.235Z level=INFO fiber=#304 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
332 | 		if (asyncApiFile) {
333 | 			const content = host.fs.get(asyncApiFile) as string
334 | 			const spec = content.startsWith('{') ? JSON.parse(content) : require('yaml').parse(content)
335 | 
336 | 			// Should have valid AsyncAPI without security
337 | 			expect(spec.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/e2e/error-handling-edgecases.test.ts:337:26)
(fail) E2E: Error Handling and Edge Cases > should handle missing security gracefully [71.34ms]

test/domain/security-comprehensive.test.ts:
32 | 				op publishMessage(): Msg;
33 | 			`)
34 | 
35 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
36 | 		expect(spec).toBeDefined()
37 | 		expect(spec?.asyncapi).toBe("3.0.0")
                              ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:37:26)
(fail) Security Schemes - Comprehensive Domain Tests > HTTP Authentication > should support HTTP Basic Auth [55.94ms]
60 | 				op publishMessage(): Msg;
61 | 			`)
62 | 
63 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
64 | 		expect(spec).toBeDefined()
65 | 		expect(spec?.asyncapi).toBe("3.0.0")
                              ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:65:26)
(fail) Security Schemes - Comprehensive Domain Tests > HTTP Authentication > should support HTTP Bearer JWT [38.31ms]
88 | 				op publishMessage(): Msg;
89 | 			`)
90 | 
91 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
92 | 		expect(spec).toBeDefined()
93 | 		expect(spec?.asyncapi).toBe("3.0.0")
                              ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:93:26)
(fail) Security Schemes - Comprehensive Domain Tests > HTTP Authentication > should support HTTP Bearer with custom format [61.11ms]
115 | 				op publishMessage(): Msg;
116 | 			`)
117 | 
118 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
119 | 		expect(spec).toBeDefined()
120 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:120:26)
(fail) Security Schemes - Comprehensive Domain Tests > HTTP Authentication > should support HTTP Digest Auth [72.90ms]
142 | 				op publishMessage(): Msg;
143 | 			`)
144 | 
145 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
146 | 		expect(spec).toBeDefined()
147 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:147:26)
(fail) Security Schemes - Comprehensive Domain Tests > HTTP Authentication > should support HTTP Mutual TLS [61.24ms]
169 | 				op publishMessage(): Msg;
170 | 			`)
171 | 
172 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
173 | 		expect(spec).toBeDefined()
174 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:174:26)
(fail) Security Schemes - Comprehensive Domain Tests > HTTP Authentication > should support HTTP HOBA (HTTP Origin-Bound Auth) [62.87ms]
196 | 				op publishMessage(): Msg;
197 | 			`)
198 | 
199 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
200 | 		expect(spec).toBeDefined()
201 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:201:26)
(fail) Security Schemes - Comprehensive Domain Tests > HTTP Authentication > should support HTTP Negotiate (SPNEGO) [48.66ms]
223 | 				op publishMessage(): Msg;
224 | 			`)
225 | 
226 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
227 | 		expect(spec).toBeDefined()
228 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:228:26)
(fail) Security Schemes - Comprehensive Domain Tests > HTTP Authentication > should support HTTP SCRAM-SHA-1 [49.48ms]
250 | 				op publishMessage(): Msg;
251 | 			`)
252 | 
253 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
254 | 		expect(spec).toBeDefined()
255 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:255:26)
(fail) Security Schemes - Comprehensive Domain Tests > HTTP Authentication > should support HTTP SCRAM-SHA-256 [125.18ms]
277 | 				op publishMessage(): Msg;
278 | 			`)
279 | 
280 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
281 | 		expect(spec).toBeDefined()
282 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:282:26)
(fail) Security Schemes - Comprehensive Domain Tests > HTTP Authentication > should support HTTP AWS Signature V4 [41.05ms]
304 | 				op publishMessage(): Msg;
305 | 			`)
306 | 
307 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
308 | 		expect(spec).toBeDefined()
309 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:309:26)
(fail) Security Schemes - Comprehensive Domain Tests > HTTP Authentication > should support HTTP MAC (Message Authentication Code) [49.62ms]
331 | 				op publishMessage(): PushMsg;
332 | 			`)
333 | 
334 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
335 | 		expect(spec).toBeDefined()
336 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:336:26)
(fail) Security Schemes - Comprehensive Domain Tests > HTTP Authentication > should support HTTP VAPID (Web Push) [54.66ms]
358 | 				op publishMessage(): Msg;
359 | 			`)
360 | 
361 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
362 | 		expect(spec).toBeDefined()
363 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:363:26)
(fail) Security Schemes - Comprehensive Domain Tests > HTTP Authentication > should support HTTP DPoP (Demonstrating Proof-of-Possession) [43.56ms]
385 | 				op publishMessage(): Msg;
386 | 			`)
387 | 
388 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
389 | 		expect(spec).toBeDefined()
390 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:390:26)
(fail) Security Schemes - Comprehensive Domain Tests > HTTP Authentication > should support HTTP PrivateToken [39.55ms]
412 | 				op publishMessage(): Msg;
413 | 			`)
414 | 
415 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
416 | 		expect(spec).toBeDefined()
417 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:417:26)
(fail) Security Schemes - Comprehensive Domain Tests > HTTP Authentication > should support HTTP GNAP (Grant Negotiation and Authorization Protocol) [146.51ms]
451 | 				op pub2(): Msg;
452 | 			`)
453 | 
454 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
455 | 		expect(spec).toBeDefined()
456 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:456:26)
(fail) Security Schemes - Comprehensive Domain Tests > HTTP Authentication > should support multiple HTTP auth schemes (OR) [60.45ms]
479 | 				op publishMessage(): Msg;
480 | 			`)
481 | 
482 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
483 | 		expect(spec).toBeDefined()
484 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:484:26)
(fail) Security Schemes - Comprehensive Domain Tests > HTTP Authentication > should support HTTP auth with realm [40.65ms]
507 | 				op publishMessage(): Msg;
508 | 			`)
509 | 
510 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
511 | 		expect(spec).toBeDefined()
512 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:512:26)
(fail) Security Schemes - Comprehensive Domain Tests > HTTP Authentication > should support HTTP auth with charset [69.02ms]
535 | 				op publishMessage(): Msg;
536 | 			`)
537 | 
538 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
539 | 		expect(spec).toBeDefined()
540 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:540:26)
(fail) Security Schemes - Comprehensive Domain Tests > HTTP Authentication > should support HTTP auth with nonce [64.66ms]
562 | 				op publishMessage(): Msg;
563 | 			`)
564 | 
565 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
566 | 		expect(spec).toBeDefined()
567 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:567:26)
(fail) Security Schemes - Comprehensive Domain Tests > HTTP Authentication > should support HTTP Hawk authentication [147.34ms]
593 | 				op publishMessage(): Msg;
594 | 			`)
595 | 
596 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
597 | 		expect(spec).toBeDefined()
598 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:598:26)
(fail) Security Schemes - Comprehensive Domain Tests > API Key Authentication > should support API Key in header [133.00ms]
621 | 				op publishMessage(): Msg;
622 | 			`)
623 | 
624 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
625 | 		expect(spec).toBeDefined()
626 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:626:26)
(fail) Security Schemes - Comprehensive Domain Tests > API Key Authentication > should support API Key in query parameter [94.87ms]
649 | 				op publishMessage(): Msg;
650 | 			`)
651 | 
652 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
653 | 		expect(spec).toBeDefined()
654 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:654:26)
(fail) Security Schemes - Comprehensive Domain Tests > API Key Authentication > should support API Key in cookie [58.98ms]
689 | 				op pub2(): Msg;
690 | 			`)
691 | 
692 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
693 | 		expect(spec).toBeDefined()
694 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:694:26)
(fail) Security Schemes - Comprehensive Domain Tests > API Key Authentication > should support multiple API keys [64.33ms]
718 | 				op publishMessage(): Msg;
719 | 			`)
720 | 
721 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
722 | 		expect(spec).toBeDefined()
723 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:723:26)
(fail) Security Schemes - Comprehensive Domain Tests > API Key Authentication > should support API Key with prefix [65.14ms]
750 | 				op publishMessage(): Msg;
751 | 			`)
752 | 
753 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
754 | 		expect(spec).toBeDefined()
755 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:755:26)
(fail) Security Schemes - Comprehensive Domain Tests > API Key Authentication > should support API Key rotation [47.63ms]
779 | 				op publishMessage(): Msg;
780 | 			`)
781 | 
782 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
783 | 		expect(spec).toBeDefined()
784 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:784:26)
(fail) Security Schemes - Comprehensive Domain Tests > API Key Authentication > should support API Key scopes [42.73ms]
811 | 				op publishMessage(): Msg;
812 | 			`)
813 | 
814 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
815 | 		expect(spec).toBeDefined()
816 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:816:26)
(fail) Security Schemes - Comprehensive Domain Tests > API Key Authentication > should support API Key rate limiting [50.15ms]
843 | 				op publishMessage(): Msg;
844 | 			`)
845 | 
846 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
847 | 		expect(spec).toBeDefined()
848 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:848:26)
(fail) Security Schemes - Comprehensive Domain Tests > API Key Authentication > should support API Key expiration [42.38ms]
875 | 				op publishMessage(): Msg;
876 | 			`)
877 | 
878 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
879 | 		expect(spec).toBeDefined()
880 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:880:26)
(fail) Security Schemes - Comprehensive Domain Tests > API Key Authentication > should support API Key IP whitelisting [43.27ms]
907 | 				op publishMessage(): Msg;
908 | 			`)
909 | 
910 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
911 | 		expect(spec).toBeDefined()
912 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:912:26)
(fail) Security Schemes - Comprehensive Domain Tests > API Key Authentication > should support API Key usage tracking [57.99ms]
936 | 				op publishMessage(): Msg;
937 | 			`)
938 | 
939 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
940 | 		expect(spec).toBeDefined()
941 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:941:26)
(fail) Security Schemes - Comprehensive Domain Tests > API Key Authentication > should support API Key with CORS [42.08ms]
968 | 				op publishMessage(): Msg;
969 | 			`)
970 | 
971 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
972 | 		expect(spec).toBeDefined()
973 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:973:26)
(fail) Security Schemes - Comprehensive Domain Tests > API Key Authentication > should support API Key with environment (dev/staging/prod) [55.95ms]
1001 | 				op publishMessage(): Msg;
1002 | 			`)
1003 | 
1004 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1005 | 		expect(spec).toBeDefined()
1006 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1006:26)
(fail) Security Schemes - Comprehensive Domain Tests > API Key Authentication > should support API Key with request signing [41.49ms]
1030 | 				op publishMessage(): Msg;
1031 | 			`)
1032 | 
1033 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1034 | 		expect(spec).toBeDefined()
1035 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1035:26)
(fail) Security Schemes - Comprehensive Domain Tests > API Key Authentication > should support API Key with custom validation [55.29ms]
1063 | 				op receiveWebhook(): WebhookMsg;
1064 | 			`)
1065 | 
1066 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1067 | 		expect(spec).toBeDefined()
1068 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1068:26)
(fail) Security Schemes - Comprehensive Domain Tests > API Key Authentication > should support API Key with webhook verification [70.06ms]
1095 | 				op publishMessage(): Msg;
1096 | 			`)
1097 | 
1098 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1099 | 		expect(spec).toBeDefined()
1100 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1100:26)
(fail) Security Schemes - Comprehensive Domain Tests > API Key Authentication > should support API Key with tenant isolation [40.35ms]
1124 | 				op publishMessage(): Msg;
1125 | 			`)
1126 | 
1127 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1128 | 		expect(spec).toBeDefined()
1129 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1129:26)
(fail) Security Schemes - Comprehensive Domain Tests > API Key Authentication > should support API Key with fallback authentication [38.74ms]
1156 | 				op publishMessage(): Msg;
1157 | 			`)
1158 | 
1159 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1160 | 		expect(spec).toBeDefined()
1161 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1161:26)
(fail) Security Schemes - Comprehensive Domain Tests > API Key Authentication > should support API Key with conditional requirements [40.83ms]
1188 | 				op publishMessage(): Msg;
1189 | 			`)
1190 | 
1191 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1192 | 		expect(spec).toBeDefined()
1193 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1193:26)
(fail) Security Schemes - Comprehensive Domain Tests > API Key Authentication > should support API Key with audit logging [71.42ms]
1227 | 				op publishMessage(): Msg;
1228 | 			`)
1229 | 
1230 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1231 | 		expect(spec).toBeDefined()
1232 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1232:26)
(fail) Security Schemes - Comprehensive Domain Tests > OAuth2 Flows > should support OAuth2 Authorization Code flow [90.53ms]
1262 | 				op publishMessage(): Msg;
1263 | 			`)
1264 | 
1265 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1266 | 		expect(spec).toBeDefined()
1267 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1267:26)
(fail) Security Schemes - Comprehensive Domain Tests > OAuth2 Flows > should support OAuth2 Client Credentials flow [46.91ms]
1297 | 				op publishMessage(): Msg;
1298 | 			`)
1299 | 
1300 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1301 | 		expect(spec).toBeDefined()
1302 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1302:26)
(fail) Security Schemes - Comprehensive Domain Tests > OAuth2 Flows > should support OAuth2 Implicit flow [57.49ms]
1331 | 				op publishMessage(): Msg;
1332 | 			`)
1333 | 
1334 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1335 | 		expect(spec).toBeDefined()
1336 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1336:26)
(fail) Security Schemes - Comprehensive Domain Tests > OAuth2 Flows > should support OAuth2 Password flow (Resource Owner) [82.15ms]
1368 | 				op publishMessage(): Msg;
1369 | 			`)
1370 | 
1371 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1372 | 		expect(spec).toBeDefined()
1373 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1373:26)
(fail) Security Schemes - Comprehensive Domain Tests > OAuth2 Flows > should support OAuth2 with multiple flows [47.43ms]
1402 | 				op publishMessage(): Msg;
1403 | 			`)
1404 | 
1405 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1406 | 		expect(spec).toBeDefined()
1407 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1407:26)
(fail) Security Schemes - Comprehensive Domain Tests > OAuth2 Flows > should support OAuth2 with PKCE [76.23ms]
1439 | 				op publishMessage(): Msg;
1440 | 			`)
1441 | 
1442 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1443 | 		expect(spec).toBeDefined()
1444 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1444:26)
(fail) Security Schemes - Comprehensive Domain Tests > OAuth2 Flows > should support OAuth2 with refresh tokens [53.83ms]
1476 | 				op publishMessage(): Msg;
1477 | 			`)
1478 | 
1479 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1480 | 		expect(spec).toBeDefined()
1481 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1481:26)
(fail) Security Schemes - Comprehensive Domain Tests > OAuth2 Flows > should support OAuth2 with OpenID Connect [39.93ms]
1513 | 				op publishMessage(): Msg;
1514 | 			`)
1515 | 
1516 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1517 | 		expect(spec).toBeDefined()
1518 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1518:26)
(fail) Security Schemes - Comprehensive Domain Tests > OAuth2 Flows > should support OAuth2 with dynamic scopes [54.77ms]
1549 | 				op publishMessage(): Msg;
1550 | 			`)
1551 | 
1552 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1553 | 		expect(spec).toBeDefined()
1554 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1554:26)
(fail) Security Schemes - Comprehensive Domain Tests > OAuth2 Flows > should support OAuth2 with audience restriction [37.64ms]
1585 | 				op publishMessage(): Msg;
1586 | 			`)
1587 | 
1588 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1589 | 		expect(spec).toBeDefined()
1590 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1590:26)
(fail) Security Schemes - Comprehensive Domain Tests > OAuth2 Flows > should support OAuth2 Device Authorization Grant [38.16ms]
1620 | 				op publishMessage(): Msg;
1621 | 			`)
1622 | 
1623 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1624 | 		expect(spec).toBeDefined()
1625 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1625:26)
(fail) Security Schemes - Comprehensive Domain Tests > OAuth2 Flows > should support OAuth2 Token Exchange (RFC 8693) [38.25ms]
1655 | 				op publishMessage(): Msg;
1656 | 			`)
1657 | 
1658 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1659 | 		expect(spec).toBeDefined()
1660 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1660:26)
(fail) Security Schemes - Comprehensive Domain Tests > OAuth2 Flows > should support OAuth2 JWT Bearer Grant (RFC 7523) [37.99ms]
1690 | 				op publishMessage(): Msg;
1691 | 			`)
1692 | 
1693 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1694 | 		expect(spec).toBeDefined()
1695 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1695:26)
(fail) Security Schemes - Comprehensive Domain Tests > OAuth2 Flows > should support OAuth2 SAML Bearer Grant (RFC 7522) [36.30ms]
1726 | 				op publishMessage(): Msg;
1727 | 			`)
1728 | 
1729 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1730 | 		expect(spec).toBeDefined()
1731 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1731:26)
(fail) Security Schemes - Comprehensive Domain Tests > OAuth2 Flows > should support OAuth2 with token introspection [44.78ms]
1763 | 				op publishMessage(): Msg;
1764 | 			`)
1765 | 
1766 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1767 | 		expect(spec).toBeDefined()
1768 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1768:26)
(fail) Security Schemes - Comprehensive Domain Tests > OAuth2 Flows > should support OAuth2 with token revocation [45.70ms]
1803 | 				op publishMessage(): Msg;
1804 | 			`)
1805 | 
1806 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1807 | 		expect(spec).toBeDefined()
1808 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1808:26)
(fail) Security Schemes - Comprehensive Domain Tests > OAuth2 Flows > should support OAuth2 with scope negotiation [56.56ms]
1840 | 				op publishMessage(): Msg;
1841 | 			`)
1842 | 
1843 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1844 | 		expect(spec).toBeDefined()
1845 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1845:26)
(fail) Security Schemes - Comprehensive Domain Tests > OAuth2 Flows > should support OAuth2 with consent management [38.92ms]
1877 | 				op publishMessage(): Msg;
1878 | 			`)
1879 | 
1880 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1881 | 		expect(spec).toBeDefined()
1882 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1882:26)
(fail) Security Schemes - Comprehensive Domain Tests > OAuth2 Flows > should support OAuth2 with session management [53.82ms]
1907 | 				op publishMessage(): Msg;
1908 | 			`)
1909 | 
1910 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1911 | 		expect(spec).toBeDefined()
1912 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1912:26)
(fail) Security Schemes - Comprehensive Domain Tests > SASL & Other Security Mechanisms > should support SASL PLAIN [51.04ms]
1934 | 				op publishMessage(): Msg;
1935 | 			`)
1936 | 
1937 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1938 | 		expect(spec).toBeDefined()
1939 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1939:26)
(fail) Security Schemes - Comprehensive Domain Tests > SASL & Other Security Mechanisms > should support SASL SCRAM-SHA-1 [56.24ms]
1961 | 				op publishMessage(): Msg;
1962 | 			`)
1963 | 
1964 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1965 | 		expect(spec).toBeDefined()
1966 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1966:26)
(fail) Security Schemes - Comprehensive Domain Tests > SASL & Other Security Mechanisms > should support SASL SCRAM-SHA-256 [39.69ms]
1988 | 				op publishMessage(): Msg;
1989 | 			`)
1990 | 
1991 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1992 | 		expect(spec).toBeDefined()
1993 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:1993:26)
(fail) Security Schemes - Comprehensive Domain Tests > SASL & Other Security Mechanisms > should support SASL SCRAM-SHA-512 [48.05ms]
2015 | 				op publishMessage(): Msg;
2016 | 			`)
2017 | 
2018 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
2019 | 		expect(spec).toBeDefined()
2020 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:2020:26)
(fail) Security Schemes - Comprehensive Domain Tests > SASL & Other Security Mechanisms > should support SASL GSSAPI (Kerberos) [37.35ms]
2042 | 				op publishMessage(): Msg;
2043 | 			`)
2044 | 
2045 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
2046 | 		expect(spec).toBeDefined()
2047 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:2047:26)
(fail) Security Schemes - Comprehensive Domain Tests > SASL & Other Security Mechanisms > should support SASL EXTERNAL [38.41ms]
2069 | 				op publishMessage(): Msg;
2070 | 			`)
2071 | 
2072 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
2073 | 		expect(spec).toBeDefined()
2074 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:2074:26)
(fail) Security Schemes - Comprehensive Domain Tests > SASL & Other Security Mechanisms > should support SASL OAUTHBEARER [60.03ms]
2096 | 				op publishMessage(): Msg;
2097 | 			`)
2098 | 
2099 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
2100 | 		expect(spec).toBeDefined()
2101 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:2101:26)
(fail) Security Schemes - Comprehensive Domain Tests > SASL & Other Security Mechanisms > should support SASL CRAM-MD5 [52.44ms]
2123 | 				op publishMessage(): Msg;
2124 | 			`)
2125 | 
2126 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
2127 | 		expect(spec).toBeDefined()
2128 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:2128:26)
(fail) Security Schemes - Comprehensive Domain Tests > SASL & Other Security Mechanisms > should support SASL DIGEST-MD5 [50.61ms]
2150 | 				op publishMessage(): Msg;
2151 | 			`)
2152 | 
2153 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
2154 | 		expect(spec).toBeDefined()
2155 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:2155:26)
(fail) Security Schemes - Comprehensive Domain Tests > SASL & Other Security Mechanisms > should support SASL ANONYMOUS [61.43ms]
2177 | 				op publishMessage(): Msg;
2178 | 			`)
2179 | 
2180 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
2181 | 		expect(spec).toBeDefined()
2182 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:2182:26)
(fail) Security Schemes - Comprehensive Domain Tests > SASL & Other Security Mechanisms > should support X.509 Client Certificates [35.92ms]
2207 | 				op publishMessage(): Msg;
2208 | 			`)
2209 | 
2210 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
2211 | 		expect(spec).toBeDefined()
2212 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:2212:26)
(fail) Security Schemes - Comprehensive Domain Tests > SASL & Other Security Mechanisms > should support Asymmetric Key Pairs [46.42ms]
2237 | 				op publishMessage(): Msg;
2238 | 			`)
2239 | 
2240 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
2241 | 		expect(spec).toBeDefined()
2242 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:2242:26)
(fail) Security Schemes - Comprehensive Domain Tests > SASL & Other Security Mechanisms > should support Symmetric Keys [39.07ms]
2319 | 				op publishMessage(): Msg;
2320 | 			`)
2321 | 
2322 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
2323 | 		expect(spec).toBeDefined()
2324 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:2324:26)
(fail) Security Schemes - Comprehensive Domain Tests > SASL & Other Security Mechanisms > should support Plain Text (No Authentication) [32.03ms]
2477 | 				op pub2(): Msg;
2478 | 			`)
2479 | 
2480 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
2481 | 		expect(spec).toBeDefined()
2482 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:2482:26)
(fail) Security Schemes - Comprehensive Domain Tests > Combined & Advanced Security > should support multiple security schemes (AND) [32.04ms]
2510 | 				op publishMessage(): Msg;
2511 | 			`)
2512 | 
2513 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
2514 | 		expect(spec).toBeDefined()
2515 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:2515:26)
(fail) Security Schemes - Comprehensive Domain Tests > Combined & Advanced Security > should support security with rate limiting [40.67ms]
2542 | 				op publishMessage(): Msg;
2543 | 			`)
2544 | 
2545 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
2546 | 		expect(spec).toBeDefined()
2547 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:2547:26)
(fail) Security Schemes - Comprehensive Domain Tests > Combined & Advanced Security > should support security with IP restrictions [41.61ms]
2574 | 				op publishMessage(): Msg;
2575 | 			`)
2576 | 
2577 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
2578 | 		expect(spec).toBeDefined()
2579 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:2579:26)
(fail) Security Schemes - Comprehensive Domain Tests > Combined & Advanced Security > should support security with geographic restrictions [42.29ms]
2606 | 				op publishMessage(): Msg;
2607 | 			`)
2608 | 
2609 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
2610 | 		expect(spec).toBeDefined()
2611 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:2611:26)
(fail) Security Schemes - Comprehensive Domain Tests > Combined & Advanced Security > should support security with time-based access [37.63ms]
2638 | 				op publishMessage(): Msg;
2639 | 			`)
2640 | 
2641 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
2642 | 		expect(spec).toBeDefined()
2643 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:2643:26)
(fail) Security Schemes - Comprehensive Domain Tests > Combined & Advanced Security > should support security with MFA requirements [34.72ms]
2670 | 				op publishMessage(): Msg;
2671 | 			`)
2672 | 
2673 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
2674 | 		expect(spec).toBeDefined()
2675 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:2675:26)
(fail) Security Schemes - Comprehensive Domain Tests > Combined & Advanced Security > should support security with device fingerprinting [39.66ms]
2763 | 				op publishMessage(): Msg;
2764 | 			`)
2765 | 
2766 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
2767 | 		expect(spec).toBeDefined()
2768 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/security-comprehensive.test.ts:2768:26)
(fail) Security Schemes - Comprehensive Domain Tests > Combined & Advanced Security > should support security with risk-based authentication [34.16ms]

test/domain/protocol-websocket-mqtt.test.ts:
29 | 				op receiveMessage(): Message;
30 | 			`)
31 | 
32 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
33 | 		expect(spec).toBeDefined()
34 | 		expect(spec?.asyncapi).toBe("3.0.0")
                              ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:34:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > WebSocket Protocol > should support basic WebSocket connection [41.25ms]
58 | 				op subscribeMessage(): Msg;
59 | 			`)
60 | 
61 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
62 | 		expect(spec).toBeDefined()
63 | 		expect(spec?.asyncapi).toBe("3.0.0")
                              ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:63:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > WebSocket Protocol > should support WebSocket with query parameters [56.83ms]
86 | 				op receiveMessage(): Msg;
87 | 			`)
88 | 
89 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
90 | 		expect(spec).toBeDefined()
91 | 		expect(spec?.asyncapi).toBe("3.0.0")
                              ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:91:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > WebSocket Protocol > should support WebSocket with custom headers [51.80ms]
113 | 				op joinChat(): Event;
114 | 			`)
115 | 
116 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
117 | 		expect(spec).toBeDefined()
118 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:118:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > WebSocket Protocol > should support Socket.IO namespace [29.54ms]
140 | 				op sendPing(): Ping;
141 | 			`)
142 | 
143 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
144 | 		expect(spec).toBeDefined()
145 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:145:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > WebSocket Protocol > should support WebSocket ping/pong heartbeat [38.26ms]
166 | 				op sendBinary(): BinaryData;
167 | 			`)
168 | 
169 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
170 | 		expect(spec).toBeDefined()
171 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:171:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > WebSocket Protocol > should support WebSocket binary frames [45.88ms]
192 | 				op sendText(): TextMsg;
193 | 			`)
194 | 
195 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
196 | 		expect(spec).toBeDefined()
197 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:197:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > WebSocket Protocol > should support WebSocket text frames [57.13ms]
218 | 				op sendCompressed(): CompressedMsg;
219 | 			`)
220 | 
221 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
222 | 		expect(spec).toBeDefined()
223 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:223:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > WebSocket Protocol > should support WebSocket compression (permessage-deflate) [48.30ms]
248 | 				op receiveMultiplexed(): MultiplexedMsg;
249 | 			`)
250 | 
251 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
252 | 		expect(spec).toBeDefined()
253 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:253:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > WebSocket Protocol > should support WebSocket multiplexing [39.54ms]
274 | 				op broadcastToAll(): BroadcastMsg;
275 | 			`)
276 | 
277 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
278 | 		expect(spec).toBeDefined()
279 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:279:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > WebSocket Protocol > should support WebSocket broadcast to all clients [70.45ms]
303 | 				op sendToRoom(): RoomMsg;
304 | 			`)
305 | 
306 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
307 | 		expect(spec).toBeDefined()
308 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:308:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > WebSocket Protocol > should support WebSocket room-based messaging [50.57ms]
333 | 				op sendWithAck(): AckMsg;
334 | 			`)
335 | 
336 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
337 | 		expect(spec).toBeDefined()
338 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:338:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > WebSocket Protocol > should support WebSocket acknowledgments [35.95ms]
361 | 				op connect(): Msg;
362 | 			`)
363 | 
364 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
365 | 		expect(spec).toBeDefined()
366 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:366:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > WebSocket Protocol > should support WebSocket reconnection strategy [44.50ms]
391 | 				op sendClose(): CloseMsg;
392 | 			`)
393 | 
394 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
395 | 		expect(spec).toBeDefined()
396 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:396:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > WebSocket Protocol > should support WebSocket close codes [36.09ms]
417 | 				op receiveWAMP(): Msg;
418 | 			`)
419 | 
420 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
421 | 		expect(spec).toBeDefined()
422 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:422:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > WebSocket Protocol > should support WebSocket subprotocols [42.50ms]
443 | 				op receiveMessage(): Msg;
444 | 			`)
445 | 
446 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
447 | 		expect(spec).toBeDefined()
448 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:448:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > WebSocket Protocol > should support WebSocket extensions [31.60ms]
469 | 				op sendLarge(): LargeMsg;
470 | 			`)
471 | 
472 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
473 | 		expect(spec).toBeDefined()
474 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:474:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > WebSocket Protocol > should support WebSocket max message size [52.10ms]
498 | 				op receiveOrdered(): OrderedMsg;
499 | 			`)
500 | 
501 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
502 | 		expect(spec).toBeDefined()
503 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:503:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > WebSocket Protocol > should support WebSocket message ordering [43.40ms]
525 | 				op receiveWithBackpressure(): FlowMsg;
526 | 			`)
527 | 
528 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
529 | 		expect(spec).toBeDefined()
530 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:530:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > WebSocket Protocol > should support WebSocket backpressure [46.58ms]
553 | 				op sendBatch(): BatchMsg;
554 | 			`)
555 | 
556 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
557 | 		expect(spec).toBeDefined()
558 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:558:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > WebSocket Protocol > should support WebSocket message batching [33.45ms]
582 | 				op trackPresence(): PresenceMsg;
583 | 			`)
584 | 
585 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
586 | 		expect(spec).toBeDefined()
587 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:587:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > WebSocket Protocol > should support WebSocket presence tracking [37.87ms]
timestamp=2025-11-18T21:00:34.662Z level=INFO fiber=#305 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:34.662Z level=INFO fiber=#305 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:34.663Z level=INFO fiber=#305 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:34.663Z level=INFO fiber=#305 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:34.663Z level=INFO fiber=#305 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:34.663Z level=INFO fiber=#305 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:34.663Z level=INFO fiber=#305 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:34.663Z level=INFO fiber=#305 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:34.663Z level=INFO fiber=#305 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:34.663Z level=INFO fiber=#305 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:34.663Z level=INFO fiber=#305 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:34.663Z level=INFO fiber=#305 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:34.663Z level=INFO fiber=#305 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:34.663Z level=INFO fiber=#305 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:34.663Z level=INFO fiber=#305 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:34.663Z level=INFO fiber=#305 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:34.663Z level=INFO fiber=#305 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:34.663Z level=INFO fiber=#305 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:34.663Z level=INFO fiber=#305 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:34.663Z level=INFO fiber=#305 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:34.663Z level=INFO fiber=#305 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:34.663Z level=INFO fiber=#305 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:34.663Z level=INFO fiber=#305 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:34.663Z level=INFO fiber=#305 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:34.663Z level=INFO fiber=#305 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:34.664Z level=INFO fiber=#305 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:34.664Z level=INFO fiber=#305 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:34.664Z level=INFO fiber=#305 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:34.664Z level=INFO fiber=#305 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:34.664Z level=INFO fiber=#305 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:34.664Z level=INFO fiber=#305 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:34.664Z level=INFO fiber=#305 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.08ms)"
timestamp=2025-11-18T21:00:34.664Z level=INFO fiber=#305 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:34.664Z level=INFO fiber=#305 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:34.665Z level=INFO fiber=#305 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:34.665Z level=INFO fiber=#305 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:34.665Z level=INFO fiber=#305 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:34.665Z level=INFO fiber=#305 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:34.665Z level=INFO fiber=#305 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:34.665Z level=INFO fiber=#305 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:34.665Z level=INFO fiber=#305 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:34.665Z level=INFO fiber=#305 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:34.665Z level=INFO fiber=#306 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
timestamp=2025-11-18T21:00:34.725Z level=INFO fiber=#307 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:34.725Z level=INFO fiber=#307 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:34.725Z level=INFO fiber=#307 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:34.725Z level=INFO fiber=#307 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:34.725Z level=INFO fiber=#307 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:34.725Z level=INFO fiber=#307 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:34.725Z level=INFO fiber=#307 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:34.725Z level=INFO fiber=#307 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:34.725Z level=INFO fiber=#307 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:34.725Z level=INFO fiber=#307 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:34.725Z level=INFO fiber=#307 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:34.725Z level=INFO fiber=#307 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:34.725Z level=INFO fiber=#307 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:34.725Z level=INFO fiber=#307 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:34.725Z level=INFO fiber=#307 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:34.725Z level=INFO fiber=#307 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:34.725Z level=INFO fiber=#307 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:34.725Z level=INFO fiber=#307 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:34.725Z level=INFO fiber=#307 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:34.725Z level=INFO fiber=#307 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:34.725Z level=INFO fiber=#307 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:34.725Z level=INFO fiber=#307 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:34.726Z level=INFO fiber=#307 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:34.726Z level=INFO fiber=#307 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:34.726Z level=INFO fiber=#307 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:34.726Z level=INFO fiber=#307 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:34.726Z level=INFO fiber=#307 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:34.726Z level=INFO fiber=#307 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:34.726Z level=INFO fiber=#307 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:34.726Z level=INFO fiber=#307 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:34.726Z level=INFO fiber=#307 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:34.726Z level=INFO fiber=#307 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.08ms)"
timestamp=2025-11-18T21:00:34.726Z level=INFO fiber=#307 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:34.726Z level=INFO fiber=#307 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:34.727Z level=INFO fiber=#307 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:34.727Z level=INFO fiber=#307 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:34.727Z level=INFO fiber=#307 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:34.727Z level=INFO fiber=#307 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:34.727Z level=INFO fiber=#307 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:34.727Z level=INFO fiber=#307 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:34.727Z level=INFO fiber=#307 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:34.727Z level=INFO fiber=#307 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:34.727Z level=INFO fiber=#308 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
timestamp=2025-11-18T21:00:34.794Z level=INFO fiber=#309 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:34.794Z level=INFO fiber=#309 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:34.794Z level=INFO fiber=#309 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:34.794Z level=INFO fiber=#309 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:34.794Z level=INFO fiber=#309 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:34.794Z level=INFO fiber=#309 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:34.794Z level=INFO fiber=#309 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:34.794Z level=INFO fiber=#309 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:34.794Z level=INFO fiber=#309 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:34.794Z level=INFO fiber=#309 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:34.794Z level=INFO fiber=#309 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:34.794Z level=INFO fiber=#309 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:34.794Z level=INFO fiber=#309 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:34.794Z level=INFO fiber=#309 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:34.794Z level=INFO fiber=#309 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:34.794Z level=INFO fiber=#309 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:34.794Z level=INFO fiber=#309 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:34.794Z level=INFO fiber=#309 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:34.794Z level=INFO fiber=#309 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:34.794Z level=INFO fiber=#309 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:34.794Z level=INFO fiber=#309 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:34.795Z level=INFO fiber=#309 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:34.795Z level=INFO fiber=#309 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:34.795Z level=INFO fiber=#309 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:34.795Z level=INFO fiber=#309 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:34.795Z level=INFO fiber=#309 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:34.795Z level=INFO fiber=#309 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:34.795Z level=INFO fiber=#309 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:34.795Z level=INFO fiber=#309 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:34.795Z level=INFO fiber=#309 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:34.795Z level=INFO fiber=#309 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:34.795Z level=INFO fiber=#309 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T21:00:34.795Z level=INFO fiber=#309 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:34.795Z level=INFO fiber=#309 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:34.796Z level=INFO fiber=#309 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:34.797Z level=INFO fiber=#309 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:34.797Z level=INFO fiber=#309 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:34.797Z level=INFO fiber=#309 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:34.797Z level=INFO fiber=#309 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:34.797Z level=INFO fiber=#309 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:34.797Z level=INFO fiber=#309 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:34.797Z level=INFO fiber=#309 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:34.797Z level=INFO fiber=#310 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
686 | 				op streamAudio(): StreamPacket;
687 | 			`)
688 | 
689 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
690 | 		expect(spec).toBeDefined()
691 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:691:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > WebSocket Protocol > should support WebSocket voice/video streaming [41.84ms]
719 | 				op publishTemp(): Msg;
720 | 			`)
721 | 
722 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
723 | 		expect(spec).toBeDefined()
724 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:724:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > MQTT Protocol > should support MQTT QoS 0 (at most once) [30.84ms]
745 | 				op publishCritical(): Msg;
746 | 			`)
747 | 
748 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
749 | 		expect(spec).toBeDefined()
750 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:750:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > MQTT Protocol > should support MQTT QoS 1 (at least once) [38.39ms]
771 | 				op publishTx(): Transaction;
772 | 			`)
773 | 
774 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
775 | 		expect(spec).toBeDefined()
776 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:776:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > MQTT Protocol > should support MQTT QoS 2 (exactly once) [52.65ms]
797 | 				op publishStatus(): Status;
798 | 			`)
799 | 
800 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
801 | 		expect(spec).toBeDefined()
802 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:802:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > MQTT Protocol > should support MQTT retained messages [48.22ms]
timestamp=2025-11-18T21:00:35.064Z level=INFO fiber=#311 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:35.064Z level=INFO fiber=#311 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:35.064Z level=INFO fiber=#311 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:35.064Z level=INFO fiber=#311 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:35.064Z level=INFO fiber=#311 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:35.064Z level=INFO fiber=#311 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:35.064Z level=INFO fiber=#311 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:35.064Z level=INFO fiber=#311 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:35.064Z level=INFO fiber=#311 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:35.064Z level=INFO fiber=#311 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:35.065Z level=INFO fiber=#311 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:35.065Z level=INFO fiber=#311 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:35.065Z level=INFO fiber=#311 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:35.065Z level=INFO fiber=#311 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:35.065Z level=INFO fiber=#311 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:35.065Z level=INFO fiber=#311 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:35.065Z level=INFO fiber=#311 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:35.065Z level=INFO fiber=#311 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:35.065Z level=INFO fiber=#311 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:35.065Z level=INFO fiber=#311 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:35.065Z level=INFO fiber=#311 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:35.065Z level=INFO fiber=#311 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:35.065Z level=INFO fiber=#311 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:35.065Z level=INFO fiber=#311 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:35.065Z level=INFO fiber=#311 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:35.065Z level=INFO fiber=#311 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:35.065Z level=INFO fiber=#311 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:35.065Z level=INFO fiber=#311 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:35.065Z level=INFO fiber=#311 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:35.065Z level=INFO fiber=#311 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:35.065Z level=INFO fiber=#311 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:35.065Z level=INFO fiber=#311 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.05ms)"
timestamp=2025-11-18T21:00:35.065Z level=INFO fiber=#311 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:35.065Z level=INFO fiber=#311 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:35.065Z level=INFO fiber=#311 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:35.066Z level=INFO fiber=#311 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:35.066Z level=INFO fiber=#311 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:35.066Z level=INFO fiber=#311 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:35.066Z level=INFO fiber=#311 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:35.066Z level=INFO fiber=#311 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:35.066Z level=INFO fiber=#311 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:35.066Z level=INFO fiber=#311 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:35.066Z level=INFO fiber=#312 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
timestamp=2025-11-18T21:00:35.144Z level=INFO fiber=#313 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:35.145Z level=INFO fiber=#313 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:35.145Z level=INFO fiber=#313 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:35.145Z level=INFO fiber=#313 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:35.145Z level=INFO fiber=#313 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:35.145Z level=INFO fiber=#313 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:35.145Z level=INFO fiber=#313 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:35.145Z level=INFO fiber=#313 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:35.145Z level=INFO fiber=#313 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:35.145Z level=INFO fiber=#313 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:35.145Z level=INFO fiber=#313 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:35.145Z level=INFO fiber=#313 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:35.145Z level=INFO fiber=#313 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:35.145Z level=INFO fiber=#313 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:35.145Z level=INFO fiber=#313 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:35.145Z level=INFO fiber=#313 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:35.145Z level=INFO fiber=#313 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:35.145Z level=INFO fiber=#313 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:35.145Z level=INFO fiber=#313 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:35.145Z level=INFO fiber=#313 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:35.145Z level=INFO fiber=#313 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:35.145Z level=INFO fiber=#313 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:35.145Z level=INFO fiber=#313 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:35.145Z level=INFO fiber=#313 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:35.145Z level=INFO fiber=#313 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:35.145Z level=INFO fiber=#313 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:35.145Z level=INFO fiber=#313 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:35.145Z level=INFO fiber=#313 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:35.146Z level=INFO fiber=#313 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:35.146Z level=INFO fiber=#313 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:35.146Z level=INFO fiber=#313 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:35.146Z level=INFO fiber=#313 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.07ms)"
timestamp=2025-11-18T21:00:35.146Z level=INFO fiber=#313 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:35.146Z level=INFO fiber=#313 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:35.147Z level=INFO fiber=#313 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:35.147Z level=INFO fiber=#313 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:35.147Z level=INFO fiber=#313 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:35.147Z level=INFO fiber=#313 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:35.147Z level=INFO fiber=#313 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:35.147Z level=INFO fiber=#313 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:35.147Z level=INFO fiber=#313 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:35.150Z level=INFO fiber=#313 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:35.150Z level=INFO fiber=#314 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
865 | 				op publishWill(): WillMsg;
866 | 			`)
867 | 
868 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
869 | 		expect(spec).toBeDefined()
870 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:870:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > MQTT Protocol > should support MQTT last will and testament [75.74ms]
891 | 				op connectClean(): Msg;
892 | 			`)
893 | 
894 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
895 | 		expect(spec).toBeDefined()
896 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:896:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > MQTT Protocol > should support MQTT clean session [54.79ms]
918 | 				op connectPersistent(): Msg;
919 | 			`)
920 | 
921 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
922 | 		expect(spec).toBeDefined()
923 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:923:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > MQTT Protocol > should support MQTT persistent session [41.97ms]
944 | 				op publishWithClientId(): Msg;
945 | 			`)
946 | 
947 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
948 | 		expect(spec).toBeDefined()
949 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:949:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > MQTT Protocol > should support MQTT client ID [72.80ms]
970 | 				op sendPing(): Ping;
971 | 			`)
972 | 
973 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
974 | 		expect(spec).toBeDefined()
975 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:975:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > MQTT Protocol > should support MQTT keep alive [50.98ms]
1000 | 				op publishWithProps(): Msg;
1001 | 			`)
1002 | 
1003 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1004 | 		expect(spec).toBeDefined()
1005 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:1005:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > MQTT Protocol > should support MQTT v5 user properties [68.89ms]
1030 | 				op publishRequest(): Request;
1031 | 			`)
1032 | 
1033 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1034 | 		expect(spec).toBeDefined()
1035 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:1035:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > MQTT Protocol > should support MQTT v5 response topic [47.38ms]
1060 | 				op publishCorrelated(): Msg;
1061 | 			`)
1062 | 
1063 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1064 | 		expect(spec).toBeDefined()
1065 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:1065:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > MQTT Protocol > should support MQTT v5 correlation data [54.17ms]
1090 | 				op publishTyped(): Msg;
1091 | 			`)
1092 | 
1093 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1094 | 		expect(spec).toBeDefined()
1095 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:1095:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > MQTT Protocol > should support MQTT v5 content type [56.98ms]
1120 | 				op publishExpiring(): ExpiringMsg;
1121 | 			`)
1122 | 
1123 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1124 | 		expect(spec).toBeDefined()
1125 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:1125:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > MQTT Protocol > should support MQTT v5 message expiry [68.97ms]
1147 | 				op publishAliased(): Msg;
1148 | 			`)
1149 | 
1150 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1151 | 		expect(spec).toBeDefined()
1152 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:1152:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > MQTT Protocol > should support MQTT v5 topic alias [110.98ms]
1174 | 				op subscribeWithId(): Msg;
1175 | 			`)
1176 | 
1177 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1178 | 		expect(spec).toBeDefined()
1179 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:1179:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > MQTT Protocol > should support MQTT v5 subscription identifiers [49.24ms]
1201 | 				op receiveWithFlow(): Msg;
1202 | 			`)
1203 | 
1204 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1205 | 		expect(spec).toBeDefined()
1206 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:1206:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > MQTT Protocol > should support MQTT v5 flow control [57.32ms]
1228 | 				op publishLarge(): LargeMsg;
1229 | 			`)
1230 | 
1231 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1232 | 		expect(spec).toBeDefined()
1233 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:1233:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > MQTT Protocol > should support MQTT v5 maximum packet size [34.51ms]
1252 | 				op publishOverWS(): Msg;
1253 | 			`)
1254 | 
1255 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1256 | 		expect(spec).toBeDefined()
1257 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:1257:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > MQTT Protocol > should support MQTT over WebSocket [40.57ms]
1276 | 				op publishSecure(): SecureMsg;
1277 | 			`)
1278 | 
1279 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1280 | 		expect(spec).toBeDefined()
1281 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:1281:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > MQTT Protocol > should support MQTT TLS/SSL [40.04ms]
1307 | 				op publishBridged(): BridgeMsg;
1308 | 			`)
1309 | 
1310 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1311 | 		expect(spec).toBeDefined()
1312 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:1312:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > MQTT Protocol > should support MQTT bridge configuration [45.76ms]
1334 | 				op consumeWork(): WorkItem;
1335 | 			`)
1336 | 
1337 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1338 | 		expect(spec).toBeDefined()
1339 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-websocket-mqtt.test.ts:1339:26)
(fail) WebSocket & MQTT Protocols - Comprehensive Domain Tests > MQTT Protocol > should support MQTT shared subscriptions [62.95ms]
timestamp=2025-11-18T21:00:36.251Z level=INFO fiber=#315 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:36.251Z level=INFO fiber=#315 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:36.251Z level=INFO fiber=#315 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:36.251Z level=INFO fiber=#315 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:36.252Z level=INFO fiber=#315 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:36.252Z level=INFO fiber=#315 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:36.252Z level=INFO fiber=#315 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:36.252Z level=INFO fiber=#315 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:36.252Z level=INFO fiber=#315 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:36.252Z level=INFO fiber=#315 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:36.252Z level=INFO fiber=#315 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:36.252Z level=INFO fiber=#315 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:36.252Z level=INFO fiber=#315 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:36.252Z level=INFO fiber=#315 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:36.252Z level=INFO fiber=#315 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:36.252Z level=INFO fiber=#315 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:36.254Z level=INFO fiber=#315 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:36.254Z level=INFO fiber=#315 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:36.254Z level=INFO fiber=#315 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:36.254Z level=INFO fiber=#315 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:36.254Z level=INFO fiber=#315 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:36.254Z level=INFO fiber=#315 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:36.254Z level=INFO fiber=#315 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:36.254Z level=INFO fiber=#315 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:36.254Z level=INFO fiber=#315 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:36.254Z level=INFO fiber=#315 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:36.254Z level=INFO fiber=#315 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:36.254Z level=INFO fiber=#315 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:36.254Z level=INFO fiber=#315 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:36.254Z level=INFO fiber=#315 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:36.254Z level=INFO fiber=#315 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:36.254Z level=INFO fiber=#315 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T21:00:36.254Z level=INFO fiber=#315 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:36.254Z level=INFO fiber=#315 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:36.255Z level=INFO fiber=#315 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:36.259Z level=INFO fiber=#315 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:36.259Z level=INFO fiber=#315 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:36.259Z level=INFO fiber=#315 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:36.259Z level=INFO fiber=#315 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:36.259Z level=INFO fiber=#315 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:36.259Z level=INFO fiber=#315 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:36.259Z level=INFO fiber=#315 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:36.259Z level=INFO fiber=#316 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"

test/domain/protocol-kafka-comprehensive.test.ts:
 8 |  * Assert there is no diagnostics.
 9 |  * @param diagnostics Diagnostics
10 |  */
11 | export function expectDiagnosticEmpty(diagnostics) {
12 |     if (diagnostics.length > 0) {
13 |         fail(`Unexpected diagnostics:\n${formatDiagnostics(diagnostics)}`);
             ^
AssertionError: Unexpected diagnostics:
/test/main.tsp:5:13 - error invalid-argument: Argument of type '#{name: "kafka-prod", url: "kafka://broker1:9092,broker2:9092,broker3:9092", protocol: "kafka", description: "Production Kafka cluster"}' is not assignable to parameter of type 'unknown'
 generatedMessage: false,
     actual: undefined,
   expected: undefined,
   operator: "fail",
       code: "ERR_ASSERTION"

      at expectDiagnosticEmpty (/Users/larsartmann/projects/typespec-asyncapi/node_modules/@typespec/compiler/dist/src/testing/expect.js:13:9)
      at compile (/Users/larsartmann/projects/typespec-asyncapi/node_modules/@typespec/compiler/dist/src/testing/test-host.js:58:5)
      at processTicksAndRejections (native:7:39)
(fail) Kafka Protocol - Comprehensive Domain Tests > Basic Kafka Configuration > should generate Kafka server with bootstrap servers [32.26ms]
62 | 				op publishEvent(): Event;
63 | 			`)
64 | 
65 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
66 | 		expect(spec).toBeDefined()
67 | 		expect(spec?.asyncapi).toBe("3.0.0") // Compilation success
                              ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:67:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Basic Kafka Configuration > should handle Kafka topic with partitions [58.48ms]
89 | 				op consumeMessages(): Message;
90 | 			`)
91 | 
92 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
93 | 		expect(spec).toBeDefined()
94 | 		expect(spec?.asyncapi).toBe("3.0.0")
                              ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:94:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Basic Kafka Configuration > should handle Kafka consumer group configuration [39.76ms]
116 | 				op publishUserEvent(): UserEvent;
117 | 			`)
118 | 
119 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
120 | 		expect(spec).toBeDefined()
121 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:121:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Basic Kafka Configuration > should support Kafka key-based routing [36.96ms]
143 | 				op publishCompressed(): LargeMessage;
144 | 			`)
145 | 
146 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
147 | 		expect(spec).toBeDefined()
148 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:148:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Basic Kafka Configuration > should handle Kafka compression settings [54.93ms]
170 | 				op publishTimedEvent(): TimedEvent;
171 | 			`)
172 | 
173 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
174 | 		expect(spec).toBeDefined()
175 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:175:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Basic Kafka Configuration > should support Kafka retention policies [44.98ms]
197 | 				op publishTransaction(): Transaction;
198 | 			`)
199 | 
200 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
201 | 		expect(spec).toBeDefined()
202 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:202:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Basic Kafka Configuration > should handle Kafka idempotent producers [47.34ms]
224 | 				op publishPayment(): Payment;
225 | 			`)
226 | 
227 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
228 | 		expect(spec).toBeDefined()
229 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:229:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Basic Kafka Configuration > should support Kafka exactly-once semantics [38.13ms]
251 | 				op publishSnapshot(): Snapshot;
252 | 			`)
253 | 
254 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
255 | 		expect(spec).toBeDefined()
256 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:256:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Basic Kafka Configuration > should handle Kafka topic cleanup policies [29.59ms]
279 | 				op publishBatch(): BatchEvent;
280 | 			`)
281 | 
282 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
283 | 		expect(spec).toBeDefined()
284 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:284:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Basic Kafka Configuration > should support Kafka batch configurations [37.54ms]
313 | 				op publishSecure(): SecureMessage;
314 | 			`)
315 | 
316 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
317 | 		expect(spec).toBeDefined()
318 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:318:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Kafka Security & Authentication > should support SASL/SCRAM-SHA-256 authentication [57.82ms]
340 | 				op publish(): Message;
341 | 			`)
342 | 
343 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
344 | 		expect(spec).toBeDefined()
345 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:345:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Kafka Security & Authentication > should support SASL/SCRAM-SHA-512 authentication [69.04ms]
367 | 				op publishMessage(): Msg;
368 | 			`)
369 | 
370 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
371 | 		expect(spec).toBeDefined()
372 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:372:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Kafka Security & Authentication > should support SASL/PLAIN authentication [68.35ms]
394 | 				op publishKerberos(): KerberosMsg;
395 | 			`)
396 | 
397 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
398 | 		expect(spec).toBeDefined()
399 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:399:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Kafka Security & Authentication > should support SASL/GSSAPI (Kerberos) authentication [47.64ms]
421 | 				op publishOAuth(): OAuthMsg;
422 | 			`)
423 | 
424 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
425 | 		expect(spec).toBeDefined()
426 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:426:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Kafka Security & Authentication > should support SASL/OAUTHBEARER authentication [63.22ms]
447 | 				op publishEncrypted(): EncryptedMsg;
448 | 			`)
449 | 
450 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
451 | 		expect(spec).toBeDefined()
452 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:452:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Kafka Security & Authentication > should support SSL/TLS encryption [56.30ms]
474 | 				op publishACL(): ACLMessage;
475 | 			`)
476 | 
477 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
478 | 		expect(spec).toBeDefined()
479 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:479:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Kafka Security & Authentication > should support Kafka ACLs configuration [45.56ms]
501 | 				op publishMTLS(): MutualAuthMsg;
502 | 			`)
503 | 
504 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
505 | 		expect(spec).toBeDefined()
506 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:506:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Kafka Security & Authentication > should support mTLS (mutual TLS) authentication [43.96ms]
529 | 				op publishRegistered(): RegisteredMsg;
530 | 			`)
531 | 
532 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
533 | 		expect(spec).toBeDefined()
534 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:534:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Kafka Security & Authentication > should support Schema Registry authentication [38.38ms]
557 | 				op publishToken(): TokenMsg;
558 | 			`)
559 | 
560 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
561 | 		expect(spec).toBeDefined()
562 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:562:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Kafka Security & Authentication > should support delegation tokens [83.51ms]
591 | 				op publishAvro(): AvroMsg;
592 | 			`)
593 | 
594 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
595 | 		expect(spec).toBeDefined()
596 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:596:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Kafka Message Formats & Serialization > should support Avro serialization [54.01ms]
621 | 				op publishProto(): ProtoMsg;
622 | 			`)
623 | 
624 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
625 | 		expect(spec).toBeDefined()
626 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:626:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Kafka Message Formats & Serialization > should support Protobuf serialization [50.91ms]
651 | 				op publishJSON(): JSONMsg;
652 | 			`)
653 | 
654 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
655 | 		expect(spec).toBeDefined()
656 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:656:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Kafka Message Formats & Serialization > should support JSON serialization [46.93ms]
681 | 				op publishBinary(): BinaryMsg;
682 | 			`)
683 | 
684 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
685 | 		expect(spec).toBeDefined()
686 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:686:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Kafka Message Formats & Serialization > should support binary/raw serialization [49.24ms]
712 | 				op publishHeadered(): HeaderedMsg;
713 | 			`)
714 | 
715 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
716 | 		expect(spec).toBeDefined()
717 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:717:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Kafka Message Formats & Serialization > should support message headers [89.86ms]
745 | 				op publishCloudEvent(): CloudEvent;
746 | 			`)
747 | 
748 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
749 | 		expect(spec).toBeDefined()
750 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:750:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Kafka Message Formats & Serialization > should support CloudEvents format [42.21ms]
776 | 				op publishTimestamped(): TimestampedMsg;
777 | 			`)
778 | 
779 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
780 | 		expect(spec).toBeDefined()
781 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:781:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Kafka Message Formats & Serialization > should support message timestamps [38.26ms]
807 | 				op publishVersioned(): VersionedMsg;
808 | 			`)
809 | 
810 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
811 | 		expect(spec).toBeDefined()
812 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:812:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Kafka Message Formats & Serialization > should support Schema Registry with versioning [119.18ms]
837 | 				op publishCustom(): CustomMsg;
838 | 			`)
839 | 
840 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
841 | 		expect(spec).toBeDefined()
842 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:842:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Kafka Message Formats & Serialization > should support custom serializers [66.03ms]
866 | 				op publishCompressed(): CompressedMsg;
867 | 			`)
868 | 
869 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
870 | 		expect(spec).toBeDefined()
871 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:871:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Kafka Message Formats & Serialization > should support message compression per message [38.66ms]
timestamp=2025-11-18T21:00:37.911Z level=INFO fiber=#317 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:37.912Z level=INFO fiber=#317 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:37.912Z level=INFO fiber=#317 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:37.912Z level=INFO fiber=#317 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:37.912Z level=INFO fiber=#317 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:37.912Z level=INFO fiber=#317 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:37.912Z level=INFO fiber=#317 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:37.913Z level=INFO fiber=#317 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:37.913Z level=INFO fiber=#317 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:37.913Z level=INFO fiber=#317 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:37.913Z level=INFO fiber=#317 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:37.913Z level=INFO fiber=#317 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:37.913Z level=INFO fiber=#317 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:37.913Z level=INFO fiber=#317 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:37.913Z level=INFO fiber=#317 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:37.913Z level=INFO fiber=#317 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:37.914Z level=INFO fiber=#317 message="âœ… Discovery: 2 operations found"
timestamp=2025-11-18T21:00:37.914Z level=INFO fiber=#317 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:37.914Z level=INFO fiber=#317 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:37.914Z level=INFO fiber=#317 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:37.914Z level=INFO fiber=#317 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:37.914Z level=INFO fiber=#317 message="ğŸ”„ Processing 2 operations with Effect.TS..."
timestamp=2025-11-18T21:00:37.914Z level=INFO fiber=#317 message="âœ… Processed 2 operations successfully"
timestamp=2025-11-18T21:00:37.914Z level=INFO fiber=#317 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:37.914Z level=INFO fiber=#317 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:37.914Z level=INFO fiber=#317 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:37.915Z level=INFO fiber=#317 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:37.915Z level=INFO fiber=#317 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 2,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 2
}"
timestamp=2025-11-18T21:00:37.915Z level=INFO fiber=#317 message="âœ… Processing: 2 elements processed"
timestamp=2025-11-18T21:00:37.915Z level=INFO fiber=#317 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:37.915Z level=INFO fiber=#317 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:37.915Z level=INFO fiber=#317 message="âœ… AsyncAPI document validation passed! 2 channels, 0 operations (0.16ms)"
timestamp=2025-11-18T21:00:37.915Z level=INFO fiber=#317 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:37.915Z level=INFO fiber=#317 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:37.916Z level=INFO fiber=#317 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:37.916Z level=INFO fiber=#317 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:37.916Z level=INFO fiber=#317 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:37.916Z level=INFO fiber=#317 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:37.916Z level=INFO fiber=#317 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:37.917Z level=INFO fiber=#317 message="ğŸ‰ TYPESPEC API SUCCESS: 2 channels, 0 operations"
timestamp=2025-11-18T21:00:37.917Z level=INFO fiber=#317 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:37.917Z level=INFO fiber=#317 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:37.917Z level=INFO fiber=#318 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
920 | 				op publishState(): State;
921 | 			`)
922 | 
923 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
924 | 		expect(spec).toBeDefined()
925 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:925:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Kafka Streams & Advanced Patterns > should support compacted topics for state stores [35.67ms]
947 | 				op publishChange(): Change;
948 | 			`)
949 | 
950 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
951 | 		expect(spec).toBeDefined()
952 | 		expect(spec?.asyncapi).toBe("3.0.0")
                               ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:952:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Kafka Streams & Advanced Patterns > should support changelog topics [189.88ms]
timestamp=2025-11-18T21:00:38.203Z level=INFO fiber=#319 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:38.203Z level=INFO fiber=#319 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:38.203Z level=INFO fiber=#319 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:38.203Z level=INFO fiber=#319 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:38.203Z level=INFO fiber=#319 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:38.203Z level=INFO fiber=#319 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:38.203Z level=INFO fiber=#319 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:38.203Z level=INFO fiber=#319 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:38.203Z level=INFO fiber=#319 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:38.203Z level=INFO fiber=#319 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:38.203Z level=INFO fiber=#319 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:38.203Z level=INFO fiber=#319 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:38.203Z level=INFO fiber=#319 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:38.203Z level=INFO fiber=#319 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:38.203Z level=INFO fiber=#319 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:38.203Z level=INFO fiber=#319 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:38.203Z level=INFO fiber=#319 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:38.203Z level=INFO fiber=#319 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:38.203Z level=INFO fiber=#319 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:38.203Z level=INFO fiber=#319 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:38.203Z level=INFO fiber=#319 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:38.203Z level=INFO fiber=#319 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:38.203Z level=INFO fiber=#319 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:38.203Z level=INFO fiber=#319 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:38.203Z level=INFO fiber=#319 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:38.204Z level=INFO fiber=#319 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:38.204Z level=INFO fiber=#319 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:38.204Z level=INFO fiber=#319 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:38.204Z level=INFO fiber=#319 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:38.204Z level=INFO fiber=#319 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:38.204Z level=INFO fiber=#319 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:38.204Z level=INFO fiber=#319 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T21:00:38.204Z level=INFO fiber=#319 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:38.204Z level=INFO fiber=#319 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:38.204Z level=INFO fiber=#319 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.204Z level=INFO fiber=#319 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.204Z level=INFO fiber=#319 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.206Z level=INFO fiber=#319 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.208Z level=INFO fiber=#319 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.208Z level=INFO fiber=#319 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:38.208Z level=INFO fiber=#319 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.208Z level=INFO fiber=#319 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:38.208Z level=INFO fiber=#320 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.321Z level=INFO fiber=#321 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:38.321Z level=INFO fiber=#321 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:38.321Z level=INFO fiber=#321 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:38.321Z level=INFO fiber=#321 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:38.321Z level=INFO fiber=#321 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:38.321Z level=INFO fiber=#321 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:38.321Z level=INFO fiber=#321 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:38.321Z level=INFO fiber=#321 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:38.321Z level=INFO fiber=#321 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:38.322Z level=INFO fiber=#321 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:38.322Z level=INFO fiber=#321 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:38.322Z level=INFO fiber=#321 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:38.322Z level=INFO fiber=#321 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:38.322Z level=INFO fiber=#321 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:38.322Z level=INFO fiber=#321 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:38.322Z level=INFO fiber=#321 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:38.322Z level=INFO fiber=#321 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:38.322Z level=INFO fiber=#321 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:38.322Z level=INFO fiber=#321 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:38.322Z level=INFO fiber=#321 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:38.322Z level=INFO fiber=#321 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:38.322Z level=INFO fiber=#321 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:38.322Z level=INFO fiber=#321 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:38.322Z level=INFO fiber=#321 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:38.322Z level=INFO fiber=#321 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:38.322Z level=INFO fiber=#321 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:38.322Z level=INFO fiber=#321 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:38.322Z level=INFO fiber=#321 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:38.322Z level=INFO fiber=#321 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:38.322Z level=INFO fiber=#321 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:38.322Z level=INFO fiber=#321 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:38.322Z level=INFO fiber=#321 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T21:00:38.322Z level=INFO fiber=#321 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:38.322Z level=INFO fiber=#321 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:38.323Z level=INFO fiber=#321 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.323Z level=INFO fiber=#321 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.323Z level=INFO fiber=#321 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.323Z level=INFO fiber=#321 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.323Z level=INFO fiber=#321 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.323Z level=INFO fiber=#321 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:38.323Z level=INFO fiber=#321 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.323Z level=INFO fiber=#321 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:38.323Z level=INFO fiber=#322 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
1026 | 				op publishDLQ(): FailedMessage;
1027 | 			`)
1028 | 
1029 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1030 | 		expect(spec).toBeDefined()
1031 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:1031:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Kafka Streams & Advanced Patterns > should support dead letter queues [48.56ms]
1054 | 				op publishTransaction(): Transaction;
1055 | 			`)
1056 | 
1057 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1058 | 		expect(spec).toBeDefined()
1059 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:1059:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Kafka Streams & Advanced Patterns > should support exactly-once processing [40.26ms]
1084 | 				op publishConnectorEvent(): ConnectorEvent;
1085 | 			`)
1086 | 
1087 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1088 | 		expect(spec).toBeDefined()
1089 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:1089:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Kafka Streams & Advanced Patterns > should support Kafka Connect integration [39.11ms]
timestamp=2025-11-18T21:00:38.504Z level=INFO fiber=#323 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:38.504Z level=INFO fiber=#323 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:38.504Z level=INFO fiber=#323 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:38.504Z level=INFO fiber=#323 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:38.505Z level=INFO fiber=#323 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:38.505Z level=INFO fiber=#323 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:38.505Z level=INFO fiber=#323 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:38.506Z level=INFO fiber=#323 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:38.506Z level=INFO fiber=#323 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:38.506Z level=INFO fiber=#323 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:38.506Z level=INFO fiber=#323 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:38.506Z level=INFO fiber=#323 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:38.506Z level=INFO fiber=#323 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:38.506Z level=INFO fiber=#323 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:38.506Z level=INFO fiber=#323 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:38.506Z level=INFO fiber=#323 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:38.506Z level=INFO fiber=#323 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:38.506Z level=INFO fiber=#323 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:38.506Z level=INFO fiber=#323 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:38.506Z level=INFO fiber=#323 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:38.506Z level=INFO fiber=#323 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:38.506Z level=INFO fiber=#323 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:38.506Z level=INFO fiber=#323 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:38.506Z level=INFO fiber=#323 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:38.506Z level=INFO fiber=#323 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:38.506Z level=INFO fiber=#323 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:38.506Z level=INFO fiber=#323 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:38.506Z level=INFO fiber=#323 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:38.506Z level=INFO fiber=#323 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:38.506Z level=INFO fiber=#323 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:38.506Z level=INFO fiber=#323 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:38.506Z level=INFO fiber=#323 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T21:00:38.506Z level=INFO fiber=#323 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:38.506Z level=INFO fiber=#323 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:38.507Z level=INFO fiber=#323 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.507Z level=INFO fiber=#323 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.507Z level=INFO fiber=#323 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.507Z level=INFO fiber=#323 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.507Z level=INFO fiber=#323 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.507Z level=INFO fiber=#323 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:38.507Z level=INFO fiber=#323 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.507Z level=INFO fiber=#323 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:38.507Z level=INFO fiber=#324 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.556Z level=INFO fiber=#325 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:38.556Z level=INFO fiber=#325 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:38.556Z level=INFO fiber=#325 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:38.556Z level=INFO fiber=#325 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:38.556Z level=INFO fiber=#325 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:38.556Z level=INFO fiber=#325 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:38.556Z level=INFO fiber=#325 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:38.556Z level=INFO fiber=#325 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:38.556Z level=INFO fiber=#325 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:38.556Z level=INFO fiber=#325 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:38.556Z level=INFO fiber=#325 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:38.556Z level=INFO fiber=#325 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:38.556Z level=INFO fiber=#325 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:38.556Z level=INFO fiber=#325 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:38.556Z level=INFO fiber=#325 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:38.556Z level=INFO fiber=#325 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:38.556Z level=INFO fiber=#325 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:38.556Z level=INFO fiber=#325 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:38.556Z level=INFO fiber=#325 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:38.556Z level=INFO fiber=#325 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:38.556Z level=INFO fiber=#325 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:38.556Z level=INFO fiber=#325 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:38.557Z level=INFO fiber=#325 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:38.557Z level=INFO fiber=#325 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:38.557Z level=INFO fiber=#325 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:38.557Z level=INFO fiber=#325 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:38.557Z level=INFO fiber=#325 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:38.557Z level=INFO fiber=#325 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:38.557Z level=INFO fiber=#325 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:38.557Z level=INFO fiber=#325 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:38.557Z level=INFO fiber=#325 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:38.557Z level=INFO fiber=#325 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.03ms)"
timestamp=2025-11-18T21:00:38.557Z level=INFO fiber=#325 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:38.557Z level=INFO fiber=#325 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:38.557Z level=INFO fiber=#325 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.557Z level=INFO fiber=#325 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.557Z level=INFO fiber=#325 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.557Z level=INFO fiber=#325 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.557Z level=INFO fiber=#325 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.557Z level=INFO fiber=#325 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:38.557Z level=INFO fiber=#325 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.557Z level=INFO fiber=#325 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:38.557Z level=INFO fiber=#326 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.673Z level=INFO fiber=#327 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:38.673Z level=INFO fiber=#327 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:38.673Z level=INFO fiber=#327 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:38.673Z level=INFO fiber=#327 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:38.673Z level=INFO fiber=#327 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:38.673Z level=INFO fiber=#327 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:38.673Z level=INFO fiber=#327 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:38.673Z level=INFO fiber=#327 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:38.673Z level=INFO fiber=#327 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:38.673Z level=INFO fiber=#327 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:38.673Z level=INFO fiber=#327 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:38.673Z level=INFO fiber=#327 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:38.673Z level=INFO fiber=#327 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:38.673Z level=INFO fiber=#327 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:38.673Z level=INFO fiber=#327 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:38.673Z level=INFO fiber=#327 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:38.673Z level=INFO fiber=#327 message="âœ… Discovery: 2 operations found"
timestamp=2025-11-18T21:00:38.673Z level=INFO fiber=#327 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:38.673Z level=INFO fiber=#327 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:38.673Z level=INFO fiber=#327 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:38.673Z level=INFO fiber=#327 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:38.673Z level=INFO fiber=#327 message="ğŸ”„ Processing 2 operations with Effect.TS..."
timestamp=2025-11-18T21:00:38.674Z level=INFO fiber=#327 message="âœ… Processed 2 operations successfully"
timestamp=2025-11-18T21:00:38.674Z level=INFO fiber=#327 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:38.674Z level=INFO fiber=#327 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:38.674Z level=INFO fiber=#327 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:38.674Z level=INFO fiber=#327 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:38.674Z level=INFO fiber=#327 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 2,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 2
}"
timestamp=2025-11-18T21:00:38.674Z level=INFO fiber=#327 message="âœ… Processing: 2 elements processed"
timestamp=2025-11-18T21:00:38.674Z level=INFO fiber=#327 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:38.674Z level=INFO fiber=#327 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:38.674Z level=INFO fiber=#327 message="âœ… AsyncAPI document validation passed! 2 channels, 0 operations (0.09ms)"
timestamp=2025-11-18T21:00:38.674Z level=INFO fiber=#327 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:38.674Z level=INFO fiber=#327 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:38.676Z level=INFO fiber=#327 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.676Z level=INFO fiber=#327 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.676Z level=INFO fiber=#327 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.676Z level=INFO fiber=#327 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.676Z level=INFO fiber=#327 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.676Z level=INFO fiber=#327 message="ğŸ‰ TYPESPEC API SUCCESS: 2 channels, 0 operations"
timestamp=2025-11-18T21:00:38.676Z level=INFO fiber=#327 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.676Z level=INFO fiber=#327 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:38.676Z level=INFO fiber=#328 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:38.738Z level=INFO fiber=#329 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:38.739Z level=INFO fiber=#329 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.739Z level=INFO fiber=#329 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.739Z level=INFO fiber=#329 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.739Z level=INFO fiber=#329 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.739Z level=INFO fiber=#329 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.739Z level=INFO fiber=#329 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:38.739Z level=INFO fiber=#329 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.739Z level=INFO fiber=#329 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:38.739Z level=INFO fiber=#330 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.796Z level=INFO fiber=#331 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:38.796Z level=INFO fiber=#331 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:38.796Z level=INFO fiber=#331 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:38.796Z level=INFO fiber=#331 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:38.796Z level=INFO fiber=#331 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:38.796Z level=INFO fiber=#331 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:38.796Z level=INFO fiber=#331 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:38.796Z level=INFO fiber=#331 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:38.796Z level=INFO fiber=#331 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:38.796Z level=INFO fiber=#331 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:38.796Z level=INFO fiber=#331 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:38.796Z level=INFO fiber=#331 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:38.796Z level=INFO fiber=#331 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:38.796Z level=INFO fiber=#331 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:38.796Z level=INFO fiber=#331 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:38.796Z level=INFO fiber=#331 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:38.796Z level=INFO fiber=#331 message="âœ… Discovery: 2 operations found"
timestamp=2025-11-18T21:00:38.796Z level=INFO fiber=#331 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:38.796Z level=INFO fiber=#331 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:38.796Z level=INFO fiber=#331 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:38.796Z level=INFO fiber=#331 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:38.796Z level=INFO fiber=#331 message="ğŸ”„ Processing 2 operations with Effect.TS..."
timestamp=2025-11-18T21:00:38.796Z level=INFO fiber=#331 message="âœ… Processed 2 operations successfully"
timestamp=2025-11-18T21:00:38.796Z level=INFO fiber=#331 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:38.796Z level=INFO fiber=#331 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:38.796Z level=INFO fiber=#331 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:38.797Z level=INFO fiber=#331 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:38.797Z level=INFO fiber=#331 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 2,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 2
}"
timestamp=2025-11-18T21:00:38.797Z level=INFO fiber=#331 message="âœ… Processing: 2 elements processed"
timestamp=2025-11-18T21:00:38.797Z level=INFO fiber=#331 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:38.797Z level=INFO fiber=#331 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:38.797Z level=INFO fiber=#331 message="âœ… AsyncAPI document validation passed! 2 channels, 0 operations (0.03ms)"
timestamp=2025-11-18T21:00:38.797Z level=INFO fiber=#331 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:38.797Z level=INFO fiber=#331 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:38.798Z level=INFO fiber=#331 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.798Z level=INFO fiber=#331 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.798Z level=INFO fiber=#331 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.798Z level=INFO fiber=#331 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.798Z level=INFO fiber=#331 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.798Z level=INFO fiber=#331 message="ğŸ‰ TYPESPEC API SUCCESS: 2 channels, 0 operations"
timestamp=2025-11-18T21:00:38.798Z level=INFO fiber=#331 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.798Z level=INFO fiber=#331 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:38.798Z level=INFO fiber=#332 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
1255 | 				op publishPriority(): PriorityMessage;
1256 | 			`)
1257 | 
1258 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1259 | 		expect(spec).toBeDefined()
1260 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:1260:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Kafka Streams & Advanced Patterns > should support priority queues [36.96ms]
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.03ms)"
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:38.906Z level=INFO fiber=#333 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:38.907Z level=INFO fiber=#333 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.907Z level=INFO fiber=#333 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.907Z level=INFO fiber=#333 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.907Z level=INFO fiber=#333 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.907Z level=INFO fiber=#333 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.907Z level=INFO fiber=#333 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:38.907Z level=INFO fiber=#333 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.907Z level=INFO fiber=#333 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:38.907Z level=INFO fiber=#334 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.03ms)"
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:38.959Z level=INFO fiber=#335 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:38.961Z level=INFO fiber=#335 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.962Z level=INFO fiber=#335 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.962Z level=INFO fiber=#335 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.962Z level=INFO fiber=#335 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.962Z level=INFO fiber=#335 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.962Z level=INFO fiber=#335 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:38.962Z level=INFO fiber=#335 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:38.962Z level=INFO fiber=#335 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:38.962Z level=INFO fiber=#336 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
1334 | 				op publishRateLimited(): RateLimitedMsg;
1335 | 			`)
1336 | 
1337 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1338 | 		expect(spec).toBeDefined()
1339 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:1339:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Kafka Streams & Advanced Patterns > should support rate limiting [51.08ms]
timestamp=2025-11-18T21:00:39.069Z level=INFO fiber=#337 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:39.069Z level=INFO fiber=#337 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:39.069Z level=INFO fiber=#337 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:39.069Z level=INFO fiber=#337 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:39.069Z level=INFO fiber=#337 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:39.069Z level=INFO fiber=#337 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:39.069Z level=INFO fiber=#337 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:39.069Z level=INFO fiber=#337 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:39.069Z level=INFO fiber=#337 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:39.069Z level=INFO fiber=#337 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:39.069Z level=INFO fiber=#337 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:39.069Z level=INFO fiber=#337 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:39.069Z level=INFO fiber=#337 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:39.069Z level=INFO fiber=#337 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:39.069Z level=INFO fiber=#337 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:39.069Z level=INFO fiber=#337 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:39.070Z level=INFO fiber=#337 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:39.070Z level=INFO fiber=#337 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:39.070Z level=INFO fiber=#337 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:39.070Z level=INFO fiber=#337 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:39.070Z level=INFO fiber=#337 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:39.070Z level=INFO fiber=#337 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:39.070Z level=INFO fiber=#337 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:39.070Z level=INFO fiber=#337 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:39.070Z level=INFO fiber=#337 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:39.070Z level=INFO fiber=#337 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:39.070Z level=INFO fiber=#337 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:39.070Z level=INFO fiber=#337 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:39.070Z level=INFO fiber=#337 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:39.070Z level=INFO fiber=#337 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:39.070Z level=INFO fiber=#337 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:39.070Z level=INFO fiber=#337 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T21:00:39.070Z level=INFO fiber=#337 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:39.070Z level=INFO fiber=#337 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:39.070Z level=INFO fiber=#337 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:39.070Z level=INFO fiber=#337 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:39.070Z level=INFO fiber=#337 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:39.070Z level=INFO fiber=#337 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:39.070Z level=INFO fiber=#337 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:39.070Z level=INFO fiber=#337 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:39.070Z level=INFO fiber=#337 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:39.070Z level=INFO fiber=#337 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:39.070Z level=INFO fiber=#338 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
timestamp=2025-11-18T21:00:39.119Z level=INFO fiber=#339 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:39.120Z level=INFO fiber=#339 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:39.120Z level=INFO fiber=#339 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:39.120Z level=INFO fiber=#339 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:39.120Z level=INFO fiber=#339 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:39.120Z level=INFO fiber=#339 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:39.120Z level=INFO fiber=#339 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:39.120Z level=INFO fiber=#339 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:39.120Z level=INFO fiber=#339 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:39.120Z level=INFO fiber=#339 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:39.120Z level=INFO fiber=#339 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:39.122Z level=INFO fiber=#339 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:39.122Z level=INFO fiber=#339 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:39.122Z level=INFO fiber=#339 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:39.122Z level=INFO fiber=#339 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:39.123Z level=INFO fiber=#339 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:39.123Z level=INFO fiber=#339 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:39.123Z level=INFO fiber=#339 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:39.123Z level=INFO fiber=#339 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:39.123Z level=INFO fiber=#339 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:39.123Z level=INFO fiber=#339 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:39.123Z level=INFO fiber=#339 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:39.123Z level=INFO fiber=#339 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:39.123Z level=INFO fiber=#339 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:39.123Z level=INFO fiber=#339 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:39.123Z level=INFO fiber=#339 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:39.123Z level=INFO fiber=#339 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:39.123Z level=INFO fiber=#339 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:39.123Z level=INFO fiber=#339 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:39.123Z level=INFO fiber=#339 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:39.123Z level=INFO fiber=#339 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:39.123Z level=INFO fiber=#339 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.06ms)"
timestamp=2025-11-18T21:00:39.123Z level=INFO fiber=#339 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:39.123Z level=INFO fiber=#339 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:39.124Z level=INFO fiber=#339 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:39.124Z level=INFO fiber=#339 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:39.125Z level=INFO fiber=#339 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:39.125Z level=INFO fiber=#339 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:39.125Z level=INFO fiber=#339 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:39.125Z level=INFO fiber=#339 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:39.125Z level=INFO fiber=#339 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:39.125Z level=INFO fiber=#339 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:39.125Z level=INFO fiber=#340 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
1415 | 				op publishReplicated(): ReplicatedMsg;
1416 | 			`)
1417 | 
1418 | 			const spec = await compileAndGetAsyncAPI(host, "./main.tsp")
1419 | 		expect(spec).toBeDefined()
1420 | 		expect(spec?.asyncapi).toBe("3.0.0")
                                ^
error: expect(received).toBe(expected)

Expected: "3.0.0"
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/domain/protocol-kafka-comprehensive.test.ts:1420:26)
(fail) Kafka Protocol - Comprehensive Domain Tests > Kafka Streams & Advanced Patterns > should support multi-region replication [39.88ms]

test/validation/critical-validation.test.ts:
timestamp=2025-11-18T21:00:39.176Z level=INFO fiber=#341 message="ğŸ”§ Initializing AsyncAPI 3.0.0 Validator..." message={}
timestamp=2025-11-18T21:00:39.178Z level=INFO fiber=#342 message="ğŸ”§ Initializing AsyncAPI 3.0.0 Validator with REAL @asyncapi/parser..." message={}
timestamp=2025-11-18T21:00:39.178Z level=INFO fiber=#342 message="âœ… AsyncAPI 3.0.0 Validator initialized successfully"

test/validation/security-validation.test.ts:
4 | describe("Security Validation", () => {
5 |   test("schema prevents arbitrary properties (security vulnerability fix)", () => {
6 |     // This test ensures our fix for the security vulnerability works
7 |     expect(ASYNC_API_EMITTER_OPTIONS_SCHEMA.additionalProperties).toBe(false);
8 |     expect(ASYNC_API_EMITTER_OPTIONS_SCHEMA.type).toBe("object");
9 |     expect(ASYNC_API_EMITTER_OPTIONS_SCHEMA.properties).toBeDefined();
                                                            ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/security-validation.test.ts:9:57)
(fail) Security Validation > schema prevents arbitrary properties (security vulnerability fix) [0.07ms]
23 |       "security-schemes",
24 |       "versioning"
25 |     ];
26 | 
27 |     for (const prop of expectedProperties) {
28 |       expect(ASYNC_API_EMITTER_OPTIONS_SCHEMA.properties[prop]).toBeDefined();
                                                   ^
TypeError: undefined is not an object (evaluating 'ASYNC_API_EMITTER_OPTIONS_SCHEMA.properties[prop]')
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/security-validation.test.ts:28:47)
(fail) Security Validation > schema validates all expected AsyncAPI emitter options [0.22ms]
29 |       expect(ASYNC_API_EMITTER_OPTIONS_SCHEMA.properties[prop].nullable).toBe(true);
30 |     }
31 |   });
32 | 
33 |   test("file-type enum is properly constrained", () => {
34 |     const fileTypeSchema = ASYNC_API_EMITTER_OPTIONS_SCHEMA.properties["file-type"];
                                                                 ^
TypeError: undefined is not an object (evaluating 'ASYNC_API_EMITTER_OPTIONS_SCHEMA.properties["file-type"]')
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/security-validation.test.ts:34:61)
(fail) Security Validation > file-type enum is properly constrained [0.07ms]
34 |     const fileTypeSchema = ASYNC_API_EMITTER_OPTIONS_SCHEMA.properties["file-type"];
35 |     expect(fileTypeSchema.enum).toEqual(["yaml", "json"]);
36 |   });
37 | 
38 |   test("asyncapi-version enum is properly constrained", () => {
39 |     const versionSchema = ASYNC_API_EMITTER_OPTIONS_SCHEMA.properties["asyncapi-version"];
                                                                ^
TypeError: undefined is not an object (evaluating 'ASYNC_API_EMITTER_OPTIONS_SCHEMA.properties["asyncapi-version"]')
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/security-validation.test.ts:39:60)
(fail) Security Validation > asyncapi-version enum is properly constrained [0.06ms]
39 |     const versionSchema = ASYNC_API_EMITTER_OPTIONS_SCHEMA.properties["asyncapi-version"];
40 |     expect(versionSchema.enum).toEqual(["3.0.0"]);
41 |   });
42 | 
43 |   test("protocol-bindings enum is properly constrained", () => {
44 |     const bindingsSchema = ASYNC_API_EMITTER_OPTIONS_SCHEMA.properties["protocol-bindings"];
                                                                 ^
TypeError: undefined is not an object (evaluating 'ASYNC_API_EMITTER_OPTIONS_SCHEMA.properties["protocol-bindings"]')
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/security-validation.test.ts:44:61)
(fail) Security Validation > protocol-bindings enum is properly constrained [0.06ms]
48 |       expect(bindingsSchema.uniqueItems).toBe(true);
49 |     }
50 |   });
51 | 
52 |   test("versioning sub-object prevents arbitrary properties", () => {
53 |     const versioningSchema = ASYNC_API_EMITTER_OPTIONS_SCHEMA.properties["versioning"];
                                                                   ^
TypeError: undefined is not an object (evaluating 'ASYNC_API_EMITTER_OPTIONS_SCHEMA.properties.versioning')
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/security-validation.test.ts:53:63)
(fail) Security Validation > versioning sub-object prevents arbitrary properties [9.51ms]
64 | 
65 |   test("CRITICAL: no {} as any security hole exists", () => {
66 |     // This is the core security test - ensure we eliminated the vulnerability
67 |     const schemaString = JSON.stringify(ASYNC_API_EMITTER_OPTIONS_SCHEMA);
68 |     expect(schemaString).not.toContain("as any");
69 |     expect(schemaString).not.toContain("{}");
                                  ^
error: expect(received).not.toContain(expected)

Expected to not contain: "{}"
Received: "{\"$schema\":\"http://json-schema.org/draft-07/schema#\",\"$ref\":\"#/$defs/AsyncAPIEmitterOptions\",\"$defs\":{\"AsyncAPIEmitterOptions\":{\"type\":\"object\",\"required\":[],\"properties\":{\"output-file\":{\"type\":\"string\",\"description\":\"Output file name\"},\"file-type\":{\"enum\":[\"yaml\",\"json\"],\"description\":\"Output file type. Default: 'yaml'\"},\"asyncapi-version\":{\"enum\":[\"3.0.0\"],\"description\":\"AsyncAPI version to target. Default: '3.0.0'\"},\"omit-unreachable-types\":{\"type\":\"boolean\",\"description\":\"Whether to omit unreachable message types. Default: false\"},\"include-source-info\":{\"type\":\"boolean\",\"description\":\"Whether to include TypeSpec source information in comments. Default: false\"},\"default-servers\":{\"type\":\"object\",\"required\":[],\"properties\":{},\"patternProperties\":{\"\":{\"type\":\"object\",\"required\":[\"host\",\"protocol\"],\"properties\":{\"host\":{\"type\":\"string\"},\"protocol\":{\"type\":\"string\"},\"description\":{\"type\":\"string\"},\"variables\":{\"type\":\"object\",\"required\":[],\"properties\":{},\"patternProperties\":{\"\":{\"$ref\":\"#/$defs/VariableConfig\"}}},\"security\":{\"type\":\"array\",\"items\":{\"type\":\"string\"}},\"bindings\":{\"type\":\"object\",\"required\":[],\"properties\":{},\"patternProperties\":{\"\":{\"$id\":\"/schemas/unknown\",\"title\":\"unknown\"}}}},\"additionalProperties\":false}},\"description\":\"Custom servers to include in the output\"},\"validate-spec\":{\"type\":\"boolean\",\"description\":\"Whether to validate generated AsyncAPI spec. Default: true\"},\"additional-properties\":{\"type\":\"object\",\"required\":[],\"properties\":{},\"patternProperties\":{\"\":{\"$id\":\"/schemas/unknown\",\"title\":\"unknown\"}},\"description\":\"Additional schema properties to include\"},\"protocol-bindings\":{\"type\":\"array\",\"items\":{\"enum\":[\"kafka\",\"amqp\",\"websocket\",\"http\"]},\"description\":\"Protocol bindings to include\"},\"security-schemes\":{\"type\":\"object\",\"required\":[],\"properties\":{},\"patternProperties\":{\"\":{\"$ref\":\"#/$defs/SecuritySchemeConfig\"}},\"description\":\"Security schemes configuration\"},\"versioning\":{\"type\":\"object\",\"required\":[],\"properties\":{\"separate-files\":{\"type\":\"boolean\"},\"file-naming\":{\"enum\":[\"suffix\",\"directory\",\"prefix\"]},\"include-version-info\":{\"type\":\"boolean\"},\"version-mappings\":{\"type\":\"object\",\"required\":[],\"properties\":{},\"patternProperties\":{\"\":{\"type\":\"string\"}}},\"validate-version-compatibility\":{\"type\":\"boolean\"}},\"additionalProperties\":false,\"description\":\"Versioning configuration\"}},\"additionalProperties\":false,\"description\":\"Complete AsyncAPI emitter configuration options with validation\"},\"VariableConfig\":{\"type\":\"object\",\"required\":[],\"properties\":{\"description\":{\"type\":\"string\",\"description\":\"Variable description (max 500 chars)\",\"maxLength\":500},\"default\":{\"type\":\"string\",\"description\":\"Default value (max 100 chars)\",\"maxLength\":100},\"enum\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Allowed values (max 50 items)\"},\"examples\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Example values (max 10 items)\"}},\"additionalProperties\":false,\"description\":\"Server variable configuration with validation constraints\"},\"SecuritySchemeConfig\":{\"type\":\"object\",\"required\":[\"type\"],\"properties\":{\"type\":{\"enum\":[\"oauth2\",\"apiKey\",\"httpApiKey\",\"http\",\"plain\",\"scram-sha-256\",\"scram-sha-512\",\"gssapi\"],\"description\":\"Security scheme type - determines available fields\"},\"description\":{\"type\":\"string\",\"description\":\"Human-readable security scheme description\",\"maxLength\":1000},\"name\":{\"type\":\"string\",\"description\":\"Security parameter name (for apiKey schemes)\",\"pattern\":\"^[a-zA-Z0-9._-]+$\",\"maxLength\":50},\"in\":{\"enum\":[\"user\",\"password\",\"query\",\"header\",\"cookie\"],\"description\":\"Location of security parameter\"},\"scheme\":{\"type\":\"string\",\"description\":\"HTTP authentication scheme (for http type)\",\"pattern\":\"^[a-zA-Z0-9]+$\",\"maxLength\":20},\"bearerFormat\":{\"type\":\"string\",\"description\":\"Bearer token format hint (e.g., 'JWT')\",\"maxLength\":50},\"flows\":{\"type\":\"object\",\"required\":[],\"properties\":{\"implicit\":{\"$ref\":\"#/$defs/OAuthFlowConfig\"},\"password\":{\"$ref\":\"#/$defs/OAuthFlowConfig\"},\"clientCredentials\":{\"$ref\":\"#/$defs/OAuthFlowConfig\"},\"authorizationCode\":{\"$ref\":\"#/$defs/OAuthFlowConfig\"}},\"additionalProperties\":false}},\"additionalProperties\":false,\"description\":\"Security scheme configuration\"},\"OAuthFlowConfig\":{\"type\":\"object\",\"required\":[],\"properties\":{\"authorizationUrl\":{\"type\":\"string\",\"description\":\"OAuth authorization endpoint URL\",\"pattern\":\"^https?:\\\\/\\\\/.+\"},\"tokenUrl\":{\"type\":\"string\",\"description\":\"OAuth token endpoint URL\",\"pattern\":\"^https?:\\\\/\\\\/.+\"},\"refreshUrl\":{\"type\":\"string\",\"description\":\"OAuth refresh token endpoint URL\",\"pattern\":\"^https?:\\\\/\\\\/.+\"},\"availableScopes\":{\"type\":\"object\",\"required\":[],\"properties\":{},\"patternProperties\":{\"\":{\"type\":\"string\",\"description\":\"Human-readable scope description\",\"maxLength\":200}},\"propertyNames\":{\"type\":\"string\",\"description\":\"a string at most 100 character(s) long\",\"pattern\":\"^[a-zA-Z0-9._:-]+$\",\"maxLength\":100},\"description\":\"Available OAuth scopes (max 50)\"}},\"additionalProperties\":false,\"description\":\"OAuth flow configuration with URL validation and scope limits\"}},\"type\":\"object\",\"additionalProperties\":false}"

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/security-validation.test.ts:69:30)
(fail) Security Validation > CRITICAL: no {} as any security hole exists [0.31ms]

test/validation/end-to-end-validation.test.ts:
timestamp=2025-11-18T21:00:44.401Z level=INFO fiber=#392 message="ğŸ”§ Initializing AsyncAPI 3.0.0 Validator with REAL @asyncapi/parser..." message={}
timestamp=2025-11-18T21:00:44.401Z level=INFO fiber=#392 message="âœ… AsyncAPI 3.0.0 Validator initialized successfully"
ğŸš€ compileAsyncAPISpecRaw called with source length: 3428
timestamp=2025-11-18T21:00:44.432Z level=INFO fiber=#393 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:44.432Z level=INFO fiber=#393 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="âœ… Discovery: 5 operations found"
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="ğŸ”„ Processing 5 operations with Effect.TS..."
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="âœ… Processed 5 operations successfully"
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 5,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 5
}"
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="âœ… Processing: 5 elements processed"
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="âœ… AsyncAPI document validation passed! 5 channels, 0 operations (0.05ms)"
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:44.433Z level=INFO fiber=#393 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:44.435Z level=INFO fiber=#393 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.435Z level=INFO fiber=#393 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.435Z level=INFO fiber=#393 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.435Z level=INFO fiber=#393 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.435Z level=INFO fiber=#393 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.435Z level=INFO fiber=#393 message="ğŸ‰ TYPESPEC API SUCCESS: 5 channels, 0 operations"
timestamp=2025-11-18T21:00:44.435Z level=INFO fiber=#393 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.435Z level=INFO fiber=#393 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:44.436Z level=INFO fiber=#394 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
151 | 			const compilationResult = await compileAsyncAPISpec(typeSpecSource, {
152 | 				"file-type": "json",
153 | 				"output-file": "comprehensive-api",
154 | 			})
155 | 
156 | 			expect(compilationResult.diagnostics).toBeDefined()
                                               ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/end-to-end-validation.test.ts:156:42)
(fail) End-to-End AsyncAPI Validation Pipeline > TypeSpec â†’ AsyncAPI â†’ Validation Pipeline > should generate and validate a complete event-driven API specification [62.31ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 363
timestamp=2025-11-18T21:00:44.517Z level=INFO fiber=#395 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:44.517Z level=INFO fiber=#395 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:44.517Z level=INFO fiber=#395 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:44.517Z level=INFO fiber=#395 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:44.517Z level=INFO fiber=#395 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:44.517Z level=INFO fiber=#395 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:44.517Z level=INFO fiber=#395 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:44.518Z level=INFO fiber=#395 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:44.518Z level=INFO fiber=#395 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:44.518Z level=INFO fiber=#395 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:44.518Z level=INFO fiber=#395 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:44.518Z level=INFO fiber=#395 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:44.518Z level=INFO fiber=#395 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:44.518Z level=INFO fiber=#395 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:44.518Z level=INFO fiber=#395 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:44.518Z level=INFO fiber=#395 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:44.518Z level=INFO fiber=#395 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:44.518Z level=INFO fiber=#395 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:44.518Z level=INFO fiber=#395 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:44.518Z level=INFO fiber=#395 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:44.518Z level=INFO fiber=#395 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:44.518Z level=INFO fiber=#395 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:44.518Z level=INFO fiber=#395 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:44.518Z level=INFO fiber=#395 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:44.518Z level=INFO fiber=#395 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:44.518Z level=INFO fiber=#395 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:44.518Z level=INFO fiber=#395 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:44.518Z level=INFO fiber=#395 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:44.518Z level=INFO fiber=#395 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:44.518Z level=INFO fiber=#395 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:44.518Z level=INFO fiber=#395 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:44.518Z level=INFO fiber=#395 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.05ms)"
timestamp=2025-11-18T21:00:44.518Z level=INFO fiber=#395 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:44.518Z level=INFO fiber=#395 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:44.519Z level=INFO fiber=#395 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.519Z level=INFO fiber=#395 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.519Z level=INFO fiber=#395 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.519Z level=INFO fiber=#395 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.519Z level=INFO fiber=#395 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.519Z level=INFO fiber=#395 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:44.519Z level=INFO fiber=#395 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.519Z level=INFO fiber=#395 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:44.519Z level=INFO fiber=#396 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
ğŸš€ compileAsyncAPISpecRaw called with source length: 501
557 | 	content: string
558 | }>, filename: string): Promise<AsyncAPIObject | string> {
559 | 	//TODO: refactor to use Effect.TS!
560 | 
561 | 	// ğŸ”¥ CRITICAL: Added debug logging at entry
562 | 	console.log(`ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: ${outputFiles.size}, looking for: ${filename}`)
                                                                           ^
TypeError: undefined is not an object (evaluating 'outputFiles.size')
      at parseAsyncAPIOutput (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:562:70)
      at parseAsyncAPIOutput (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:1002:16)
      at /Users/larsartmann/projects/typespec-asyncapi/test/validation/end-to-end-validation.test.ts:327:10
      at processTicksAndRejections (unknown:7:39)
(fail) End-to-End AsyncAPI Validation Pipeline > TypeSpec â†’ AsyncAPI â†’ Validation Pipeline > should validate AsyncAPI files generated to disk [1.57ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 494
timestamp=2025-11-18T21:00:44.624Z level=INFO fiber=#400 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:44.624Z level=INFO fiber=#400 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:44.624Z level=INFO fiber=#400 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:44.624Z level=INFO fiber=#400 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:44.624Z level=INFO fiber=#400 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:44.625Z level=INFO fiber=#400 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:44.625Z level=INFO fiber=#400 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:44.625Z level=INFO fiber=#400 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:44.625Z level=INFO fiber=#400 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:44.625Z level=INFO fiber=#400 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:44.625Z level=INFO fiber=#400 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:44.625Z level=INFO fiber=#400 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:44.625Z level=INFO fiber=#400 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:44.625Z level=INFO fiber=#400 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:44.625Z level=INFO fiber=#400 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:44.625Z level=INFO fiber=#400 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:44.625Z level=INFO fiber=#400 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:44.625Z level=INFO fiber=#400 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:44.625Z level=INFO fiber=#400 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:44.625Z level=INFO fiber=#400 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:44.625Z level=INFO fiber=#400 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:44.625Z level=INFO fiber=#400 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:44.625Z level=INFO fiber=#400 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:44.625Z level=INFO fiber=#400 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:44.625Z level=INFO fiber=#400 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:44.625Z level=INFO fiber=#400 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:44.625Z level=INFO fiber=#400 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:44.625Z level=INFO fiber=#400 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:44.625Z level=INFO fiber=#400 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:44.625Z level=INFO fiber=#400 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:44.625Z level=INFO fiber=#400 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:44.625Z level=INFO fiber=#400 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T21:00:44.625Z level=INFO fiber=#400 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:44.625Z level=INFO fiber=#400 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:44.626Z level=INFO fiber=#400 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.626Z level=INFO fiber=#400 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.626Z level=INFO fiber=#400 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.626Z level=INFO fiber=#400 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.626Z level=INFO fiber=#400 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.626Z level=INFO fiber=#400 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:44.626Z level=INFO fiber=#400 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.626Z level=INFO fiber=#400 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:44.626Z level=INFO fiber=#401 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.640Z level=INFO fiber=#402 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:44.640Z level=INFO fiber=#402 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:44.640Z level=INFO fiber=#402 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:44.640Z level=INFO fiber=#402 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:44.640Z level=INFO fiber=#402 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:44.640Z level=INFO fiber=#402 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:44.640Z level=INFO fiber=#402 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:44.640Z level=INFO fiber=#402 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:44.640Z level=INFO fiber=#402 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:44.640Z level=INFO fiber=#402 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:44.640Z level=INFO fiber=#402 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:44.640Z level=INFO fiber=#402 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:44.640Z level=INFO fiber=#402 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:44.640Z level=INFO fiber=#402 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:44.640Z level=INFO fiber=#402 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:44.640Z level=INFO fiber=#402 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:44.640Z level=INFO fiber=#402 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:44.640Z level=INFO fiber=#402 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:44.640Z level=INFO fiber=#402 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:44.640Z level=INFO fiber=#402 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:44.640Z level=INFO fiber=#402 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:44.641Z level=INFO fiber=#402 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:44.642Z level=INFO fiber=#402 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:44.642Z level=INFO fiber=#402 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:44.642Z level=INFO fiber=#402 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:44.642Z level=INFO fiber=#402 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:44.642Z level=INFO fiber=#402 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:44.642Z level=INFO fiber=#402 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:44.642Z level=INFO fiber=#402 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:44.642Z level=INFO fiber=#402 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:44.642Z level=INFO fiber=#402 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:44.642Z level=INFO fiber=#402 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T21:00:44.642Z level=INFO fiber=#402 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:44.642Z level=INFO fiber=#402 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:44.643Z level=INFO fiber=#402 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.643Z level=INFO fiber=#402 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.643Z level=INFO fiber=#402 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.643Z level=INFO fiber=#402 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.643Z level=INFO fiber=#402 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.643Z level=INFO fiber=#402 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:44.643Z level=INFO fiber=#402 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.643Z level=INFO fiber=#402 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:44.643Z level=INFO fiber=#403 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
328 | 				"file-type": "yaml",
329 | 				"output-file": "yaml-validation-test",
330 | 			})
331 | 
332 | 			// Get YAML content
333 | 			const yamlContent = compilationResult.outputFiles.get("test-output/yaml-validation-test.yaml")?.content ||
                                               ^
TypeError: undefined is not an object (evaluating 'compilationResult.outputFiles.get')
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/end-to-end-validation.test.ts:333:42)
(fail) End-to-End AsyncAPI Validation Pipeline > TypeSpec â†’ AsyncAPI â†’ Validation Pipeline > should validate YAML output from TypeSpec compilation [107.82ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 2232
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
557 | 	content: string
558 | }>, filename: string): Promise<AsyncAPIObject | string> {
559 | 	//TODO: refactor to use Effect.TS!
560 | 
561 | 	// ğŸ”¥ CRITICAL: Added debug logging at entry
562 | 	console.log(`ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: ${outputFiles.size}, looking for: ${filename}`)
                                                                           ^
TypeError: undefined is not an object (evaluating 'outputFiles.size')
      at parseAsyncAPIOutput (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:562:70)
      at parseAsyncAPIOutput (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:556:43)
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/end-to-end-validation.test.ts:289:24)
(fail) End-to-End AsyncAPI Validation Pipeline > Real-World AsyncAPI Validation Scenarios > should validate microservices event architecture [0.82ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 2179
timestamp=2025-11-18T21:00:44.657Z level=INFO fiber=#404 message="ğŸ”§ Initializing AsyncAPI 3.0.0 Validator with REAL @asyncapi/parser..." message={}
timestamp=2025-11-18T21:00:44.657Z level=INFO fiber=#404 message="âœ… AsyncAPI 3.0.0 Validator initialized successfully"

# Unhandled error between tests
-------------------------------
295 | 			// Validate the file using file validation
296 | 			const fileValidator = new AsyncAPIValidator({strict: false})
297 | 			fileValidator.initialize()
298 | 			const fileValidationResult = await fileValidator.validateFile(filePath)
299 | 
300 | 			expect(fileValidationResult.valid).toBe(true)
                                            ^
error: expect(received).toBe(expected)

Expected: true
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/end-to-end-validation.test.ts:300:39)
-------------------------------

timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="âœ… Discovery: 5 operations found"
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="ğŸ”„ Processing 5 operations with Effect.TS..."
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="âœ… Processed 5 operations successfully"
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 5,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 5
}"
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="âœ… Processing: 5 elements processed"
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:44.737Z level=INFO fiber=#408 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:44.738Z level=INFO fiber=#408 message="âœ… AsyncAPI document validation passed! 5 channels, 0 operations (0.05ms)"
timestamp=2025-11-18T21:00:44.738Z level=INFO fiber=#408 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:44.738Z level=INFO fiber=#408 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:44.740Z level=INFO fiber=#408 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.740Z level=INFO fiber=#408 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.740Z level=INFO fiber=#408 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.740Z level=INFO fiber=#408 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.740Z level=INFO fiber=#408 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.740Z level=INFO fiber=#408 message="ğŸ‰ TYPESPEC API SUCCESS: 5 channels, 0 operations"
timestamp=2025-11-18T21:00:44.740Z level=INFO fiber=#408 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.740Z level=INFO fiber=#408 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:44.740Z level=INFO fiber=#409 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
timestamp=2025-11-18T21:00:44.774Z level=INFO fiber=#410 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:44.774Z level=INFO fiber=#410 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:44.774Z level=INFO fiber=#410 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:44.774Z level=INFO fiber=#410 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:44.774Z level=INFO fiber=#410 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:44.774Z level=INFO fiber=#410 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:44.774Z level=INFO fiber=#410 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:44.774Z level=INFO fiber=#410 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:44.774Z level=INFO fiber=#410 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:44.774Z level=INFO fiber=#410 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:44.774Z level=INFO fiber=#410 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:44.774Z level=INFO fiber=#410 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:44.774Z level=INFO fiber=#410 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:44.774Z level=INFO fiber=#410 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:44.774Z level=INFO fiber=#410 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:44.774Z level=INFO fiber=#410 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:44.774Z level=INFO fiber=#410 message="âœ… Discovery: 7 operations found"
timestamp=2025-11-18T21:00:44.774Z level=INFO fiber=#410 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:44.774Z level=INFO fiber=#410 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:44.774Z level=INFO fiber=#410 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:44.774Z level=INFO fiber=#410 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:44.779Z level=INFO fiber=#410 message="ğŸ”„ Processing 7 operations with Effect.TS..."
timestamp=2025-11-18T21:00:44.779Z level=INFO fiber=#410 message="âœ… Processed 7 operations successfully"
timestamp=2025-11-18T21:00:44.779Z level=INFO fiber=#410 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:44.779Z level=INFO fiber=#410 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:44.779Z level=INFO fiber=#410 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:44.779Z level=INFO fiber=#410 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:44.779Z level=INFO fiber=#410 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 7,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 7
}"
timestamp=2025-11-18T21:00:44.779Z level=INFO fiber=#410 message="âœ… Processing: 7 elements processed"
timestamp=2025-11-18T21:00:44.779Z level=INFO fiber=#410 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:44.779Z level=INFO fiber=#410 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:44.780Z level=INFO fiber=#410 message="âœ… AsyncAPI document validation passed! 7 channels, 0 operations (0.09ms)"
timestamp=2025-11-18T21:00:44.780Z level=INFO fiber=#410 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:44.780Z level=INFO fiber=#410 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:44.782Z level=INFO fiber=#410 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.782Z level=INFO fiber=#410 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.782Z level=INFO fiber=#410 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.782Z level=INFO fiber=#410 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.782Z level=INFO fiber=#410 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.782Z level=INFO fiber=#410 message="ğŸ‰ TYPESPEC API SUCCESS: 7 channels, 0 operations"
timestamp=2025-11-18T21:00:44.782Z level=INFO fiber=#410 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:44.782Z level=INFO fiber=#410 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:44.782Z level=INFO fiber=#411 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
521 | 			})
522 | 
523 | 			const asyncApiDoc = parseAsyncAPIOutput(compilationResult.outputFiles, "iot-sensor-api.json")
524 | 			const validationResult = await validator.validate(asyncApiDoc)
525 | 
526 | 			expect(validationResult.valid).toBe(true)
                                        ^
error: expect(received).toBe(expected)

Expected: true
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/end-to-end-validation.test.ts:526:35)
(fail) End-to-End AsyncAPI Validation Pipeline > Real-World AsyncAPI Validation Scenarios > should validate IoT sensor data streaming API [138.47ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 148
557 | 	content: string
558 | }>, filename: string): Promise<AsyncAPIObject | string> {
559 | 	//TODO: refactor to use Effect.TS!
560 | 
561 | 	// ğŸ”¥ CRITICAL: Added debug logging at entry
562 | 	console.log(`ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: ${outputFiles.size}, looking for: ${filename}`)
                                                                           ^
TypeError: undefined is not an object (evaluating 'outputFiles.size')
      at parseAsyncAPIOutput (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:562:70)
      at parseAsyncAPIOutput (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:556:43)
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/end-to-end-validation.test.ts:523:24)
(fail) End-to-End AsyncAPI Validation Pipeline > Validation Performance in Real Pipeline > should validate multiple generated APIs efficiently [1.39ms]
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"

# Unhandled error between tests
-------------------------------
431 | 			})
432 | 
433 | 			const asyncApiDoc = parseAsyncAPIOutput(compilationResult.outputFiles, "microservices-api.json")
434 | 			const validationResult = await validator.validate(asyncApiDoc)
435 | 
436 | 			expect(validationResult.valid).toBe(true)
                                        ^
error: expect(received).toBe(expected)

Expected: true
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/end-to-end-validation.test.ts:436:35)
-------------------------------


# Unhandled error between tests
-------------------------------
557 | 	content: string
558 | }>, filename: string): Promise<AsyncAPIObject | string> {
559 | 	//TODO: refactor to use Effect.TS!
560 | 
561 | 	// ğŸ”¥ CRITICAL: Added debug logging at entry
562 | 	console.log(`ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: ${outputFiles.size}, looking for: ${filename}`)
                                                                           ^
TypeError: undefined is not an object (evaluating 'outputFiles.size')
      at parseAsyncAPIOutput (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:562:70)
      at parseAsyncAPIOutput (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:556:43)
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/end-to-end-validation.test.ts:433:24)
-------------------------------


test/validation/asyncapi-spec-validation.test.ts:

# Unhandled error between tests
-------------------------------
1 | })
2 | {
    ^
SyntaxError: Export named 'validateAsyncAPIObject' not found in module '/Users/larsartmann/projects/typespec-asyncapi/src/domain/validation/asyncapi-validator.ts'.
      at loadAndEvaluateModule (2:1)
-------------------------------


test/validation/all-generated-specs-validation.test.ts:
timestamp=2025-11-18T21:00:44.825Z level=INFO fiber=#418 message="ğŸ”§ Initializing AsyncAPI 3.0.0 Validator with REAL @asyncapi/parser..." message={}
timestamp=2025-11-18T21:00:44.825Z level=INFO fiber=#418 message="âœ… AsyncAPI 3.0.0 Validator initialized successfully"
508 |           const channelCount = getChannelCount(result.value)
509 |           const operationCount = getOperationCount(result.value)
510 |           Effect.log(`  ğŸ“Š ${channelCount} channels, ${operationCount} operations`);
511 | 
512 |           // Performance requirement check (adjusted for real AsyncAPI parser)
513 |           expect(result.metrics.duration).toBeLessThan(250); // <250ms requirement
                                                ^
error: expect(received).toBeLessThan(expected)

Expected: < 250
Received: 354.19162500000675

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/all-generated-specs-validation.test.ts:513:43)
(fail) ğŸš¨ ALL GENERATED ASYNCAPI SPECS VALIDATION > ğŸ” Spec Discovery and Validation Pipeline > should validate ALL discovered AsyncAPI specifications [356.78ms]
591 |         JSON.stringify(wrongVersionSpec.content, null, 2)
592 |       );
593 | 
594 |       const result = await validator.validateFile(wrongVersionSpec.filePath);
595 | 
596 |       expect(result.valid).toBe(false);
                                 ^
error: expect(received).toBe(expected)

Expected: false
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/all-generated-specs-validation.test.ts:596:28)
(fail) ğŸš¨ ALL GENERATED ASYNCAPI SPECS VALIDATION > ğŸ”’ Validation Requirements Enforcement > should enforce strict AsyncAPI 3.0.0 compliance [307.19ms]
632 |         const filePath = join(testOutputDir, testSpec.name);
633 |         await writeFile(filePath, JSON.stringify(testSpec.content, null, 2));
634 | 
635 |         const result = await validator.validateFile(filePath);
636 | 
637 |         expect(result.valid).toBe(false);
                                   ^
error: expect(received).toBe(expected)

Expected: false
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/all-generated-specs-validation.test.ts:637:30)
(fail) ğŸš¨ ALL GENERATED ASYNCAPI SPECS VALIDATION > ğŸ”’ Validation Requirements Enforcement > should enforce required field validation [20.74ms]
664 |       const filePath = join(testOutputDir, "invalid-action-test.json");
665 |       await writeFile(filePath, JSON.stringify(invalidActionSpec, null, 2));
666 | 
667 |       const result = await validator.validateFile(filePath);
668 | 
669 |       expect(result.valid).toBe(false);
                                 ^
error: expect(received).toBe(expected)

Expected: false
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/all-generated-specs-validation.test.ts:669:28)
(fail) ğŸš¨ ALL GENERATED ASYNCAPI SPECS VALIDATION > ğŸ”’ Validation Requirements Enforcement > should enforce operation action validation [359.51ms]

test/validation/real-asyncapi-validation.test.ts:
timestamp=2025-11-18T21:00:45.932Z level=INFO fiber=#431 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:45.932Z level=INFO fiber=#431 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:45.932Z level=INFO fiber=#431 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:45.932Z level=INFO fiber=#431 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:45.932Z level=INFO fiber=#431 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:45.932Z level=INFO fiber=#431 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:45.932Z level=INFO fiber=#431 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:45.932Z level=INFO fiber=#431 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:45.932Z level=INFO fiber=#431 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:45.932Z level=INFO fiber=#431 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:45.932Z level=INFO fiber=#431 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:45.932Z level=INFO fiber=#431 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:45.932Z level=INFO fiber=#431 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:45.932Z level=INFO fiber=#431 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:45.932Z level=INFO fiber=#431 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:45.932Z level=INFO fiber=#431 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:45.932Z level=INFO fiber=#431 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:45.933Z level=INFO fiber=#431 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:45.933Z level=INFO fiber=#431 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:45.933Z level=INFO fiber=#431 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:45.933Z level=INFO fiber=#431 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:45.933Z level=INFO fiber=#431 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:45.933Z level=INFO fiber=#431 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:45.933Z level=INFO fiber=#431 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:45.933Z level=INFO fiber=#431 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:45.933Z level=INFO fiber=#431 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:45.933Z level=INFO fiber=#431 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:45.933Z level=INFO fiber=#431 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:45.933Z level=INFO fiber=#431 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:45.933Z level=INFO fiber=#431 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:45.933Z level=INFO fiber=#431 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:45.933Z level=INFO fiber=#431 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T21:00:45.933Z level=INFO fiber=#431 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:45.933Z level=INFO fiber=#431 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:45.933Z level=INFO fiber=#431 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:45.933Z level=INFO fiber=#431 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:45.934Z level=INFO fiber=#431 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:45.934Z level=INFO fiber=#431 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:45.934Z level=INFO fiber=#431 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:45.934Z level=INFO fiber=#431 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:45.934Z level=INFO fiber=#431 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:45.934Z level=INFO fiber=#431 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:45.934Z level=INFO fiber=#432 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
ğŸš€ compileAsyncAPISpecRaw called with source length: 179

# Unhandled error between tests
-------------------------------
557 | 	content: string
558 | }>, filename: string): Promise<AsyncAPIObject | string> {
559 | 	//TODO: refactor to use Effect.TS!
560 | 
561 | 	// ğŸ”¥ CRITICAL: Added debug logging at entry
562 | 	console.log(`ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: ${outputFiles.size}, looking for: ${filename}`)
                                                                           ^
TypeError: undefined is not an object (evaluating 'outputFiles.size')
      at parseAsyncAPIOutput (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:562:70)
      at parseAsyncAPIOutput (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:1002:16)
      at /Users/larsartmann/projects/typespec-asyncapi/test/validation/end-to-end-validation.test.ts:581:25
      at processTicksAndRejections (unknown:7:39)
-------------------------------

 8 |  * Assert there is no diagnostics.
 9 |  * @param diagnostics Diagnostics
10 |  */
11 | export function expectDiagnosticEmpty(diagnostics) {
12 |     if (diagnostics.length > 0) {
13 |         fail(`Unexpected diagnostics:\n${formatDiagnostics(diagnostics)}`);
             ^
AssertionError: Unexpected diagnostics:
error import-not-found: Couldn't resolve import "@lars-artmann/typespec-asyncapi"
 generatedMessage: false,
     actual: undefined,
   expected: undefined,
   operator: "fail",
       code: "ERR_ASSERTION"

      at expectDiagnosticEmpty (/Users/larsartmann/projects/typespec-asyncapi/node_modules/@typespec/compiler/dist/src/testing/expect.js:13:9)
      at compile (/Users/larsartmann/projects/typespec-asyncapi/node_modules/@typespec/compiler/dist/src/testing/test-host.js:58:5)
      at processTicksAndRejections (native:7:39)
(fail) Real AsyncAPI Validation Tests > should generate valid AsyncAPI 3.0 specification from TypeSpec [76.31ms]
Test file test-output-basic/@lars-artmann/typespec-asyncapi/test-output.yaml not found, skipping YAML validation
timestamp=2025-11-18T21:00:46.018Z level=INFO fiber=#436 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:46.018Z level=INFO fiber=#436 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:46.018Z level=INFO fiber=#436 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:46.018Z level=INFO fiber=#436 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:46.018Z level=INFO fiber=#436 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:46.018Z level=INFO fiber=#436 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:46.018Z level=INFO fiber=#436 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:46.018Z level=INFO fiber=#436 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:46.018Z level=INFO fiber=#436 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:46.018Z level=INFO fiber=#436 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:46.018Z level=INFO fiber=#436 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:46.018Z level=INFO fiber=#436 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:46.018Z level=INFO fiber=#436 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:46.018Z level=INFO fiber=#436 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:46.018Z level=INFO fiber=#436 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:46.018Z level=INFO fiber=#436 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:46.018Z level=INFO fiber=#436 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:46.018Z level=INFO fiber=#436 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:46.018Z level=INFO fiber=#436 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:46.018Z level=INFO fiber=#436 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:46.018Z level=INFO fiber=#436 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:46.018Z level=INFO fiber=#436 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:46.019Z level=INFO fiber=#436 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:46.019Z level=INFO fiber=#436 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:46.019Z level=INFO fiber=#436 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:46.019Z level=INFO fiber=#436 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:46.019Z level=INFO fiber=#436 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:46.019Z level=INFO fiber=#436 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:46.019Z level=INFO fiber=#436 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:46.019Z level=INFO fiber=#436 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:46.019Z level=INFO fiber=#436 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:46.019Z level=INFO fiber=#436 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T21:00:46.019Z level=INFO fiber=#436 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:46.019Z level=INFO fiber=#436 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:46.020Z level=INFO fiber=#436 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.020Z level=INFO fiber=#436 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.020Z level=INFO fiber=#436 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.020Z level=INFO fiber=#436 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.020Z level=INFO fiber=#436 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.020Z level=INFO fiber=#436 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:46.020Z level=INFO fiber=#436 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.020Z level=INFO fiber=#436 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:46.020Z level=INFO fiber=#437 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
ğŸš€ compileAsyncAPISpecRaw called with source length: 171

# Unhandled error between tests
-------------------------------
557 | 	content: string
558 | }>, filename: string): Promise<AsyncAPIObject | string> {
559 | 	//TODO: refactor to use Effect.TS!
560 | 
561 | 	// ğŸ”¥ CRITICAL: Added debug logging at entry
562 | 	console.log(`ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: ${outputFiles.size}, looking for: ${filename}`)
                                                                           ^
TypeError: undefined is not an object (evaluating 'outputFiles.size')
      at parseAsyncAPIOutput (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:562:70)
      at parseAsyncAPIOutput (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:556:43)
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/end-to-end-validation.test.ts:581:25)
-------------------------------

Test file test-output-basic/@lars-artmann/typespec-asyncapi/test-output.yaml not found, skipping metadata test
 8 |  * Assert there is no diagnostics.
 9 |  * @param diagnostics Diagnostics
10 |  */
11 | export function expectDiagnosticEmpty(diagnostics) {
12 |     if (diagnostics.length > 0) {
13 |         fail(`Unexpected diagnostics:\n${formatDiagnostics(diagnostics)}`);
             ^
AssertionError: Unexpected diagnostics:
error import-not-found: Couldn't resolve import "@lars-artmann/typespec-asyncapi"
 generatedMessage: false,
     actual: undefined,
   expected: undefined,
   operator: "fail",
       code: "ERR_ASSERTION"

      at expectDiagnosticEmpty (/Users/larsartmann/projects/typespec-asyncapi/node_modules/@typespec/compiler/dist/src/testing/expect.js:13:9)
      at compile (/Users/larsartmann/projects/typespec-asyncapi/node_modules/@typespec/compiler/dist/src/testing/test-host.js:58:5)
      at processTicksAndRejections (native:7:39)
(fail) Real AsyncAPI Validation Tests > should process TypeSpec models into AsyncAPI schemas [14.01ms]
timestamp=2025-11-18T21:00:46.149Z level=INFO fiber=#441 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:46.149Z level=INFO fiber=#441 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:46.149Z level=INFO fiber=#441 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:46.150Z level=INFO fiber=#441 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:46.150Z level=INFO fiber=#441 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:46.150Z level=INFO fiber=#441 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:46.150Z level=INFO fiber=#441 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:46.150Z level=INFO fiber=#441 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:46.150Z level=INFO fiber=#441 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:46.150Z level=INFO fiber=#441 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:46.150Z level=INFO fiber=#441 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:46.150Z level=INFO fiber=#441 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:46.150Z level=INFO fiber=#441 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:46.150Z level=INFO fiber=#441 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:46.150Z level=INFO fiber=#441 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:46.150Z level=INFO fiber=#441 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:46.150Z level=INFO fiber=#441 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:46.150Z level=INFO fiber=#441 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:46.150Z level=INFO fiber=#441 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:46.150Z level=INFO fiber=#441 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:46.150Z level=INFO fiber=#441 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:46.150Z level=INFO fiber=#441 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:46.151Z level=INFO fiber=#441 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:46.151Z level=INFO fiber=#441 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:46.151Z level=INFO fiber=#441 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:46.151Z level=INFO fiber=#441 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:46.151Z level=INFO fiber=#441 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:46.151Z level=INFO fiber=#441 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:46.151Z level=INFO fiber=#441 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:46.151Z level=INFO fiber=#441 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:46.151Z level=INFO fiber=#441 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:46.151Z level=INFO fiber=#441 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.07ms)"
timestamp=2025-11-18T21:00:46.151Z level=INFO fiber=#441 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:46.151Z level=INFO fiber=#441 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:46.152Z level=INFO fiber=#441 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.152Z level=INFO fiber=#441 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.152Z level=INFO fiber=#441 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.152Z level=INFO fiber=#441 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.152Z level=INFO fiber=#441 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.152Z level=INFO fiber=#441 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:46.152Z level=INFO fiber=#441 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.152Z level=INFO fiber=#441 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:46.152Z level=INFO fiber=#442 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"

# Unhandled error between tests
-------------------------------
557 | 	content: string
558 | }>, filename: string): Promise<AsyncAPIObject | string> {
559 | 	//TODO: refactor to use Effect.TS!
560 | 
561 | 	// ğŸ”¥ CRITICAL: Added debug logging at entry
562 | 	console.log(`ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: ${outputFiles.size}, looking for: ${filename}`)
                                                                           ^
TypeError: undefined is not an object (evaluating 'outputFiles.size')
      at parseAsyncAPIOutput (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:562:70)
      at parseAsyncAPIOutput (/Users/larsartmann/projects/typespec-asyncapi/test/utils/test-helpers.ts:1002:16)
      at /Users/larsartmann/projects/typespec-asyncapi/test/validation/end-to-end-validation.test.ts:581:25
      at processTicksAndRejections (unknown:7:39)
-------------------------------

 8 |  * Assert there is no diagnostics.
 9 |  * @param diagnostics Diagnostics
10 |  */
11 | export function expectDiagnosticEmpty(diagnostics) {
12 |     if (diagnostics.length > 0) {
13 |         fail(`Unexpected diagnostics:\n${formatDiagnostics(diagnostics)}`);
             ^
AssertionError: Unexpected diagnostics:
error import-not-found: Couldn't resolve import "@lars-artmann/typespec-asyncapi"
 generatedMessage: false,
     actual: undefined,
   expected: undefined,
   operator: "fail",
       code: "ERR_ASSERTION"

      at expectDiagnosticEmpty (/Users/larsartmann/projects/typespec-asyncapi/node_modules/@typespec/compiler/dist/src/testing/expect.js:13:9)
      at compile (/Users/larsartmann/projects/typespec-asyncapi/node_modules/@typespec/compiler/dist/src/testing/test-host.js:58:5)
      at processTicksAndRejections (native:7:39)
(fail) Real AsyncAPI Validation Tests > should demonstrate real TypeSpec AST processing [144.27ms]

test/validation/automated-spec-validation.test.ts:
timestamp=2025-11-18T21:00:46.214Z level=INFO fiber=#446 message="ğŸ”§ Initializing AsyncAPI 3.0.0 Validator with REAL @asyncapi/parser..." message={}
timestamp=2025-11-18T21:00:46.214Z level=INFO fiber=#446 message="âœ… AsyncAPI 3.0.0 Validator initialized successfully"
ğŸš€ compileAsyncAPISpecRaw called with source length: 203
timestamp=2025-11-18T21:00:46.256Z level=INFO fiber=#447 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:46.256Z level=INFO fiber=#447 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:46.256Z level=INFO fiber=#447 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:46.256Z level=INFO fiber=#447 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:46.256Z level=INFO fiber=#447 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:46.256Z level=INFO fiber=#447 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:46.256Z level=INFO fiber=#447 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:46.256Z level=INFO fiber=#447 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:46.256Z level=INFO fiber=#447 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:46.256Z level=INFO fiber=#447 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:46.256Z level=INFO fiber=#447 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:46.256Z level=INFO fiber=#447 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:46.256Z level=INFO fiber=#447 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:46.256Z level=INFO fiber=#447 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:46.256Z level=INFO fiber=#447 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:46.256Z level=INFO fiber=#447 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:46.257Z level=INFO fiber=#447 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:46.257Z level=INFO fiber=#447 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:46.257Z level=INFO fiber=#447 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:46.257Z level=INFO fiber=#447 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:46.257Z level=INFO fiber=#447 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:46.257Z level=INFO fiber=#447 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:46.258Z level=INFO fiber=#447 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:46.258Z level=INFO fiber=#447 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:46.258Z level=INFO fiber=#447 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:46.258Z level=INFO fiber=#447 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:46.259Z level=INFO fiber=#447 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:46.259Z level=INFO fiber=#447 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:46.259Z level=INFO fiber=#447 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:46.259Z level=INFO fiber=#447 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:46.259Z level=INFO fiber=#447 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:46.259Z level=INFO fiber=#447 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.08ms)"
timestamp=2025-11-18T21:00:46.259Z level=INFO fiber=#447 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:46.259Z level=INFO fiber=#447 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:46.260Z level=INFO fiber=#447 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.260Z level=INFO fiber=#447 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.260Z level=INFO fiber=#447 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.260Z level=INFO fiber=#447 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.260Z level=INFO fiber=#447 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.260Z level=INFO fiber=#447 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:46.260Z level=INFO fiber=#447 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.260Z level=INFO fiber=#447 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:46.260Z level=INFO fiber=#448 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG compileAsyncAPISpecWithResult: outputFiles size: 0
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
ğŸ” DEBUG parsed result for asyncapi.yaml: object, has value
ğŸ” DEBUG parsed object has 5 keys
271 | 						"file-type": format,
272 | 						"output-file": scenario.name,
273 | 					})
274 | 
275 | 					expect(compilationResult.result.outputFiles).toBeDefined()
276 | 					expect(compilationResult.result.outputFiles.size).toBeGreaterThan(0)
                                                             ^
error: expect(received).toBeGreaterThan(expected)

Expected: > 0
Received: 0

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/automated-spec-validation.test.ts:276:56)
(fail) ğŸš¨ CRITICAL: AUTOMATED ASYNCAPI SPECIFICATION VALIDATION > ğŸ­ AsyncAPI Spec Generation & Validation Pipeline > should generate and validate basic-event-api (Basic event publishing API) [53.32ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 553
timestamp=2025-11-18T21:00:46.305Z level=INFO fiber=#449 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:46.305Z level=INFO fiber=#449 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:46.305Z level=INFO fiber=#449 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:46.305Z level=INFO fiber=#449 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:46.305Z level=INFO fiber=#449 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:46.305Z level=INFO fiber=#449 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:46.305Z level=INFO fiber=#449 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:46.305Z level=INFO fiber=#449 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:46.305Z level=INFO fiber=#449 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:46.305Z level=INFO fiber=#449 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:46.305Z level=INFO fiber=#449 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:46.305Z level=INFO fiber=#449 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:46.305Z level=INFO fiber=#449 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:46.305Z level=INFO fiber=#449 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:46.305Z level=INFO fiber=#449 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:46.305Z level=INFO fiber=#449 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:46.306Z level=INFO fiber=#449 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:46.306Z level=INFO fiber=#449 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:46.306Z level=INFO fiber=#449 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:46.306Z level=INFO fiber=#449 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:46.306Z level=INFO fiber=#449 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:46.306Z level=INFO fiber=#449 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:46.306Z level=INFO fiber=#449 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:46.306Z level=INFO fiber=#449 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:46.306Z level=INFO fiber=#449 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:46.306Z level=INFO fiber=#449 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:46.306Z level=INFO fiber=#449 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:46.306Z level=INFO fiber=#449 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:46.306Z level=INFO fiber=#449 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:46.306Z level=INFO fiber=#449 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:46.306Z level=INFO fiber=#449 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:46.306Z level=INFO fiber=#449 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.06ms)"
timestamp=2025-11-18T21:00:46.306Z level=INFO fiber=#449 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:46.306Z level=INFO fiber=#449 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:46.307Z level=INFO fiber=#449 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.307Z level=INFO fiber=#449 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.307Z level=INFO fiber=#449 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.307Z level=INFO fiber=#449 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.307Z level=INFO fiber=#449 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.307Z level=INFO fiber=#449 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:46.307Z level=INFO fiber=#449 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.307Z level=INFO fiber=#449 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:46.307Z level=INFO fiber=#450 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG compileAsyncAPISpecWithResult: outputFiles size: 0
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
ğŸ” DEBUG parsed result for asyncapi.yaml: object, has value
ğŸ” DEBUG parsed object has 5 keys
271 | 						"file-type": format,
272 | 						"output-file": scenario.name,
273 | 					})
274 | 
275 | 					expect(compilationResult.result.outputFiles).toBeDefined()
276 | 					expect(compilationResult.result.outputFiles.size).toBeGreaterThan(0)
                                                             ^
error: expect(received).toBeGreaterThan(expected)

Expected: > 0
Received: 0

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/automated-spec-validation.test.ts:276:56)
(fail) ğŸš¨ CRITICAL: AUTOMATED ASYNCAPI SPECIFICATION VALIDATION > ğŸ­ AsyncAPI Spec Generation & Validation Pipeline > should generate and validate complex-event-api (Complex event with metadata and status) [48.25ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 457
timestamp=2025-11-18T21:00:46.383Z level=INFO fiber=#451 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:46.383Z level=INFO fiber=#451 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:46.383Z level=INFO fiber=#451 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:46.383Z level=INFO fiber=#451 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:46.383Z level=INFO fiber=#451 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:46.383Z level=INFO fiber=#451 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:46.383Z level=INFO fiber=#451 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:46.383Z level=INFO fiber=#451 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:46.383Z level=INFO fiber=#451 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:46.383Z level=INFO fiber=#451 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:46.383Z level=INFO fiber=#451 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:46.383Z level=INFO fiber=#451 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:46.383Z level=INFO fiber=#451 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:46.383Z level=INFO fiber=#451 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:46.383Z level=INFO fiber=#451 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:46.383Z level=INFO fiber=#451 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:46.383Z level=INFO fiber=#451 message="âœ… Discovery: 3 operations found"
timestamp=2025-11-18T21:00:46.383Z level=INFO fiber=#451 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:46.383Z level=INFO fiber=#451 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:46.383Z level=INFO fiber=#451 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:46.383Z level=INFO fiber=#451 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:46.383Z level=INFO fiber=#451 message="ğŸ”„ Processing 3 operations with Effect.TS..."
timestamp=2025-11-18T21:00:46.384Z level=INFO fiber=#451 message="âœ… Processed 3 operations successfully"
timestamp=2025-11-18T21:00:46.384Z level=INFO fiber=#451 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:46.384Z level=INFO fiber=#451 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:46.384Z level=INFO fiber=#451 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:46.384Z level=INFO fiber=#451 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:46.384Z level=INFO fiber=#451 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 3,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 3
}"
timestamp=2025-11-18T21:00:46.384Z level=INFO fiber=#451 message="âœ… Processing: 3 elements processed"
timestamp=2025-11-18T21:00:46.384Z level=INFO fiber=#451 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:46.384Z level=INFO fiber=#451 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:46.384Z level=INFO fiber=#451 message="âœ… AsyncAPI document validation passed! 3 channels, 0 operations (0.06ms)"
timestamp=2025-11-18T21:00:46.384Z level=INFO fiber=#451 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:46.384Z level=INFO fiber=#451 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:46.385Z level=INFO fiber=#451 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.385Z level=INFO fiber=#451 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.385Z level=INFO fiber=#451 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.385Z level=INFO fiber=#451 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.385Z level=INFO fiber=#451 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.385Z level=INFO fiber=#451 message="ğŸ‰ TYPESPEC API SUCCESS: 3 channels, 0 operations"
timestamp=2025-11-18T21:00:46.385Z level=INFO fiber=#451 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.385Z level=INFO fiber=#451 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:46.385Z level=INFO fiber=#452 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG compileAsyncAPISpecWithResult: outputFiles size: 0
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
ğŸ” DEBUG parsed result for asyncapi.yaml: object, has value
ğŸ” DEBUG parsed object has 5 keys
271 | 						"file-type": format,
272 | 						"output-file": scenario.name,
273 | 					})
274 | 
275 | 					expect(compilationResult.result.outputFiles).toBeDefined()
276 | 					expect(compilationResult.result.outputFiles.size).toBeGreaterThan(0)
                                                             ^
error: expect(received).toBeGreaterThan(expected)

Expected: > 0
Received: 0

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/automated-spec-validation.test.ts:276:56)
(fail) ğŸš¨ CRITICAL: AUTOMATED ASYNCAPI SPECIFICATION VALIDATION > ğŸ­ AsyncAPI Spec Generation & Validation Pipeline > should generate and validate multiple-operations-api (API with multiple channels and operations) [95.74ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 484
timestamp=2025-11-18T21:00:46.447Z level=INFO fiber=#453 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:46.447Z level=INFO fiber=#453 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:46.447Z level=INFO fiber=#453 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:46.447Z level=INFO fiber=#453 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:46.447Z level=INFO fiber=#453 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:46.447Z level=INFO fiber=#453 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:46.447Z level=INFO fiber=#453 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:46.447Z level=INFO fiber=#453 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:46.447Z level=INFO fiber=#453 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:46.447Z level=INFO fiber=#453 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:46.447Z level=INFO fiber=#453 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:46.447Z level=INFO fiber=#453 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:46.447Z level=INFO fiber=#453 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:46.447Z level=INFO fiber=#453 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:46.447Z level=INFO fiber=#453 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:46.447Z level=INFO fiber=#453 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:46.448Z level=INFO fiber=#453 message="âœ… Discovery: 1 operations found"
timestamp=2025-11-18T21:00:46.448Z level=INFO fiber=#453 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:46.448Z level=INFO fiber=#453 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:46.448Z level=INFO fiber=#453 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:46.448Z level=INFO fiber=#453 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:46.448Z level=INFO fiber=#453 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:46.448Z level=INFO fiber=#453 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:46.448Z level=INFO fiber=#453 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:46.448Z level=INFO fiber=#453 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:46.448Z level=INFO fiber=#453 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:46.448Z level=INFO fiber=#453 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:46.448Z level=INFO fiber=#453 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 1
}"
timestamp=2025-11-18T21:00:46.448Z level=INFO fiber=#453 message="âœ… Processing: 1 elements processed"
timestamp=2025-11-18T21:00:46.448Z level=INFO fiber=#453 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:46.448Z level=INFO fiber=#453 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:46.448Z level=INFO fiber=#453 message="âœ… AsyncAPI document validation passed! 1 channels, 0 operations (0.04ms)"
timestamp=2025-11-18T21:00:46.448Z level=INFO fiber=#453 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:46.448Z level=INFO fiber=#453 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:46.448Z level=INFO fiber=#453 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.448Z level=INFO fiber=#453 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.448Z level=INFO fiber=#453 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.449Z level=INFO fiber=#453 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.449Z level=INFO fiber=#453 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.449Z level=INFO fiber=#453 message="ğŸ‰ TYPESPEC API SUCCESS: 1 channels, 0 operations"
timestamp=2025-11-18T21:00:46.449Z level=INFO fiber=#453 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.449Z level=INFO fiber=#453 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:46.449Z level=INFO fiber=#454 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG compileAsyncAPISpecWithResult: outputFiles size: 0
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
ğŸ” DEBUG parsed result for asyncapi.yaml: object, has value
ğŸ” DEBUG parsed object has 5 keys
271 | 						"file-type": format,
272 | 						"output-file": scenario.name,
273 | 					})
274 | 
275 | 					expect(compilationResult.result.outputFiles).toBeDefined()
276 | 					expect(compilationResult.result.outputFiles.size).toBeGreaterThan(0)
                                                             ^
error: expect(received).toBeGreaterThan(expected)

Expected: > 0
Received: 0

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/automated-spec-validation.test.ts:276:56)
(fail) ğŸš¨ CRITICAL: AUTOMATED ASYNCAPI SPECIFICATION VALIDATION > ğŸ­ AsyncAPI Spec Generation & Validation Pipeline > should generate and validate documented-api (API with comprehensive documentation) [44.82ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 1393
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="âœ… Discovery: 4 operations found"
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="ğŸ”„ Processing 4 operations with Effect.TS..."
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="âœ… Processed 4 operations successfully"
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 4,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 4
}"
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="âœ… Processing: 4 elements processed"
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:46.494Z level=INFO fiber=#455 message="âœ… AsyncAPI document validation passed! 4 channels, 0 operations (0.05ms)"
timestamp=2025-11-18T21:00:46.495Z level=INFO fiber=#455 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:46.495Z level=INFO fiber=#455 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:46.496Z level=INFO fiber=#455 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.496Z level=INFO fiber=#455 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.496Z level=INFO fiber=#455 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.496Z level=INFO fiber=#455 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.496Z level=INFO fiber=#455 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.496Z level=INFO fiber=#455 message="ğŸ‰ TYPESPEC API SUCCESS: 4 channels, 0 operations"
timestamp=2025-11-18T21:00:46.496Z level=INFO fiber=#455 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.496Z level=INFO fiber=#455 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:46.496Z level=INFO fiber=#456 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG compileAsyncAPISpecWithResult: outputFiles size: 0
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
ğŸ” DEBUG parsed result for asyncapi.yaml: object, has value
ğŸ” DEBUG parsed object has 5 keys
271 | 						"file-type": format,
272 | 						"output-file": scenario.name,
273 | 					})
274 | 
275 | 					expect(compilationResult.result.outputFiles).toBeDefined()
276 | 					expect(compilationResult.result.outputFiles.size).toBeGreaterThan(0)
                                                             ^
error: expect(received).toBeGreaterThan(expected)

Expected: > 0
Received: 0

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/automated-spec-validation.test.ts:276:56)
(fail) ğŸš¨ CRITICAL: AUTOMATED ASYNCAPI SPECIFICATION VALIDATION > ğŸ­ AsyncAPI Spec Generation & Validation Pipeline > should generate and validate microservices-event-api (Microservices event-driven architecture) [45.34ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 1400
timestamp=2025-11-18T21:00:46.544Z level=INFO fiber=#457 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:46.544Z level=INFO fiber=#457 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:46.544Z level=INFO fiber=#457 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:46.544Z level=INFO fiber=#457 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:46.544Z level=INFO fiber=#457 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:46.544Z level=INFO fiber=#457 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:46.544Z level=INFO fiber=#457 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:46.544Z level=INFO fiber=#457 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:46.544Z level=INFO fiber=#457 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:46.544Z level=INFO fiber=#457 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:46.544Z level=INFO fiber=#457 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:46.544Z level=INFO fiber=#457 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:46.544Z level=INFO fiber=#457 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:46.544Z level=INFO fiber=#457 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:46.544Z level=INFO fiber=#457 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:46.544Z level=INFO fiber=#457 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:46.544Z level=INFO fiber=#457 message="âœ… Discovery: 3 operations found"
timestamp=2025-11-18T21:00:46.544Z level=INFO fiber=#457 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:46.545Z level=INFO fiber=#457 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:46.545Z level=INFO fiber=#457 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:46.545Z level=INFO fiber=#457 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:46.545Z level=INFO fiber=#457 message="ğŸ”„ Processing 3 operations with Effect.TS..."
timestamp=2025-11-18T21:00:46.545Z level=INFO fiber=#457 message="âœ… Processed 3 operations successfully"
timestamp=2025-11-18T21:00:46.545Z level=INFO fiber=#457 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:46.545Z level=INFO fiber=#457 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:46.545Z level=INFO fiber=#457 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:46.545Z level=INFO fiber=#457 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:46.545Z level=INFO fiber=#457 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 3,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 3
}"
timestamp=2025-11-18T21:00:46.545Z level=INFO fiber=#457 message="âœ… Processing: 3 elements processed"
timestamp=2025-11-18T21:00:46.545Z level=INFO fiber=#457 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:46.545Z level=INFO fiber=#457 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:46.545Z level=INFO fiber=#457 message="âœ… AsyncAPI document validation passed! 3 channels, 0 operations (0.06ms)"
timestamp=2025-11-18T21:00:46.545Z level=INFO fiber=#457 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:46.545Z level=INFO fiber=#457 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:46.547Z level=INFO fiber=#457 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.547Z level=INFO fiber=#457 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.547Z level=INFO fiber=#457 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.547Z level=INFO fiber=#457 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.547Z level=INFO fiber=#457 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.547Z level=INFO fiber=#457 message="ğŸ‰ TYPESPEC API SUCCESS: 3 channels, 0 operations"
timestamp=2025-11-18T21:00:46.547Z level=INFO fiber=#457 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.547Z level=INFO fiber=#457 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:46.547Z level=INFO fiber=#458 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG compileAsyncAPISpecWithResult: outputFiles size: 0
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
ğŸ” DEBUG parsed result for asyncapi.yaml: object, has value
ğŸ” DEBUG parsed object has 5 keys
271 | 						"file-type": format,
272 | 						"output-file": scenario.name,
273 | 					})
274 | 
275 | 					expect(compilationResult.result.outputFiles).toBeDefined()
276 | 					expect(compilationResult.result.outputFiles.size).toBeGreaterThan(0)
                                                             ^
error: expect(received).toBeGreaterThan(expected)

Expected: > 0
Received: 0

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/automated-spec-validation.test.ts:276:56)
(fail) ğŸš¨ CRITICAL: AUTOMATED ASYNCAPI SPECIFICATION VALIDATION > ğŸ­ AsyncAPI Spec Generation & Validation Pipeline > should generate and validate iot-sensor-api (IoT sensor data streaming with parameterized channels) [48.01ms]
ğŸš€ compileAsyncAPISpecRaw called with source length: 1484
timestamp=2025-11-18T21:00:46.597Z level=INFO fiber=#459 message="ğŸš€ TypeSpec API Integration: Using emitFile for test framework compatibility"
timestamp=2025-11-18T21:00:46.597Z level=INFO fiber=#459 message="ğŸš€ Loading built-in protocol plugins..."
timestamp=2025-11-18T21:00:46.597Z level=INFO fiber=#459 message="ğŸ“¦ Registering plugin: kafka v1.0.0"
timestamp=2025-11-18T21:00:46.597Z level=INFO fiber=#459 message="âš ï¸  Plugin kafka already registered, replacing"
timestamp=2025-11-18T21:00:46.597Z level=INFO fiber=#459 message="âœ… Plugin kafka registered successfully"
timestamp=2025-11-18T21:00:46.597Z level=INFO fiber=#459 message="ğŸ“¦ Registering plugin: websocket v1.0.0"
timestamp=2025-11-18T21:00:46.597Z level=INFO fiber=#459 message="âš ï¸  Plugin websocket already registered, replacing"
timestamp=2025-11-18T21:00:46.597Z level=INFO fiber=#459 message="âœ… Plugin websocket registered successfully"
timestamp=2025-11-18T21:00:46.598Z level=INFO fiber=#459 message="ğŸ“¦ Registering plugin: http v1.0.0"
timestamp=2025-11-18T21:00:46.598Z level=INFO fiber=#459 message="âš ï¸  Plugin http already registered, replacing"
timestamp=2025-11-18T21:00:46.598Z level=INFO fiber=#459 message="âœ… Plugin http registered successfully"
timestamp=2025-11-18T21:00:46.598Z level=INFO fiber=#459 message="ğŸ“¦ Registering plugin: mqtt v1.0.0"
timestamp=2025-11-18T21:00:46.598Z level=INFO fiber=#459 message="âš ï¸  Plugin mqtt already registered, replacing"
timestamp=2025-11-18T21:00:46.598Z level=INFO fiber=#459 message="âœ… Plugin mqtt registered successfully"
timestamp=2025-11-18T21:00:46.598Z level=INFO fiber=#459 message="âœ… Built-in plugins loaded successfully"
timestamp=2025-11-18T21:00:46.598Z level=INFO fiber=#459 message="ğŸš€ Stage 1: Discovery"
timestamp=2025-11-18T21:00:46.598Z level=INFO fiber=#459 message="âœ… Discovery: 4 operations found"
timestamp=2025-11-18T21:00:46.598Z level=INFO fiber=#459 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:46.598Z level=INFO fiber=#459 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:46.599Z level=INFO fiber=#459 message="ğŸš€ Stage 2: Processing"
timestamp=2025-11-18T21:00:46.599Z level=INFO fiber=#459 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:46.599Z level=INFO fiber=#459 message="ğŸ”„ Processing 4 operations with Effect.TS..."
timestamp=2025-11-18T21:00:46.599Z level=INFO fiber=#459 message="âœ… Processed 4 operations successfully"
timestamp=2025-11-18T21:00:46.599Z level=INFO fiber=#459 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:46.599Z level=INFO fiber=#459 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:46.599Z level=INFO fiber=#459 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:46.599Z level=INFO fiber=#459 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:46.599Z level=INFO fiber=#459 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 4,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 4
}"
timestamp=2025-11-18T21:00:46.599Z level=INFO fiber=#459 message="âœ… Processing: 4 elements processed"
timestamp=2025-11-18T21:00:46.599Z level=INFO fiber=#459 message="ğŸš€ Stage 3: Validation"
timestamp=2025-11-18T21:00:46.599Z level=INFO fiber=#459 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:46.599Z level=INFO fiber=#459 message="âœ… AsyncAPI document validation passed! 4 channels, 0 operations (0.16ms)"
timestamp=2025-11-18T21:00:46.599Z level=INFO fiber=#459 message="âœ… Validation: PASSED"
timestamp=2025-11-18T21:00:46.599Z level=INFO fiber=#459 message="ğŸš€ Stage 4: TypeSpec emitFile API"
timestamp=2025-11-18T21:00:46.603Z level=INFO fiber=#459 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.604Z level=INFO fiber=#459 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.604Z level=INFO fiber=#459 message="ğŸ” Emitting file: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.604Z level=INFO fiber=#459 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.604Z level=INFO fiber=#459 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.604Z level=INFO fiber=#459 message="ğŸ‰ TYPESPEC API SUCCESS: 4 channels, 0 operations"
timestamp=2025-11-18T21:00:46.604Z level=INFO fiber=#459 message="âœ… File emitted: asyncapi.yaml"
timestamp=2025-11-18T21:00:46.604Z level=INFO fiber=#459 message="ğŸ”— Test framework bridge: Automatic via emitFile API"
timestamp=2025-11-18T21:00:46.604Z level=INFO fiber=#460 message="âœ… Generated AsyncAPI specification: asyncapi.yaml"
ğŸ” TestFileSystem empty, checking real filesystem...
ğŸ” Attempting to read directory: /Users/larsartmann/projects/typespec-asyncapi/@lars-artmann/typespec-asyncapi
ğŸ” DEBUG compileAsyncAPISpecWithResult: outputFiles size: 0
ğŸ” DEBUG parseAsyncAPIOutput entry: outputFiles size: 0, looking for: asyncapi.yaml
ğŸ” DEBUG: extractSchemaNameFromTest("asyncapi.yaml") = "null"
ğŸ” DEBUG parsed result for asyncapi.yaml: object, has value
ğŸ” DEBUG parsed object has 5 keys
271 | 						"file-type": format,
272 | 						"output-file": scenario.name,
273 | 					})
274 | 
275 | 					expect(compilationResult.result.outputFiles).toBeDefined()
276 | 					expect(compilationResult.result.outputFiles.size).toBeGreaterThan(0)
                                                             ^
error: expect(received).toBeGreaterThan(expected)

Expected: > 0
Received: 0

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/automated-spec-validation.test.ts:276:56)
(fail) ğŸš¨ CRITICAL: AUTOMATED ASYNCAPI SPECIFICATION VALIDATION > ğŸ­ AsyncAPI Spec Generation & Validation Pipeline > should generate and validate real-time-chat-api (Real-time chat with presence and parameterized channels) [61.59ms]
360 | 	describe("ğŸ” Batch Validation of All Generated Specs", () => {
361 | 		it("should validate all generated specifications in a single batch", async () => {
362 | 			Effect.log("\nğŸ­ Running batch validation of all generated specifications...")
363 | 
364 | 			if (generatedSpecs.length === 0) {
365 | 				throw new Error("No specifications were generated for batch validation")
                    ^
error: No specifications were generated for batch validation
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/automated-spec-validation.test.ts:365:15)
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/automated-spec-validation.test.ts:361:72)
(fail) ğŸš¨ CRITICAL: AUTOMATED ASYNCAPI SPECIFICATION VALIDATION > ğŸ” Batch Validation of All Generated Specs > should validate all generated specifications in a single batch [0.56ms]
ğŸ” DEBUG: invalidSpec.document type: object
ğŸ” DEBUG: invalidSpec.document: {
  info: {
    title: "Invalid API",
    version: "1.0.0",
  },
  channels: {},
}
490 | 				console.log(`ğŸ” DEBUG: invalidSpec.document:`, invalidSpec.document)
491 | 
492 | 				const result = await validator.validate(invalidSpec.document)
493 | 
494 | 				// Should be invalid
495 | 				expect(result.valid).toBe(false)
                               ^
error: expect(received).toBe(expected)

Expected: false
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/automated-spec-validation.test.ts:495:26)
(fail) ğŸš¨ CRITICAL: AUTOMATED ASYNCAPI SPECIFICATION VALIDATION > ğŸš¨ Validation Error Detection > should detect and report validation errors in invalid specifications [1.96ms]
579 | 			for (let i = 0; i < iterations; i++) {
580 | 				const startTime = performance.now()
581 | 				const result = await validator.validate(testDocument, `perf-test-${i}`)
582 | 				const duration = performance.now() - startTime
583 | 
584 | 				expect(result.valid).toBe(true)
                               ^
error: expect(received).toBe(expected)

Expected: true
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/validation/automated-spec-validation.test.ts:584:26)
(fail) ğŸš¨ CRITICAL: AUTOMATED ASYNCAPI SPECIFICATION VALIDATION > âš¡ Performance Requirements > should meet performance requirements for validation [479.20ms]

test/unit/core/ValidationService.test.ts:
timestamp=2025-11-18T21:00:47.112Z level=INFO fiber=#467 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:47.113Z level=INFO fiber=#467 message="âœ… AsyncAPI document validation passed! 1 channels, 1 operations (0.57ms)"
timestamp=2025-11-18T21:00:47.113Z level=INFO fiber=#468 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:47.113Z level=INFO fiber=#468 message="âœ… AsyncAPI document validation passed! 3 channels, 3 operations (0.08ms)"
timestamp=2025-11-18T21:00:47.114Z level=INFO fiber=#469 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:47.114Z level=INFO fiber=#469 message="âŒ AsyncAPI document validation failed with 1 errors, 3 warnings (0.04ms)"
timestamp=2025-11-18T21:00:47.114Z level=INFO fiber=#470 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:47.114Z level=INFO fiber=#470 message="âœ… AsyncAPI document validation passed! 1 channels, 1 operations (0.04ms)"
 98 | 				validationService.validateDocument(docInvalidVersion)
 99 | 			)
100 | 
101 | 			expect(result._tag).toBe("Success") // Should still be valid
102 | 			const warningMessages = result.warnings.map(w => w.message)
103 | 			expect(warningMessages).toContain("Using AsyncAPI version 2.6.0, expected 3.x")
                                 ^
error: expect(received).toContain(expected)

Expected to contain: "Using AsyncAPI version 2.6.0, expected 3.x"
Received: []

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/core/ValidationService.test.ts:103:28)
(fail) ValidationService > validateDocument > should detect invalid AsyncAPI version [0.34ms]
timestamp=2025-11-18T21:00:47.114Z level=INFO fiber=#471 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:47.114Z level=INFO fiber=#471 message="âŒ AsyncAPI document validation failed with 1 errors, 0 warnings (0.04ms)"
timestamp=2025-11-18T21:00:47.114Z level=INFO fiber=#472 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:47.114Z level=INFO fiber=#472 message="âŒ AsyncAPI document validation failed with 2 errors, 1 warnings (0.04ms)"
timestamp=2025-11-18T21:00:47.114Z level=INFO fiber=#473 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:47.114Z level=INFO fiber=#473 message="âœ… AsyncAPI document validation passed! 1 channels, 1 operations (0.02ms)"
149 | 				validationService.validateDocument(docMissingDescription)
150 | 			)
151 | 
152 | 			expect(result._tag).toBe("Success")
153 | 			const warningMessages = result.warnings.map(w => w.message)
154 | 			expect(warningMessages).toContain("Missing recommended 'info.description' field")
                                 ^
error: expect(received).toContain(expected)

Expected to contain: "Missing recommended 'info.description' field"
Received: []

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/core/ValidationService.test.ts:154:28)
(fail) ValidationService > validateDocument > should warn about missing recommended fields [0.13ms]
timestamp=2025-11-18T21:00:47.115Z level=INFO fiber=#474 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:47.115Z level=INFO fiber=#474 message="âŒ AsyncAPI document validation failed with 2 errors, 0 warnings (0.03ms)"
timestamp=2025-11-18T21:00:47.115Z level=INFO fiber=#475 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:47.115Z level=INFO fiber=#475 message="âœ… AsyncAPI document validation passed! 0 channels, 0 operations (0.03ms)"
183 | 			)
184 | 
185 | 			// Empty channels should still be valid but generate warning
186 | 			expect(result._tag).toBe("Success")
187 | 			const warningMessages = result.warnings.map(w => w.message)
188 | 			expect(warningMessages).toContain("No channels defined - document may be incomplete")
                                 ^
error: expect(received).toContain(expected)

Expected to contain: "No channels defined - document may be incomplete"
Received: []

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/core/ValidationService.test.ts:188:28)
(fail) ValidationService > validateDocument > should warn about empty channels [0.22ms]
timestamp=2025-11-18T21:00:47.115Z level=INFO fiber=#476 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:47.115Z level=INFO fiber=#476 message="âŒ AsyncAPI document validation failed with 5 errors, 0 warnings (0.03ms)"
timestamp=2025-11-18T21:00:47.115Z level=INFO fiber=#477 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:47.115Z level=INFO fiber=#477 message="âŒ AsyncAPI document validation failed with 2 errors, 0 warnings (0.03ms)"
timestamp=2025-11-18T21:00:47.115Z level=INFO fiber=#478 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:47.115Z level=INFO fiber=#478 message="âœ… AsyncAPI document validation passed! 0 channels, 0 operations (0.02ms)"
252 | 				validationService.validateDocument(minimalDoc)
253 | 			)
254 | 
255 | 			expect(result._tag).toBe("Success")
256 | 			const warningMessages = result.warnings.map(w => w.message)
257 | 			expect(warningMessages).toContain("No channels defined - document may be incomplete")
                                 ^
error: expect(received).toContain(expected)

Expected to contain: "No channels defined - document may be incomplete"
Received: []

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/core/ValidationService.test.ts:257:28)
(fail) ValidationService > validateDocument > should handle documents without optional sections [0.27ms]
timestamp=2025-11-18T21:00:47.116Z level=INFO fiber=#479 message="ğŸ” Validating AsyncAPI document content (635 bytes)"
timestamp=2025-11-18T21:00:47.116Z level=INFO fiber=#479 message="ğŸ” Content preview: {\"asyncapi\":\"3.0.0\",\"info\":{\"title\":\"Test API\",\"version\":\"1.0.0\",\"description\":\"A valid test API\"},\"..."
timestamp=2025-11-18T21:00:47.116Z level=INFO fiber=#479 message="ğŸ”§ About to parse JSON..."
timestamp=2025-11-18T21:00:47.117Z level=INFO fiber=#479 message="ğŸ”§ Starting JSON parsing attempt..."
timestamp=2025-11-18T21:00:47.117Z level=INFO fiber=#479 message="ğŸ”§ Parsed doc type: object, keys: asyncapi, info, channels, operations, components"
timestamp=2025-11-18T21:00:47.117Z level=INFO fiber=#479 message="ğŸ” Starting comprehensive AsyncAPI document validation (static method)..."
timestamp=2025-11-18T21:00:47.117Z level=INFO fiber=#479 message="âœ… AsyncAPI document validation completed (static method)!"
timestamp=2025-11-18T21:00:47.117Z level=INFO fiber=#479 message="âœ… Document content validation passed!"
timestamp=2025-11-18T21:00:47.117Z level=INFO fiber=#480 message="ğŸ” Validating AsyncAPI document content (23 bytes)"
timestamp=2025-11-18T21:00:47.117Z level=INFO fiber=#480 message="ğŸ” Content preview: { invalid json content}..."
timestamp=2025-11-18T21:00:47.117Z level=INFO fiber=#480 message="ğŸ”§ About to parse JSON..."
timestamp=2025-11-18T21:00:47.117Z level=INFO fiber=#480 message="ğŸ”§ Starting JSON parsing attempt..."
(FiberFailure) SyntaxError: JSON Parse error: Expected '}'
 effect/Runtime/FiberFailure: Symbol(effect/Runtime/FiberFailure),
 effect/Runtime/FiberFailure/Cause: {
  _tag: "Die",
  defect: 334 |   }
335 | };
336 | const forced = {
337 |   effect_internal_function: body => {
338 |     try {
339 |       return body();
      ^
SyntaxError: JSON Parse error: Expected '}'
      at <parse> ()
      at parse (unknown:1:1)
      at effect_internal_function (/Users/larsartmann/projects/typespec-asyncapi/node_modules/effect/dist/esm/Utils.js:339:14)
      at Iterator (/Users/larsartmann/projects/typespec-asyncapi/node_modules/effect/dist/esm/internal/fiberRuntime.js:132:17)
      at runLoop (/Users/larsartmann/projects/typespec-asyncapi/node_modules/effect/dist/esm/internal/fiberRuntime.js:1568:31)
      at evaluateEffect (/Users/larsartmann/projects/typespec-asyncapi/node_modules/effect/dist/esm/internal/fiberRuntime.js:1064:27)
      at start (/Users/larsartmann/projects/typespec-asyncapi/node_modules/effect/dist/esm/internal/fiberRuntime.js:1126:11)
      at /Users/larsartmann/projects/typespec-asyncapi/node_modules/effect/dist/esm/internal/runtime.js:52:18
      at /Users/larsartmann/projects/typespec-asyncapi/node_modules/effect/dist/esm/internal/runtime.js:256:3
      at new Promise (native:1:11)
      at /Users/larsartmann/projects/typespec-asyncapi/node_modules/effect/dist/esm/internal/runtime.js:250:2
      at /Users/larsartmann/projects/typespec-asyncapi/node_modules/effect/dist/esm/internal/runtime.js:217:54
      at /Users/larsartmann/projects/typespec-asyncapi/test/unit/core/ValidationService.test.ts:437:23
      at /Users/larsartmann/projects/typespec-asyncapi/test/unit/core/ValidationService.test.ts:432:18
,
  [Symbol(effect/Cause)]: [Object ...],
  [Symbol(effect/Hash)]: [Function],
  [Symbol(effect/Equal)]: [Function],
  pipe: [Function: pipe],
  toJSON: [Function: toJSON],
  toString: [Function: toString],
  [Symbol(nodejs.util.inspect.custom)]: [Function],
},

      at <parse> (1:1)
      at parse (unknown:1:1)
(fail) ValidationService > validateDocumentContent > should reject invalid JSON content [1.33ms]
timestamp=2025-11-18T21:00:47.119Z level=INFO fiber=#481 message="ğŸ” Validating AsyncAPI document content (20 bytes)"
timestamp=2025-11-18T21:00:47.119Z level=INFO fiber=#481 message="ğŸ” Content preview: {\"asyncapi\":\"3.0.0\"}..."
timestamp=2025-11-18T21:00:47.119Z level=INFO fiber=#481 message="ğŸ”§ About to parse JSON..."
timestamp=2025-11-18T21:00:47.119Z level=INFO fiber=#481 message="ğŸ”§ Starting JSON parsing attempt..."
timestamp=2025-11-18T21:00:47.119Z level=INFO fiber=#481 message="ğŸ”§ Parsed doc type: object, keys: asyncapi"
timestamp=2025-11-18T21:00:47.119Z level=INFO fiber=#481 message="ğŸ” Starting comprehensive AsyncAPI document validation (static method)..."
timestamp=2025-11-18T21:00:47.119Z level=INFO fiber=#481 message="âœ… AsyncAPI document validation completed (static method)!"
timestamp=2025-11-18T21:00:47.119Z level=INFO fiber=#481 message="âŒ Document content validation failed:"
timestamp=2025-11-18T21:00:47.119Z level=INFO fiber=#481 message="  - Missing required field: info"
timestamp=2025-11-18T21:00:47.119Z level=INFO fiber=#481 message="  - Missing required field: info.title"
timestamp=2025-11-18T21:00:47.119Z level=INFO fiber=#481 message="  - Missing required field: info.version"
timestamp=2025-11-18T21:00:47.119Z level=INFO fiber=#481 message="ğŸ”§ Attempting to return sanitized content despite validation errors"
timestamp=2025-11-18T21:00:47.119Z level=INFO fiber=#482 message="ğŸ” Validating AsyncAPI document content (0 bytes)"
timestamp=2025-11-18T21:00:47.119Z level=INFO fiber=#482 message="ğŸ” Content preview: ..."
timestamp=2025-11-18T21:00:47.119Z level=INFO fiber=#482 message="ğŸ”§ About to parse JSON..."
timestamp=2025-11-18T21:00:47.119Z level=INFO fiber=#482 message="ğŸ”§ Starting JSON parsing attempt..."
(FiberFailure) SyntaxError: JSON Parse error: Unexpected EOF
 effect/Runtime/FiberFailure: Symbol(effect/Runtime/FiberFailure),
 effect/Runtime/FiberFailure/Cause: {
  _tag: "Die",
  defect: 334 |   }
335 | };
336 | const forced = {
337 |   effect_internal_function: body => {
338 |     try {
339 |       return body();
      ^
SyntaxError: JSON Parse error: Unexpected EOF
      at <parse> ()
      at parse (unknown:1:1)
      at effect_internal_function (/Users/larsartmann/projects/typespec-asyncapi/node_modules/effect/dist/esm/Utils.js:339:14)
      at Iterator (/Users/larsartmann/projects/typespec-asyncapi/node_modules/effect/dist/esm/internal/fiberRuntime.js:132:17)
      at runLoop (/Users/larsartmann/projects/typespec-asyncapi/node_modules/effect/dist/esm/internal/fiberRuntime.js:1568:31)
      at evaluateEffect (/Users/larsartmann/projects/typespec-asyncapi/node_modules/effect/dist/esm/internal/fiberRuntime.js:1064:27)
      at start (/Users/larsartmann/projects/typespec-asyncapi/node_modules/effect/dist/esm/internal/fiberRuntime.js:1126:11)
      at /Users/larsartmann/projects/typespec-asyncapi/node_modules/effect/dist/esm/internal/runtime.js:52:18
      at /Users/larsartmann/projects/typespec-asyncapi/node_modules/effect/dist/esm/internal/runtime.js:256:3
      at new Promise (native:1:11)
      at /Users/larsartmann/projects/typespec-asyncapi/node_modules/effect/dist/esm/internal/runtime.js:250:2
      at /Users/larsartmann/projects/typespec-asyncapi/node_modules/effect/dist/esm/internal/runtime.js:217:54
      at /Users/larsartmann/projects/typespec-asyncapi/test/unit/core/ValidationService.test.ts:484:19
      at /Users/larsartmann/projects/typespec-asyncapi/test/unit/core/ValidationService.test.ts:479:18
,
  [Symbol(effect/Cause)]: [Object ...],
  [Symbol(effect/Hash)]: [Function],
  [Symbol(effect/Equal)]: [Function],
  pipe: [Function: pipe],
  toJSON: [Function: toJSON],
  toString: [Function: toString],
  [Symbol(nodejs.util.inspect.custom)]: [Function],
},

      at <parse> (1:1)
      at parse (unknown:1:1)
(fail) ValidationService > validateDocumentContent > should handle empty content [0.45ms]
timestamp=2025-11-18T21:00:47.120Z level=INFO fiber=#483 message="âš¡ Quick validation: PASS"
timestamp=2025-11-18T21:00:47.120Z level=INFO fiber=#484 message="âš¡ Quick validation: FAIL"
timestamp=2025-11-18T21:00:47.120Z level=INFO fiber=#485 message="âš¡ Quick validation: PASS"
timestamp=2025-11-18T21:00:47.120Z level=INFO fiber=#486 message="âš¡ Quick validation: PASS"
timestamp=2025-11-18T21:00:47.120Z level=INFO fiber=#487 message="âš¡ Quick validation: FAIL"
timestamp=2025-11-18T21:00:47.121Z level=INFO fiber=#488 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:47.121Z level=INFO fiber=#488 message="âŒ AsyncAPI document validation failed with 1 errors, 3 warnings (0.03ms)"
timestamp=2025-11-18T21:00:47.121Z level=INFO fiber=#489 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:47.121Z level=INFO fiber=#489 message="âœ… AsyncAPI document validation passed! 0 channels, 0 operations (0.03ms)"
timestamp=2025-11-18T21:00:47.121Z level=INFO fiber=#490 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:47.122Z level=INFO fiber=#490 message="âœ… AsyncAPI document validation passed! 100 channels, 100 operations (0.82ms)"
timestamp=2025-11-18T21:00:47.123Z level=INFO fiber=#491 message="ğŸ” Starting comprehensive AsyncAPI document validation..."
timestamp=2025-11-18T21:00:47.123Z level=INFO fiber=#491 message="âœ… AsyncAPI document validation passed! 0 channels, 0 operations (0.06ms)"

test/unit/core/DocumentBuilder.test.ts:
timestamp=2025-11-18T21:00:47.132Z level=INFO fiber=#492 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:47.132Z level=INFO fiber=#492 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:47.132Z level=INFO fiber=#493 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:47.132Z level=INFO fiber=#493 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:47.133Z level=INFO fiber=#494 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:47.133Z level=INFO fiber=#494 message="ğŸ—ï¸  Generated servers: {
  \"testServer\": {
    \"host\": \"localhost:9092\",
    \"protocol\": \"kafka\",
    \"description\": \"Test Kafka server\"
  }
}"
timestamp=2025-11-18T21:00:47.133Z level=INFO fiber=#495 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:47.133Z level=INFO fiber=#495 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:47.133Z level=INFO fiber=#497 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:47.133Z level=INFO fiber=#497 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:47.133Z level=INFO fiber=#499 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:47.133Z level=INFO fiber=#499 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:47.134Z level=INFO fiber=#501 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:47.134Z level=INFO fiber=#501 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:47.135Z level=INFO fiber=#510 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:47.135Z level=INFO fiber=#510 message="ğŸ—ï¸  Generated servers: {}"
timestamp=2025-11-18T21:00:47.135Z level=INFO fiber=#513 message="ğŸ—ï¸  DocumentBuilder.createInitialDocument called with valid program"
timestamp=2025-11-18T21:00:47.135Z level=INFO fiber=#513 message="ğŸ—ï¸  Generated servers: {}"

test/unit/core/ProcessingService.test.ts:
timestamp=2025-11-18T21:00:47.163Z level=INFO fiber=#540 message="ğŸ”„ Processing 2 operations with Effect.TS..."
timestamp=2025-11-18T21:00:47.163Z level=INFO fiber=#540 message="âœ… Processed 2 operations successfully"
34 | 
35 | 			expect(result).toBe(2) // Should return count of processed operations
36 | 
37 | 			// Verify channels were created (using default channel paths since no @channel decorator)
38 | 			expect(baseAsyncApiDoc.channels).toBeDefined()
39 | 			expect(baseAsyncApiDoc.channels["/publishuserevent"]).toBeDefined()
                                                              ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/core/ProcessingService.test.ts:39:58)
(fail) ProcessingService > processOperations > should process operations and update AsyncAPI document [1.61ms]
timestamp=2025-11-18T21:00:47.164Z level=INFO fiber=#541 message="ğŸ”„ Processing 0 operations with Effect.TS..."
timestamp=2025-11-18T21:00:47.164Z level=INFO fiber=#541 message="âœ… Processed 0 operations successfully"
timestamp=2025-11-18T21:00:47.164Z level=INFO fiber=#542 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:47.164Z level=INFO fiber=#542 message="âœ… Processed 1 operations successfully"
67 | 			await Effect.runPromise(
68 | 				ProcessingService.processOperations([testOp], baseAsyncApiDoc, mockProgram)
69 | 			)
70 | 
71 | 			const channel = baseAsyncApiDoc.channels["/testoperation"]
72 | 			expect(channel).toBeDefined()
                        ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/core/ProcessingService.test.ts:72:20)
(fail) ProcessingService > processOperations > should create proper channel structure [0.24ms]
timestamp=2025-11-18T21:00:47.164Z level=INFO fiber=#543 message="ğŸ”„ Processing 2 operations with Effect.TS..."
timestamp=2025-11-18T21:00:47.164Z level=INFO fiber=#543 message="âœ… Processed 2 operations successfully"
89 | 			await Effect.runPromise(
90 | 				ProcessingService.processOperations([publishOp, subscribeOp], baseAsyncApiDoc, mockProgram)
91 | 			)
92 | 
93 | 			const publishOperation = baseAsyncApiDoc.operations["publishEvent"]
94 | 			expect(publishOperation.action).toBe("send")
               ^
TypeError: undefined is not an object (evaluating 'publishOperation.action')
      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/core/ProcessingService.test.ts:94:11)
(fail) ProcessingService > processOperations > should create proper operation structure [0.28ms]
timestamp=2025-11-18T21:00:47.164Z level=INFO fiber=#544 message="ğŸ”„ Processing 1 operations with Effect.TS..."
43 | 		const channelName: ChannelName = channelDefinition.name
44 | 
45 | 		// Convert parameters to JSON schema if present
46 | 		const parameters = operation.parameters?.properties
47 | 			? Array.from(operation.parameters.properties.entries()).map(([paramName, paramModel]) => {
48 | 					const schemaType = paramModel.type.kind === "String" ? "string" :
                                        ^
(FiberFailure) TypeError: undefined is not an object (evaluating 'paramModel.type.kind')
 effect/Runtime/FiberFailure: Symbol(effect/Runtime/FiberFailure),
 effect/Runtime/FiberFailure/Cause: {
  _tag: "Die",
  defect: 43 | 		const channelName: ChannelName = channelDefinition.name
44 | 
45 | 		// Convert parameters to JSON schema if present
46 | 		const parameters = operation.parameters?.properties
47 | 			? Array.from(operation.parameters.properties.entries()).map(([paramName, paramModel]) => {
48 | 					const schemaType = paramModel.type.kind === "String" ? "string" :
                                        ^
TypeError: undefined is not an object (evaluating 'paramModel.type.kind')
      at /Users/larsartmann/projects/typespec-asyncapi/src/domain/emitter/OperationProcessingService.ts:48:36
      at map (native:1:11)
      at /Users/larsartmann/projects/typespec-asyncapi/src/domain/emitter/OperationProcessingService.ts:112:48
      at effect_internal_function (/Users/larsartmann/projects/typespec-asyncapi/node_modules/effect/dist/esm/Utils.js:339:14)
      at Iterator (/Users/larsartmann/projects/typespec-asyncapi/node_modules/effect/dist/esm/internal/fiberRuntime.js:132:17)
      at runLoop (/Users/larsartmann/projects/typespec-asyncapi/node_modules/effect/dist/esm/internal/fiberRuntime.js:1568:31)
      at evaluateEffect (/Users/larsartmann/projects/typespec-asyncapi/node_modules/effect/dist/esm/internal/fiberRuntime.js:1064:27)
      at start (/Users/larsartmann/projects/typespec-asyncapi/node_modules/effect/dist/esm/internal/fiberRuntime.js:1126:11)
      at /Users/larsartmann/projects/typespec-asyncapi/node_modules/effect/dist/esm/internal/runtime.js:52:18
      at /Users/larsartmann/projects/typespec-asyncapi/node_modules/effect/dist/esm/internal/runtime.js:256:3
      at new Promise (native:1:11)
      at /Users/larsartmann/projects/typespec-asyncapi/node_modules/effect/dist/esm/internal/runtime.js:250:2
      at /Users/larsartmann/projects/typespec-asyncapi/node_modules/effect/dist/esm/internal/runtime.js:217:54
      at /Users/larsartmann/projects/typespec-asyncapi/test/unit/core/ProcessingService.test.ts:181:4
      at /Users/larsartmann/projects/typespec-asyncapi/test/unit/core/ProcessingService.test.ts:174:6
,
  [Symbol(effect/Cause)]: [Object ...],
  [Symbol(effect/Hash)]: [Function],
  [Symbol(effect/Equal)]: [Function],
  pipe: [Function: pipe],
  toJSON: [Function: toJSON],
  toString: [Function: toString],
  [Symbol(nodejs.util.inspect.custom)]: [Function],
},

      at /Users/larsartmann/projects/typespec-asyncapi/src/domain/emitter/OperationProcessingService.ts:48:36
      at map (native:1:11)
      at /Users/larsartmann/projects/typespec-asyncapi/src/domain/emitter/OperationProcessingService.ts:112:48
(fail) ProcessingService > processOperations > should create proper message structure [0.62ms]
timestamp=2025-11-18T21:00:47.165Z level=INFO fiber=#545 message="ğŸ¯ Processing 2 message models with functional composition..."
timestamp=2025-11-18T21:00:47.167Z level=INFO fiber=#546 message="ğŸ” Converting model to schema: UserEvent (cache miss)"
timestamp=2025-11-18T21:00:47.167Z level=INFO fiber=#546 message="ğŸ” Converting model to schema: UserEvent (cache miss)"
timestamp=2025-11-18T21:00:47.167Z level=INFO fiber=#546 message="ğŸ” walkPropertiesInherited found 0 properties for model UserEvent"
timestamp=2025-11-18T21:00:47.167Z level=INFO fiber=#546 message="ğŸš¨ ISSUE #180: No properties found for model UserEvent"
timestamp=2025-11-18T21:00:47.167Z level=INFO fiber=#546 message="ğŸ” Model properties direct access: 0"
timestamp=2025-11-18T21:00:47.167Z level=INFO fiber=#546 message="ğŸš¨ Model UserEvent has no accessible properties"
timestamp=2025-11-18T21:00:47.167Z level=INFO fiber=#546 message="âœ… Schema conversion complete for UserEvent: 0 properties, 0 required"
timestamp=2025-11-18T21:00:47.167Z level=INFO fiber=#547 message="ğŸ” Converting model to schema: SystemAlert (cache miss)"
timestamp=2025-11-18T21:00:47.167Z level=INFO fiber=#547 message="ğŸ” Converting model to schema: SystemAlert (cache miss)"
timestamp=2025-11-18T21:00:47.167Z level=INFO fiber=#547 message="ğŸ” walkPropertiesInherited found 0 properties for model SystemAlert"
timestamp=2025-11-18T21:00:47.167Z level=INFO fiber=#547 message="ğŸš¨ ISSUE #180: No properties found for model SystemAlert"
timestamp=2025-11-18T21:00:47.167Z level=INFO fiber=#547 message="ğŸ” Model properties direct access: 0"
timestamp=2025-11-18T21:00:47.167Z level=INFO fiber=#547 message="ğŸš¨ Model SystemAlert has no accessible properties"
timestamp=2025-11-18T21:00:47.167Z level=INFO fiber=#547 message="âœ… Schema conversion complete for SystemAlert: 0 properties, 0 required"
timestamp=2025-11-18T21:00:47.167Z level=INFO fiber=#545 message="Batch emit completed" message="{
  \"processedCount\": 2,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
148 | 			expect(userEventMessage).toBeDefined()
149 | 			expect(userEventMessage.name).toBe("UserEvent")
150 | 			expect(userEventMessage.title).toBe("User Event Message")
151 | 			expect(userEventMessage.description).toBe("User-related events")
152 | 			expect(userEventMessage.contentType).toBe("application/json")
153 | 			expect(userEventMessage.payload).toEqual({ $ref: "#/components/schemas/UserEvent" })
                                          ^
error: expect(received).toEqual(expected)

  {
-   "$ref": "#/components/schemas/UserEvent",
+   "description": "Schema for UserEvent",
+   "properties": {},
+   "type": "object",
  }

- Expected  - 1
+ Received  + 3

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/core/ProcessingService.test.ts:153:37)
(fail) ProcessingService > processMessageModels > should process message models and update AsyncAPI document [2.38ms]
timestamp=2025-11-18T21:00:47.167Z level=INFO fiber=#548 message="ğŸ¯ Processing 1 message models with functional composition..."
timestamp=2025-11-18T21:00:47.167Z level=INFO fiber=#549 message="ğŸ” Converting model to schema: PlainModel (cache miss)"
timestamp=2025-11-18T21:00:47.168Z level=INFO fiber=#549 message="ğŸ” Converting model to schema: PlainModel (cache miss)"
timestamp=2025-11-18T21:00:47.168Z level=INFO fiber=#549 message="ğŸ” walkPropertiesInherited found 0 properties for model PlainModel"
timestamp=2025-11-18T21:00:47.168Z level=INFO fiber=#549 message="ğŸš¨ ISSUE #180: No properties found for model PlainModel"
timestamp=2025-11-18T21:00:47.168Z level=INFO fiber=#549 message="ğŸ” Model properties direct access: 0"
timestamp=2025-11-18T21:00:47.168Z level=INFO fiber=#549 message="ğŸš¨ Model PlainModel has no accessible properties"
timestamp=2025-11-18T21:00:47.168Z level=INFO fiber=#549 message="âœ… Schema conversion complete for PlainModel: 0 properties, 0 required"
timestamp=2025-11-18T21:00:47.168Z level=INFO fiber=#548 message="Batch emit completed" message="{
  \"processedCount\": 1,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
166 | 				ProcessingService.processMessageModels([modelWithoutConfig], baseAsyncApiDoc, mockProgram)
167 | 			)
168 | 
169 | 			expect(result).toBe(1) // Still counts as processed
170 | 			// Should not add message to components (no config found)
171 | 			expect(Object.keys(baseAsyncApiDoc.components?.messages || {})).toHaveLength(0)
                                                                         ^
error: expect(received).toHaveLength(expected)

Expected length: 0
Received length: 1

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/core/ProcessingService.test.ts:171:68)
(fail) ProcessingService > processMessageModels > should handle models without message configs [0.32ms]
timestamp=2025-11-18T21:00:47.168Z level=INFO fiber=#550 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:47.168Z level=INFO fiber=#550 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:47.168Z level=INFO fiber=#551 message="ğŸ¯ Processing 1 message models with functional composition..."
timestamp=2025-11-18T21:00:47.168Z level=INFO fiber=#552 message="ğŸ” Converting model to schema: TestMessage (cache miss)"
timestamp=2025-11-18T21:00:47.168Z level=INFO fiber=#552 message="ğŸ” Converting model to schema: TestMessage (cache miss)"
timestamp=2025-11-18T21:00:47.168Z level=INFO fiber=#552 message="ğŸ” walkPropertiesInherited found 0 properties for model TestMessage"
timestamp=2025-11-18T21:00:47.168Z level=INFO fiber=#552 message="ğŸš¨ ISSUE #180: No properties found for model TestMessage"
timestamp=2025-11-18T21:00:47.168Z level=INFO fiber=#552 message="ğŸ” Model properties direct access: 0"
timestamp=2025-11-18T21:00:47.168Z level=INFO fiber=#552 message="ğŸš¨ Model TestMessage has no accessible properties"
timestamp=2025-11-18T21:00:47.168Z level=INFO fiber=#552 message="âœ… Schema conversion complete for TestMessage: 0 properties, 0 required"
timestamp=2025-11-18T21:00:47.168Z level=INFO fiber=#551 message="Batch emit completed" message="{
  \"processedCount\": 1,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:47.168Z level=INFO fiber=#553 message="ğŸ” Processing 2 security configurations with functional composition..."
timestamp=2025-11-18T21:00:47.168Z level=INFO fiber=#553 message="ğŸ“Š Processed 2 security configurations successfully"
234 | 
235 | 			// Verify security schemes were created
236 | 			const apiKeyScheme = baseAsyncApiDoc.components?.securitySchemes?.["apiKeyAuth"]
237 | 			expect(apiKeyScheme).toBeDefined()
238 | 			expect(apiKeyScheme.type).toBe("apiKey")
239 | 			expect(apiKeyScheme.description).toBe("API Key authentication")
                                          ^
error: expect(received).toBe(expected)

Expected: "API Key authentication"
Received: "API Key security: apiKeyAuth"

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/core/ProcessingService.test.ts:239:37)
(fail) ProcessingService > processSecurityConfigs > should process security configurations [0.49ms]
timestamp=2025-11-18T21:00:47.169Z level=INFO fiber=#554 message="ğŸ” Processing 1 security configurations with functional composition..."
timestamp=2025-11-18T21:00:47.169Z level=INFO fiber=#554 message="ğŸ“Š Processed 1 security configurations successfully"
timestamp=2025-11-18T21:00:47.169Z level=INFO fiber=#555 message="ğŸ” Processing 1 security configurations with functional composition..."
timestamp=2025-11-18T21:00:47.169Z level=INFO fiber=#555 message="ğŸ“Š Processed 1 security configurations successfully"
281 | 
282 | 			// Should fallback to apiKey
283 | 			const scheme = baseAsyncApiDoc.components?.securitySchemes?.["unknownAuth"]
284 | 			expect(scheme).toBeDefined()
285 | 			expect(scheme.type).toBe("apiKey")
286 | 			expect(scheme.in).toBe("user")
                           ^
error: expect(received).toBe(expected)

Expected: "user"
Received: "header"

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/core/ProcessingService.test.ts:286:22)
(fail) ProcessingService > processSecurityConfigs > should handle unknown security scheme types [0.58ms]
timestamp=2025-11-18T21:00:47.169Z level=INFO fiber=#556 message="ğŸ” Processing 1 security configurations with functional composition..."
timestamp=2025-11-18T21:00:47.170Z level=INFO fiber=#556 message="ğŸ“Š Processed 1 security configurations successfully"
timestamp=2025-11-18T21:00:47.170Z level=INFO fiber=#557 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:47.170Z level=INFO fiber=#557 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:47.170Z level=INFO fiber=#558 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:47.170Z level=INFO fiber=#558 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:47.170Z level=INFO fiber=#558 message="âœ… Processed 1 operations successfully"
timestamp=2025-11-18T21:00:47.170Z level=INFO fiber=#558 message="ğŸ¯ Processing 1 message models with functional composition..."
timestamp=2025-11-18T21:00:47.170Z level=INFO fiber=#559 message="ğŸ” Converting model to schema: TestMessage (cache miss)"
timestamp=2025-11-18T21:00:47.170Z level=INFO fiber=#559 message="ğŸ” Converting model to schema: TestMessage (cache miss)"
timestamp=2025-11-18T21:00:47.170Z level=INFO fiber=#559 message="ğŸ” walkPropertiesInherited found 0 properties for model TestMessage"
timestamp=2025-11-18T21:00:47.170Z level=INFO fiber=#559 message="ğŸš¨ ISSUE #180: No properties found for model TestMessage"
timestamp=2025-11-18T21:00:47.170Z level=INFO fiber=#559 message="ğŸ” Model properties direct access: 0"
timestamp=2025-11-18T21:00:47.170Z level=INFO fiber=#559 message="ğŸš¨ Model TestMessage has no accessible properties"
timestamp=2025-11-18T21:00:47.170Z level=INFO fiber=#559 message="âœ… Schema conversion complete for TestMessage: 0 properties, 0 required"
timestamp=2025-11-18T21:00:47.170Z level=INFO fiber=#558 message="Batch emit completed" message="{
  \"processedCount\": 1,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:47.170Z level=INFO fiber=#558 message="ğŸ” Processing 1 security configurations with functional composition..."
timestamp=2025-11-18T21:00:47.170Z level=INFO fiber=#558 message="ğŸ“Š Processed 1 security configurations successfully"
timestamp=2025-11-18T21:00:47.170Z level=INFO fiber=#558 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 1,
  \"messagesProcessed\": 1,
  \"securityProcessed\": 1,
  \"totalProcessed\": 3
}"
340 | 					mockProgram
341 | 				)
342 | 			)
343 | 
344 | 			expect(result.operationsProcessed).toBe(1)
345 | 			expect(result.messageModelsProcessed).toBe(1)
                                               ^
error: expect(received).toBe(expected)

Expected: 1
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/core/ProcessingService.test.ts:345:42)
(fail) ProcessingService > executeProcessing > should execute complete processing pipeline [0.85ms]
timestamp=2025-11-18T21:00:47.171Z level=INFO fiber=#560 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:47.171Z level=INFO fiber=#560 message="ğŸ”„ Processing 0 operations with Effect.TS..."
timestamp=2025-11-18T21:00:47.172Z level=INFO fiber=#560 message="âœ… Processed 0 operations successfully"
timestamp=2025-11-18T21:00:47.172Z level=INFO fiber=#560 message="ğŸ¯ Processing 0 message models with functional composition..."
timestamp=2025-11-18T21:00:47.172Z level=INFO fiber=#560 message="Batch emit completed" message="{
  \"processedCount\": 0,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:47.172Z level=INFO fiber=#560 message="ğŸ” Processing 0 security configurations with functional composition..."
timestamp=2025-11-18T21:00:47.172Z level=INFO fiber=#560 message="ğŸ“Š Processed 0 security configurations successfully"
timestamp=2025-11-18T21:00:47.172Z level=INFO fiber=#560 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 0,
  \"messagesProcessed\": 0,
  \"securityProcessed\": 0,
  \"totalProcessed\": 0
}"
356 | 			const result = await Effect.runPromise(
357 | 				ProcessingService.executeProcessing([], [], [], baseAsyncApiDoc, mockProgram)
358 | 			)
359 | 
360 | 			expect(result.operationsProcessed).toBe(0)
361 | 			expect(result.messageModelsProcessed).toBe(0)
                                               ^
error: expect(received).toBe(expected)

Expected: 0
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/core/ProcessingService.test.ts:361:42)
(fail) ProcessingService > executeProcessing > should handle empty processing inputs [1.54ms]
timestamp=2025-11-18T21:00:47.173Z level=INFO fiber=#561 message="ğŸš€ Orchestrating complete TypeSpec to AsyncAPI transformation..."
timestamp=2025-11-18T21:00:47.173Z level=INFO fiber=#561 message="ğŸ”„ Processing 20 operations with Effect.TS..."
timestamp=2025-11-18T21:00:47.173Z level=INFO fiber=#561 message="âœ… Processed 20 operations successfully"
timestamp=2025-11-18T21:00:47.173Z level=INFO fiber=#561 message="ğŸ¯ Processing 10 message models with functional composition..."
timestamp=2025-11-18T21:00:47.173Z level=INFO fiber=#562 message="ğŸ” Converting model to schema: Message0 (cache miss)"
timestamp=2025-11-18T21:00:47.173Z level=INFO fiber=#562 message="ğŸ” Converting model to schema: Message0 (cache miss)"
timestamp=2025-11-18T21:00:47.173Z level=INFO fiber=#562 message="ğŸ” walkPropertiesInherited found 0 properties for model Message0"
timestamp=2025-11-18T21:00:47.173Z level=INFO fiber=#562 message="ğŸš¨ ISSUE #180: No properties found for model Message0"
timestamp=2025-11-18T21:00:47.173Z level=INFO fiber=#562 message="ğŸ” Model properties direct access: 0"
timestamp=2025-11-18T21:00:47.173Z level=INFO fiber=#562 message="ğŸš¨ Model Message0 has no accessible properties"
timestamp=2025-11-18T21:00:47.173Z level=INFO fiber=#562 message="âœ… Schema conversion complete for Message0: 0 properties, 0 required"
timestamp=2025-11-18T21:00:47.173Z level=INFO fiber=#563 message="ğŸ” Converting model to schema: Message1 (cache miss)"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#563 message="ğŸ” Converting model to schema: Message1 (cache miss)"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#563 message="ğŸ” walkPropertiesInherited found 0 properties for model Message1"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#563 message="ğŸš¨ ISSUE #180: No properties found for model Message1"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#563 message="ğŸ” Model properties direct access: 0"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#563 message="ğŸš¨ Model Message1 has no accessible properties"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#563 message="âœ… Schema conversion complete for Message1: 0 properties, 0 required"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#564 message="ğŸ” Converting model to schema: Message2 (cache miss)"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#564 message="ğŸ” Converting model to schema: Message2 (cache miss)"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#564 message="ğŸ” walkPropertiesInherited found 0 properties for model Message2"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#564 message="ğŸš¨ ISSUE #180: No properties found for model Message2"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#564 message="ğŸ” Model properties direct access: 0"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#564 message="ğŸš¨ Model Message2 has no accessible properties"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#564 message="âœ… Schema conversion complete for Message2: 0 properties, 0 required"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#565 message="ğŸ” Converting model to schema: Message3 (cache miss)"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#565 message="ğŸ” Converting model to schema: Message3 (cache miss)"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#565 message="ğŸ” walkPropertiesInherited found 0 properties for model Message3"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#565 message="ğŸš¨ ISSUE #180: No properties found for model Message3"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#565 message="ğŸ” Model properties direct access: 0"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#565 message="ğŸš¨ Model Message3 has no accessible properties"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#565 message="âœ… Schema conversion complete for Message3: 0 properties, 0 required"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#566 message="ğŸ” Converting model to schema: Message4 (cache miss)"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#566 message="ğŸ” Converting model to schema: Message4 (cache miss)"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#566 message="ğŸ” walkPropertiesInherited found 0 properties for model Message4"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#566 message="ğŸš¨ ISSUE #180: No properties found for model Message4"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#566 message="ğŸ” Model properties direct access: 0"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#566 message="ğŸš¨ Model Message4 has no accessible properties"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#566 message="âœ… Schema conversion complete for Message4: 0 properties, 0 required"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#567 message="ğŸ” Converting model to schema: Message5 (cache miss)"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#567 message="ğŸ” Converting model to schema: Message5 (cache miss)"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#567 message="ğŸ” walkPropertiesInherited found 0 properties for model Message5"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#567 message="ğŸš¨ ISSUE #180: No properties found for model Message5"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#567 message="ğŸ” Model properties direct access: 0"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#567 message="ğŸš¨ Model Message5 has no accessible properties"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#567 message="âœ… Schema conversion complete for Message5: 0 properties, 0 required"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#568 message="ğŸ” Converting model to schema: Message6 (cache miss)"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#568 message="ğŸ” Converting model to schema: Message6 (cache miss)"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#568 message="ğŸ” walkPropertiesInherited found 0 properties for model Message6"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#568 message="ğŸš¨ ISSUE #180: No properties found for model Message6"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#568 message="ğŸ” Model properties direct access: 0"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#568 message="ğŸš¨ Model Message6 has no accessible properties"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#568 message="âœ… Schema conversion complete for Message6: 0 properties, 0 required"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#569 message="ğŸ” Converting model to schema: Message7 (cache miss)"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#569 message="ğŸ” Converting model to schema: Message7 (cache miss)"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#569 message="ğŸ” walkPropertiesInherited found 0 properties for model Message7"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#569 message="ğŸš¨ ISSUE #180: No properties found for model Message7"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#569 message="ğŸ” Model properties direct access: 0"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#569 message="ğŸš¨ Model Message7 has no accessible properties"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#569 message="âœ… Schema conversion complete for Message7: 0 properties, 0 required"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#570 message="ğŸ” Converting model to schema: Message8 (cache miss)"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#570 message="ğŸ” Converting model to schema: Message8 (cache miss)"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#570 message="ğŸ” walkPropertiesInherited found 0 properties for model Message8"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#570 message="ğŸš¨ ISSUE #180: No properties found for model Message8"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#570 message="ğŸ” Model properties direct access: 0"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#570 message="ğŸš¨ Model Message8 has no accessible properties"
timestamp=2025-11-18T21:00:47.174Z level=INFO fiber=#570 message="âœ… Schema conversion complete for Message8: 0 properties, 0 required"
timestamp=2025-11-18T21:00:47.175Z level=INFO fiber=#571 message="ğŸ” Converting model to schema: Message9 (cache miss)"
timestamp=2025-11-18T21:00:47.175Z level=INFO fiber=#571 message="ğŸ” Converting model to schema: Message9 (cache miss)"
timestamp=2025-11-18T21:00:47.175Z level=INFO fiber=#571 message="ğŸ” walkPropertiesInherited found 0 properties for model Message9"
timestamp=2025-11-18T21:00:47.175Z level=INFO fiber=#571 message="ğŸš¨ ISSUE #180: No properties found for model Message9"
timestamp=2025-11-18T21:00:47.175Z level=INFO fiber=#571 message="ğŸ” Model properties direct access: 0"
timestamp=2025-11-18T21:00:47.175Z level=INFO fiber=#571 message="ğŸš¨ Model Message9 has no accessible properties"
timestamp=2025-11-18T21:00:47.175Z level=INFO fiber=#571 message="âœ… Schema conversion complete for Message9: 0 properties, 0 required"
timestamp=2025-11-18T21:00:47.175Z level=INFO fiber=#561 message="Batch emit completed" message="{
  \"processedCount\": 10,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
timestamp=2025-11-18T21:00:47.175Z level=INFO fiber=#561 message="ğŸ” Processing 5 security configurations with functional composition..."
timestamp=2025-11-18T21:00:47.175Z level=INFO fiber=#561 message="ğŸ“Š Processed 5 security configurations successfully"
timestamp=2025-11-18T21:00:47.175Z level=INFO fiber=#561 message="âœ… Complete transformation orchestrated" message="{
  \"operationsProcessed\": 20,
  \"messagesProcessed\": 10,
  \"securityProcessed\": 5,
  \"totalProcessed\": 35
}"
388 | 					mockProgram
389 | 				)
390 | 			)
391 | 
392 | 			expect(result.operationsProcessed).toBe(20)
393 | 			expect(result.messageModelsProcessed).toBe(10)
                                               ^
error: expect(received).toBe(expected)

Expected: 10
Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/core/ProcessingService.test.ts:393:42)
(fail) ProcessingService > executeProcessing > should handle large-scale processing [3.83ms]
timestamp=2025-11-18T21:00:47.176Z level=INFO fiber=#572 message="ğŸ”„ Processing 1 operations with Effect.TS..."
timestamp=2025-11-18T21:00:47.176Z level=INFO fiber=#572 message="âœ… Processed 1 operations successfully"
406 | 
407 | 			expect(result).toBe(1) // Should still process
408 | 
409 | 			// Should create default channel path
410 | 			const channel = baseAsyncApiDoc.channels["/missingmetadataop"]
411 | 			expect(channel).toBeDefined()
                         ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/core/ProcessingService.test.ts:411:20)
(fail) ProcessingService > error handling > should handle operations with missing metadata gracefully [0.46ms]
timestamp=2025-11-18T21:00:47.177Z level=INFO fiber=#573 message="ğŸ¯ Processing 1 message models with functional composition..."
timestamp=2025-11-18T21:00:47.177Z level=INFO fiber=#574 message="ğŸ” Converting model to schema: NoConfigModel (cache miss)"
timestamp=2025-11-18T21:00:47.177Z level=INFO fiber=#574 message="ğŸ” Converting model to schema: NoConfigModel (cache miss)"
timestamp=2025-11-18T21:00:47.177Z level=INFO fiber=#574 message="ğŸ” walkPropertiesInherited found 0 properties for model NoConfigModel"
timestamp=2025-11-18T21:00:47.177Z level=INFO fiber=#574 message="ğŸš¨ ISSUE #180: No properties found for model NoConfigModel"
timestamp=2025-11-18T21:00:47.177Z level=INFO fiber=#574 message="ğŸ” Model properties direct access: 0"
timestamp=2025-11-18T21:00:47.177Z level=INFO fiber=#574 message="ğŸš¨ Model NoConfigModel has no accessible properties"
timestamp=2025-11-18T21:00:47.177Z level=INFO fiber=#574 message="âœ… Schema conversion complete for NoConfigModel: 0 properties, 0 required"
timestamp=2025-11-18T21:00:47.177Z level=INFO fiber=#573 message="Batch emit completed" message="{
  \"processedCount\": 1,
  \"throughput\": \"0 contexts/sec\",
  \"totalDuration\": \"0.00ms\"
}"
418 | 			const result = await Effect.runPromise(
419 | 				ProcessingService.processMessageModels([modelWithoutConfig], baseAsyncApiDoc, mockProgram)
420 | 			)
421 | 
422 | 			expect(result).toBe(1) // Still counts as processed
423 | 			expect(Object.keys(baseAsyncApiDoc.components?.messages || {})).toHaveLength(0)
                                                                         ^
error: expect(received).toHaveLength(expected)

Expected length: 0
Received length: 1

      at <anonymous> (/Users/larsartmann/projects/typespec-asyncapi/test/unit/core/ProcessingService.test.ts:423:68)
(fail) ProcessingService > error handling > should handle models without message configs [0.43ms]
timestamp=2025-11-18T21:00:47.177Z level=INFO fiber=#575 message="ğŸ” Processing 1 security configurations with functional composition..."
timestamp=2025-11-18T21:00:47.177Z level=INFO fiber=#575 message="ğŸ“Š Processed 1 security configurations successfully"

 363 pass
 29 skip
 344 fail
 12 errors
 1514 expect() calls
Ran 736 tests across 76 files. [83.17s]
